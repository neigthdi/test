import{r as xe,c as Ae}from"./babylon.yvSPI_6S.js";var Re={exports:{}};(function(Me,be){(function(Fe,ye){Me.exports=ye(xe())})(typeof self<"u"?self:typeof Ae<"u"?Ae:Ae,Le=>(()=>{var Fe={"../../../dev/loaders/src/OBJ/index.ts":(w,M,d)=>{d.r(M),d.d(M,{MTLFileLoader:()=>f.MTLFileLoader,OBJFileLoader:()=>m.OBJFileLoader,SolidParser:()=>c.SolidParser});var f=d("../../../dev/loaders/src/OBJ/mtlFileLoader.ts");d("../../../dev/loaders/src/OBJ/objLoadingOptions.ts");var c=d("../../../dev/loaders/src/OBJ/solidParser.ts"),m=d("../../../dev/loaders/src/OBJ/objFileLoader.ts")},"../../../dev/loaders/src/OBJ/mtlFileLoader.ts":(w,M,d)=>{d.r(M),d.d(M,{MTLFileLoader:()=>c});var f=d("babylonjs/Misc/tools"),c=function(){function m(){this.materials=[]}return m.prototype.parseMTL=function(p,T,a,i){if(!(T instanceof ArrayBuffer)){for(var l=T.split(`
`),r=/\s+/,t,e=null,n=0;n<l.length;n++){var o=l[n].trim();if(!(o.length===0||o.charAt(0)==="#")){var s=o.indexOf(" "),u=s>=0?o.substring(0,s):o;u=u.toLowerCase();var _=s>=0?o.substring(s+1).trim():"";if(u==="newmtl")e&&this.materials.push(e),p._blockEntityCollection=!!i,e=new f.StandardMaterial(_,p),e._parentContainer=i,p._blockEntityCollection=!1;else if(u==="kd"&&e)t=_.split(r,3).map(parseFloat),e.diffuseColor=f.Color3.FromArray(t);else if(u==="ka"&&e)t=_.split(r,3).map(parseFloat),e.ambientColor=f.Color3.FromArray(t);else if(u==="ks"&&e)t=_.split(r,3).map(parseFloat),e.specularColor=f.Color3.FromArray(t);else if(u==="ke"&&e)t=_.split(r,3).map(parseFloat),e.emissiveColor=f.Color3.FromArray(t);else if(u==="ns"&&e)e.specularPower=parseFloat(_);else if(u==="d"&&e)e.alpha=parseFloat(_);else if(u==="map_ka"&&e)e.ambientTexture=m._GetTexture(a,_,p);else if(u==="map_kd"&&e)e.diffuseTexture=m._GetTexture(a,_,p);else if(u==="map_ks"&&e)e.specularTexture=m._GetTexture(a,_,p);else if(u!=="map_ns")if(u==="map_bump"&&e){var g=_.split(r),O=g.indexOf("-bm"),y=null;O>=0&&(y=g[O+1],g.splice(O,2)),e.bumpTexture=m._GetTexture(a,g.join(" "),p),e.bumpTexture&&y!==null&&(e.bumpTexture.level=parseFloat(y))}else u==="map_d"&&e&&(e.opacityTexture=m._GetTexture(a,_,p))}}e&&this.materials.push(e)}},m._GetTexture=function(p,T,a){if(!T)return null;var i=p;if(p==="file:"){var l=T.lastIndexOf("\\");l===-1&&(l=T.lastIndexOf("/")),l>-1?i+=T.substring(l+1):i+=T}else i+=T;return new f.Texture(i,a,!1,m.INVERT_TEXTURE_Y)},m.INVERT_TEXTURE_Y=!0,m}()},"../../../dev/loaders/src/OBJ/objFileLoader.metadata.ts":(w,M,d)=>{d.r(M),d.d(M,{OBJFileLoaderMetadata:()=>f});var f={name:"obj",extensions:".obj"}},"../../../dev/loaders/src/OBJ/objFileLoader.ts":(w,M,d)=>{d.r(M),d.d(M,{OBJFileLoader:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/OBJ/objFileLoader.metadata.ts"),m=d("../../../dev/loaders/src/OBJ/mtlFileLoader.ts"),p=d("../../../dev/loaders/src/OBJ/solidParser.ts"),T=function(){function a(i){this.name=c.OBJFileLoaderMetadata.name,this.extensions=c.OBJFileLoaderMetadata.extensions,this._assetContainer=null,this._loadingOptions=i||a._DefaultLoadingOptions}return Object.defineProperty(a,"INVERT_TEXTURE_Y",{get:function(){return m.MTLFileLoader.INVERT_TEXTURE_Y},set:function(i){m.MTLFileLoader.INVERT_TEXTURE_Y=i},enumerable:!1,configurable:!0}),Object.defineProperty(a,"_DefaultLoadingOptions",{get:function(){return{computeNormals:a.COMPUTE_NORMALS,optimizeNormals:a.OPTIMIZE_NORMALS,importVertexColors:a.IMPORT_VERTEX_COLORS,invertY:a.INVERT_Y,invertTextureY:a.INVERT_TEXTURE_Y,UVScaling:a.UV_SCALING,materialLoadingFailsSilently:a.MATERIAL_LOADING_FAILS_SILENTLY,optimizeWithUV:a.OPTIMIZE_WITH_UV,skipMaterials:a.SKIP_MATERIALS,useLegacyBehavior:a.USE_LEGACY_BEHAVIOR}},enumerable:!1,configurable:!0}),a.prototype._loadMTL=function(i,l,r,t){var e=l+i;f.Tools.LoadFile(e,r,void 0,void 0,!1,function(n,o){t(e,o)})},a.prototype.createPlugin=function(){return new a(a._DefaultLoadingOptions)},a.prototype.canDirectLoad=function(){return!1},a.prototype.importMeshAsync=function(i,l,r,t){return this._parseSolid(i,l,r,t).then(function(e){return{meshes:e,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[],spriteManagers:[]}})},a.prototype.loadAsync=function(i,l,r){return this.importMeshAsync(null,i,l,r).then(function(){})},a.prototype.loadAssetContainerAsync=function(i,l,r){var t=this,e=new f.AssetContainer(i);return this._assetContainer=e,this.importMeshAsync(null,i,l,r).then(function(n){return n.meshes.forEach(function(o){return e.meshes.push(o)}),n.meshes.forEach(function(o){var s=o.material;if(s&&e.materials.indexOf(s)==-1){e.materials.push(s);var u=s.getActiveTextures();u.forEach(function(_){e.textures.indexOf(_)==-1&&e.textures.push(_)})}}),t._assetContainer=null,e}).catch(function(n){throw t._assetContainer=null,n})},a.prototype._parseSolid=function(i,l,r,t){var e=this,n="",o=new m.MTLFileLoader,s=[],u=[];r=r.replace(/#.*$/gm,"").trim();var _=new p.SolidParser(s,u,this._loadingOptions);_.parse(i,r,l,this._assetContainer,function(O){n=O});var g=[];return n!==""&&!this._loadingOptions.skipMaterials&&g.push(new Promise(function(O,y){e._loadMTL(n,t,function(E){try{o.parseMTL(l,E,t,e._assetContainer);for(var P=0;P<o.materials.length;P++){for(var x=0,B=[],K=void 0;(K=s.indexOf(o.materials[P].name,x))>-1;)B.push(K),x=K+1;if(K===-1&&B.length===0)o.materials[P].dispose();else for(var I=0;I<B.length;I++){var S=u[B[I]],H=o.materials[P];S.material=H,S.getTotalIndices()||(H.pointsCloud=!0)}}O()}catch(Y){f.Tools.Warn("Error processing MTL file: '".concat(n,"'")),e._loadingOptions.materialLoadingFailsSilently?O():y(Y)}},function(E,P){f.Tools.Warn("Error downloading MTL file: '".concat(n,"'")),e._loadingOptions.materialLoadingFailsSilently?O():y(P)})})),Promise.all(g).then(function(){var O=function(y){var E,P;return!!((P=(E=y._internalMetadata)===null||E===void 0?void 0:E._isLine)!==null&&P!==void 0&&P)};return u.forEach(function(y){var E,P;if(O(y)){var x=(E=y.material)!==null&&E!==void 0?E:new f.StandardMaterial(y.name+"_line",l),B=x.getBindedMeshes().filter(function(K){return!O(K)}).length>0;B&&(x=(P=x.clone(x.name+"_line"))!==null&&P!==void 0?P:x),x.wireframe=!0,y.material=x,y._internalMetadata&&(y._internalMetadata._isLine=void 0)}}),u})},a.OPTIMIZE_WITH_UV=!0,a.INVERT_Y=!1,a.IMPORT_VERTEX_COLORS=!1,a.COMPUTE_NORMALS=!1,a.OPTIMIZE_NORMALS=!1,a.UV_SCALING=new f.Vector2(1,1),a.SKIP_MATERIALS=!1,a.MATERIAL_LOADING_FAILS_SILENTLY=!0,a.USE_LEGACY_BEHAVIOR=!1,a}();(0,f.registerSceneLoaderPlugin)(new T)},"../../../dev/loaders/src/OBJ/objLoadingOptions.ts":(w,M,d)=>{d.r(M)},"../../../dev/loaders/src/OBJ/solidParser.ts":(w,M,d)=>{d.r(M),d.d(M,{SolidParser:()=>c});var f=d("babylonjs/Misc/tools"),c=function(){function m(p,T,a){this._positions=[],this._normals=[],this._uvs=[],this._colors=[],this._extColors=[],this._meshesFromObj=[],this._indicesForBabylon=[],this._wrappedPositionForBabylon=[],this._wrappedUvsForBabylon=[],this._wrappedColorsForBabylon=[],this._wrappedNormalsForBabylon=[],this._tuplePosNorm=[],this._curPositionInIndices=0,this._hasMeshes=!1,this._unwrappedPositionsForBabylon=[],this._unwrappedColorsForBabylon=[],this._unwrappedNormalsForBabylon=[],this._unwrappedUVForBabylon=[],this._triangles=[],this._materialNameFromObj="",this._objMeshName="",this._increment=1,this._isFirstMaterial=!0,this._grayColor=new f.Color4(.5,.5,.5,1),this._hasLineData=!1,this._materialToUse=p,this._babylonMeshesArray=T,this._loadingOptions=a}return m.prototype._isInArray=function(p,T){p[T[0]]||(p[T[0]]={normals:[],idx:[]});var a=p[T[0]].normals.indexOf(T[1]);return a===-1?-1:p[T[0]].idx[a]},m.prototype._isInArrayUV=function(p,T){p[T[0]]||(p[T[0]]={normals:[],idx:[],uv:[]});var a=p[T[0]].normals.indexOf(T[1]);return a!=1&&T[2]===p[T[0]].uv[a]?p[T[0]].idx[a]:-1},m.prototype._setData=function(p,T,a,i,l,r,t){var e;this._loadingOptions.optimizeWithUV?e=this._isInArrayUV(this._tuplePosNorm,[p,a,T]):e=this._isInArray(this._tuplePosNorm,[p,a]),e===-1?(this._indicesForBabylon.push(this._wrappedPositionForBabylon.length),this._wrappedPositionForBabylon.push(i),l=l??new f.Vector2(0,0),this._wrappedUvsForBabylon.push(l),this._wrappedNormalsForBabylon.push(r),t!==void 0&&this._wrappedColorsForBabylon.push(t),this._tuplePosNorm[p].normals.push(a),this._tuplePosNorm[p].idx.push(this._curPositionInIndices++),this._loadingOptions.optimizeWithUV&&this._tuplePosNorm[p].uv.push(T)):this._indicesForBabylon.push(e)},m.prototype._unwrapData=function(){try{for(var p=0;p<this._wrappedPositionForBabylon.length;p++)this._unwrappedPositionsForBabylon.push(this._wrappedPositionForBabylon[p].x*this._handednessSign,this._wrappedPositionForBabylon[p].y,this._wrappedPositionForBabylon[p].z),this._unwrappedNormalsForBabylon.push(this._wrappedNormalsForBabylon[p].x*this._handednessSign,this._wrappedNormalsForBabylon[p].y,this._wrappedNormalsForBabylon[p].z),this._unwrappedUVForBabylon.push(this._wrappedUvsForBabylon[p].x,this._wrappedUvsForBabylon[p].y),this._loadingOptions.importVertexColors&&this._unwrappedColorsForBabylon.push(this._wrappedColorsForBabylon[p].r,this._wrappedColorsForBabylon[p].g,this._wrappedColorsForBabylon[p].b,this._wrappedColorsForBabylon[p].a);this._wrappedPositionForBabylon.length=0,this._wrappedNormalsForBabylon.length=0,this._wrappedUvsForBabylon.length=0,this._wrappedColorsForBabylon.length=0,this._tuplePosNorm.length=0,this._curPositionInIndices=0}catch{throw new Error("Unable to unwrap data while parsing OBJ data.")}},m.prototype._getTriangles=function(p,T){for(var a=T;a<p.length-1;a++)this._pushTriangle(p,a)},m.prototype._getColor=function(p){var T;if(this._loadingOptions.importVertexColors)return(T=this._extColors[p])!==null&&T!==void 0?T:this._colors[p]},m.prototype._setDataForCurrentFaceWithPattern1=function(p,T){this._getTriangles(p,T);for(var a=0;a<this._triangles.length;a++){var i=parseInt(this._triangles[a])-1;this._setData(i,0,0,this._positions[i],f.Vector2.Zero(),f.Vector3.Up(),this._getColor(i))}this._triangles.length=0},m.prototype._setDataForCurrentFaceWithPattern2=function(p,T){var a;this._getTriangles(p,T);for(var i=0;i<this._triangles.length;i++){var l=this._triangles[i].split("/"),r=parseInt(l[0])-1,t=parseInt(l[1])-1;this._setData(r,t,0,this._positions[r],(a=this._uvs[t])!==null&&a!==void 0?a:f.Vector2.Zero(),f.Vector3.Up(),this._getColor(r))}this._triangles.length=0},m.prototype._setDataForCurrentFaceWithPattern3=function(p,T){var a,i;this._getTriangles(p,T);for(var l=0;l<this._triangles.length;l++){var r=this._triangles[l].split("/"),t=parseInt(r[0])-1,e=parseInt(r[1])-1,n=parseInt(r[2])-1;this._setData(t,e,n,this._positions[t],(a=this._uvs[e])!==null&&a!==void 0?a:f.Vector2.Zero(),(i=this._normals[n])!==null&&i!==void 0?i:f.Vector3.Up())}this._triangles.length=0},m.prototype._setDataForCurrentFaceWithPattern4=function(p,T){this._getTriangles(p,T);for(var a=0;a<this._triangles.length;a++){var i=this._triangles[a].split("//"),l=parseInt(i[0])-1,r=parseInt(i[1])-1;this._setData(l,1,r,this._positions[l],f.Vector2.Zero(),this._normals[r],this._getColor(l))}this._triangles.length=0},m.prototype._setDataForCurrentFaceWithPattern5=function(p,T){this._getTriangles(p,T);for(var a=0;a<this._triangles.length;a++){var i=this._triangles[a].split("/"),l=this._positions.length+parseInt(i[0]),r=this._uvs.length+parseInt(i[1]),t=this._normals.length+parseInt(i[2]);this._setData(l,r,t,this._positions[l],this._uvs[r],this._normals[t],this._getColor(l))}this._triangles.length=0},m.prototype._addPreviousObjMesh=function(){this._meshesFromObj.length>0&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._unwrapData(),this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._handledMesh.indices=this._indicesForBabylon.slice(),this._handledMesh.positions=this._unwrappedPositionsForBabylon.slice(),this._handledMesh.normals=this._unwrappedNormalsForBabylon.slice(),this._handledMesh.uvs=this._unwrappedUVForBabylon.slice(),this._handledMesh.hasLines=this._hasLineData,this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon.slice()),this._indicesForBabylon.length=0,this._unwrappedPositionsForBabylon.length=0,this._unwrappedColorsForBabylon.length=0,this._unwrappedNormalsForBabylon.length=0,this._unwrappedUVForBabylon.length=0,this._hasLineData=!1)},m.prototype._optimizeNormals=function(p){var T=p.getVerticesData(f.VertexBuffer.PositionKind),a=p.getVerticesData(f.VertexBuffer.NormalKind),i={};if(!(!T||!a)){for(var l=0;l<T.length/3;l++){var r=T[l*3+0],t=T[l*3+1],e=T[l*3+2],n=r+"_"+t+"_"+e,o=i[n];o||(o=[],i[n]=o),o.push(l)}var s=new f.Vector3;for(var n in i){var o=i[n];if(!(o.length<2)){for(var u=o[0],l=1;l<o.length;++l){var _=o[l];a[u*3+0]+=a[_*3+0],a[u*3+1]+=a[_*3+1],a[u*3+2]+=a[_*3+2]}s.copyFromFloats(a[u*3+0],a[u*3+1],a[u*3+2]),s.normalize();for(var l=0;l<o.length;++l){var _=o[l];a[_*3+0]=s.x,a[_*3+1]=s.y,a[_*3+2]=s.z}}}p.setVerticesData(f.VertexBuffer.NormalKind,a)}},m._IsLineElement=function(p){return p.startsWith("l")},m._IsObjectElement=function(p){return p.startsWith("o")},m._IsGroupElement=function(p){return p.startsWith("g")},m._GetZbrushMRGB=function(p,T){if(!p.startsWith("mrgb"))return null;if(p=p.replace("mrgb","").trim(),T)return[];var a=/[a-z0-9]/g,i=p.match(a);if(!i||i.length%8!==0)return[];for(var l=[],r=0;r<i.length/8;r++){var t=i[r*8+2]+i[r*8+3],e=i[r*8+4]+i[r*8+5],n=i[r*8+6]+i[r*8+7];l.push(new f.Color4(parseInt(t,16)/255,parseInt(e,16)/255,parseInt(n,16)/255,1))}return l},m.prototype.parse=function(p,T,a,i,l){var r=this,t,e;T=T.replace(/#MRGB/g,"mrgb"),T=T.replace(/#.*$/gm,"").trim(),this._loadingOptions.useLegacyBehavior?(this._pushTriangle=function(b,N){return r._triangles.push(b[0],b[N],b[N+1])},this._handednessSign=1):a.useRightHandedSystem?(this._pushTriangle=function(b,N){return r._triangles.push(b[0],b[N+1],b[N])},this._handednessSign=1):(this._pushTriangle=function(b,N){return r._triangles.push(b[0],b[N],b[N+1])},this._handednessSign=-1);var n=T.split(`
`),o=[],s=[];o.push(s);for(var u=0;u<n.length;u++){var _=n[u].trim().replace(/\s\s/g," ");if(!(_.length===0||_.charAt(0)==="#"))if((m._IsGroupElement(_)||m._IsObjectElement(_))&&(s=[],o.push(s)),m._IsLineElement(_))for(var g=_.split(" "),O=1;O<g.length-1;O++)s.push("l ".concat(g[O]," ").concat(g[O+1]));else s.push(_)}for(var y=o.flat(),u=0;u<y.length;u++){var _=y[u].trim().replace(/\s\s/g," "),E=void 0;if(!(_.length===0||_.charAt(0)==="#"))if(m.VertexPattern.test(_)){if(E=_.match(/[^ ]+/g),this._positions.push(new f.Vector3(parseFloat(E[1]),parseFloat(E[2]),parseFloat(E[3]))),this._loadingOptions.importVertexColors)if(E.length>=7){var P=parseFloat(E[4]),x=parseFloat(E[5]),B=parseFloat(E[6]);this._colors.push(new f.Color4(P>1?P/255:P,x>1?x/255:x,B>1?B/255:B,E.length===7||E[7]===void 0?1:parseFloat(E[7])))}else this._colors.push(this._grayColor)}else if((E=m.NormalPattern.exec(_))!==null)this._normals.push(new f.Vector3(parseFloat(E[1]),parseFloat(E[2]),parseFloat(E[3])));else if((E=m.UVPattern.exec(_))!==null)this._uvs.push(new f.Vector2(parseFloat(E[1])*this._loadingOptions.UVScaling.x,parseFloat(E[2])*this._loadingOptions.UVScaling.y));else if((E=m.FacePattern3.exec(_))!==null)this._setDataForCurrentFaceWithPattern3(E[1].trim().split(" "),1);else if((E=m.FacePattern4.exec(_))!==null)this._setDataForCurrentFaceWithPattern4(E[1].trim().split(" "),1);else if((E=m.FacePattern5.exec(_))!==null)this._setDataForCurrentFaceWithPattern5(E[1].trim().split(" "),1);else if((E=m.FacePattern2.exec(_))!==null)this._setDataForCurrentFaceWithPattern2(E[1].trim().split(" "),1);else if((E=m.FacePattern1.exec(_))!==null)this._setDataForCurrentFaceWithPattern1(E[1].trim().split(" "),1);else if((E=m.LinePattern1.exec(_))!==null)this._setDataForCurrentFaceWithPattern1(E[1].trim().split(" "),0),this._hasLineData=!0;else if((E=m.LinePattern2.exec(_))!==null)this._setDataForCurrentFaceWithPattern2(E[1].trim().split(" "),0),this._hasLineData=!0;else if(E=m._GetZbrushMRGB(_,!this._loadingOptions.importVertexColors))E.forEach(function(D){r._extColors.push(D)});else if((E=m.LinePattern3.exec(_))!==null)this._setDataForCurrentFaceWithPattern3(E[1].trim().split(" "),0),this._hasLineData=!0;else if(m.GroupDescriptor.test(_)||m.ObjectDescriptor.test(_)){var K={name:_.substring(2).trim(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:m.ObjectDescriptor.test(_)};this._addPreviousObjMesh(),this._meshesFromObj.push(K),this._hasMeshes=!0,this._isFirstMaterial=!0,this._increment=1}else if(m.UseMtlDescriptor.test(_)){if(this._materialNameFromObj=_.substring(7).trim(),!this._isFirstMaterial||!this._hasMeshes){this._addPreviousObjMesh();var K={name:(this._objMeshName||"mesh")+"_mm"+this._increment.toString(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:!1};this._increment++,this._meshesFromObj.push(K),this._hasMeshes=!0}this._hasMeshes&&this._isFirstMaterial&&(this._meshesFromObj[this._meshesFromObj.length-1].materialName=this._materialNameFromObj,this._isFirstMaterial=!1)}else m.MtlLibGroupDescriptor.test(_)?l(_.substring(7).trim()):m.SmoothDescriptor.test(_)||f.Logger.Log("Unhandled expression at line : "+_)}if(this._hasMeshes&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData(),this._handledMesh.indices=this._indicesForBabylon,this._handledMesh.positions=this._unwrappedPositionsForBabylon,this._handledMesh.normals=this._unwrappedNormalsForBabylon,this._handledMesh.uvs=this._unwrappedUVForBabylon,this._handledMesh.hasLines=this._hasLineData,this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon)),!this._hasMeshes){var I=null;if(this._indicesForBabylon.length)this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData();else{for(var S=0,H=this._positions;S<H.length;S++){var Y=H[S];this._unwrappedPositionsForBabylon.push(Y.x,Y.y,Y.z)}if(this._normals.length)for(var re=0,Q=this._normals;re<Q.length;re++){var $=Q[re];this._unwrappedNormalsForBabylon.push($.x,$.y,$.z)}if(this._uvs.length)for(var oe=0,J=this._uvs;oe<J.length;oe++){var ne=J[oe];this._unwrappedUVForBabylon.push(ne.x,ne.y)}if(this._extColors.length)for(var te=0,q=this._extColors;te<q.length;te++){var Z=q[te];this._unwrappedColorsForBabylon.push(Z.r,Z.g,Z.b,Z.a)}else if(this._colors.length)for(var C=0,v=this._colors;C<v.length;C++){var Z=v[C];this._unwrappedColorsForBabylon.push(Z.r,Z.g,Z.b,Z.a)}this._materialNameFromObj||(I=new f.StandardMaterial(f.Geometry.RandomId(),a),I.pointsCloud=!0,this._materialNameFromObj=I.name,this._normals.length||(I.disableLighting=!0,I.emissiveColor=f.Color3.White()))}this._meshesFromObj.push({name:f.Geometry.RandomId(),indices:this._indicesForBabylon,positions:this._unwrappedPositionsForBabylon,colors:this._unwrappedColorsForBabylon,normals:this._unwrappedNormalsForBabylon,uvs:this._unwrappedUVForBabylon,materialName:this._materialNameFromObj,directMaterial:I,isObject:!0,hasLines:this._hasLineData})}for(var h=0;h<this._meshesFromObj.length;h++){if(p&&this._meshesFromObj[h].name){if(p instanceof Array){if(p.indexOf(this._meshesFromObj[h].name)===-1)continue}else if(this._meshesFromObj[h].name!==p)continue}this._handledMesh=this._meshesFromObj[h],a._blockEntityCollection=!!i;var A=new f.Mesh(this._meshesFromObj[h].name,a);if(A._parentContainer=i,a._blockEntityCollection=!1,this._handledMesh._babylonMesh=A,!this._handledMesh.isObject){for(var L=h-1;L>=0;--L)if(this._meshesFromObj[L].isObject&&this._meshesFromObj[L]._babylonMesh){A.parent=this._meshesFromObj[L]._babylonMesh;break}}if(this._materialToUse.push(this._meshesFromObj[h].materialName),this._handledMesh.hasLines&&((t=A._internalMetadata)!==null&&t!==void 0||(A._internalMetadata={}),A._internalMetadata._isLine=!0),((e=this._handledMesh.positions)===null||e===void 0?void 0:e.length)===0){this._babylonMeshesArray.push(A);continue}var F=new f.VertexData;if(F.uvs=this._handledMesh.uvs,F.indices=this._handledMesh.indices,F.positions=this._handledMesh.positions,this._loadingOptions.computeNormals){var R=new Array;f.VertexData.ComputeNormals(this._handledMesh.positions,this._handledMesh.indices,R),F.normals=R}else F.normals=this._handledMesh.normals;this._loadingOptions.importVertexColors&&(F.colors=this._handledMesh.colors),F.applyToMesh(A),this._loadingOptions.invertY&&(A.scaling.y*=-1),this._loadingOptions.optimizeNormals&&this._optimizeNormals(A),this._babylonMeshesArray.push(A),this._handledMesh.directMaterial&&(A.material=this._handledMesh.directMaterial)}},m.ObjectDescriptor=/^o/,m.GroupDescriptor=/^g/,m.MtlLibGroupDescriptor=/^mtllib /,m.UseMtlDescriptor=/^usemtl /,m.SmoothDescriptor=/^s /,m.VertexPattern=/^v(\s+[\d|.|+|\-|e|E]+){3,7}/,m.NormalPattern=/^vn(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,m.UVPattern=/^vt(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,m.FacePattern1=/^f\s+(([\d]{1,}[\s]?){3,})+/,m.FacePattern2=/^f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,m.FacePattern3=/^f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,m.FacePattern4=/^f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,m.FacePattern5=/^f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/,m.LinePattern1=/^l\s+(([\d]{1,}[\s]?){2,})+/,m.LinePattern2=/^l\s+((([\d]{1,}\/[\d]{1,}[\s]?){2,})+)/,m.LinePattern3=/^l\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){2,})+)/,m}()},"../../../dev/loaders/src/SPLAT/index.ts":(w,M,d)=>{d.r(M),d.d(M,{SPLATFileLoader:()=>f.SPLATFileLoader}),d("../../../dev/loaders/src/SPLAT/splatLoadingOptions.ts");var f=d("../../../dev/loaders/src/SPLAT/splatFileLoader.ts")},"../../../dev/loaders/src/SPLAT/splatFileLoader.metadata.ts":(w,M,d)=>{d.r(M),d.d(M,{SPLATFileLoaderMetadata:()=>f});var f={name:"splat",extensions:{".splat":{isBinary:!0},".ply":{isBinary:!0},".spz":{isBinary:!0}}}},"../../../dev/loaders/src/SPLAT/splatFileLoader.ts":(w,M,d)=>{d.r(M),d.d(M,{SPLATFileLoader:()=>T});var f=d("../../../../node_modules/tslib/tslib.es6.mjs"),c=d("babylonjs/Misc/tools"),m=d("../../../dev/loaders/src/SPLAT/splatFileLoader.metadata.ts"),p;(function(a){a[a.Splat=0]="Splat",a[a.PointCloud=1]="PointCloud",a[a.Mesh=2]="Mesh",a[a.Reject=3]="Reject"})(p||(p={}));var T=function(){function a(i){i===void 0&&(i=a._DefaultLoadingOptions),this.name=m.SPLATFileLoaderMetadata.name,this._assetContainer=null,this.extensions=m.SPLATFileLoaderMetadata.extensions,this._loadingOptions=i}return a.prototype.createPlugin=function(i){return new a(i[m.SPLATFileLoaderMetadata.name])},a.prototype.importMeshAsync=function(i,l,r,t,e,n){return(0,f.__awaiter)(this,void 0,void 0,function(){return(0,f.__generator)(this,function(o){return[2,this._parse(i,l,r,t).then(function(s){return{meshes:s,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[],spriteManagers:[]}})]})})},a._BuildPointCloud=function(i,l){if(!l.byteLength)return!1;var r=new Uint8Array(l),t=new Float32Array(l),e=3*4+3*4+4+4,n=r.length/e,o=function(s,u){var _=t[8*u+0],g=t[8*u+1],O=t[8*u+2];s.position=new c.Vector3(_,g,O);var y=r[e*u+24+0]/255,E=r[e*u+24+1]/255,P=r[e*u+24+2]/255;s.color=new c.Color4(y,E,P,1)};return i.addPoints(n,o),!0},a._BuildMesh=function(i,l){for(var r=new c.Mesh("PLYMesh",i),t=new Uint8Array(l.data),e=new Float32Array(l.data),n=3*4+3*4+4+4,o=t.length/n,s=[],u=new c.VertexData,_=0;_<o;_++){var g=e[8*_+0],O=e[8*_+1],y=e[8*_+2];s.push(g,O,y)}if(l.hasVertexColors){for(var E=new Float32Array(o*4),_=0;_<o;_++){var P=t[n*_+24+0]/255,x=t[n*_+24+1]/255,B=t[n*_+24+2]/255;E[_*4+0]=P,E[_*4+1]=x,E[_*4+2]=B,E[_*4+3]=1}u.colors=E}return u.positions=s,u.indices=l.faces,u.applyToMesh(r),r},a.prototype._parseSPZ=function(i,l){var r=new Uint8Array(i),t=new Uint32Array(i),e=t[2],n=r[12],o=r[13],s=r[15];if(s||t[0]!=1347635022||t[1]!=2)return new Promise(function(W){W({mode:3,data:_,hasVertexColors:!1})});for(var u=3*4+3*4+4+4,_=new ArrayBuffer(u*e),g=1/(1<<o),O=new Int32Array(1),y=new Uint8Array(O.buffer),E=function(W,X){return y[0]=W[X+0],y[1]=W[X+1],y[2]=W[X+2],y[3]=W[X+2]&128?255:0,O[0]*g},P=16,x=new Float32Array(_),B=new Float32Array(_),K=new Uint8ClampedArray(_),I=new Uint8ClampedArray(_),S=0;S<e;S++)x[S*8+0]=E(r,P+0),x[S*8+1]=-E(r,P+3),x[S*8+2]=E(r,P+6),P+=9;for(var H=.282,S=0;S<e;S++){var Y=r[P+e+S*3+0],re=r[P+e+S*3+1],Q=r[P+e+S*3+2];K[S*32+24+0]=Math.max(Math.min((Y/255-H)*(1+H*4)*255,255),0),K[S*32+24+1]=Math.max(Math.min((re/255-H)*(1+H*4)*255,255),0),K[S*32+24+2]=Math.max(Math.min((Q/255-H)*(1+H*4)*255,255),0),K[S*32+24+3]=r[P+S]}P+=e*4;for(var S=0;S<e;S++)B[S*8+3+0]=Math.exp(r[P+0]/16-10),B[S*8+3+1]=Math.exp(r[P+1]/16-10),B[S*8+3+2]=Math.exp(r[P+2]/16-10),P+=3;for(var S=0;S<e;S++){var $=r[P+0],oe=r[P+1],J=r[P+2],ne=$/127.5-1,te=oe/127.5-1,q=J/127.5-1;I[S*32+28+1]=$,I[S*32+28+2]=oe,I[S*32+28+3]=J;var Z=1-(ne*ne+te*te+q*q);I[S*32+28+0]=127.5-Math.sqrt(Z<0?0:Z)*127.5,P+=3}if(n){for(var C=(n+1)*(n+1)-1,v=C*3,h=Math.ceil(v/16),A=P,L=[],F=l.getEngine(),R=F.getCaps().maxTextureSize,b=Math.ceil(e/R),N=0;N<h;N++){var D=new Uint8Array(b*R*4*4);L.push(D)}for(var S=0;S<e;S++)for(var G=0;G<v;G++){var U=r[A++],N=Math.floor(G/16),z=L[N],V=G%16,j=S*16;z[V+j]=U}return new Promise(function(W){W({mode:0,data:_,hasVertexColors:!1,sh:L})})}return new Promise(function(W){W({mode:0,data:_,hasVertexColors:!1})})},a.prototype._parse=function(i,l,r,t){var e=this,n=[],o=new ReadableStream({start:function(_){_.enqueue(new Uint8Array(r)),_.close()}}),s=new DecompressionStream("gzip"),u=o.pipeThrough(s);return new Promise(function(_){new Response(u).arrayBuffer().then(function(g){e._parseSPZ(g,l).then(function(O){var y=new c.GaussianSplattingMesh("GaussianSplatting",null,l,e._loadingOptions.keepInRam);y._parentContainer=e._assetContainer,n.push(y),y.updateData(O.data,O.sh)}),_(n)}).catch(function(){a._ConvertPLYToSplat(r).then(function(g){return(0,f.__awaiter)(e,void 0,void 0,function(){var O,y,E;return(0,f.__generator)(this,function(P){switch(P.label){case 0:switch(O=g.mode,O){case 0:return[3,1];case 1:return[3,2];case 2:return[3,6]}return[3,7];case 1:return y=new c.GaussianSplattingMesh("GaussianSplatting",null,l,this._loadingOptions.keepInRam),y._parentContainer=this._assetContainer,n.push(y),y.updateData(g.data),[3,8];case 2:return E=new c.PointsCloudSystem("PointCloud",1,l),a._BuildPointCloud(E,g.data)?[4,E.buildMeshAsync().then(function(x){n.push(x)})]:[3,4];case 3:return P.sent(),[3,5];case 4:E.dispose(),P.label=5;case 5:return[3,8];case 6:if(g.faces)n.push(a._BuildMesh(l,g));else throw new Error("PLY mesh doesn't contain face informations.");return[3,8];case 7:throw new Error("Unsupported Splat mode");case 8:return[2]}})})}),_(n)})})},a.prototype.loadAssetContainerAsync=function(i,l,r){var t=this,e=new c.AssetContainer(i);return this._assetContainer=e,this.importMeshAsync(null,i,l,r).then(function(n){return n.meshes.forEach(function(o){return e.meshes.push(o)}),t._assetContainer=null,e}).catch(function(n){throw t._assetContainer=null,n})},a.prototype.loadAsync=function(i,l,r){return this.importMeshAsync(null,i,l,r).then(function(){})},a._ConvertPLYToSplat=function(i){var l=new Uint8Array(i),r=new TextDecoder().decode(l.slice(0,1024*10)),t=`end_header
`,e=r.indexOf(t);if(e<0||!r)return new Promise(function(J){J({mode:0,data:i})});var n=parseInt(/element vertex (\d+)\n/.exec(r)[1]),o=/element face (\d+)\n/.exec(r),s=0;o&&(s=parseInt(o[1]));var u=/element chunk (\d+)\n/.exec(r),_=0;u&&(_=parseInt(u[1]));var g=0,O=0,y={double:8,int:4,uint:4,float:4,short:2,ushort:2,uchar:1,list:0},E;(function(J){J[J.Vertex=0]="Vertex",J[J.Chunk=1]="Chunk"})(E||(E={}));for(var P=1,x=[],B=r.slice(0,e).split(`
`),K=0,I=B;K<I.length;K++){var S=I[K];if(S.startsWith("property ")){var H=S.split(" "),Y=H[1],re=H[2];P==1?O+=y[Y]:P==0&&(x.push({name:re,type:Y,offset:g}),g+=y[Y]),y[Y]||c.Logger.Warn("Unsupported property type: ".concat(Y,"."))}else if(S.startsWith("element ")){var Q=S.split(" "),Y=Q[1];Y=="chunk"?P=1:Y=="vertex"&&(P=0)}}var $=g,oe=O;return c.GaussianSplattingMesh.ConvertPLYToSplatAsync(i).then(function(J){var ne=new DataView(i,e+t.length),te=oe*_+$*n,q=[];if(s)for(var Z=0;Z<s;Z++){var C=ne.getUint8(te);if(C==3){te+=1;for(var v=0;v<C;v++){var h=ne.getUint32(te+(2-v)*4,!0);q.push(h)}te+=12}}if(_)return new Promise(function(U){U({mode:0,data:J,faces:q,hasVertexColors:!1})});for(var A=0,L=0,F=["x","y","z","scale_0","scale_1","scale_2","opacity","rot_0","rot_1","rot_2","rot_3"],R=["red","green","blue","f_dc_0","f_dc_1","f_dc_2"],b=0;b<x.length;b++){var N=x[b];F.includes(N.name)&&A++,R.includes(N.name)&&L++}var D=A==F.length&&L==3,G=s?2:D?0:1;return new Promise(function(U){U({mode:G,data:J,faces:q,hasVertexColors:!!L})})})},a._DefaultLoadingOptions={keepInRam:!1},a}();(0,c.registerSceneLoaderPlugin)(new T)},"../../../dev/loaders/src/SPLAT/splatLoadingOptions.ts":(w,M,d)=>{d.r(M)},"../../../dev/loaders/src/STL/index.ts":(w,M,d)=>{d.r(M),d.d(M,{STLFileLoader:()=>f.STLFileLoader});var f=d("../../../dev/loaders/src/STL/stlFileLoader.ts")},"../../../dev/loaders/src/STL/stlFileLoader.metadata.ts":(w,M,d)=>{d.r(M),d.d(M,{STLFileLoaderMetadata:()=>f});var f={name:"stl",extensions:{".stl":{isBinary:!0}}}},"../../../dev/loaders/src/STL/stlFileLoader.ts":(w,M,d)=>{d.r(M),d.d(M,{STLFileLoader:()=>m});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/STL/stlFileLoader.metadata.ts"),m=function(){function p(){this.solidPattern=/solid (\S*)([\S\s]*?)endsolid[ ]*(\S*)/g,this.facetsPattern=/facet([\s\S]*?)endfacet/g,this.normalPattern=/normal[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g,this.vertexPattern=/vertex[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g,this.name=c.STLFileLoaderMetadata.name,this.extensions=c.STLFileLoaderMetadata.extensions}return p.prototype.importMesh=function(T,a,i,l,r){var t;if(typeof i!="string"){if(this._isBinary(i)){var e=new f.Mesh("stlmesh",a);return this._parseBinary(e,i),r&&r.push(e),!0}i=new TextDecoder().decode(new Uint8Array(i))}for(;t=this.solidPattern.exec(i);){var n=t[1],o=t[3];if(o&&n!=o)return f.Tools.Error("Error in STL, solid name != endsolid name"),!1;if(T&&n){if(T instanceof Array){if(!T.indexOf(n))continue}else if(n!==T)continue}n=n||"stlmesh";var e=new f.Mesh(n,a);this._parseASCII(e,t[2]),r&&r.push(e)}return!0},p.prototype.load=function(T,a,i){var l=this.importMesh(null,T,a,i,null);return l},p.prototype.loadAssetContainer=function(T,a,i){var l=new f.AssetContainer(T);return T._blockEntityCollection=!0,this.importMesh(null,T,a,i,l.meshes),T._blockEntityCollection=!1,l},p.prototype._isBinary=function(T){var a=new DataView(T);if(a.byteLength<=80)return!1;var i=32/8*3+32/8*3*3+16/8,l=a.getUint32(80,!0);if(80+32/8+l*i===a.byteLength)return!0;for(var r=[115,111,108,105,100],t=0;t<5;t++)if(a.getUint8(t)!==r[t])return!0;return!1},p.prototype._parseBinary=function(T,a){for(var i=new DataView(a),l=i.getUint32(80,!0),r=84,t=12*4+2,e=0,n=new Float32Array(l*3*3),o=new Float32Array(l*3*3),s=new Uint32Array(l*3),u=0,_=0;_<l;_++){for(var g=r+_*t,O=i.getFloat32(g,!0),y=i.getFloat32(g+4,!0),E=i.getFloat32(g+8,!0),P=1;P<=3;P++){var x=g+P*12;n[e]=i.getFloat32(x,!0),o[e]=O,p.DO_NOT_ALTER_FILE_COORDINATES?(n[e+1]=i.getFloat32(x+4,!0),n[e+2]=i.getFloat32(x+8,!0),o[e+1]=y,o[e+2]=E):(n[e+2]=i.getFloat32(x+4,!0),n[e+1]=i.getFloat32(x+8,!0),o[e+2]=y,o[e+1]=E),e+=3}p.DO_NOT_ALTER_FILE_COORDINATES?(s[u]=u,s[u+1]=u+2,s[u+2]=u+1,u+=3):(s[u]=u++,s[u]=u++,s[u]=u++)}T.setVerticesData(f.VertexBuffer.PositionKind,n),T.setVerticesData(f.VertexBuffer.NormalKind,o),T.setIndices(s),T.computeWorldMatrix(!0)},p.prototype._parseASCII=function(T,a){for(var i=[],l=[],r=[],t=0,e;e=this.facetsPattern.exec(a);){var n=e[1],o=this.normalPattern.exec(n);if(this.normalPattern.lastIndex=0,!!o){for(var s=[Number(o[1]),Number(o[5]),Number(o[3])],u=void 0;u=this.vertexPattern.exec(n);)p.DO_NOT_ALTER_FILE_COORDINATES?(i.push(Number(u[1]),Number(u[3]),Number(u[5])),l.push(s[0],s[2],s[1])):(i.push(Number(u[1]),Number(u[5]),Number(u[3])),l.push(s[0],s[1],s[2]));p.DO_NOT_ALTER_FILE_COORDINATES?(r.push(t,t+2,t+1),t+=3):r.push(t++,t++,t++),this.vertexPattern.lastIndex=0}}this.facetsPattern.lastIndex=0,T.setVerticesData(f.VertexBuffer.PositionKind,i),T.setVerticesData(f.VertexBuffer.NormalKind,l),T.setIndices(r),T.computeWorldMatrix(!0)},p.DO_NOT_ALTER_FILE_COORDINATES=!1,p}();(0,f.registerSceneLoaderPlugin)(new m)},"../../../dev/loaders/src/glTF/1.0/glTFBinaryExtension.ts":(w,M,d)=>{d.r(M),d.d(M,{GLTFBinaryExtension:()=>a});var f=d("../../../../node_modules/tslib/tslib.es6.mjs"),c=d("../../../dev/loaders/src/glTF/1.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/1.0/glTFLoaderUtils.ts"),p=d("../../../dev/loaders/src/glTF/1.0/glTFLoaderInterfaces.ts"),T="binary_glTF",a=function(i){(0,f.__extends)(l,i);function l(){return i.call(this,"KHR_binary_glTF")||this}return l.prototype.loadRuntimeAsync=function(r,t,e,n){var o=t.json.extensionsUsed;return!o||o.indexOf(this.name)===-1||!t.bin?!1:(this._bin=t.bin,n(c.GLTFLoaderBase.CreateRuntime(t.json,r,e)),!0)},l.prototype.loadBufferAsync=function(r,t,e,n){return r.extensionsUsed.indexOf(this.name)===-1||t!==T?!1:(this._bin.readAsync(0,this._bin.byteLength).then(e,function(o){return n(o.message)}),!0)},l.prototype.loadTextureBufferAsync=function(r,t,e){var n=r.textures[t],o=r.images[n.source];if(!o.extensions||!(this.name in o.extensions))return!1;var s=o.extensions[this.name],u=r.bufferViews[s.bufferView],_=m.GLTFUtils.GetBufferFromBufferView(r,u,0,u.byteLength,p.EComponentType.UNSIGNED_BYTE);return e(_),!0},l.prototype.loadShaderStringAsync=function(r,t,e){var n=r.shaders[t];if(!n.extensions||!(this.name in n.extensions))return!1;var o=n.extensions[this.name],s=r.bufferViews[o.bufferView],u=m.GLTFUtils.GetBufferFromBufferView(r,s,0,s.byteLength,p.EComponentType.UNSIGNED_BYTE);return setTimeout(function(){var _=m.GLTFUtils.DecodeBufferToText(u);e(_)}),!0},l}(c.GLTFLoaderExtension);c.GLTFLoader.RegisterExtension(new a)},"../../../dev/loaders/src/glTF/1.0/glTFLoader.ts":(w,M,d)=>{d.r(M),d.d(M,{GLTFLoader:()=>Z,GLTFLoaderBase:()=>q,GLTFLoaderExtension:()=>C});var f=d("../../../dev/loaders/src/glTF/1.0/glTFLoaderInterfaces.ts"),c=d("babylonjs/Misc/tools"),m=d("../../../dev/loaders/src/glTF/1.0/glTFLoaderUtils.ts"),p=d("../../../dev/loaders/src/glTF/glTFFileLoader.ts"),T;(function(v){v[v.IDENTIFIER=1]="IDENTIFIER",v[v.UNKNOWN=2]="UNKNOWN",v[v.END_OF_INPUT=3]="END_OF_INPUT"})(T||(T={}));var a=function(){function v(h){this._pos=0,this.currentToken=T.UNKNOWN,this.currentIdentifier="",this.currentString="",this.isLetterOrDigitPattern=/^[a-zA-Z0-9]+$/,this._toParse=h,this._maxPos=h.length}return v.prototype.getNextToken=function(){if(this.isEnd())return T.END_OF_INPUT;if(this.currentString=this.read(),this.currentToken=T.UNKNOWN,this.currentString==="_"||this.isLetterOrDigitPattern.test(this.currentString))for(this.currentToken=T.IDENTIFIER,this.currentIdentifier=this.currentString;!this.isEnd()&&(this.isLetterOrDigitPattern.test(this.currentString=this.peek())||this.currentString==="_");)this.currentIdentifier+=this.currentString,this.forward();return this.currentToken},v.prototype.peek=function(){return this._toParse[this._pos]},v.prototype.read=function(){return this._toParse[this._pos++]},v.prototype.forward=function(){this._pos++},v.prototype.isEnd=function(){return this._pos>=this._maxPos},v}(),i=["MODEL","VIEW","PROJECTION","MODELVIEW","MODELVIEWPROJECTION","JOINTMATRIX"],l=["world","view","projection","worldView","worldViewProjection","mBones"],r=["translation","rotation","scale"],t=["position","rotationQuaternion","scaling"],e=function(v,h){for(var A in v){var L=v[A];h.buffers[A]=L,h.buffersCount++}},n=function(v,h){for(var A in v){var L=v[A];h.shaders[A]=L,h.shaderscount++}},o=function(v,h,A){for(var L in v){var F=v[L];A[h][L]=F}},s=function(v){if(v)for(var h=0;h<v.length/2;h++)v[h*2+1]=1-v[h*2+1]},u=function(v){if(v.semantic==="NORMAL")return"normal";if(v.semantic==="POSITION")return"position";if(v.semantic==="JOINT")return"matricesIndices";if(v.semantic==="WEIGHT")return"matricesWeights";if(v.semantic==="COLOR")return"color";if(v.semantic&&v.semantic.indexOf("TEXCOORD_")!==-1){var h=Number(v.semantic.split("_")[1]);return"uv"+(h===0?"":h+1)}return null},_=function(v){for(var h in v.animations){var A=v.animations[h];if(!(!A.channels||!A.samplers))for(var L=null,F=0;F<A.channels.length;F++){var R=A.channels[F],b=A.samplers[R.sampler];if(b){var N=null,D=null;A.parameters?(N=A.parameters[b.input],D=A.parameters[b.output]):(N=b.input,D=b.output);var G=m.GLTFUtils.GetBufferFromAccessor(v,v.accessors[N]),U=m.GLTFUtils.GetBufferFromAccessor(v,v.accessors[D]),z=R.target.id,V=v.scene.getNodeById(z);if(V===null&&(V=v.scene.getNodeByName(z)),V===null){c.Tools.Warn("Creating animation named "+h+". But cannot find node named "+z+" to attach to");continue}var j=V instanceof c.Bone,W=R.target.path,X=r.indexOf(W);X!==-1&&(W=t[X]);var ee=c.Animation.ANIMATIONTYPE_MATRIX;j||(W==="rotationQuaternion"?(ee=c.Animation.ANIMATIONTYPE_QUATERNION,V.rotationQuaternion=new c.Quaternion):ee=c.Animation.ANIMATIONTYPE_VECTOR3);var ae=null,ce=[],k=0,se=!1;j&&L&&L.getKeys().length===G.length&&(ae=L,se=!0),se||(v.scene._blockEntityCollection=!!v.assetContainer,ae=new c.Animation(h,j?"_matrix":W,1,ee,c.Animation.ANIMATIONLOOPMODE_CYCLE),v.scene._blockEntityCollection=!1);for(var le=0;le<G.length;le++){var ue=null;if(W==="rotationQuaternion"?(ue=c.Quaternion.FromArray([U[k],U[k+1],U[k+2],U[k+3]]),k+=4):(ue=c.Vector3.FromArray([U[k],U[k+1],U[k+2]]),k+=3),j){var Te=V,fe=c.Vector3.Zero(),pe=new c.Quaternion,he=c.Vector3.Zero(),_e=Te.getBaseMatrix();se&&L&&(_e=L.getKeys()[le].value),_e.decompose(he,pe,fe),W==="position"?fe=ue:W==="rotationQuaternion"?pe=ue:he=ue,ue=c.Matrix.Compose(he,pe,fe)}se?L&&(L.getKeys()[le].value=ue):ce.push({frame:G[le],value:ue})}!se&&ae&&(ae.setKeys(ce),V.animations.push(ae)),L=ae,v.scene.stopAnimation(V),v.scene.beginAnimation(V,0,G[G.length-1],!0,1)}}}},g=function(v){var h=null;if(v.translation||v.rotation||v.scale){var A=c.Vector3.FromArray(v.scale||[1,1,1]),L=c.Quaternion.FromArray(v.rotation||[0,0,0,1]),F=c.Vector3.FromArray(v.translation||[0,0,0]);h=c.Matrix.Compose(A,L,F)}else h=c.Matrix.FromArray(v.matrix);return h},O=function(v,h,A,L){for(var F=0;F<L.bones.length;F++)if(L.bones[F].name===A)return L.bones[F];var R=v.nodes;for(var b in R){var N=R[b];if(N.jointName)for(var D=N.children,F=0;F<D.length;F++){var G=v.nodes[D[F]];if(G.jointName&&G.jointName===A){var U=g(N),z=new c.Bone(N.name||"",L,O(v,h,N.jointName,L),U);return z.id=b,z}}}return null},y=function(v,h){for(var A=0;A<v.length;A++)for(var L=v[A],F=0;F<L.node.children.length;F++){var R=L.node.children[F];if(R===h)return L.bone}return null},E=function(v,h){var A=v.nodes,L=A[h];if(L)return{node:L,id:h};for(var F in A)if(L=A[F],L.jointName===h)return{node:L,id:F};return null},P=function(v,h){for(var A=0;A<v.jointNames.length;A++)if(v.jointNames[A]===h)return!0;return!1},x=function(v,h,A,L){for(var F in v.nodes){var R=v.nodes[F],b=F;if(!(!R.jointName||P(A,R.jointName))){var N=g(R),D=new c.Bone(R.name||"",h,null,N);D.id=b,L.push({bone:D,node:R,id:b})}}for(var G=0;G<L.length;G++)for(var U=L[G],z=U.node.children,V=0;V<z.length;V++){for(var j=null,W=0;W<L.length;W++)if(L[W].id===z[V]){j=L[W];break}j&&(j.bone._parent=U.bone,U.bone.children.push(j.bone))}},B=function(v,h,A,L){if(L||(L=new c.Skeleton(h.name||"","",v.scene)),!h.babylonSkeleton)return L;var F=[],R=[];x(v,L,h,F),L.bones=[];for(var b=0;b<h.jointNames.length;b++){var N=E(v,h.jointNames[b]);if(N){var D=N.node;if(!D){c.Tools.Warn("Joint named "+h.jointNames[b]+" does not exist");continue}var G=N.id,U=v.scene.getBoneById(G);if(U){L.bones.push(U);continue}for(var z=!1,V=null,j=0;j<b;j++){var W=E(v,h.jointNames[j]);if(W){var X=W.node;if(!X){c.Tools.Warn("Joint named "+h.jointNames[j]+" does not exist when looking for parent");continue}var ee=X.children;if(ee){z=!1;for(var ae=0;ae<ee.length;ae++)if(ee[ae]===G){V=O(v,h,h.jointNames[j],L),z=!0;break}if(z)break}}}var ce=g(D);!V&&F.length>0&&(V=y(F,G),V&&R.indexOf(V)===-1&&R.push(V));var k=new c.Bone(D.jointName||"",L,V,ce);k.id=G}}var se=L.bones;L.bones=[];for(var b=0;b<h.jointNames.length;b++){var N=E(v,h.jointNames[b]);if(N){for(var j=0;j<se.length;j++)if(se[j].id===N.id){L.bones.push(se[j]);break}}}L.prepare();for(var b=0;b<R.length;b++)L.bones.push(R[b]);return L},K=function(v,h,A,L,F){if(F||(v.scene._blockEntityCollection=!!v.assetContainer,F=new c.Mesh(h.name||"",v.scene),F._parentContainer=v.assetContainer,v.scene._blockEntityCollection=!1,F.id=L),!h.babylonNode)return F;for(var R=[],b=null,N=[],D=[],G=[],U=[],z=0;z<A.length;z++){var V=A[z],j=v.meshes[V];if(j)for(var W=0;W<j.primitives.length;W++){var X=new c.VertexData,ee=j.primitives[W];ee.mode;var ae=ee.attributes,ce=null,k=null;for(var se in ae)if(ce=v.accessors[ae[se]],k=m.GLTFUtils.GetBufferFromAccessor(v,ce),se==="NORMAL")X.normals=new Float32Array(k.length),X.normals.set(k);else if(se==="POSITION"){if(p.GLTFFileLoader.HomogeneousCoordinates){X.positions=new Float32Array(k.length-k.length/4);for(var le=0;le<k.length;le+=4)X.positions[le]=k[le],X.positions[le+1]=k[le+1],X.positions[le+2]=k[le+2]}else X.positions=new Float32Array(k.length),X.positions.set(k);D.push(X.positions.length)}else if(se.indexOf("TEXCOORD_")!==-1){var ue=Number(se.split("_")[1]),Te=c.VertexBuffer.UVKind+(ue===0?"":ue+1),fe=new Float32Array(k.length);fe.set(k),s(fe),X.set(fe,Te)}else se==="JOINT"?(X.matricesIndices=new Float32Array(k.length),X.matricesIndices.set(k)):se==="WEIGHT"?(X.matricesWeights=new Float32Array(k.length),X.matricesWeights.set(k)):se==="COLOR"&&(X.colors=new Float32Array(k.length),X.colors.set(k));if(ce=v.accessors[ee.indices],ce)k=m.GLTFUtils.GetBufferFromAccessor(v,ce),X.indices=new Int32Array(k.length),X.indices.set(k),U.push(X.indices.length);else{for(var pe=[],le=0;le<X.positions.length/3;le++)pe.push(le);X.indices=new Int32Array(pe),U.push(X.indices.length)}b?b.merge(X):b=X;var he=v.scene.getMaterialById(ee.material);R.push(he===null?m.GLTFUtils.GetDefaultMaterial(v.scene):he),N.push(N.length===0?0:N[N.length-1]+D[D.length-2]),G.push(G.length===0?0:G[G.length-1]+U[U.length-2])}}var _e;v.scene._blockEntityCollection=!!v.assetContainer,R.length>1?(_e=new c.MultiMaterial("multimat"+L,v.scene),_e.subMaterials=R):_e=new c.StandardMaterial("multimat"+L,v.scene),R.length===1&&(_e=R[0]),_e._parentContainer=v.assetContainer,F.material||(F.material=_e),new c.Geometry(L,v.scene,b,!1,F),F.computeWorldMatrix(!0),v.scene._blockEntityCollection=!1,F.subMeshes=[];for(var me=0,z=0;z<A.length;z++){var V=A[z],j=v.meshes[V];if(j)for(var W=0;W<j.primitives.length;W++)j.primitives[W].mode,c.SubMesh.AddToMesh(me,N[me],D[me],G[me],U[me],F,F,!0),me++}return F},I=function(v,h,A,L){v.position&&(v.position=h),(v.rotationQuaternion||v.rotation)&&(v.rotationQuaternion=A),v.scaling&&(v.scaling=L)},S=function(v,h){if(h.matrix){var A=new c.Vector3(0,0,0),L=new c.Quaternion,F=new c.Vector3(0,0,0),R=c.Matrix.FromArray(h.matrix);R.decompose(F,L,A),I(v,A,L,F)}else h.translation&&h.rotation&&h.scale&&I(v,c.Vector3.FromArray(h.translation),c.Quaternion.FromArray(h.rotation),c.Vector3.FromArray(h.scale));v.computeWorldMatrix(!0)},H=function(v,h,A){var L=null;if(v.importOnlyMeshes&&(h.skin||h.meshes)&&v.importMeshesNames&&v.importMeshesNames.length>0&&v.importMeshesNames.indexOf(h.name||"")===-1)return null;if(h.skin){if(h.meshes){var F=v.skins[h.skin],R=K(v,h,h.meshes,A,h.babylonNode);R.skeleton=v.scene.getLastSkeletonById(h.skin),R.skeleton===null&&(R.skeleton=B(v,F,R,F.babylonSkeleton),F.babylonSkeleton||(F.babylonSkeleton=R.skeleton)),L=R}}else if(h.meshes){var R=K(v,h,h.mesh?[h.mesh]:h.meshes,A,h.babylonNode);L=R}else if(h.light&&!h.babylonNode&&!v.importOnlyMeshes){var b=v.lights[h.light];if(b){if(b.type==="ambient"){var N=b[b.type],D=new c.HemisphericLight(h.light,c.Vector3.Zero(),v.scene);D.name=h.name||"",N.color&&(D.diffuse=c.Color3.FromArray(N.color)),L=D}else if(b.type==="directional"){var G=b[b.type],U=new c.DirectionalLight(h.light,c.Vector3.Zero(),v.scene);U.name=h.name||"",G.color&&(U.diffuse=c.Color3.FromArray(G.color)),L=U}else if(b.type==="point"){var z=b[b.type],V=new c.PointLight(h.light,c.Vector3.Zero(),v.scene);V.name=h.name||"",z.color&&(V.diffuse=c.Color3.FromArray(z.color)),L=V}else if(b.type==="spot"){var j=b[b.type],W=new c.SpotLight(h.light,c.Vector3.Zero(),c.Vector3.Zero(),0,0,v.scene);W.name=h.name||"",j.color&&(W.diffuse=c.Color3.FromArray(j.color)),j.fallOfAngle&&(W.angle=j.fallOfAngle),j.fallOffExponent&&(W.exponent=j.fallOffExponent),L=W}}}else if(h.camera&&!h.babylonNode&&!v.importOnlyMeshes){var X=v.cameras[h.camera];if(X){if(v.scene._blockEntityCollection=!!v.assetContainer,X.type==="orthographic"){var ee=new c.FreeCamera(h.camera,c.Vector3.Zero(),v.scene,!1);ee.name=h.name||"",ee.mode=c.Camera.ORTHOGRAPHIC_CAMERA,ee.attachControl(),L=ee,ee._parentContainer=v.assetContainer}else if(X.type==="perspective"){var ae=X[X.type],ce=new c.FreeCamera(h.camera,c.Vector3.Zero(),v.scene,!1);ce.name=h.name||"",ce.attachControl(),ae.aspectRatio||(ae.aspectRatio=v.scene.getEngine().getRenderWidth()/v.scene.getEngine().getRenderHeight()),ae.znear&&ae.zfar&&(ce.maxZ=ae.zfar,ce.minZ=ae.znear),L=ce,ce._parentContainer=v.assetContainer}v.scene._blockEntityCollection=!1}}if(!h.jointName){if(h.babylonNode)return h.babylonNode;if(L===null){v.scene._blockEntityCollection=!!v.assetContainer;var k=new c.Mesh(h.name||"",v.scene);k._parentContainer=v.assetContainer,v.scene._blockEntityCollection=!1,h.babylonNode=k,L=k}}if(L!==null){if(h.matrix&&L instanceof c.Mesh)S(L,h);else{var se=h.translation||[0,0,0],le=h.rotation||[0,0,0,1],ue=h.scale||[1,1,1];I(L,c.Vector3.FromArray(se),c.Quaternion.FromArray(le),c.Vector3.FromArray(ue))}L.updateCache(!0),h.babylonNode=L}return L},Y=function(v,h,A,L){L===void 0&&(L=!1);var F=v.nodes[h],R=null;if(v.importOnlyMeshes&&!L&&v.importMeshesNames?v.importMeshesNames.indexOf(F.name||"")!==-1||v.importMeshesNames.length===0?L=!0:L=!1:L=!0,!F.jointName&&L&&(R=H(v,F,h),R!==null&&(R.id=h,R.parent=A)),F.children)for(var b=0;b<F.children.length;b++)Y(v,F.children[b],R,L)},re=function(v){var h=v.currentScene;if(h)for(var A=0;A<h.nodes.length;A++)Y(v,h.nodes[A],null);else for(var L in v.scenes){h=v.scenes[L];for(var A=0;A<h.nodes.length;A++)Y(v,h.nodes[A],null)}_(v);for(var A=0;A<v.scene.skeletons.length;A++){var F=v.scene.skeletons[A];v.scene.beginAnimation(F,0,Number.MAX_VALUE,!0,1)}},Q=function(v,h,A,L,F,R,b){var N=R.values||F.parameters;for(var D in A){var G=A[D],U=G.type;if(U===f.EParameterType.FLOAT_MAT2||U===f.EParameterType.FLOAT_MAT3||U===f.EParameterType.FLOAT_MAT4){if(G.semantic&&!G.source&&!G.node)m.GLTFUtils.SetMatrix(h.scene,v,G,D,L.getEffect());else if(G.semantic&&(G.source||G.node)){var z=h.scene.getNodeByName(G.source||G.node||"");if(z===null&&(z=h.scene.getNodeById(G.source||G.node||"")),z===null)continue;m.GLTFUtils.SetMatrix(h.scene,z,G,D,L.getEffect())}}else{var V=N[F.uniforms[D]];if(!V)continue;if(U===f.EParameterType.SAMPLER_2D){var j=h.textures[R.values?V:G.value].babylonTexture;if(j==null)continue;L.getEffect().setTexture(D,j)}else m.GLTFUtils.SetUniform(L.getEffect(),D,V,U)}}b(L)},$=function(v,h,A,L,F){var R=L.values||A.parameters,b=A.uniforms,N=function(G){var U=F[G],z=U.type,V=R[b[G]];if(V===void 0&&(V=U.value),!V)return"continue";var j=function(W){return function(X){U.value&&W&&(h.setTexture(W,X),delete F[W])}};z===f.EParameterType.SAMPLER_2D?C.LoadTextureAsync(v,L.values?V:U.value,j(G),function(){return j(null)}):U.value&&m.GLTFUtils.SetUniform(h,G,L.values?V:U.value,z)&&delete F[G]};for(var D in F)N(D)},oe=function(v,h,A){return function(L,F){h.dispose(!0),A("Cannot compile program named "+v.name+". Error: "+F+". Default material will be applied")}},J=function(v,h,A,L,F,R){return function(b){$(v,h,A,L,F),h.onBind=function(N){Q(N,v,F,h,A,L,R)}}},ne=function(v,h,A){for(var L in h.uniforms){var F=h.uniforms[L],R=h.parameters[F];if(v.currentIdentifier===L&&R.semantic&&!R.source&&!R.node){var b=i.indexOf(R.semantic);if(b!==-1)return delete A[L],l[b]}}return v.currentIdentifier},te=function(v){for(var h in v.materials)C.LoadMaterialAsync(v,h,function(){},function(){})},q=function(){function v(){}return v.CreateRuntime=function(h,A,L){var F={extensions:{},accessors:{},buffers:{},bufferViews:{},meshes:{},lights:{},cameras:{},nodes:{},images:{},textures:{},shaders:{},programs:{},samplers:{},techniques:{},materials:{},animations:{},skins:{},extensionsUsed:[],scenes:{},buffersCount:0,shaderscount:0,scene:A,rootUrl:L,loadedBufferCount:0,loadedBufferViews:{},loadedShaderCount:0,importOnlyMeshes:!1,dummyNodes:[],assetContainer:null};return h.extensions&&o(h.extensions,"extensions",F),h.extensionsUsed&&o(h.extensionsUsed,"extensionsUsed",F),h.buffers&&e(h.buffers,F),h.bufferViews&&o(h.bufferViews,"bufferViews",F),h.accessors&&o(h.accessors,"accessors",F),h.meshes&&o(h.meshes,"meshes",F),h.lights&&o(h.lights,"lights",F),h.cameras&&o(h.cameras,"cameras",F),h.nodes&&o(h.nodes,"nodes",F),h.images&&o(h.images,"images",F),h.textures&&o(h.textures,"textures",F),h.shaders&&n(h.shaders,F),h.programs&&o(h.programs,"programs",F),h.samplers&&o(h.samplers,"samplers",F),h.techniques&&o(h.techniques,"techniques",F),h.materials&&o(h.materials,"materials",F),h.animations&&o(h.animations,"animations",F),h.skins&&o(h.skins,"skins",F),h.scenes&&(F.scenes=h.scenes),h.scene&&h.scenes&&(F.currentScene=h.scenes[h.scene]),F},v.LoadBufferAsync=function(h,A,L,F,R){var b=h.buffers[A];c.Tools.IsBase64(b.uri)?setTimeout(function(){return L(new Uint8Array(c.Tools.DecodeBase64(b.uri)))}):c.Tools.LoadFile(h.rootUrl+b.uri,function(N){return L(new Uint8Array(N))},R,void 0,!0,function(N){N&&F(N.status+" "+N.statusText)})},v.LoadTextureBufferAsync=function(h,A,L,F){var R=h.textures[A];if(!R||!R.source){F("");return}if(R.babylonTexture){L(null);return}var b=h.images[R.source];c.Tools.IsBase64(b.uri)?setTimeout(function(){return L(new Uint8Array(c.Tools.DecodeBase64(b.uri)))}):c.Tools.LoadFile(h.rootUrl+b.uri,function(N){return L(new Uint8Array(N))},void 0,void 0,!0,function(N){N&&F(N.status+" "+N.statusText)})},v.CreateTextureAsync=function(h,A,L,F){var R=h.textures[A];if(R.babylonTexture){F(R.babylonTexture);return}var b=h.samplers[R.sampler],N=b.minFilter===f.ETextureFilterType.NEAREST_MIPMAP_NEAREST||b.minFilter===f.ETextureFilterType.NEAREST_MIPMAP_LINEAR||b.minFilter===f.ETextureFilterType.LINEAR_MIPMAP_NEAREST||b.minFilter===f.ETextureFilterType.LINEAR_MIPMAP_LINEAR,D=c.Texture.BILINEAR_SAMPLINGMODE,G=L==null?new Blob:new Blob([L]),U=URL.createObjectURL(G),z=function(){return URL.revokeObjectURL(U)},V=new c.Texture(U,h.scene,!N,!0,D,z,z);b.wrapS!==void 0&&(V.wrapU=m.GLTFUtils.GetWrapMode(b.wrapS)),b.wrapT!==void 0&&(V.wrapV=m.GLTFUtils.GetWrapMode(b.wrapT)),V.name=A,R.babylonTexture=V,F(V)},v.LoadShaderStringAsync=function(h,A,L,F){var R=h.shaders[A];if(c.Tools.IsBase64(R.uri)){var b=atob(R.uri.split(",")[1]);L&&L(b)}else c.Tools.LoadFile(h.rootUrl+R.uri,L,void 0,void 0,!1,function(N){N&&F&&F(N.status+" "+N.statusText)})},v.LoadMaterialAsync=function(h,A,L,F){var R=h.materials[A];if(!R.technique){F&&F("No technique found.");return}var b=h.techniques[R.technique];if(!b){h.scene._blockEntityCollection=!!h.assetContainer;var N=new c.StandardMaterial(A,h.scene);N._parentContainer=h.assetContainer,h.scene._blockEntityCollection=!1,N.diffuseColor=new c.Color3(.5,.5,.5),N.sideOrientation=c.Material.CounterClockWiseSideOrientation,L(N);return}var D=h.programs[b.program],G=b.states,U=c.Effect.ShadersStore[D.vertexShader+"VertexShader"],z=c.Effect.ShadersStore[D.fragmentShader+"PixelShader"],V="",j="",W=new a(U),X=new a(z),ee={},ae=[],ce=[],k=[];for(var se in b.uniforms){var le=b.uniforms[se],ue=b.parameters[le];if(ee[se]=ue,ue.semantic&&!ue.node&&!ue.source){var Te=i.indexOf(ue.semantic);Te!==-1?(ae.push(l[Te]),delete ee[se]):ae.push(se)}else ue.type===f.EParameterType.SAMPLER_2D?k.push(se):ae.push(se)}for(var fe in b.attributes){var pe=b.attributes[fe],he=b.parameters[pe];if(he.semantic){var _e=u(he);_e&&ce.push(_e)}}for(;!W.isEnd()&&W.getNextToken();){var me=W.currentToken;if(me!==T.IDENTIFIER){V+=W.currentString;continue}var Oe=!1;for(var fe in b.attributes){var pe=b.attributes[fe],he=b.parameters[pe];if(W.currentIdentifier===fe&&he.semantic){V+=u(he),Oe=!0;break}}Oe||(V+=ne(W,b,ee))}for(;!X.isEnd()&&X.getNextToken();){var me=X.currentToken;if(me!==T.IDENTIFIER){j+=X.currentString;continue}j+=ne(X,b,ee)}var Pe={vertex:D.vertexShader+A,fragment:D.fragmentShader+A},Ce={attributes:ce,uniforms:ae,samplers:k,needAlphaBlending:G&&G.enable&&G.enable.indexOf(3042)!==-1};c.Effect.ShadersStore[D.vertexShader+A+"VertexShader"]=V,c.Effect.ShadersStore[D.fragmentShader+A+"PixelShader"]=j;var ve=new c.ShaderMaterial(A,h.scene,Pe,Ce);if(ve.onError=oe(D,ve,F),ve.onCompiled=J(h,ve,b,R,ee,L),ve.sideOrientation=c.Material.CounterClockWiseSideOrientation,G&&G.functions){var Ee=G.functions;Ee.cullFace&&Ee.cullFace[0]!==f.ECullingType.BACK&&(ve.backFaceCulling=!1);var ie=Ee.blendFuncSeparate;ie&&(ie[0]===f.EBlendingFunction.SRC_ALPHA&&ie[1]===f.EBlendingFunction.ONE_MINUS_SRC_ALPHA&&ie[2]===f.EBlendingFunction.ONE&&ie[3]===f.EBlendingFunction.ONE?ve.alphaMode=c.Constants.ALPHA_COMBINE:ie[0]===f.EBlendingFunction.ONE&&ie[1]===f.EBlendingFunction.ONE&&ie[2]===f.EBlendingFunction.ZERO&&ie[3]===f.EBlendingFunction.ONE?ve.alphaMode=c.Constants.ALPHA_ONEONE:ie[0]===f.EBlendingFunction.SRC_ALPHA&&ie[1]===f.EBlendingFunction.ONE&&ie[2]===f.EBlendingFunction.ZERO&&ie[3]===f.EBlendingFunction.ONE?ve.alphaMode=c.Constants.ALPHA_ADD:ie[0]===f.EBlendingFunction.ZERO&&ie[1]===f.EBlendingFunction.ONE_MINUS_SRC_COLOR&&ie[2]===f.EBlendingFunction.ONE&&ie[3]===f.EBlendingFunction.ONE?ve.alphaMode=c.Constants.ALPHA_SUBTRACT:ie[0]===f.EBlendingFunction.DST_COLOR&&ie[1]===f.EBlendingFunction.ZERO&&ie[2]===f.EBlendingFunction.ONE&&ie[3]===f.EBlendingFunction.ONE?ve.alphaMode=c.Constants.ALPHA_MULTIPLY:ie[0]===f.EBlendingFunction.SRC_ALPHA&&ie[1]===f.EBlendingFunction.ONE_MINUS_SRC_COLOR&&ie[2]===f.EBlendingFunction.ONE&&ie[3]===f.EBlendingFunction.ONE&&(ve.alphaMode=c.Constants.ALPHA_MAXIMIZED))}},v}(),Z=function(){function v(){}return v.RegisterExtension=function(h){if(v.Extensions[h.name]){c.Tools.Error('Tool with the same name "'+h.name+'" already exists');return}v.Extensions[h.name]=h},v.prototype.dispose=function(){},v.prototype._importMeshAsync=function(h,A,L,F,R,b,N,D){var G=this;return A.useRightHandedSystem=!0,C.LoadRuntimeAsync(A,L,F,function(U){U.assetContainer=R,U.importOnlyMeshes=!0,h===""?U.importMeshesNames=[]:typeof h=="string"?U.importMeshesNames=[h]:h&&!(h instanceof Array)?U.importMeshesNames=[h]:(U.importMeshesNames=[],c.Tools.Warn("Argument meshesNames must be of type string or string[]")),G._createNodes(U);var z=[],V=[];for(var j in U.nodes){var W=U.nodes[j];W.babylonNode instanceof c.AbstractMesh&&z.push(W.babylonNode)}for(var X in U.skins){var ee=U.skins[X];ee.babylonSkeleton instanceof c.Skeleton&&V.push(ee.babylonSkeleton)}G._loadBuffersAsync(U,function(){G._loadShadersAsync(U,function(){te(U),re(U),!p.GLTFFileLoader.IncrementalLoading&&b&&b(z,V)})}),p.GLTFFileLoader.IncrementalLoading&&b&&b(z,V)},D),!0},v.prototype.importMeshAsync=function(h,A,L,F,R,b){var N=this;return new Promise(function(D,G){N._importMeshAsync(h,A,F,R,L,function(U,z){D({meshes:U,particleSystems:[],skeletons:z,animationGroups:[],lights:[],transformNodes:[],geometries:[],spriteManagers:[]})},b,function(U){G(new Error(U))})})},v.prototype._loadAsync=function(h,A,L,F,R,b){var N=this;h.useRightHandedSystem=!0,C.LoadRuntimeAsync(h,A,L,function(D){C.LoadRuntimeExtensionsAsync(D,function(){N._createNodes(D),N._loadBuffersAsync(D,function(){N._loadShadersAsync(D,function(){te(D),re(D),p.GLTFFileLoader.IncrementalLoading||F()})}),p.GLTFFileLoader.IncrementalLoading&&F()},b)},b)},v.prototype.loadAsync=function(h,A,L,F){var R=this;return new Promise(function(b,N){R._loadAsync(h,A,L,function(){b()},F,function(D){N(new Error(D))})})},v.prototype._loadShadersAsync=function(h,A){var L=!1,F=function(N,D){C.LoadShaderStringAsync(h,N,function(G){G instanceof ArrayBuffer||(h.loadedShaderCount++,G&&(c.Effect.ShadersStore[N+(D.type===f.EShaderType.VERTEX?"VertexShader":"PixelShader")]=G),h.loadedShaderCount===h.shaderscount&&A())},function(){c.Tools.Error("Error when loading shader program named "+N+" located at "+D.uri)})};for(var R in h.shaders){L=!0;var b=h.shaders[R];b?F.bind(this,R,b)():c.Tools.Error("No shader named: "+R)}L||A()},v.prototype._loadBuffersAsync=function(h,A){var L=!1,F=function(N,D){C.LoadBufferAsync(h,N,function(G){h.loadedBufferCount++,G&&(G.byteLength!=h.buffers[N].byteLength&&c.Tools.Error("Buffer named "+N+" is length "+G.byteLength+". Expected: "+D.byteLength),h.loadedBufferViews[N]=G),h.loadedBufferCount===h.buffersCount&&A()},function(){c.Tools.Error("Error when loading buffer named "+N+" located at "+D.uri)})};for(var R in h.buffers){L=!0;var b=h.buffers[R];b?F.bind(this,R,b)():c.Tools.Error("No buffer named: "+R)}L||A()},v.prototype._createNodes=function(h){var A=h.currentScene;if(A)for(var L=0;L<A.nodes.length;L++)Y(h,A.nodes[L],null);else for(var F in h.scenes){A=h.scenes[F];for(var L=0;L<A.nodes.length;L++)Y(h,A.nodes[L],null)}},v.Extensions={},v}(),C=function(){function v(h){this._name=h}return Object.defineProperty(v.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),v.prototype.loadRuntimeAsync=function(h,A,L,F,R){return!1},v.prototype.loadRuntimeExtensionsAsync=function(h,A,L){return!1},v.prototype.loadBufferAsync=function(h,A,L,F,R){return!1},v.prototype.loadTextureBufferAsync=function(h,A,L,F){return!1},v.prototype.createTextureAsync=function(h,A,L,F,R){return!1},v.prototype.loadShaderStringAsync=function(h,A,L,F){return!1},v.prototype.loadMaterialAsync=function(h,A,L,F){return!1},v.LoadRuntimeAsync=function(h,A,L,F,R){v._ApplyExtensions(function(b){return b.loadRuntimeAsync(h,A,L,F,R)},function(){setTimeout(function(){F&&F(q.CreateRuntime(A.json,h,L))})})},v.LoadRuntimeExtensionsAsync=function(h,A,L){v._ApplyExtensions(function(F){return F.loadRuntimeExtensionsAsync(h,A,L)},function(){setTimeout(function(){A()})})},v.LoadBufferAsync=function(h,A,L,F,R){v._ApplyExtensions(function(b){return b.loadBufferAsync(h,A,L,F,R)},function(){q.LoadBufferAsync(h,A,L,F,R)})},v.LoadTextureAsync=function(h,A,L,F){v._LoadTextureBufferAsync(h,A,function(R){R&&v._CreateTextureAsync(h,A,R,L,F)},F)},v.LoadShaderStringAsync=function(h,A,L,F){v._ApplyExtensions(function(R){return R.loadShaderStringAsync(h,A,L,F)},function(){q.LoadShaderStringAsync(h,A,L,F)})},v.LoadMaterialAsync=function(h,A,L,F){v._ApplyExtensions(function(R){return R.loadMaterialAsync(h,A,L,F)},function(){q.LoadMaterialAsync(h,A,L,F)})},v._LoadTextureBufferAsync=function(h,A,L,F){v._ApplyExtensions(function(R){return R.loadTextureBufferAsync(h,A,L,F)},function(){q.LoadTextureBufferAsync(h,A,L,F)})},v._CreateTextureAsync=function(h,A,L,F,R){v._ApplyExtensions(function(b){return b.createTextureAsync(h,A,L,F,R)},function(){q.CreateTextureAsync(h,A,L,F)})},v._ApplyExtensions=function(h,A){for(var L in Z.Extensions){var F=Z.Extensions[L];if(h(F))return}A()},v}();p.GLTFFileLoader._CreateGLTF1Loader=function(){return new Z}},"../../../dev/loaders/src/glTF/1.0/glTFLoaderInterfaces.ts":(w,M,d)=>{d.r(M),d.d(M,{EBlendingFunction:()=>l,EComponentType:()=>f,ECullingType:()=>i,EParameterType:()=>m,EShaderType:()=>c,ETextureFilterType:()=>T,ETextureFormat:()=>a,ETextureWrapMode:()=>p});var f;(function(r){r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.FLOAT=5126]="FLOAT"})(f||(f={}));var c;(function(r){r[r.FRAGMENT=35632]="FRAGMENT",r[r.VERTEX=35633]="VERTEX"})(c||(c={}));var m;(function(r){r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.SAMPLER_2D=35678]="SAMPLER_2D"})(m||(m={}));var p;(function(r){r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.REPEAT=10497]="REPEAT"})(p||(p={}));var T;(function(r){r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9728]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(T||(T={}));var a;(function(r){r[r.ALPHA=6406]="ALPHA",r[r.RGB=6407]="RGB",r[r.RGBA=6408]="RGBA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA"})(a||(a={}));var i;(function(r){r[r.FRONT=1028]="FRONT",r[r.BACK=1029]="BACK",r[r.FRONT_AND_BACK=1032]="FRONT_AND_BACK"})(i||(i={}));var l;(function(r){r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC_COLOR=768]="SRC_COLOR",r[r.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",r[r.DST_COLOR=774]="DST_COLOR",r[r.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.CONSTANT_COLOR=32769]="CONSTANT_COLOR",r[r.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",r[r.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",r[r.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(l||(l={}))},"../../../dev/loaders/src/glTF/1.0/glTFLoaderUtils.ts":(w,M,d)=>{d.r(M),d.d(M,{GLTFUtils:()=>m});var f=d("../../../dev/loaders/src/glTF/1.0/glTFLoaderInterfaces.ts"),c=d("babylonjs/Misc/tools"),m=function(){function p(){}return p.SetMatrix=function(T,a,i,l,r){var t=null;if(i.semantic==="MODEL"?t=a.getWorldMatrix():i.semantic==="PROJECTION"?t=T.getProjectionMatrix():i.semantic==="VIEW"?t=T.getViewMatrix():i.semantic==="MODELVIEWINVERSETRANSPOSE"?t=c.Matrix.Transpose(a.getWorldMatrix().multiply(T.getViewMatrix()).invert()):i.semantic==="MODELVIEW"?t=a.getWorldMatrix().multiply(T.getViewMatrix()):i.semantic==="MODELVIEWPROJECTION"?t=a.getWorldMatrix().multiply(T.getTransformMatrix()):i.semantic==="MODELINVERSE"?t=a.getWorldMatrix().invert():i.semantic==="VIEWINVERSE"?t=T.getViewMatrix().invert():i.semantic==="PROJECTIONINVERSE"?t=T.getProjectionMatrix().invert():i.semantic==="MODELVIEWINVERSE"?t=a.getWorldMatrix().multiply(T.getViewMatrix()).invert():i.semantic==="MODELVIEWPROJECTIONINVERSE"?t=a.getWorldMatrix().multiply(T.getTransformMatrix()).invert():i.semantic==="MODELINVERSETRANSPOSE"&&(t=c.Matrix.Transpose(a.getWorldMatrix().invert())),t)switch(i.type){case f.EParameterType.FLOAT_MAT2:r.setMatrix2x2(l,c.Matrix.GetAsMatrix2x2(t));break;case f.EParameterType.FLOAT_MAT3:r.setMatrix3x3(l,c.Matrix.GetAsMatrix3x3(t));break;case f.EParameterType.FLOAT_MAT4:r.setMatrix(l,t);break}},p.SetUniform=function(T,a,i,l){switch(l){case f.EParameterType.FLOAT:return T.setFloat(a,i),!0;case f.EParameterType.FLOAT_VEC2:return T.setVector2(a,c.Vector2.FromArray(i)),!0;case f.EParameterType.FLOAT_VEC3:return T.setVector3(a,c.Vector3.FromArray(i)),!0;case f.EParameterType.FLOAT_VEC4:return T.setVector4(a,c.Vector4.FromArray(i)),!0;default:return!1}},p.GetWrapMode=function(T){switch(T){case f.ETextureWrapMode.CLAMP_TO_EDGE:return c.Texture.CLAMP_ADDRESSMODE;case f.ETextureWrapMode.MIRRORED_REPEAT:return c.Texture.MIRROR_ADDRESSMODE;case f.ETextureWrapMode.REPEAT:return c.Texture.WRAP_ADDRESSMODE;default:return c.Texture.WRAP_ADDRESSMODE}},p.GetByteStrideFromType=function(T){var a=T.type;switch(a){case"VEC2":return 2;case"VEC3":return 3;case"VEC4":return 4;case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 1}},p.GetTextureFilterMode=function(T){switch(T){case f.ETextureFilterType.LINEAR:case f.ETextureFilterType.LINEAR_MIPMAP_NEAREST:case f.ETextureFilterType.LINEAR_MIPMAP_LINEAR:return c.Texture.TRILINEAR_SAMPLINGMODE;case f.ETextureFilterType.NEAREST:case f.ETextureFilterType.NEAREST_MIPMAP_NEAREST:return c.Texture.NEAREST_SAMPLINGMODE;default:return c.Texture.BILINEAR_SAMPLINGMODE}},p.GetBufferFromBufferView=function(T,a,i,l,r){i=a.byteOffset+i;var t=T.loadedBufferViews[a.buffer];if(i+l>t.byteLength)throw new Error("Buffer access is out of range");var e=t.buffer;switch(i+=t.byteOffset,r){case f.EComponentType.BYTE:return new Int8Array(e,i,l);case f.EComponentType.UNSIGNED_BYTE:return new Uint8Array(e,i,l);case f.EComponentType.SHORT:return new Int16Array(e,i,l);case f.EComponentType.UNSIGNED_SHORT:return new Uint16Array(e,i,l);default:return new Float32Array(e,i,l)}},p.GetBufferFromAccessor=function(T,a){var i=T.bufferViews[a.bufferView],l=a.count*p.GetByteStrideFromType(a);return p.GetBufferFromBufferView(T,i,a.byteOffset,l,a.componentType)},p.DecodeBufferToText=function(T){for(var a="",i=T.byteLength,l=0;l<i;++l)a+=String.fromCharCode(T[l]);return a},p.GetDefaultMaterial=function(T){if(!p._DefaultMaterial){c.Effect.ShadersStore.GLTFDefaultMaterialVertexShader=["precision highp float;","","uniform mat4 worldView;","uniform mat4 projection;","","attribute vec3 position;","","void main(void)","{","    gl_Position = projection * worldView * vec4(position, 1.0);","}"].join(`
`),c.Effect.ShadersStore.GLTFDefaultMaterialPixelShader=["precision highp float;","","uniform vec4 u_emission;","","void main(void)","{","    gl_FragColor = u_emission;","}"].join(`
`);var a={vertex:"GLTFDefaultMaterial",fragment:"GLTFDefaultMaterial"},i={attributes:["position"],uniforms:["worldView","projection","u_emission"],samplers:new Array,needAlphaBlending:!1};p._DefaultMaterial=new c.ShaderMaterial("GLTFDefaultMaterial",T,a,i),p._DefaultMaterial.setColor4("u_emission",new c.Color4(.5,.5,.5,1))}return p._DefaultMaterial},p._DefaultMaterial=null,p}()},"../../../dev/loaders/src/glTF/1.0/glTFMaterialsCommonExtension.ts":(w,M,d)=>{d.r(M),d.d(M,{GLTFMaterialsCommonExtension:()=>p});var f=d("../../../../node_modules/tslib/tslib.es6.mjs"),c=d("../../../dev/loaders/src/glTF/1.0/glTFLoader.ts"),m=d("babylonjs/Misc/tools"),p=function(T){(0,f.__extends)(a,T);function a(){return T.call(this,"KHR_materials_common")||this}return a.prototype.loadRuntimeExtensionsAsync=function(i){if(!i.extensions)return!1;var l=i.extensions[this.name];if(!l)return!1;var r=l.lights;if(r)for(var t in r){var e=r[t];switch(e.type){case"ambient":{var n=new m.HemisphericLight(e.name,new m.Vector3(0,1,0),i.scene),o=e.ambient;o&&(n.diffuse=m.Color3.FromArray(o.color||[1,1,1]));break}case"point":{var s=new m.PointLight(e.name,new m.Vector3(10,10,10),i.scene),u=e.point;u&&(s.diffuse=m.Color3.FromArray(u.color||[1,1,1]));break}case"directional":{var _=new m.DirectionalLight(e.name,new m.Vector3(0,-1,0),i.scene),g=e.directional;g&&(_.diffuse=m.Color3.FromArray(g.color||[1,1,1]));break}case"spot":{var O=e.spot;if(O){var y=new m.SpotLight(e.name,new m.Vector3(0,10,0),new m.Vector3(0,-1,0),O.fallOffAngle||Math.PI,O.fallOffExponent||0,i.scene);y.diffuse=m.Color3.FromArray(O.color||[1,1,1])}break}default:m.Tools.Warn('GLTF Material Common extension: light type "'+e.type+" not supported");break}}return!1},a.prototype.loadMaterialAsync=function(i,l,r,t){var e=i.materials[l];if(!e||!e.extensions)return!1;var n=e.extensions[this.name];if(!n)return!1;var o=new m.StandardMaterial(l,i.scene);return o.sideOrientation=m.Material.CounterClockWiseSideOrientation,n.technique==="CONSTANT"&&(o.disableLighting=!0),o.backFaceCulling=n.doubleSided===void 0?!1:!n.doubleSided,o.alpha=n.values.transparency===void 0?1:n.values.transparency,o.specularPower=n.values.shininess===void 0?0:n.values.shininess,typeof n.values.ambient=="string"?this._loadTexture(i,n.values.ambient,o,"ambientTexture",t):o.ambientColor=m.Color3.FromArray(n.values.ambient||[0,0,0]),typeof n.values.diffuse=="string"?this._loadTexture(i,n.values.diffuse,o,"diffuseTexture",t):o.diffuseColor=m.Color3.FromArray(n.values.diffuse||[0,0,0]),typeof n.values.emission=="string"?this._loadTexture(i,n.values.emission,o,"emissiveTexture",t):o.emissiveColor=m.Color3.FromArray(n.values.emission||[0,0,0]),typeof n.values.specular=="string"?this._loadTexture(i,n.values.specular,o,"specularTexture",t):o.specularColor=m.Color3.FromArray(n.values.specular||[0,0,0]),!0},a.prototype._loadTexture=function(i,l,r,t,e){c.GLTFLoaderBase.LoadTextureBufferAsync(i,l,function(n){c.GLTFLoaderBase.CreateTextureAsync(i,l,n,function(o){return r[t]=o})},e)},a}(c.GLTFLoaderExtension);c.GLTFLoader.RegisterExtension(new p)},"../../../dev/loaders/src/glTF/1.0/index.ts":(w,M,d)=>{d.r(M),d.d(M,{EBlendingFunction:()=>m.EBlendingFunction,EComponentType:()=>m.EComponentType,ECullingType:()=>m.ECullingType,EParameterType:()=>m.EParameterType,EShaderType:()=>m.EShaderType,ETextureFilterType:()=>m.ETextureFilterType,ETextureFormat:()=>m.ETextureFormat,ETextureWrapMode:()=>m.ETextureWrapMode,GLTFBinaryExtension:()=>f.GLTFBinaryExtension,GLTFLoader:()=>c.GLTFLoader,GLTFLoaderBase:()=>c.GLTFLoaderBase,GLTFLoaderExtension:()=>c.GLTFLoaderExtension,GLTFMaterialsCommonExtension:()=>T.GLTFMaterialsCommonExtension,GLTFUtils:()=>p.GLTFUtils});var f=d("../../../dev/loaders/src/glTF/1.0/glTFBinaryExtension.ts"),c=d("../../../dev/loaders/src/glTF/1.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/1.0/glTFLoaderInterfaces.ts"),p=d("../../../dev/loaders/src/glTF/1.0/glTFLoaderUtils.ts"),T=d("../../../dev/loaders/src/glTF/1.0/glTFMaterialsCommonExtension.ts")},"../../../dev/loaders/src/glTF/2.0/Extensions/EXT_lights_ies.ts":(w,M,d)=>{d.r(M),d.d(M,{EXT_lights_ies:()=>a});var f=d("../../../../node_modules/tslib/tslib.es6.mjs"),c=d("babylonjs/Misc/tools"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),p=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),T="EXT_lights_ies",a=function(){function i(l){this.name=T,this._loader=l,this.enabled=this._loader.isExtensionUsed(T)}return i.prototype.dispose=function(){this._loader=null,delete this._lights},i.prototype.onLoading=function(){var l=this._loader.gltf.extensions;if(l&&l[this.name]){var r=l[this.name];this._lights=r.lights,m.ArrayItem.Assign(this._lights)}},i.prototype.loadNodeAsync=function(l,r,t){var e=this;return m.GLTFLoader.LoadExtensionAsync(l,r,this.name,function(n,o){return(0,f.__awaiter)(e,void 0,void 0,function(){var s,u,_,g,O,y=this;return(0,f.__generator)(this,function(E){switch(E.label){case 0:return this._loader._allMaterialsDirtyRequired=!0,[4,this._loader.loadNodeAsync(l,r,function(P){u=m.ArrayItem.Get(n,y._lights,o.light);var x=u.name||P.name;y._loader.babylonScene._blockEntityCollection=!!y._loader._assetContainer,s=new c.SpotLight(x,c.Vector3.Zero(),c.Vector3.Backward(),0,1,y._loader.babylonScene),s.angle=Math.PI/2,s.innerAngle=0,s._parentContainer=y._loader._assetContainer,y._loader.babylonScene._blockEntityCollection=!1,u._babylonLight=s,s.falloffType=c.Light.FALLOFF_GLTF,s.diffuse=o.color?c.Color3.FromArray(o.color):c.Color3.White(),s.intensity=o.multiplier||1,s.range=Number.MAX_VALUE,s.parent=P,y._loader._babylonLights.push(s),m.GLTFLoader.AddPointerMetadata(s,n),t(P)})];case 1:return _=E.sent(),u.uri?[4,this._loader.loadUriAsync(l,u,u.uri)]:[3,3];case 2:return g=E.sent(),[3,5];case 3:return O=m.ArrayItem.Get("".concat(l,"/bufferView"),this._loader.gltf.bufferViews,u.bufferView),[4,this._loader.loadBufferViewAsync("/bufferViews/".concat(O.index),O)];case 4:g=E.sent(),E.label=5;case 5:return s.iesProfileTexture=new c.Texture(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,g,!0,void 0,void 0,void 0,void 0,".ies"),[2,_]}})})})},i}();(0,p.unregisterGLTFExtension)(T),(0,p.registerGLTFExtension)(T,!0,function(i){return new a(i)})},"../../../dev/loaders/src/glTF/2.0/Extensions/EXT_lights_image_based.ts":(w,M,d)=>{d.r(M),d.d(M,{EXT_lights_image_based:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="EXT_lights_image_based",T=function(){function a(i){this.name=p,this._loader=i,this.enabled=this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){this._loader=null,delete this._lights},a.prototype.onLoading=function(){var i=this._loader.gltf.extensions;if(i&&i[this.name]){var l=i[this.name];this._lights=l.lights}},a.prototype.loadSceneAsync=function(i,l){var r=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(t,e){r._loader._allMaterialsDirtyRequired=!0;var n=new Array;n.push(r._loader.loadSceneAsync(i,l)),r._loader.logOpen("".concat(t));var o=c.ArrayItem.Get("".concat(t,"/light"),r._lights,e.light);return n.push(r._loadLightAsync("/extensions/".concat(r.name,"/lights/").concat(e.light),o).then(function(s){r._loader.babylonScene.environmentTexture=s})),r._loader.logClose(),Promise.all(n).then(function(){})})},a.prototype._loadLightAsync=function(i,l){var r=this;if(!l._loaded){var t=new Array;this._loader.logOpen("".concat(i));for(var e=new Array(l.specularImages.length),n=function(u){var _=l.specularImages[u];e[u]=new Array(_.length);for(var g=function(y){var E="".concat(i,"/specularImages/").concat(u,"/").concat(y);o._loader.logOpen("".concat(E));var P=_[y],x=c.ArrayItem.Get(E,o._loader.gltf.images,P);t.push(o._loader.loadImageAsync("/images/".concat(P),x).then(function(B){e[u][y]=B})),o._loader.logClose()},O=0;O<_.length;O++)g(O)},o=this,s=0;s<l.specularImages.length;s++)n(s);this._loader.logClose(),l._loaded=Promise.all(t).then(function(){var u=new f.RawCubeTexture(r._loader.babylonScene,null,l.specularImageSize);if(u.name=l.name||"environment",l._babylonTexture=u,l.intensity!=null&&(u.level=l.intensity),l.rotation){var _=f.Quaternion.FromArray(l.rotation);r._loader.babylonScene.useRightHandedSystem||(_=f.Quaternion.Inverse(_)),f.Matrix.FromQuaternionToRef(_,u.getReflectionTextureMatrix())}if(!l.irradianceCoefficients)throw new Error("".concat(i,": Irradiance coefficients are missing"));var g=f.SphericalHarmonics.FromArray(l.irradianceCoefficients);g.scaleInPlace(l.intensity),g.convertIrradianceToLambertianRadiance();var O=f.SphericalPolynomial.FromHarmonics(g),y=(e.length-1)/Math.log2(l.specularImageSize);return u.updateRGBDAsync(e,O,y)})}return l._loaded.then(function(){return l._babylonTexture})},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/EXT_mesh_gpu_instancing.ts":(w,M,d)=>{d.r(M),d.d(M,{EXT_mesh_gpu_instancing:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="EXT_mesh_gpu_instancing",T=function(){function a(i){this.name=p,this._loader=i,this.enabled=this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadNodeAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(e,n){t._loader._disableInstancedMesh++;var o=t._loader.loadNodeAsync("/nodes/".concat(l.index),l,r);if(t._loader._disableInstancedMesh--,!l._primitiveBabylonMeshes)return o;var s=new Array,u=0,_=function(g){if(n.attributes[g]==null){s.push(Promise.resolve(null));return}var O=c.ArrayItem.Get("".concat(e,"/attributes/").concat(g),t._loader.gltf.accessors,n.attributes[g]);if(s.push(t._loader._loadFloatAccessorAsync("/accessors/".concat(O.bufferView),O)),u===0)u=O.count;else if(u!==O.count)throw new Error("".concat(e,"/attributes: Instance buffer accessors do not have the same count."))};return _("TRANSLATION"),_("ROTATION"),_("SCALE"),o.then(function(g){return Promise.all(s).then(function(O){var y=O[0],E=O[1],P=O[2],x=new Float32Array(u*16);f.TmpVectors.Vector3[0].copyFromFloats(0,0,0),f.TmpVectors.Quaternion[0].copyFromFloats(0,0,0,1),f.TmpVectors.Vector3[1].copyFromFloats(1,1,1);for(var B=0;B<u;++B)y&&f.Vector3.FromArrayToRef(y,B*3,f.TmpVectors.Vector3[0]),E&&f.Quaternion.FromArrayToRef(E,B*4,f.TmpVectors.Quaternion[0]),P&&f.Vector3.FromArrayToRef(P,B*3,f.TmpVectors.Vector3[1]),f.Matrix.ComposeToRef(f.TmpVectors.Vector3[1],f.TmpVectors.Quaternion[0],f.TmpVectors.Vector3[0],f.TmpVectors.Matrix[0]),f.TmpVectors.Matrix[0].copyToArray(x,B*16);for(var K=0,I=l._primitiveBabylonMeshes;K<I.length;K++){var S=I[K];S.thinInstanceSetBuffer("matrix",x,16,!0)}return g})})})},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/EXT_meshopt_compression.ts":(w,M,d)=>{d.r(M),d.d(M,{EXT_meshopt_compression:()=>T});var f=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),c=d("babylonjs/Misc/tools"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="EXT_meshopt_compression",T=function(){function a(i){this.name=p,this.enabled=i.isExtensionUsed(p),this._loader=i}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadBufferViewAsync=function(i,l){var r=this;return f.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(t,e){var n=l;if(n._meshOptData)return n._meshOptData;var o=f.ArrayItem.Get("".concat(i,"/buffer"),r._loader.gltf.buffers,e.buffer);return n._meshOptData=r._loader.loadBufferAsync("/buffers/".concat(o.index),o,e.byteOffset||0,e.byteLength).then(function(s){return c.MeshoptCompression.Default.decodeGltfBufferAsync(s,e.count,e.byteStride,e.mode,e.filter)}),n._meshOptData})},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/EXT_texture_avif.ts":(w,M,d)=>{d.r(M),d.d(M,{EXT_texture_avif:()=>p});var f=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),m="EXT_texture_avif",p=function(){function T(a){this.name=m,this._loader=a,this.enabled=a.isExtensionUsed(m)}return T.prototype.dispose=function(){this._loader=null},T.prototype._loadTextureAsync=function(a,i,l){var r=this;return f.GLTFLoader.LoadExtensionAsync(a,i,this.name,function(t,e){var n=i.sampler==null?f.GLTFLoader.DefaultSampler:f.ArrayItem.Get("".concat(a,"/sampler"),r._loader.gltf.samplers,i.sampler),o=f.ArrayItem.Get("".concat(t,"/source"),r._loader.gltf.images,e.source);return r._loader._createTextureAsync(a,n,o,function(s){l(s)},void 0,!i._textureInfo.nonColorData)})},T}();(0,c.unregisterGLTFExtension)(m),(0,c.registerGLTFExtension)(m,!0,function(T){return new p(T)})},"../../../dev/loaders/src/glTF/2.0/Extensions/EXT_texture_webp.ts":(w,M,d)=>{d.r(M),d.d(M,{EXT_texture_webp:()=>p});var f=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),m="EXT_texture_webp",p=function(){function T(a){this.name=m,this._loader=a,this.enabled=a.isExtensionUsed(m)}return T.prototype.dispose=function(){this._loader=null},T.prototype._loadTextureAsync=function(a,i,l){var r=this;return f.GLTFLoader.LoadExtensionAsync(a,i,this.name,function(t,e){var n=i.sampler==null?f.GLTFLoader.DefaultSampler:f.ArrayItem.Get("".concat(a,"/sampler"),r._loader.gltf.samplers,i.sampler),o=f.ArrayItem.Get("".concat(t,"/source"),r._loader.gltf.images,e.source);return r._loader._createTextureAsync(a,n,o,function(s){l(s)},void 0,!i._textureInfo.nonColorData)})},T}();(0,c.unregisterGLTFExtension)(m),(0,c.registerGLTFExtension)(m,!0,function(T){return new p(T)})},"../../../dev/loaders/src/glTF/2.0/Extensions/ExtrasAsMetadata.ts":(w,M,d)=>{d.r(M),d.d(M,{ExtrasAsMetadata:()=>m});var f=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),c="ExtrasAsMetadata",m=function(){function p(T){this.name=c,this.enabled=!0,this._loader=T}return p.prototype._assignExtras=function(T,a){if(a.extras&&Object.keys(a.extras).length>0){var i=T.metadata=T.metadata||{},l=i.gltf=i.gltf||{};l.extras=a.extras}},p.prototype.dispose=function(){this._loader=null},p.prototype.loadNodeAsync=function(T,a,i){var l=this;return this._loader.loadNodeAsync(T,a,function(r){l._assignExtras(r,a),i(r)})},p.prototype.loadCameraAsync=function(T,a,i){var l=this;return this._loader.loadCameraAsync(T,a,function(r){l._assignExtras(r,a),i(r)})},p.prototype.createMaterial=function(T,a,i){var l=this._loader.createMaterial(T,a,i);return this._assignExtras(l,a),l},p}();(0,f.unregisterGLTFExtension)(c),(0,f.registerGLTFExtension)(c,!1,function(p){return new m(p)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_animation_pointer.data.ts":(w,M,d)=>{d.r(M),d.d(M,{animationPointerTree:()=>O});var f=d("../../../../node_modules/tslib/tslib.es6.mjs"),c=d("babylonjs/Misc/tools"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderAnimation.ts");function p(y,E,P,x){return c.Color3.FromArray(E,P).scale(x)}function T(y,E,P,x){return E[P+3]*x}function a(y,E,P,x){return E[P]*x}function i(y,E,P,x){return-E[P]*x}function l(y,E,P,x){return E[P+1]*x}function r(y,E,P,x){return E[P]*x*2}function t(y){return{scale:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"".concat(y,".uScale"),a,function(){return 2}),new n(c.Animation.ANIMATIONTYPE_FLOAT,"".concat(y,".vScale"),l,function(){return 2})],offset:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"".concat(y,".uOffset"),a,function(){return 2}),new n(c.Animation.ANIMATIONTYPE_FLOAT,"".concat(y,".vOffset"),l,function(){return 2})],rotation:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"".concat(y,".wAng"),i,function(){return 1})]}}var e=function(y){(0,f.__extends)(E,y);function E(){return y!==null&&y.apply(this,arguments)||this}return E.prototype.buildAnimations=function(P,x,B,K,I){I(P._babylonCamera,this._buildAnimation(x,B,K))},E}(m.AnimationPropertyInfo),n=function(y){(0,f.__extends)(E,y);function E(){return y!==null&&y.apply(this,arguments)||this}return E.prototype.buildAnimations=function(P,x,B,K,I){for(var S in P._data)I(P._data[S].babylonMaterial,this._buildAnimation(x,B,K))},E}(m.AnimationPropertyInfo),o=function(y){(0,f.__extends)(E,y);function E(){return y!==null&&y.apply(this,arguments)||this}return E.prototype.buildAnimations=function(P,x,B,K,I){I(P._babylonLight,this._buildAnimation(x,B,K))},E}(m.AnimationPropertyInfo),s={__array__:(0,f.__assign)({__target__:!0},m.nodeAnimationData)},u={__array__:{__target__:!0,orthographic:{xmag:[new e(c.Animation.ANIMATIONTYPE_FLOAT,"orthoLeft",i,function(){return 1}),new e(c.Animation.ANIMATIONTYPE_FLOAT,"orthoRight",l,function(){return 1})],ymag:[new e(c.Animation.ANIMATIONTYPE_FLOAT,"orthoBottom",i,function(){return 1}),new e(c.Animation.ANIMATIONTYPE_FLOAT,"orthoTop",l,function(){return 1})],zfar:[new e(c.Animation.ANIMATIONTYPE_FLOAT,"maxZ",a,function(){return 1})],znear:[new e(c.Animation.ANIMATIONTYPE_FLOAT,"minZ",a,function(){return 1})]},perspective:{yfov:[new e(c.Animation.ANIMATIONTYPE_FLOAT,"fov",a,function(){return 1})],zfar:[new e(c.Animation.ANIMATIONTYPE_FLOAT,"maxZ",a,function(){return 1})],znear:[new e(c.Animation.ANIMATIONTYPE_FLOAT,"minZ",a,function(){return 1})]}}},_={__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new n(c.Animation.ANIMATIONTYPE_COLOR3,"albedoColor",p,function(){return 4}),new n(c.Animation.ANIMATIONTYPE_FLOAT,"alpha",T,function(){return 4})],metallicFactor:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"metallic",a,function(){return 1})],roughnessFactor:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"roughness",a,function(){return 1})],baseColorTexture:{extensions:{KHR_texture_transform:t("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:t("metallicTexture")}}},emissiveFactor:[new n(c.Animation.ANIMATIONTYPE_COLOR3,"emissiveColor",p,function(){return 3})],normalTexture:{scale:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"bumpTexture.level",a,function(){return 1})],extensions:{KHR_texture_transform:t("bumpTexture")}},occlusionTexture:{strength:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",a,function(){return 1})],extensions:{KHR_texture_transform:t("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:t("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",a,function(){return 1})],anisotropyRotation:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"anisotropy.angle",a,function(){return 1})],anisotropyTexture:{extensions:{KHR_texture_transform:t("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",a,function(){return 1})],clearcoatRoughnessFactor:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",a,function(){return 1})],clearcoatTexture:{extensions:{KHR_texture_transform:t("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",a,function(){return 1})],extensions:{KHR_texture_transform:t("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:t("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",a,function(){return 1})]},KHR_materials_emissive_strength:{emissiveStrength:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"emissiveIntensity",a,function(){return 1})]},KHR_materials_ior:{ior:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"indexOfRefraction",a,function(){return 1})]},KHR_materials_iridescence:{iridescenceFactor:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"iridescence.intensity",a,function(){return 1})],iridescenceIor:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",a,function(){return 1})],iridescenceThicknessMinimum:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",a,function(){return 1})],iridescenceThicknessMaximum:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",a,function(){return 1})],iridescenceTexture:{extensions:{KHR_texture_transform:t("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:t("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new n(c.Animation.ANIMATIONTYPE_COLOR3,"sheen.color",p,function(){return 3})],sheenRoughnessFactor:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"sheen.roughness",a,function(){return 1})],sheenColorTexture:{extensions:{KHR_texture_transform:t("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:t("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"metallicF0Factor",a,function(){return 1})],specularColorFactor:[new n(c.Animation.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",p,function(){return 3})],specularTexture:{extensions:{KHR_texture_transform:t("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:t("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",a,function(){return 1})],transmissionTexture:{extensions:{KHR_texture_transform:t("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new n(c.Animation.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",p,function(){return 3})],attenuationDistance:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",a,function(){return 1})],thicknessFactor:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",a,function(){return 1})],thicknessTexture:{extensions:{KHR_texture_transform:t("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new n(c.Animation.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",a,function(){return 1})],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:t("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new n(c.Animation.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",p,function(){return 3})],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:t("subSurface.translucencyColorTexture")}}}}}},g={KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new o(c.Animation.ANIMATIONTYPE_COLOR3,"diffuse",p,function(){return 3})],intensity:[new o(c.Animation.ANIMATIONTYPE_FLOAT,"intensity",a,function(){return 1})],range:[new o(c.Animation.ANIMATIONTYPE_FLOAT,"range",a,function(){return 1})],spot:{innerConeAngle:[new o(c.Animation.ANIMATIONTYPE_FLOAT,"innerAngle",r,function(){return 1})],outerConeAngle:[new o(c.Animation.ANIMATIONTYPE_FLOAT,"angle",r,function(){return 1})]}}}},EXT_lights_ies:{lights:{__array__:{__target__:!0,color:[new o(c.Animation.ANIMATIONTYPE_COLOR3,"diffuse",p,function(){return 3})],multiplier:[new o(c.Animation.ANIMATIONTYPE_FLOAT,"intensity",a,function(){return 1})]}}}},O={nodes:s,materials:_,cameras:u,extensions:g}},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_animation_pointer.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_animation_pointer:()=>l});var f=d("../../../../node_modules/tslib/tslib.es6.mjs"),c=d("babylonjs/Misc/tools"),m=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_animation_pointer.data.ts"),p=d("../../../dev/loaders/src/glTF/2.0/Extensions/gltfPathToObjectConverter.ts"),T=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),a="KHR_animation_pointer",i=function(r){(0,f.__extends)(t,r);function t(e){return r.call(this,e,m.animationPointerTree)||this}return t}(p.GLTFPathToObjectConverter),l=function(){function r(t){this.name=a,this._loader=t,this._pathToObjectConverter=new i(this._loader.gltf)}return Object.defineProperty(r.prototype,"enabled",{get:function(){return this._loader.isExtensionUsed(a)},enumerable:!1,configurable:!0}),r.prototype.dispose=function(){this._loader=null,delete this._pathToObjectConverter},r.prototype._loadAnimationChannelAsync=function(t,e,n,o,s){var u,_=(u=o.target.extensions)===null||u===void 0?void 0:u.KHR_animation_pointer;if(!_||!this._pathToObjectConverter)return null;o.target.path!=="pointer"&&c.Logger.Warn("".concat(t,"/target/path: Value (").concat(o.target.path,") must be (").concat("pointer",") when using the ").concat(this.name," extension")),o.target.node!=null&&c.Logger.Warn("".concat(t,"/target/node: Value (").concat(o.target.node,") must not be present when using the ").concat(this.name," extension"));var g="".concat(t,"/extensions/").concat(this.name),O=_.pointer;if(!O)throw new Error("".concat(g,": Pointer is missing"));try{var y=this._pathToObjectConverter.convert(O);return this._loader._loadAnimationChannelFromTargetInfoAsync(t,e,n,o,y,s)}catch{return c.Logger.Warn("".concat(g,"/pointer: Invalid pointer (").concat(O,") skipped")),null}},r}();(0,T.unregisterGLTFExtension)(a),(0,T.registerGLTFExtension)(a,!0,function(r){return new l(r)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_draco_mesh_compression.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_draco_mesh_compression:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="KHR_draco_mesh_compression",T=function(){function a(i){this.name=p,this.useNormalizedFlagFromAccessor=!0,this._loader=i,this.enabled=f.DracoDecoder.DefaultAvailable&&this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){delete this.dracoDecoder,this._loader=null},a.prototype._loadVertexDataAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(e,n){if(l.mode!=null&&l.mode!==4&&l.mode!==5)throw new Error("".concat(i,": Unsupported mode ").concat(l.mode));var o={},s={},u=function(g,O){var y=n.attributes[g];if(y!=null&&(r._delayInfo=r._delayInfo||[],r._delayInfo.indexOf(O)===-1&&r._delayInfo.push(O),o[O]=y,t.useNormalizedFlagFromAccessor)){var E=c.ArrayItem.TryGet(t._loader.gltf.accessors,l.attributes[g]);E&&(s[O]=E.normalized||!1)}};u("POSITION",f.VertexBuffer.PositionKind),u("NORMAL",f.VertexBuffer.NormalKind),u("TANGENT",f.VertexBuffer.TangentKind),u("TEXCOORD_0",f.VertexBuffer.UVKind),u("TEXCOORD_1",f.VertexBuffer.UV2Kind),u("TEXCOORD_2",f.VertexBuffer.UV3Kind),u("TEXCOORD_3",f.VertexBuffer.UV4Kind),u("TEXCOORD_4",f.VertexBuffer.UV5Kind),u("TEXCOORD_5",f.VertexBuffer.UV6Kind),u("JOINTS_0",f.VertexBuffer.MatricesIndicesKind),u("WEIGHTS_0",f.VertexBuffer.MatricesWeightsKind),u("COLOR_0",f.VertexBuffer.ColorKind);var _=c.ArrayItem.Get(e,t._loader.gltf.bufferViews,n.bufferView);return _._dracoBabylonGeometry||(_._dracoBabylonGeometry=t._loader.loadBufferViewAsync("/bufferViews/".concat(_.index),_).then(function(g){var O=t.dracoDecoder||f.DracoDecoder.Default,y=c.ArrayItem.TryGet(t._loader.gltf.accessors,l.attributes.POSITION),E=!t._loader.parent.alwaysComputeBoundingBox&&!r.skeleton&&y?(0,c.LoadBoundingInfoFromPositionAccessor)(y):null;return O._decodeMeshToGeometryForGltfAsync(r.name,t._loader.babylonScene,g,o,s,E).catch(function(P){throw new Error("".concat(i,": ").concat(P.message))})})),_._dracoBabylonGeometry})},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_interactivity.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_interactivity:()=>a});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/Extensions/interactivityFunctions.ts"),m=d("../../../dev/loaders/src/glTF/2.0/Extensions/interactivityPathToObjectConverter.ts"),p=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),T="KHR_interactivity",a=function(){function i(l){this._loader=l,this.name=T,this.enabled=this._loader.isExtensionUsed(T),this._pathConverter=new m.InteractivityPathToObjectConverter(this._loader.gltf)}return i.prototype.dispose=function(){this._loader=null,delete this._pathConverter},i.prototype.onReady=function(){var l;if(!(!this._loader.babylonScene||!this._pathConverter)){var r=this._loader.babylonScene,t=(l=this._loader.gltf.extensions)===null||l===void 0?void 0:l.KHR_interactivity,e=(0,c.convertGLTFToSerializedFlowGraph)(t),n=new f.FlowGraphCoordinator({scene:r});f.FlowGraph.Parse(e,{coordinator:n,pathConverter:this._pathConverter}),n.start()}},i}();(0,p.unregisterGLTFExtension)(T),(0,p.registerGLTFExtension)(T,!0,function(i){return new a(i)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_lights_punctual.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_lights:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="KHR_lights_punctual",T=function(){function a(i){this.name=p,this._loader=i,this.enabled=this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){this._loader=null,delete this._lights},a.prototype.onLoading=function(){var i=this._loader.gltf.extensions;if(i&&i[this.name]){var l=i[this.name];this._lights=l.lights,c.ArrayItem.Assign(this._lights)}},a.prototype.loadNodeAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(e,n){return t._loader._allMaterialsDirtyRequired=!0,t._loader.loadNodeAsync(i,l,function(o){var s,u=c.ArrayItem.Get(e,t._lights,n.light),_=u.name||o.name;switch(t._loader.babylonScene._blockEntityCollection=!!t._loader._assetContainer,u.type){case"directional":{var g=new f.DirectionalLight(_,f.Vector3.Backward(),t._loader.babylonScene);g.position.setAll(0),s=g;break}case"point":{s=new f.PointLight(_,f.Vector3.Zero(),t._loader.babylonScene);break}case"spot":{var O=new f.SpotLight(_,f.Vector3.Zero(),f.Vector3.Backward(),0,1,t._loader.babylonScene);O.angle=(u.spot&&u.spot.outerConeAngle||Math.PI/4)*2,O.innerAngle=(u.spot&&u.spot.innerConeAngle||0)*2,s=O;break}default:throw t._loader.babylonScene._blockEntityCollection=!1,new Error("".concat(e,": Invalid light type (").concat(u.type,")"))}s._parentContainer=t._loader._assetContainer,t._loader.babylonScene._blockEntityCollection=!1,u._babylonLight=s,s.falloffType=f.Light.FALLOFF_GLTF,s.diffuse=u.color?f.Color3.FromArray(u.color):f.Color3.White(),s.intensity=u.intensity==null?1:u.intensity,s.range=u.range==null?Number.MAX_VALUE:u.range,s.parent=o,t._loader._babylonLights.push(s),c.GLTFLoader.AddPointerMetadata(s,e),r(o)})})},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_anisotropy.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_materials_anisotropy:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="KHR_materials_anisotropy",T=function(){function a(i){this.name=p,this.order=195,this._loader=i,this.enabled=this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(e,n){var o=new Array;return o.push(t._loader.loadMaterialPropertiesAsync(i,l,r)),o.push(t._loadIridescencePropertiesAsync(e,n,r)),Promise.all(o).then(function(){})})},a.prototype._loadIridescencePropertiesAsync=function(i,l,r){var t,e;if(!(r instanceof f.PBRMaterial))throw new Error("".concat(i,": Material type not supported"));var n=new Array;return r.anisotropy.isEnabled=!0,r.anisotropy.intensity=(t=l.anisotropyStrength)!==null&&t!==void 0?t:0,r.anisotropy.angle=(e=l.anisotropyRotation)!==null&&e!==void 0?e:0,l.anisotropyTexture&&(l.anisotropyTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync("".concat(i,"/anisotropyTexture"),l.anisotropyTexture,function(o){o.name="".concat(r.name," (Anisotropy Intensity)"),r.anisotropy.texture=o}))),Promise.all(n).then(function(){})},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_clearcoat.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_materials_clearcoat:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="KHR_materials_clearcoat",T=function(){function a(i){this.name=p,this.order=190,this._loader=i,this.enabled=this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(e,n){var o=new Array;return o.push(t._loader.loadMaterialPropertiesAsync(i,l,r)),o.push(t._loadClearCoatPropertiesAsync(e,n,r)),Promise.all(o).then(function(){})})},a.prototype._loadClearCoatPropertiesAsync=function(i,l,r){if(!(r instanceof f.PBRMaterial))throw new Error("".concat(i,": Material type not supported"));var t=new Array;return r.clearCoat.isEnabled=!0,r.clearCoat.useRoughnessFromMainTexture=!1,r.clearCoat.remapF0OnInterfaceChange=!1,l.clearcoatFactor!=null?r.clearCoat.intensity=l.clearcoatFactor:r.clearCoat.intensity=0,l.clearcoatTexture&&t.push(this._loader.loadTextureInfoAsync("".concat(i,"/clearcoatTexture"),l.clearcoatTexture,function(e){e.name="".concat(r.name," (ClearCoat)"),r.clearCoat.texture=e})),l.clearcoatRoughnessFactor!=null?r.clearCoat.roughness=l.clearcoatRoughnessFactor:r.clearCoat.roughness=0,l.clearcoatRoughnessTexture&&(l.clearcoatRoughnessTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync("".concat(i,"/clearcoatRoughnessTexture"),l.clearcoatRoughnessTexture,function(e){e.name="".concat(r.name," (ClearCoat Roughness)"),r.clearCoat.textureRoughness=e}))),l.clearcoatNormalTexture&&(l.clearcoatNormalTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync("".concat(i,"/clearcoatNormalTexture"),l.clearcoatNormalTexture,function(e){e.name="".concat(r.name," (ClearCoat Normal)"),r.clearCoat.bumpTexture=e})),r.invertNormalMapX=!r.getScene().useRightHandedSystem,r.invertNormalMapY=r.getScene().useRightHandedSystem,l.clearcoatNormalTexture.scale!=null&&(r.clearCoat.bumpTexture.level=l.clearcoatNormalTexture.scale)),Promise.all(t).then(function(){})},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_diffuse_transmission.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_materials_diffuse_transmission:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="KHR_materials_diffuse_transmission",T=function(){function a(i){this.name=p,this.order=174,this._loader=i,this.enabled=this._loader.isExtensionUsed(p),this.enabled&&(i.parent.transparencyAsCoverage=!0)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(e,n){var o=new Array;return o.push(t._loader.loadMaterialPropertiesAsync(i,l,r)),o.push(t._loadTranslucentPropertiesAsync(e,l,r,n)),Promise.all(o).then(function(){})})},a.prototype._loadTranslucentPropertiesAsync=function(i,l,r,t){if(!(r instanceof f.PBRMaterial))throw new Error("".concat(i,": Material type not supported"));var e=r;if(e.subSurface.isTranslucencyEnabled=!0,e.subSurface.volumeIndexOfRefraction=1,e.subSurface.minimumThickness=0,e.subSurface.maximumThickness=0,e.subSurface.useAlbedoToTintTranslucency=!1,t.diffuseTransmissionFactor!==void 0)e.subSurface.translucencyIntensity=t.diffuseTransmissionFactor;else return e.subSurface.translucencyIntensity=0,e.subSurface.isTranslucencyEnabled=!1,Promise.resolve();var n=new Array;return e.subSurface.useGltfStyleTextures=!0,t.diffuseTransmissionTexture&&(t.diffuseTransmissionTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync("".concat(i,"/diffuseTransmissionTexture"),t.diffuseTransmissionTexture).then(function(o){o.name="".concat(r.name," (Diffuse Transmission)"),e.subSurface.translucencyIntensityTexture=o}))),t.diffuseTransmissionColorFactor!==void 0?e.subSurface.translucencyColor=f.Color3.FromArray(t.diffuseTransmissionColorFactor):e.subSurface.translucencyColor=f.Color3.White(),t.diffuseTransmissionColorTexture&&n.push(this._loader.loadTextureInfoAsync("".concat(i,"/diffuseTransmissionColorTexture"),t.diffuseTransmissionColorTexture).then(function(o){o.name="".concat(r.name," (Diffuse Transmission Color)"),e.subSurface.translucencyColorTexture=o})),Promise.all(n).then(function(){})},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_dispersion.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_materials_dispersion:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="KHR_materials_dispersion",T=function(){function a(i){this.name=p,this.order=174,this._loader=i,this.enabled=this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(e,n){var o=new Array;return o.push(t._loader.loadMaterialPropertiesAsync(i,l,r)),o.push(t._loadDispersionPropertiesAsync(e,l,r,n)),Promise.all(o).then(function(){})})},a.prototype._loadDispersionPropertiesAsync=function(i,l,r,t){if(!(r instanceof f.PBRMaterial))throw new Error("".concat(i,": Material type not supported"));return!r.subSurface.isRefractionEnabled||!t.dispersion||(r.subSurface.isDispersionEnabled=!0,r.subSurface.dispersion=t.dispersion),Promise.resolve()},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_emissive_strength.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_materials_emissive_strength:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="KHR_materials_emissive_strength",T=function(){function a(i){this.name=p,this.order=170,this._loader=i,this.enabled=this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(e,n){return t._loader.loadMaterialPropertiesAsync(i,l,r).then(function(){t._loadEmissiveProperties(e,n,r)})})},a.prototype._loadEmissiveProperties=function(i,l,r){if(!(r instanceof f.PBRMaterial))throw new Error("".concat(i,": Material type not supported"));l.emissiveStrength!==void 0&&(r.emissiveIntensity=l.emissiveStrength)},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_ior.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_materials_ior:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="KHR_materials_ior",T=function(){function a(i){this.name=p,this.order=180,this._loader=i,this.enabled=this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(e,n){var o=new Array;return o.push(t._loader.loadMaterialPropertiesAsync(i,l,r)),o.push(t._loadIorPropertiesAsync(e,n,r)),Promise.all(o).then(function(){})})},a.prototype._loadIorPropertiesAsync=function(i,l,r){if(!(r instanceof f.PBRMaterial))throw new Error("".concat(i,": Material type not supported"));return l.ior!==void 0?r.indexOfRefraction=l.ior:r.indexOfRefraction=a._DEFAULT_IOR,Promise.resolve()},a._DEFAULT_IOR=1.5,a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_iridescence.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_materials_iridescence:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="KHR_materials_iridescence",T=function(){function a(i){this.name=p,this.order=195,this._loader=i,this.enabled=this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(e,n){var o=new Array;return o.push(t._loader.loadMaterialPropertiesAsync(i,l,r)),o.push(t._loadIridescencePropertiesAsync(e,n,r)),Promise.all(o).then(function(){})})},a.prototype._loadIridescencePropertiesAsync=function(i,l,r){var t,e,n,o,s;if(!(r instanceof f.PBRMaterial))throw new Error("".concat(i,": Material type not supported"));var u=new Array;return r.iridescence.isEnabled=!0,r.iridescence.intensity=(t=l.iridescenceFactor)!==null&&t!==void 0?t:0,r.iridescence.indexOfRefraction=(n=(e=l.iridescenceIor)!==null&&e!==void 0?e:l.iridescenceIOR)!==null&&n!==void 0?n:1.3,r.iridescence.minimumThickness=(o=l.iridescenceThicknessMinimum)!==null&&o!==void 0?o:100,r.iridescence.maximumThickness=(s=l.iridescenceThicknessMaximum)!==null&&s!==void 0?s:400,l.iridescenceTexture&&u.push(this._loader.loadTextureInfoAsync("".concat(i,"/iridescenceTexture"),l.iridescenceTexture,function(_){_.name="".concat(r.name," (Iridescence)"),r.iridescence.texture=_})),l.iridescenceThicknessTexture&&u.push(this._loader.loadTextureInfoAsync("".concat(i,"/iridescenceThicknessTexture"),l.iridescenceThicknessTexture,function(_){_.name="".concat(r.name," (Iridescence Thickness)"),r.iridescence.thicknessTexture=_})),Promise.all(u).then(function(){})},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_pbrSpecularGlossiness.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_materials_pbrSpecularGlossiness:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="KHR_materials_pbrSpecularGlossiness",T=function(){function a(i){this.name=p,this.order=200,this._loader=i,this.enabled=this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(e,n){var o=new Array;return o.push(t._loader.loadMaterialBasePropertiesAsync(i,l,r)),o.push(t._loadSpecularGlossinessPropertiesAsync(e,n,r)),t._loader.loadMaterialAlphaProperties(i,l,r),Promise.all(o).then(function(){})})},a.prototype._loadSpecularGlossinessPropertiesAsync=function(i,l,r){if(!(r instanceof f.PBRMaterial))throw new Error("".concat(i,": Material type not supported"));var t=new Array;return r.metallic=null,r.roughness=null,l.diffuseFactor?(r.albedoColor=f.Color3.FromArray(l.diffuseFactor),r.alpha=l.diffuseFactor[3]):r.albedoColor=f.Color3.White(),r.reflectivityColor=l.specularFactor?f.Color3.FromArray(l.specularFactor):f.Color3.White(),r.microSurface=l.glossinessFactor==null?1:l.glossinessFactor,l.diffuseTexture&&t.push(this._loader.loadTextureInfoAsync("".concat(i,"/diffuseTexture"),l.diffuseTexture,function(e){e.name="".concat(r.name," (Diffuse)"),r.albedoTexture=e})),l.specularGlossinessTexture&&(t.push(this._loader.loadTextureInfoAsync("".concat(i,"/specularGlossinessTexture"),l.specularGlossinessTexture,function(e){e.name="".concat(r.name," (Specular Glossiness)"),r.reflectivityTexture=e,r.reflectivityTexture.hasAlpha=!0})),r.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(t).then(function(){})},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_sheen.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_materials_sheen:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="KHR_materials_sheen",T=function(){function a(i){this.name=p,this.order=190,this._loader=i,this.enabled=this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(e,n){var o=new Array;return o.push(t._loader.loadMaterialPropertiesAsync(i,l,r)),o.push(t._loadSheenPropertiesAsync(e,n,r)),Promise.all(o).then(function(){})})},a.prototype._loadSheenPropertiesAsync=function(i,l,r){if(!(r instanceof f.PBRMaterial))throw new Error("".concat(i,": Material type not supported"));var t=new Array;return r.sheen.isEnabled=!0,r.sheen.intensity=1,l.sheenColorFactor!=null?r.sheen.color=f.Color3.FromArray(l.sheenColorFactor):r.sheen.color=f.Color3.Black(),l.sheenColorTexture&&t.push(this._loader.loadTextureInfoAsync("".concat(i,"/sheenColorTexture"),l.sheenColorTexture,function(e){e.name="".concat(r.name," (Sheen Color)"),r.sheen.texture=e})),l.sheenRoughnessFactor!==void 0?r.sheen.roughness=l.sheenRoughnessFactor:r.sheen.roughness=0,l.sheenRoughnessTexture&&(l.sheenRoughnessTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync("".concat(i,"/sheenRoughnessTexture"),l.sheenRoughnessTexture,function(e){e.name="".concat(r.name," (Sheen Roughness)"),r.sheen.textureRoughness=e}))),r.sheen.albedoScaling=!0,r.sheen.useRoughnessFromMainTexture=!1,Promise.all(t).then(function(){})},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_specular.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_materials_specular:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="KHR_materials_specular",T=function(){function a(i){this.name=p,this.order=190,this._loader=i,this.enabled=this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(e,n){var o=new Array;return o.push(t._loader.loadMaterialPropertiesAsync(i,l,r)),o.push(t._loadSpecularPropertiesAsync(e,n,r)),Promise.all(o).then(function(){})})},a.prototype._loadSpecularPropertiesAsync=function(i,l,r){if(!(r instanceof f.PBRMaterial))throw new Error("".concat(i,": Material type not supported"));var t=new Array;return l.specularFactor!==void 0&&(r.metallicF0Factor=l.specularFactor),l.specularColorFactor!==void 0&&(r.metallicReflectanceColor=f.Color3.FromArray(l.specularColorFactor)),l.specularTexture&&(l.specularTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync("".concat(i,"/specularTexture"),l.specularTexture,function(e){e.name="".concat(r.name," (Specular)"),r.metallicReflectanceTexture=e,r.useOnlyMetallicFromMetallicReflectanceTexture=!0}))),l.specularColorTexture&&t.push(this._loader.loadTextureInfoAsync("".concat(i,"/specularColorTexture"),l.specularColorTexture,function(e){e.name="".concat(r.name," (Specular Color)"),r.reflectanceTexture=e})),Promise.all(t).then(function(){})},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_transmission.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_materials_transmission:()=>i});var f=d("../../../../node_modules/tslib/tslib.es6.mjs"),c=d("babylonjs/Misc/tools"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),p=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),T=function(){function l(r,t){var e=this;this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options=(0,f.__assign)((0,f.__assign)({},l._GetDefaultOptions()),r),this._scene=t,this._scene._transmissionHelper=this,this.onErrorObservable=new c.Observable,this._scene.onDisposeObservable.addOnce(function(){e.dispose()}),this._parseScene(),this._setupRenderTargets()}return l._GetDefaultOptions=function(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:c.Constants.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}},l.prototype.updateOptions=function(r){var t=this,e=Object.keys(r).filter(function(s){return t._options[s]!==r[s]});if(e.length){var n=(0,f.__assign)((0,f.__assign)({},this._options),r),o=this._options;this._options=n,n.renderSize!==o.renderSize||n.renderTargetTextureType!==o.renderTargetTextureType||n.generateMipmaps!==o.generateMipmaps||!this._opaqueRenderTarget?this._setupRenderTargets():(this._opaqueRenderTarget.samples=n.samples,this._opaqueRenderTarget.lodGenerationScale=n.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=n.lodGenerationOffset)}},l.prototype.getOpaqueTarget=function(){return this._opaqueRenderTarget},l.prototype._shouldRenderAsTransmission=function(r){return r?!!(r instanceof c.PBRMaterial&&r.subSurface.isRefractionEnabled):!1},l.prototype._addMesh=function(r){var t=this;this._materialObservers[r.uniqueId]=r.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),c.Tools.SetImmediate(function(){t._shouldRenderAsTransmission(r.material)?(r.material.refractionTexture=t._opaqueRenderTarget,t._transparentMeshesCache.indexOf(r)===-1&&t._transparentMeshesCache.push(r)):t._opaqueMeshesCache.indexOf(r)===-1&&t._opaqueMeshesCache.push(r)})},l.prototype._removeMesh=function(r){r.onMaterialChangedObservable.remove(this._materialObservers[r.uniqueId]),delete this._materialObservers[r.uniqueId];var t=this._transparentMeshesCache.indexOf(r);t!==-1&&this._transparentMeshesCache.splice(t,1),t=this._opaqueMeshesCache.indexOf(r),t!==-1&&this._opaqueMeshesCache.splice(t,1)},l.prototype._parseScene=function(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))},l.prototype._onMeshMaterialChanged=function(r){var t=this._transparentMeshesCache.indexOf(r),e=this._opaqueMeshesCache.indexOf(r),n=this._shouldRenderAsTransmission(r.material);n?(r.material instanceof c.PBRMaterial&&(r.material.subSurface.refractionTexture=this._opaqueRenderTarget),e!==-1?(this._opaqueMeshesCache.splice(e,1),this._transparentMeshesCache.push(r)):t===-1&&this._transparentMeshesCache.push(r)):t!==-1?(this._transparentMeshesCache.splice(t,1),this._opaqueMeshesCache.push(r)):e===-1&&this._opaqueMeshesCache.push(r)},l.prototype._isRenderTargetValid=function(){var r;return((r=this._opaqueRenderTarget)===null||r===void 0?void 0:r.getInternalTexture())!==null},l.prototype._setupRenderTargets=function(){var r=this,t,e;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new c.RenderTargetTexture("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(e=(t=this._options.clearColor)===null||t===void 0?void 0:t.clone())!==null&&e!==void 0?e:this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0;var n,o;this._opaqueRenderTarget.onBeforeBindObservable.add(function(s){o=r._scene.environmentIntensity,r._scene.environmentIntensity=1,n=r._scene.imageProcessingConfiguration.applyByPostProcess,r._options.clearColor?s.clearColor.copyFrom(r._options.clearColor):r._scene.clearColor.toLinearSpaceToRef(s.clearColor,r._scene.getEngine().useExactSrgbConversions),r._scene.imageProcessingConfiguration._applyByPostProcess=!0}),this._opaqueRenderTarget.onAfterUnbindObservable.add(function(){r._scene.environmentIntensity=o,r._scene.imageProcessingConfiguration._applyByPostProcess=n}),this._transparentMeshesCache.forEach(function(s){r._shouldRenderAsTransmission(s.material)&&(s.material.refractionTexture=r._opaqueRenderTarget)})},l.prototype.dispose=function(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]},l}(),a="KHR_materials_transmission",i=function(){function l(r){this.name=a,this.order=175,this._loader=r,this.enabled=this._loader.isExtensionUsed(a),this.enabled&&(r.parent.transparencyAsCoverage=!0)}return l.prototype.dispose=function(){this._loader=null},l.prototype.loadMaterialPropertiesAsync=function(r,t,e){var n=this;return m.GLTFLoader.LoadExtensionAsync(r,t,this.name,function(o,s){var u=new Array;return u.push(n._loader.loadMaterialPropertiesAsync(r,t,e)),u.push(n._loadTransparentPropertiesAsync(o,t,e,s)),Promise.all(u).then(function(){})})},l.prototype._loadTransparentPropertiesAsync=function(r,t,e,n){var o,s;if(!(e instanceof c.PBRMaterial))throw new Error("".concat(r,": Material type not supported"));var u=e;if(u.subSurface.isRefractionEnabled=!0,u.subSurface.volumeIndexOfRefraction=1,u.subSurface.useAlbedoToTintRefraction=!0,n.transmissionFactor!==void 0){u.subSurface.refractionIntensity=n.transmissionFactor;var _=u.getScene();u.subSurface.refractionIntensity&&!_._transmissionHelper?new T({},u.getScene()):u.subSurface.refractionIntensity&&!(!((o=_._transmissionHelper)===null||o===void 0)&&o._isRenderTargetValid())&&((s=_._transmissionHelper)===null||s===void 0||s._setupRenderTargets())}else return u.subSurface.refractionIntensity=0,u.subSurface.isRefractionEnabled=!1,Promise.resolve();return u.subSurface.minimumThickness=0,u.subSurface.maximumThickness=0,n.transmissionTexture?(n.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(r,"/transmissionTexture"),n.transmissionTexture,void 0).then(function(g){g.name="".concat(e.name," (Transmission)"),u.subSurface.refractionIntensityTexture=g,u.subSurface.useGltfStyleTextures=!0})):Promise.resolve()},l}();(0,p.unregisterGLTFExtension)(a),(0,p.registerGLTFExtension)(a,!0,function(l){return new i(l)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_unlit.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_materials_unlit:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="KHR_materials_unlit",T=function(){function a(i){this.name=p,this.order=210,this._loader=i,this.enabled=this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(){return t._loadUnlitPropertiesAsync(i,l,r)})},a.prototype._loadUnlitPropertiesAsync=function(i,l,r){if(!(r instanceof f.PBRMaterial))throw new Error("".concat(i,": Material type not supported"));var t=new Array;r.unlit=!0;var e=l.pbrMetallicRoughness;return e&&(e.baseColorFactor?(r.albedoColor=f.Color3.FromArray(e.baseColorFactor),r.alpha=e.baseColorFactor[3]):r.albedoColor=f.Color3.White(),e.baseColorTexture&&t.push(this._loader.loadTextureInfoAsync("".concat(i,"/baseColorTexture"),e.baseColorTexture,function(n){n.name="".concat(r.name," (Base Color)"),r.albedoTexture=n}))),l.doubleSided&&(r.backFaceCulling=!1,r.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(i,l,r),Promise.all(t).then(function(){})},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_variants.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_materials_variants:()=>T});var f=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),c=d("babylonjs/Misc/tools"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="KHR_materials_variants",T=function(){function a(i){this.name=p,this._loader=i,this.enabled=this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){this._loader=null},a.GetAvailableVariants=function(i){var l=this._GetExtensionMetadata(i);return l?Object.keys(l.variants):[]},a.prototype.getAvailableVariants=function(i){return a.GetAvailableVariants(i)},a.SelectVariant=function(i,l){var r=this._GetExtensionMetadata(i);if(!r)throw new Error("Cannot select variant on a glTF mesh that does not have the ".concat(p," extension"));var t=function(s){var u=r.variants[s];if(u)for(var _=0,g=u;_<g.length;_++){var O=g[_];O.mesh.material=O.material}};if(l instanceof Array)for(var e=0,n=l;e<n.length;e++){var o=n[e];t(o)}else t(l);r.lastSelected=l},a.prototype.selectVariant=function(i,l){a.SelectVariant(i,l)},a.Reset=function(i){var l=this._GetExtensionMetadata(i);if(!l)throw new Error("Cannot reset on a glTF mesh that does not have the ".concat(p," extension"));for(var r=0,t=l.original;r<t.length;r++){var e=t[r];e.mesh.material=e.material}l.lastSelected=null},a.prototype.reset=function(i){a.Reset(i)},a.GetLastSelectedVariant=function(i){var l=this._GetExtensionMetadata(i);if(!l)throw new Error("Cannot get the last selected variant on a glTF mesh that does not have the ".concat(p," extension"));return l.lastSelected},a.prototype.getLastSelectedVariant=function(i){return a.GetLastSelectedVariant(i)},a._GetExtensionMetadata=function(i){var l,r;return((r=(l=i==null?void 0:i._internalMetadata)===null||l===void 0?void 0:l.gltf)===null||r===void 0?void 0:r[p])||null},a.prototype.onLoading=function(){var i=this._loader.gltf.extensions;if(i&&i[this.name]){var l=i[this.name];this._variants=l.variants}},a.prototype.onReady=function(){var i,l,r=this._loader.rootBabylonMesh;r&&((l=(i=this._loader.parent.extensionOptions[p])===null||i===void 0?void 0:i.onLoaded)===null||l===void 0||l.call(i,{get variants(){return a.GetAvailableVariants(r)},get selectedVariant(){var t=a.GetLastSelectedVariant(r);return t?Array.isArray(t)?t[0]:t:a.GetAvailableVariants(r)[0]},set selectedVariant(t){a.SelectVariant(r,t)}}))},a.prototype._loadMeshPrimitiveAsync=function(i,l,r,t,e,n){var o=this;return f.GLTFLoader.LoadExtensionAsync(i,e,this.name,function(s,u){var _=new Array;return _.push(o._loader._loadMeshPrimitiveAsync(i,l,r,t,e,function(g){if(n(g),g instanceof c.Mesh){var O=f.GLTFLoader._GetDrawMode(i,e.mode),y=o._loader.rootBabylonMesh,E=y?y._internalMetadata=y._internalMetadata||{}:{},P=E.gltf=E.gltf||{},x=P[p]=P[p]||{lastSelected:null,original:[],variants:{}};x.original.push({mesh:g,material:g.material});for(var B=function(I){var S=u.mappings[I],H=f.ArrayItem.Get("".concat(s,"/mappings/").concat(I,"/material"),o._loader.gltf.materials,S.material);_.push(o._loader._loadMaterialAsync("#/materials/".concat(S.material),H,g,O,function(Y){for(var re=function($){var oe=S.variants[$],J=f.ArrayItem.Get("/extensions/".concat(p,"/variants/").concat(oe),o._variants,oe);x.variants[J.name]=x.variants[J.name]||[],x.variants[J.name].push({mesh:g,material:Y}),g.onClonedObservable.add(function(ne){var te=ne,q=null,Z=te;do{if(Z=Z.parent,!Z)return;q=a._GetExtensionMetadata(Z)}while(q===null);if(y&&q===a._GetExtensionMetadata(y)){Z._internalMetadata={};for(var C in y._internalMetadata)Z._internalMetadata[C]=y._internalMetadata[C];Z._internalMetadata.gltf=[];for(var C in y._internalMetadata.gltf)Z._internalMetadata.gltf[C]=y._internalMetadata.gltf[C];Z._internalMetadata.gltf[p]={lastSelected:null,original:[],variants:{}};for(var v=0,h=q.original;v<h.length;v++){var A=h[v];Z._internalMetadata.gltf[p].original.push({mesh:A.mesh,material:A.material})}for(var C in q.variants)if(Object.prototype.hasOwnProperty.call(q.variants,C)){Z._internalMetadata.gltf[p].variants[C]=[];for(var L=0,F=q.variants[C];L<F.length;L++){var R=F[L];Z._internalMetadata.gltf[p].variants[C].push({mesh:R.mesh,material:R.material})}}q=Z._internalMetadata.gltf[p]}for(var b=0,N=q.original;b<N.length;b++){var D=N[b];D.mesh===g&&(D.mesh=te)}for(var G=0,U=q.variants[J.name];G<U.length;G++){var D=U[G];D.mesh===g&&(D.mesh=te)}})},Q=0;Q<S.variants.length;++Q)re(Q)}))},K=0;K<u.mappings.length;++K)B(K)}})),Promise.all(_).then(function(g){var O=g[0];return O})})},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_volume.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_materials_volume:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="KHR_materials_volume",T=function(){function a(i){this.name=p,this.order=173,this._loader=i,this.enabled=this._loader.isExtensionUsed(p),this.enabled&&this._loader._disableInstancedMesh++}return a.prototype.dispose=function(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(e,n){var o=new Array;return o.push(t._loader.loadMaterialPropertiesAsync(i,l,r)),o.push(t._loadVolumePropertiesAsync(e,l,r,n)),Promise.all(o).then(function(){})})},a.prototype._loadVolumePropertiesAsync=function(i,l,r,t){if(!(r instanceof f.PBRMaterial))throw new Error("".concat(i,": Material type not supported"));if(!r.subSurface.isRefractionEnabled&&!r.subSurface.isTranslucencyEnabled||!t.thicknessFactor)return Promise.resolve();r.subSurface.volumeIndexOfRefraction=r.indexOfRefraction;var e=t.attenuationDistance!==void 0?t.attenuationDistance:Number.MAX_VALUE;return r.subSurface.tintColorAtDistance=e,t.attenuationColor!==void 0&&t.attenuationColor.length==3&&r.subSurface.tintColor.copyFromFloats(t.attenuationColor[0],t.attenuationColor[1],t.attenuationColor[2]),r.subSurface.minimumThickness=0,r.subSurface.maximumThickness=t.thicknessFactor,r.subSurface.useThicknessAsDepth=!0,t.thicknessTexture?(t.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(i,"/thicknessTexture"),t.thicknessTexture).then(function(n){n.name="".concat(r.name," (Thickness)"),r.subSurface.thicknessTexture=n,r.subSurface.useGltfStyleTextures=!0})):Promise.resolve()},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_mesh_quantization.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_mesh_quantization:()=>m});var f=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),c="KHR_mesh_quantization",m=function(){function p(T){this.name=c,this.enabled=T.isExtensionUsed(c)}return p.prototype.dispose=function(){},p}();(0,f.unregisterGLTFExtension)(c),(0,f.registerGLTFExtension)(c,!0,function(p){return new m(p)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_node_visibility.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_node_visibility:()=>p});var f=d("../../../../node_modules/tslib/tslib.es6.mjs"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),m="KHR_node_visibility",p=function(){function T(a){this.name=m,this._loader=a,this.enabled=a.isExtensionUsed(m)}return T.prototype.onReady=function(){return(0,f.__awaiter)(this,void 0,void 0,function(){var a;return(0,f.__generator)(this,function(i){return(a=this._loader.gltf.nodes)===null||a===void 0||a.forEach(function(l){var r,t,e,n;(r=l._primitiveBabylonMeshes)===null||r===void 0||r.forEach(function(o){o.inheritVisibility=!0}),!((t=l.extensions)===null||t===void 0)&&t.KHR_node_visibility&&((e=l.extensions)===null||e===void 0?void 0:e.KHR_node_visibility.visible)===!1&&(l._babylonTransformNode&&(l._babylonTransformNode.isVisible=!1),(n=l._primitiveBabylonMeshes)===null||n===void 0||n.forEach(function(o){o.isVisible=!1}))}),[2]})})},T.prototype.dispose=function(){this._loader=null},T}();(0,c.unregisterGLTFExtension)(m),(0,c.registerGLTFExtension)(m,!0,function(T){return new p(T)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_texture_basisu.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_texture_basisu:()=>p});var f=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),m="KHR_texture_basisu",p=function(){function T(a){this.name=m,this._loader=a,this.enabled=a.isExtensionUsed(m)}return T.prototype.dispose=function(){this._loader=null},T.prototype._loadTextureAsync=function(a,i,l){var r=this;return f.GLTFLoader.LoadExtensionAsync(a,i,this.name,function(t,e){var n=i.sampler==null?f.GLTFLoader.DefaultSampler:f.ArrayItem.Get("".concat(a,"/sampler"),r._loader.gltf.samplers,i.sampler),o=f.ArrayItem.Get("".concat(t,"/source"),r._loader.gltf.images,e.source);return r._loader._createTextureAsync(a,n,o,function(s){l(s)},i._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!i._textureInfo.nonColorData)})},T}();(0,c.unregisterGLTFExtension)(m),(0,c.registerGLTFExtension)(m,!0,function(T){return new p(T)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_texture_transform.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_texture_transform:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="KHR_texture_transform",T=function(){function a(i){this.name=p,this._loader=i,this.enabled=this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadTextureInfoAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(e,n){return t._loader.loadTextureInfoAsync(i,l,function(o){if(!(o instanceof f.Texture))throw new Error("".concat(e,": Texture type not supported"));n.offset&&(o.uOffset=n.offset[0],o.vOffset=n.offset[1]),o.uRotationCenter=0,o.vRotationCenter=0,n.rotation&&(o.wAng=-n.rotation),n.scale&&(o.uScale=n.scale[0],o.vScale=n.scale[1]),n.texCoord!=null&&(o.coordinatesIndex=n.texCoord),r(o)})})},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/KHR_xmp_json_ld.ts":(w,M,d)=>{d.r(M),d.d(M,{KHR_xmp_json_ld:()=>m});var f=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),c="KHR_xmp_json_ld",m=function(){function p(T){this.name=c,this.order=100,this._loader=T,this.enabled=this._loader.isExtensionUsed(c)}return p.prototype.dispose=function(){this._loader=null},p.prototype.onLoading=function(){var T,a,i;if(this._loader.rootBabylonMesh!==null){var l=(T=this._loader.gltf.extensions)===null||T===void 0?void 0:T.KHR_xmp_json_ld,r=(i=(a=this._loader.gltf.asset)===null||a===void 0?void 0:a.extensions)===null||i===void 0?void 0:i.KHR_xmp_json_ld;if(l&&r){var t=+r.packet;l.packets&&t<l.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=l.packets[t])}}},p}();(0,f.unregisterGLTFExtension)(c),(0,f.registerGLTFExtension)(c,!0,function(p){return new m(p)})},"../../../dev/loaders/src/glTF/2.0/Extensions/MSFT_audio_emitter.ts":(w,M,d)=>{d.r(M),d.d(M,{MSFT_audio_emitter:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="MSFT_audio_emitter",T=function(){function a(i){this.name=p,this._loader=i,this.enabled=this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){this._loader=null,this._clips=null,this._emitters=null},a.prototype.onLoading=function(){var i=this._loader.gltf.extensions;if(i&&i[this.name]){var l=i[this.name];this._clips=l.clips,this._emitters=l.emitters,c.ArrayItem.Assign(this._clips),c.ArrayItem.Assign(this._emitters)}},a.prototype.loadSceneAsync=function(i,l){var r=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(t,e){var n=new Array;n.push(r._loader.loadSceneAsync(i,l));for(var o=0,s=e.emitters;o<s.length;o++){var u=s[o],_=c.ArrayItem.Get("".concat(t,"/emitters"),r._emitters,u);if(_.refDistance!=null||_.maxDistance!=null||_.rolloffFactor!=null||_.distanceModel!=null||_.innerAngle!=null||_.outerAngle!=null)throw new Error("".concat(t,": Direction or Distance properties are not allowed on emitters attached to a scene"));n.push(r._loadEmitterAsync("".concat(t,"/emitters/").concat(_.index),_))}return Promise.all(n).then(function(){})})},a.prototype.loadNodeAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(e,n){var o=new Array;return t._loader.loadNodeAsync(e,l,function(s){for(var u=function(y){var E=c.ArrayItem.Get("".concat(e,"/emitters"),t._emitters,y);o.push(t._loadEmitterAsync("".concat(e,"/emitters/").concat(E.index),E).then(function(){for(var P=0,x=E._babylonSounds;P<x.length;P++){var B=x[P];B.attachToMesh(s),(E.innerAngle!=null||E.outerAngle!=null)&&(B.setLocalDirectionToMesh(f.Vector3.Forward()),B.setDirectionalCone(2*f.Tools.ToDegrees(E.innerAngle==null?Math.PI:E.innerAngle),2*f.Tools.ToDegrees(E.outerAngle==null?Math.PI:E.outerAngle),0))}}))},_=0,g=n.emitters;_<g.length;_++){var O=g[_];u(O)}r(s)}).then(function(s){return Promise.all(o).then(function(){return s})})})},a.prototype.loadAnimationAsync=function(i,l){var r=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(t,e){return r._loader.loadAnimationAsync(i,l).then(function(n){var o=new Array;c.ArrayItem.Assign(e.events);for(var s=0,u=e.events;s<u.length;s++){var _=u[s];o.push(r._loadAnimationEventAsync("".concat(t,"/events/").concat(_.index),i,l,_,n))}return Promise.all(o).then(function(){return n})})})},a.prototype._loadClipAsync=function(i,l){if(l._objectURL)return l._objectURL;var r;if(l.uri)r=this._loader.loadUriAsync(i,l,l.uri);else{var t=c.ArrayItem.Get("".concat(i,"/bufferView"),this._loader.gltf.bufferViews,l.bufferView);r=this._loader.loadBufferViewAsync("/bufferViews/".concat(t.index),t)}return l._objectURL=r.then(function(e){return URL.createObjectURL(new Blob([e],{type:l.mimeType}))}),l._objectURL},a.prototype._loadEmitterAsync=function(i,l){var r=this;if(l._babylonSounds=l._babylonSounds||[],!l._babylonData){for(var t=new Array,e=l.name||"emitter".concat(l.index),n={loop:!1,autoplay:!1,volume:l.volume==null?1:l.volume},o=function(g){var O="/extensions/".concat(s.name,"/clips"),y=c.ArrayItem.Get(O,s._clips,l.clips[g].clip);t.push(s._loadClipAsync("".concat(O,"/").concat(l.clips[g].clip),y).then(function(E){var P=l._babylonSounds[g]=new f.Sound(e,E,r._loader.babylonScene,null,n);P.refDistance=l.refDistance||1,P.maxDistance=l.maxDistance||256,P.rolloffFactor=l.rolloffFactor||1,P.distanceModel=l.distanceModel||"exponential"}))},s=this,u=0;u<l.clips.length;u++)o(u);var _=Promise.all(t).then(function(){var g=l.clips.map(function(y){return y.weight||1}),O=new f.WeightedSound(l.loop||!1,l._babylonSounds,g);l.innerAngle&&(O.directionalConeInnerAngle=2*f.Tools.ToDegrees(l.innerAngle)),l.outerAngle&&(O.directionalConeOuterAngle=2*f.Tools.ToDegrees(l.outerAngle)),l.volume&&(O.volume=l.volume),l._babylonData.sound=O});l._babylonData={loaded:_}}return l._babylonData.loaded},a.prototype._getEventAction=function(i,l,r,t,e){switch(r){case"play":return function(n){var o=(e||0)+(n-t);l.play(o)};case"stop":return function(){l.stop()};case"pause":return function(){l.pause()};default:throw new Error("".concat(i,": Unsupported action ").concat(r))}},a.prototype._loadAnimationEventAsync=function(i,l,r,t,e){var n=this;if(e.targetedAnimations.length==0)return Promise.resolve();var o=e.targetedAnimations[0],s=t.emitter,u=c.ArrayItem.Get("/extensions/".concat(this.name,"/emitters"),this._emitters,s);return this._loadEmitterAsync(i,u).then(function(){var _=u._babylonData.sound;if(_){var g=new f.AnimationEvent(t.time,n._getEventAction(i,_,t.action,t.time,t.startOffset));o.animation.addEvent(g),e.onAnimationGroupEndObservable.add(function(){_.stop()}),e.onAnimationGroupPauseObservable.add(function(){_.pause()})}})},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/MSFT_lod.ts":(w,M,d)=>{d.r(M),d.d(M,{MSFT_lod:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="MSFT_lod",T=function(){function a(i){var l,r;this.name=p,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new f.Observable,this.onMaterialLODsLoadedObservable=new f.Observable,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=i,this.maxLODsToLoad=(r=(l=this._loader.parent.extensionOptions[p])===null||l===void 0?void 0:l.maxLODsToLoad)!==null&&r!==void 0?r:this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()},a.prototype.onReady=function(){for(var i=this,l=function(o){var s=Promise.all(r._nodePromiseLODs[o]).then(function(){o!==0&&(i._loader.endPerformanceCounter("Node LOD ".concat(o)),i._loader.log("Loaded node LOD ".concat(o))),i.onNodeLODsLoadedObservable.notifyObservers(o),o!==i._nodePromiseLODs.length-1&&(i._loader.startPerformanceCounter("Node LOD ".concat(o+1)),i._loadBufferLOD(i._nodeBufferLODs,o+1),i._nodeSignalLODs[o]&&i._nodeSignalLODs[o].resolve())});r._loader._completePromises.push(s)},r=this,t=0;t<this._nodePromiseLODs.length;t++)l(t);for(var e=function(o){var s=Promise.all(n._materialPromiseLODs[o]).then(function(){o!==0&&(i._loader.endPerformanceCounter("Material LOD ".concat(o)),i._loader.log("Loaded material LOD ".concat(o))),i.onMaterialLODsLoadedObservable.notifyObservers(o),o!==i._materialPromiseLODs.length-1&&(i._loader.startPerformanceCounter("Material LOD ".concat(o+1)),i._loadBufferLOD(i._materialBufferLODs,o+1),i._materialSignalLODs[o]&&i._materialSignalLODs[o].resolve())});n._loader._completePromises.push(s)},n=this,t=0;t<this._materialPromiseLODs.length;t++)e(t)},a.prototype.loadSceneAsync=function(i,l){var r=this._loader.loadSceneAsync(i,l);return this._loadBufferLOD(this._bufferLODs,0),r},a.prototype.loadNodeAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(e,n){var o,s=t._getLODs(e,l,t._loader.gltf.nodes,n.ids);t._loader.logOpen("".concat(e));for(var u=function(g){var O=s[g];g!==0&&(t._nodeIndexLOD=g,t._nodeSignalLODs[g]=t._nodeSignalLODs[g]||new f.Deferred);var y=function(P){r(P),P.setEnabled(!1)},E=t._loader.loadNodeAsync("/nodes/".concat(O.index),O,y).then(function(P){if(g!==0){var x=s[g-1];x._babylonTransformNode&&(t._disposeTransformNode(x._babylonTransformNode),delete x._babylonTransformNode)}return P.setEnabled(!0),P});t._nodePromiseLODs[g]=t._nodePromiseLODs[g]||[],g===0?o=E:(t._nodeIndexLOD=null,t._nodePromiseLODs[g].push(E))},_=0;_<s.length;_++)u(_);return t._loader.logClose(),o})},a.prototype._loadMaterialAsync=function(i,l,r,t,e){var n=this;return this._nodeIndexLOD?null:c.GLTFLoader.LoadExtensionAsync(i,l,this.name,function(o,s){var u,_=n._getLODs(o,l,n._loader.gltf.materials,s.ids);n._loader.logOpen("".concat(o));for(var g=function(y){var E=_[y];y!==0&&(n._materialIndexLOD=y);var P=n._loader._loadMaterialAsync("/materials/".concat(E.index),E,r,t,function(x){y===0&&e(x)}).then(function(x){if(y!==0){e(x);var B=_[y-1]._data;B[t]&&(n._disposeMaterials([B[t].babylonMaterial]),delete B[t])}return x});n._materialPromiseLODs[y]=n._materialPromiseLODs[y]||[],y===0?u=P:(n._materialIndexLOD=null,n._materialPromiseLODs[y].push(P))},O=0;O<_.length;O++)g(O);return n._loader.logClose(),u})},a.prototype._loadUriAsync=function(i,l,r){var t=this;if(this._nodeIndexLOD!==null){this._loader.log("deferred");var e=this._nodeIndexLOD-1;return this._nodeSignalLODs[e]=this._nodeSignalLODs[e]||new f.Deferred,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then(function(){return t._loader.loadUriAsync(i,l,r)})}else if(this._materialIndexLOD!==null){this._loader.log("deferred");var e=this._materialIndexLOD-1;return this._materialSignalLODs[e]=this._materialSignalLODs[e]||new f.Deferred,this._materialSignalLODs[e].promise.then(function(){return t._loader.loadUriAsync(i,l,r)})}return null},a.prototype.loadBufferAsync=function(i,l,r,t){if(this._loader.parent.useRangeRequests&&!l.uri){if(!this._loader.bin)throw new Error("".concat(i,": Uri is missing or the binary glTF is missing its binary chunk"));var e=function(n,o){var s=r,u=s+t-1,_=n[o];return _?(_.start=Math.min(_.start,s),_.end=Math.max(_.end,u)):(_={start:s,end:u,loaded:new f.Deferred},n[o]=_),_.loaded.promise.then(function(g){return new Uint8Array(g.buffer,g.byteOffset+r-_.start,t)})};return this._loader.log("deferred"),this._nodeIndexLOD!==null?e(this._nodeBufferLODs,this._nodeIndexLOD):this._materialIndexLOD!==null?e(this._materialBufferLODs,this._materialIndexLOD):e(this._bufferLODs,0)}return null},a.prototype._loadBufferLOD=function(i,l){var r=i[l];r&&(this._loader.log("Loading buffer range [".concat(r.start,"-").concat(r.end,"]")),this._loader.bin.readAsync(r.start,r.end-r.start+1).then(function(t){r.loaded.resolve(t)},function(t){r.loaded.reject(t)}))},a.prototype._getLODs=function(i,l,r,t){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");for(var e=[],n=t.length-1;n>=0;n--)if(e.push(c.ArrayItem.Get("".concat(i,"/ids/").concat(t[n]),r,t[n])),e.length===this.maxLODsToLoad)return e;return e.push(l),e},a.prototype._disposeTransformNode=function(i){var l=this,r=[],t=i.material;t&&r.push(t);for(var e=0,n=i.getChildMeshes();e<n.length;e++){var o=n[e];o.material&&r.push(o.material)}i.dispose();var s=r.filter(function(u){return l._loader.babylonScene.meshes.every(function(_){return _.material!=u})});this._disposeMaterials(s)},a.prototype._disposeMaterials=function(i){for(var l={},r=0,t=i;r<t.length;r++){for(var e=t[r],n=0,o=e.getActiveTextures();n<o.length;n++){var s=o[n];l[s.uniqueId]=s}e.dispose()}for(var u in l)for(var _=0,g=this._loader.babylonScene.materials;_<g.length;_++){var e=g[_];e.hasTexture(l[u])&&delete l[u]}for(var u in l)l[u].dispose()},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/MSFT_minecraftMesh.ts":(w,M,d)=>{d.r(M),d.d(M,{MSFT_minecraftMesh:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="MSFT_minecraftMesh",T=function(){function a(i){this.name=p,this._loader=i,this.enabled=this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtraAsync(i,l,this.name,function(e,n){if(n){if(!(r instanceof f.PBRMaterial))throw new Error("".concat(e,": Material type not supported"));var o=t._loader.loadMaterialPropertiesAsync(i,l,r);return r.needAlphaBlending()&&(r.forceDepthWrite=!0,r.separateCullingPass=!0),r.backFaceCulling=r.forceDepthWrite,r.twoSidedLighting=!0,o}return null})},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/MSFT_sRGBFactors.ts":(w,M,d)=>{d.r(M),d.d(M,{MSFT_sRGBFactors:()=>T});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts"),m=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),p="MSFT_sRGBFactors",T=function(){function a(i){this.name=p,this._loader=i,this.enabled=this._loader.isExtensionUsed(p)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(i,l,r){var t=this;return c.GLTFLoader.LoadExtraAsync(i,l,this.name,function(e,n){if(n){if(!(r instanceof f.PBRMaterial))throw new Error("".concat(e,": Material type not supported"));var o=t._loader.loadMaterialPropertiesAsync(i,l,r),s=r.getScene().getEngine().useExactSrgbConversions;return r.albedoTexture||r.albedoColor.toLinearSpaceToRef(r.albedoColor,s),r.reflectivityTexture||r.reflectivityColor.toLinearSpaceToRef(r.reflectivityColor,s),o}return null})},a}();(0,m.unregisterGLTFExtension)(p),(0,m.registerGLTFExtension)(p,!0,function(a){return new T(a)})},"../../../dev/loaders/src/glTF/2.0/Extensions/gltfPathToObjectConverter.ts":(w,M,d)=>{d.r(M),d.d(M,{GLTFPathToObjectConverter:()=>f});var f=function(){function c(m,p){this._gltf=m,this._infoTree=p}return c.prototype.convert=function(m){var p=this._gltf,T=this._infoTree,a=void 0;if(!m.startsWith("/"))throw new Error("Path must start with a /");var i=m.split("/");i.shift();for(var l=0,r=i;l<r.length;l++){var t=r[l];if(T.__array__)T=T.__array__;else if(T=T[t],!T)throw new Error("Path ".concat(m," is invalid"));if(p===void 0)throw new Error("Path ".concat(m," is invalid"));p=p[t],T.__target__&&(a=p)}return{object:a,info:T}},c}()},"../../../dev/loaders/src/glTF/2.0/Extensions/index.ts":(w,M,d)=>{d.r(M),d.d(M,{EXT_lights_ies:()=>a.EXT_lights_ies,EXT_lights_image_based:()=>f.EXT_lights_image_based,EXT_mesh_gpu_instancing:()=>c.EXT_mesh_gpu_instancing,EXT_meshopt_compression:()=>m.EXT_meshopt_compression,EXT_texture_avif:()=>T.EXT_texture_avif,EXT_texture_webp:()=>p.EXT_texture_webp,ExtrasAsMetadata:()=>ne.ExtrasAsMetadata,KHR_animation_pointer:()=>H.KHR_animation_pointer,KHR_draco_mesh_compression:()=>i.KHR_draco_mesh_compression,KHR_interactivity:()=>oe.KHR_interactivity,KHR_lights:()=>l.KHR_lights,KHR_materials_anisotropy:()=>o.KHR_materials_anisotropy,KHR_materials_clearcoat:()=>e.KHR_materials_clearcoat,KHR_materials_diffuse_transmission:()=>E.KHR_materials_diffuse_transmission,KHR_materials_dispersion:()=>x.KHR_materials_dispersion,KHR_materials_emissive_strength:()=>s.KHR_materials_emissive_strength,KHR_materials_ior:()=>g.KHR_materials_ior,KHR_materials_iridescence:()=>n.KHR_materials_iridescence,KHR_materials_pbrSpecularGlossiness:()=>r.KHR_materials_pbrSpecularGlossiness,KHR_materials_sheen:()=>u.KHR_materials_sheen,KHR_materials_specular:()=>_.KHR_materials_specular,KHR_materials_transmission:()=>y.KHR_materials_transmission,KHR_materials_unlit:()=>t.KHR_materials_unlit,KHR_materials_variants:()=>O.KHR_materials_variants,KHR_materials_volume:()=>P.KHR_materials_volume,KHR_mesh_quantization:()=>B.KHR_mesh_quantization,KHR_node_visibility:()=>J.KHR_node_visibility,KHR_texture_basisu:()=>K.KHR_texture_basisu,KHR_texture_transform:()=>I.KHR_texture_transform,KHR_xmp_json_ld:()=>S.KHR_xmp_json_ld,MSFT_audio_emitter:()=>Y.MSFT_audio_emitter,MSFT_lod:()=>re.MSFT_lod,MSFT_minecraftMesh:()=>Q.MSFT_minecraftMesh,MSFT_sRGBFactors:()=>$.MSFT_sRGBFactors});var f=d("../../../dev/loaders/src/glTF/2.0/Extensions/EXT_lights_image_based.ts"),c=d("../../../dev/loaders/src/glTF/2.0/Extensions/EXT_mesh_gpu_instancing.ts"),m=d("../../../dev/loaders/src/glTF/2.0/Extensions/EXT_meshopt_compression.ts"),p=d("../../../dev/loaders/src/glTF/2.0/Extensions/EXT_texture_webp.ts"),T=d("../../../dev/loaders/src/glTF/2.0/Extensions/EXT_texture_avif.ts"),a=d("../../../dev/loaders/src/glTF/2.0/Extensions/EXT_lights_ies.ts"),i=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_draco_mesh_compression.ts"),l=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_lights_punctual.ts"),r=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_pbrSpecularGlossiness.ts"),t=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_unlit.ts"),e=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_clearcoat.ts"),n=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_iridescence.ts"),o=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_anisotropy.ts"),s=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_emissive_strength.ts"),u=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_sheen.ts"),_=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_specular.ts"),g=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_ior.ts"),O=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_variants.ts"),y=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_transmission.ts"),E=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_diffuse_transmission.ts"),P=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_volume.ts"),x=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_materials_dispersion.ts"),B=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_mesh_quantization.ts"),K=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_texture_basisu.ts"),I=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_texture_transform.ts"),S=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_xmp_json_ld.ts"),H=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_animation_pointer.ts"),Y=d("../../../dev/loaders/src/glTF/2.0/Extensions/MSFT_audio_emitter.ts"),re=d("../../../dev/loaders/src/glTF/2.0/Extensions/MSFT_lod.ts"),Q=d("../../../dev/loaders/src/glTF/2.0/Extensions/MSFT_minecraftMesh.ts"),$=d("../../../dev/loaders/src/glTF/2.0/Extensions/MSFT_sRGBFactors.ts"),oe=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_interactivity.ts"),J=d("../../../dev/loaders/src/glTF/2.0/Extensions/KHR_node_visibility.ts"),ne=d("../../../dev/loaders/src/glTF/2.0/Extensions/ExtrasAsMetadata.ts")},"../../../dev/loaders/src/glTF/2.0/Extensions/interactivityFunctions.ts":(w,M,d)=>{d.r(M),d.d(M,{convertGLTFToSerializedFlowGraph:()=>a});var f=d("babylonjs/Misc/tools"),c=d("../../../dev/loaders/src/glTF/2.0/Extensions/interactivityUtils.ts");function m(i,l,r){if(i.type!==void 0){var t=l.types&&l.types[i.type];if(!t)throw new Error("".concat(r,": Unknown type: ").concat(i.type));var e=t.signature;if(!e)throw new Error("".concat(r,": Type ").concat(i.type," has no signature"));var n=c.gltfTypeToBabylonType[e];return{value:i.value,className:n}}else return i.value}function p(i,l,r){for(var t,e={},n=(t=i.configuration)!==null&&t!==void 0?t:[],o=0,s=n;o<s.length;o++){var u=s[o];if(u.id==="customEvent"){var _=l.customEvents&&l.customEvents[u.value];if(!_)throw new Error("/extensions/KHR_interactivity/nodes/".concat(r,": Unknown custom event: ").concat(u.value));e.eventId=_.id,e.eventData=_.values.map(function(y){return y.id})}else if(u.id==="variable"){var g=l.variables&&l.variables[u.value];if(!g)throw new Error("/extensions/KHR_interactivity/nodes/".concat(r,": Unknown variable: ").concat(u.value));e.variableName=g.id}else if(u.id==="path"){var O=u.value;e.path=O}else e[u.id]=m(u,l,"/extensions/KHR_interactivity/nodes/".concat(r))}return e}function T(i,l,r){var t=c.gltfToFlowGraphTypeMap[l.type];if(!t)throw new Error("/extensions/KHR_interactivity/nodes/".concat(i,": Unknown block type: ").concat(l.type));var e=i.toString(),n=p(l,r,e),o=l.metadata,s=[],u=[],_=[],g=[];return{className:t,config:n,uniqueId:e,metadata:o,dataInputs:s,dataOutputs:u,signalInputs:_,signalOutputs:g}}function a(i){for(var l,r,t,e={uniqueId:(0,f.RandomGUID)(),_userVariables:{},_connectionValues:{}},n=[e],o=[],s=0;s<i.nodes.length;s++){var u=i.nodes[s],_=T(s,u,i);o.push(_)}for(var s=0;s<i.nodes.length;s++){for(var u=i.nodes[s],g=o[s],O=(l=u.flows)!==null&&l!==void 0?l:[],y=function(J){var ne=J.id,te={uniqueId:(0,f.RandomGUID)(),name:ne,_connectionType:1,connectedPointIds:[]};g.signalOutputs.push(te);var q=J.node,Z=J.socket,C=o[q];if(!C)throw new Error("/extensions/KHR_interactivity/nodes/".concat(s,": Could not find node with id ").concat(q," that connects its input with with node ").concat(s,"'s output ").concat(ne));var v=C.signalInputs.find(function(h){return h.name===Z});v||(v={uniqueId:(0,f.RandomGUID)(),name:Z,_connectionType:0,connectedPointIds:[]},C.signalInputs.push(v)),v.connectedPointIds.push(te.uniqueId),te.connectedPointIds.push(v.uniqueId)},E=0,P=O;E<P.length;E++){var x=P[E];y(x)}for(var B=(r=u.values)!==null&&r!==void 0?r:[],K=function(J){var ne=J.id,te={uniqueId:(0,f.RandomGUID)(),name:ne,_connectionType:0,connectedPointIds:[]};if(g.dataInputs.push(te),J.value!==void 0){var q=m(J,i,"/extensions/KHR_interactivity/nodes/".concat(s));e._connectionValues[te.uniqueId]=q}else if(J.node!==void 0&&J.socket!==void 0){var Z=J.node,C=J.socket,v=o[Z];if(!v)throw new Error("/extensions/KHR_interactivity/nodes/".concat(s,": Could not find node with id ").concat(Z," that connects its output with node").concat(s,"'s input ").concat(ne));var h=v.dataOutputs.find(function(A){return A.name===C});h||(h={uniqueId:(0,f.RandomGUID)(),name:C,_connectionType:1,connectedPointIds:[]},v.dataOutputs.push(h)),te.connectedPointIds.push(h.uniqueId),h.connectedPointIds.push(te.uniqueId)}else throw new Error("/extensions/KHR_interactivity/nodes/".concat(s,": Invalid socket ").concat(ne," in node ").concat(s))},I=0,S=B;I<S.length;I++){var H=S[I];K(H)}}for(var Y=(t=i.variables)!==null&&t!==void 0?t:[],s=0;s<Y.length;s++){var re=Y[s],Q=re.id;e._userVariables[Q]=m(re,i,"/extensions/KHR_interactivity/variables/".concat(s))}return{allBlocks:o,executionContexts:n}}},"../../../dev/loaders/src/glTF/2.0/Extensions/interactivityPathToObjectConverter.ts":(w,M,d)=>{d.r(M),d.d(M,{InteractivityPathToObjectConverter:()=>m});var f=d("../../../../node_modules/tslib/tslib.es6.mjs"),c=d("../../../dev/loaders/src/glTF/2.0/Extensions/gltfPathToObjectConverter.ts"),m=function(a){(0,f.__extends)(i,a);function i(l){return a.call(this,l,T)||this}return i}(c.GLTFPathToObjectConverter),p={__array__:{__target__:!0,translation:{type:"Vector3",get:function(a){var i=a._babylonTransformNode;return i.position},set:function(a,i){var l=i._babylonTransformNode;l.position=a},getObject:function(a){return a._babylonTransformNode}}}},T={nodes:p}},"../../../dev/loaders/src/glTF/2.0/Extensions/interactivityUtils.ts":(w,M,d)=>{d.r(M),d.d(M,{gltfToFlowGraphTypeMap:()=>c,gltfTypeToBabylonType:()=>m});var f=d("babylonjs/Misc/tools"),c={"lifecycle/onStart":f.FlowGraphSceneReadyEventBlock.ClassName,"lifecycle/onTick":f.FlowGraphSceneTickEventBlock.ClassName,log:f.FlowGraphConsoleLogBlock.ClassName,"flow/delay":f.FlowGraphTimerBlock.ClassName,"customEvent/send":f.FlowGraphSendCustomEventBlock.ClassName,"customEvent/receive":f.FlowGraphReceiveCustomEventBlock.ClassName,"flow/sequence":f.FlowGraphSequenceBlock.ClassName,"world/get":f.FlowGraphGetPropertyBlock.ClassName,"world/set":f.FlowGraphSetPropertyBlock.ClassName,"flow/doN":f.FlowGraphDoNBlock.ClassName,"variable/get":f.FlowGraphGetVariableBlock.ClassName,"variable/set":f.FlowGraphSetVariableBlock.ClassName,"flow/whileLoop":f.FlowGraphWhileLoopBlock.ClassName,"math/random":f.FlowGraphRandomBlock.ClassName,"math/e":f.FlowGraphEBlock.ClassName,"math/pi":f.FlowGraphPiBlock.ClassName,"math/inf":f.FlowGraphInfBlock.ClassName,"math/nan":f.FlowGraphNaNBlock.ClassName,"math/abs":f.FlowGraphAbsBlock.ClassName,"math/sign":f.FlowGraphSignBlock.ClassName,"math/trunc":f.FlowGraphTruncBlock.ClassName,"math/floor":f.FlowGraphFloorBlock.ClassName,"math/ceil":f.FlowGraphCeilBlock.ClassName,"math/fract":f.FlowGraphFractBlock.ClassName,"math/neg":f.FlowGraphNegBlock.ClassName,"math/add":f.FlowGraphAddBlock.ClassName,"math/sub":f.FlowGraphSubtractBlock.ClassName,"math/mul":f.FlowGraphMultiplyBlock.ClassName,"math/div":f.FlowGraphDivideBlock.ClassName,"math/rem":f.FlowGraphRemainderBlock.ClassName,"math/min":f.FlowGraphMinBlock.ClassName,"math/max":f.FlowGraphMaxBlock.ClassName,"math/clamp":f.FlowGraphClampBlock.ClassName,"math/saturate":f.FlowGraphSaturateBlock.ClassName,"math/mix":f.FlowGraphInterpolateBlock.ClassName,"math/eq":f.FlowGraphEqBlock.ClassName,"math/lt":f.FlowGraphLessThanBlock.ClassName,"math/le":f.FlowGraphLessThanOrEqualBlock.ClassName,"math/gt":f.FlowGraphGreaterThanBlock.ClassName,"math/ge":f.FlowGraphGreaterThanOrEqualBlock.ClassName,"math/isnan":f.FlowGraphIsNanBlock.ClassName,"math/isinf":f.FlowGraphIsInfBlock.ClassName,"math/rad":f.FlowGraphDegToRadBlock.ClassName,"math/deg":f.FlowGraphRadToDegBlock.ClassName,"math/sin":f.FlowGraphSinBlock.ClassName,"math/cos":f.FlowGraphCosBlock.ClassName,"math/tan":f.FlowGraphTanBlock.ClassName,"math/asin":f.FlowGraphAsinBlock.ClassName,"math/acos":f.FlowGraphAcosBlock.ClassName,"math/atan":f.FlowGraphAtanBlock.ClassName,"math/atan2":f.FlowGraphAtan2Block.ClassName,"math/sinh":f.FlowGraphSinhBlock.ClassName,"math/cosh":f.FlowGraphCoshBlock.ClassName,"math/tanh":f.FlowGraphTanhBlock.ClassName,"math/asinh":f.FlowGraphAsinhBlock.ClassName,"math/acosh":f.FlowGraphAcoshBlock.ClassName,"math/atanh":f.FlowGraphAtanhBlock.ClassName,"math/exp":f.FlowGraphExpBlock.ClassName,"math/log":f.FlowGraphLogBlock.ClassName,"math/log2":f.FlowGraphLog2Block.ClassName,"math/log10":f.FlowGraphLog10Block.ClassName,"math/sqrt":f.FlowGraphSqrtBlock.ClassName,"math/cbrt":f.FlowGraphCubeRootBlock.ClassName,"math/pow":f.FlowGraphPowBlock.ClassName,"math/length":f.FlowGraphLengthBlock.ClassName,"math/normalize":f.FlowGraphNormalizeBlock.ClassName,"math/dot":f.FlowGraphDotBlock.ClassName,"math/cross":f.FlowGraphCrossBlock.ClassName,"math/rotate2d":f.FlowGraphRotate2DBlock.ClassName,"math/rotate3d":f.FlowGraphRotate3DBlock.ClassName,"math/transpose":f.FlowGraphTransposeBlock.ClassName,"math/determinant":f.FlowGraphDeterminantBlock.ClassName,"math/inverse":f.FlowGraphInvertMatrixBlock.ClassName,"math/matmul":f.FlowGraphMatMulBlock.ClassName,"math/not":f.FlowGraphBitwiseNotBlock.ClassName,"math/and":f.FlowGraphBitwiseAndBlock.ClassName,"math/or":f.FlowGraphBitwiseOrBlock.ClassName,"math/xor":f.FlowGraphBitwiseXorBlock.ClassName,"math/asr":f.FlowGraphBitwiseRightShiftBlock.ClassName,"math/lsl":f.FlowGraphBitwiseLeftShiftBlock.ClassName,"math/clz":f.FlowGraphCountLeadingZerosBlock.ClassName,"math/ctz":f.FlowGraphCountTrailingZerosBlock.ClassName,"math/popcnt":f.FlowGraphCountOneBitsBlock.ClassName},m={float2:"Vector2",float3:"Vector3",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"}},"../../../dev/loaders/src/glTF/2.0/glTFLoader.ts":(w,M,d)=>{d.r(M),d.d(M,{ArrayItem:()=>a,GLTFFileLoader:()=>m.GLTFFileLoader,GLTFLoader:()=>l,LoadBoundingInfoFromPositionAccessor:()=>i});var f=d("../../../../node_modules/tslib/tslib.es6.mjs"),c=d("babylonjs/Misc/tools"),m=d("../../../dev/loaders/src/glTF/glTFFileLoader.ts"),p=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderAnimation.ts"),T=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts"),a=function(){function r(){}return r.Get=function(t,e,n){if(!e||n==null||!e[n])throw new Error("".concat(t,": Failed to find index (").concat(n,")"));return e[n]},r.TryGet=function(t,e){return!t||e==null||!t[e]?null:t[e]},r.Assign=function(t){if(t)for(var e=0;e<t.length;e++)t[e].index=e},r}();function i(r){if(r.min&&r.max){var t=r.min,e=r.max,n=c.TmpVectors.Vector3[0].copyFromFloats(t[0],t[1],t[2]),o=c.TmpVectors.Vector3[1].copyFromFloats(e[0],e[1],e[2]);if(r.normalized&&r.componentType!==5126){var s=1;switch(r.componentType){case 5120:s=127;break;case 5121:s=255;break;case 5122:s=32767;break;case 5123:s=65535;break}var u=1/s;n.scaleInPlace(u),o.scaleInPlace(u)}return new c.BoundingInfo(n,o)}return null}var l=function(){function r(t){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=t}return r.RegisterExtension=function(t,e){(0,T.registerGLTFExtension)(t,!1,e)},r.UnregisterExtension=function(t){return(0,T.unregisterGLTFExtension)(t)},Object.defineProperty(r.prototype,"gltf",{get:function(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bin",{get:function(){return this._bin},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"babylonScene",{get:function(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rootBabylonMesh",{get:function(){return this._rootBabylonMesh},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rootUrl",{get:function(){return this._rootUrl},enumerable:!1,configurable:!0}),r.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach(function(t){return t.dispose&&t.dispose()}),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())},r.prototype.importMeshAsync=function(t,e,n,o,s,u,_){var g=this;return _===void 0&&(_=""),Promise.resolve().then(function(){g._babylonScene=e,g._assetContainer=n,g._loadData(o);var O=null;if(t){var y={};if(g._gltf.nodes)for(var E=0,P=g._gltf.nodes;E<P.length;E++){var x=P[E];x.name&&(y[x.name]=x.index)}var B=t instanceof Array?t:[t];O=B.map(function(K){var I=y[K];if(I===void 0)throw new Error("Failed to find node '".concat(K,"'"));return I})}return g._loadAsync(s,_,O,function(){return{meshes:g._getMeshes(),particleSystems:[],skeletons:g._getSkeletons(),animationGroups:g._getAnimationGroups(),lights:g._babylonLights,transformNodes:g._getTransformNodes(),geometries:g._getGeometries(),spriteManagers:[]}})})},r.prototype.loadAsync=function(t,e,n,o,s){var u=this;return s===void 0&&(s=""),Promise.resolve().then(function(){return u._babylonScene=t,u._loadData(e),u._loadAsync(n,s,null,function(){})})},r.prototype._loadAsync=function(t,e,n,o){var s=this;return Promise.resolve().then(function(){return(0,f.__awaiter)(s,void 0,void 0,function(){var u,_,g,O,y,E,P,x,B,K,I=this;return(0,f.__generator)(this,function(S){switch(S.label){case 0:return this._rootUrl=t,this._uniqueRootUrl=!t.startsWith("file:")&&e?t:"".concat(t).concat(Date.now(),"/"),this._fileName=e,this._allMaterialsDirtyRequired=!1,[4,this._loadExtensionsAsync()];case 1:if(S.sent(),u="".concat(m.GLTFLoaderState[m.GLTFLoaderState.LOADING]," => ").concat(m.GLTFLoaderState[m.GLTFLoaderState.READY]),_="".concat(m.GLTFLoaderState[m.GLTFLoaderState.LOADING]," => ").concat(m.GLTFLoaderState[m.GLTFLoaderState.COMPLETE]),this._parent._startPerformanceCounter(u),this._parent._startPerformanceCounter(_),this._parent._setState(m.GLTFLoaderState.LOADING),this._extensionsOnLoading(),g=new Array,O=this._babylonScene.blockMaterialDirtyMechanism,this._babylonScene.blockMaterialDirtyMechanism=!0,this.parent.loadOnlyMaterials||(n?g.push(this.loadSceneAsync("/nodes",{nodes:n,index:-1})):(this._gltf.scene!=null||this._gltf.scenes&&this._gltf.scenes[0])&&(y=a.Get("/scene",this._gltf.scenes,this._gltf.scene||0),g.push(this.loadSceneAsync("/scenes/".concat(y.index),y)))),!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(E=0;E<this._gltf.materials.length;++E)P=this._gltf.materials[E],x="/materials/"+E,B=c.Material.TriangleFillMode,g.push(this._loadMaterialAsync(x,P,null,B,function(){}));return this._allMaterialsDirtyRequired?this._babylonScene.blockMaterialDirtyMechanism=O:this._babylonScene._forceBlockMaterialDirtyMechanism(O),this._parent.compileMaterials&&g.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&g.push(this._compileShadowGeneratorsAsync()),K=Promise.all(g).then(function(){return I._rootBabylonMesh&&I._rootBabylonMesh!==I._parent.customRootNode&&I._rootBabylonMesh.setEnabled(!0),I._extensionsOnReady(),I._parent._setState(m.GLTFLoaderState.READY),I._startAnimations(),o()}),[2,K.then(function(H){return I._parent._endPerformanceCounter(u),c.Tools.SetImmediate(function(){I._disposed||Promise.all(I._completePromises).then(function(){I._parent._endPerformanceCounter(_),I._parent._setState(m.GLTFLoaderState.COMPLETE),I._parent.onCompleteObservable.notifyObservers(void 0),I._parent.onCompleteObservable.clear(),I.dispose()},function(Y){I._parent.onErrorObservable.notifyObservers(Y),I._parent.onErrorObservable.clear(),I.dispose()})}),H})]}})})}).catch(function(u){throw s._disposed||(s._parent.onErrorObservable.notifyObservers(u),s._parent.onErrorObservable.clear(),s.dispose()),u})},r.prototype._loadData=function(t){if(this._gltf=t.json,this._setupData(),t.bin){var e=this._gltf.buffers;if(e&&e[0]&&!e[0].uri){var n=e[0];(n.byteLength<t.bin.byteLength-3||n.byteLength>t.bin.byteLength)&&c.Logger.Warn("Binary buffer length (".concat(n.byteLength,") from JSON does not match chunk length (").concat(t.bin.byteLength,")")),this._bin=t.bin}else c.Logger.Warn("Unexpected BIN chunk")}},r.prototype._setupData=function(){if(a.Assign(this._gltf.accessors),a.Assign(this._gltf.animations),a.Assign(this._gltf.buffers),a.Assign(this._gltf.bufferViews),a.Assign(this._gltf.cameras),a.Assign(this._gltf.images),a.Assign(this._gltf.materials),a.Assign(this._gltf.meshes),a.Assign(this._gltf.nodes),a.Assign(this._gltf.samplers),a.Assign(this._gltf.scenes),a.Assign(this._gltf.skins),a.Assign(this._gltf.textures),this._gltf.nodes){for(var t={},e=0,n=this._gltf.nodes;e<n.length;e++){var o=n[e];if(o.children)for(var s=0,u=o.children;s<u.length;s++){var _=u[s];t[_]=o.index}}for(var g=this._createRootNode(),O=0,y=this._gltf.nodes;O<y.length;O++){var o=y[O],E=t[o.index];o.parent=E===void 0?g:this._gltf.nodes[E]}}},r.prototype._loadExtensionsAsync=function(){return(0,f.__awaiter)(this,void 0,void 0,function(){var t,e,n,o,s,u,_,g,O,y,E=this,P;return(0,f.__generator)(this,function(x){switch(x.label){case 0:return t=[],T.registeredGLTFExtensions.forEach(function(B,K){var I;((I=E.parent.extensionOptions[K])===null||I===void 0?void 0:I.enabled)===!1?B.isGLTFExtension&&E.isExtensionUsed(K)&&c.Logger.Warn("Extension ".concat(K," is used but has been explicitly disabled.")):(!B.isGLTFExtension||E.isExtensionUsed(K))&&t.push(function(){return(0,f.__awaiter)(E,void 0,void 0,function(){var S;return(0,f.__generator)(this,function(H){switch(H.label){case 0:return[4,B.factory(this)];case 1:return S=H.sent(),S.name!==K&&c.Logger.Warn("The name of the glTF loader extension instance does not match the registered name: ".concat(S.name," !== ").concat(K)),this._parent.onExtensionLoadedObservable.notifyObservers(S),[2,S]}})})}())}),n=(e=(y=this._extensions).push).apply,o=[y],[4,Promise.all(t)];case 1:if(n.apply(e,o.concat([x.sent()])),this._extensions.sort(function(B,K){return(B.order||Number.MAX_VALUE)-(K.order||Number.MAX_VALUE)}),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(s=function(B){var K=u._extensions.some(function(I){return I.name===B&&I.enabled});if(!K)throw((P=u.parent.extensionOptions[B])===null||P===void 0?void 0:P.enabled)===!1?new Error("Required extension ".concat(B," is disabled")):new Error("Required extension ".concat(B," is not available"))},u=this,_=0,g=this._gltf.extensionsRequired;_<g.length;_++)O=g[_],s(O);return[2]}})})},r.prototype._createRootNode=function(){if(this._parent.customRootNode!==void 0)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:this._rootBabylonMesh===null?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;var t=new c.Mesh("__root__",this._babylonScene);this._rootBabylonMesh=t,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);var e={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case m.GLTFLoaderCoordinateSystemMode.AUTO:{this._babylonScene.useRightHandedSystem||(e.rotation=[0,1,0,0],e.scale=[1,1,-1],r._LoadTransform(e,this._rootBabylonMesh));break}case m.GLTFLoaderCoordinateSystemMode.FORCE_RIGHT_HANDED:{this._babylonScene.useRightHandedSystem=!0;break}default:throw new Error("Invalid coordinate system mode (".concat(this._parent.coordinateSystemMode,")"))}return this._parent.onMeshLoadedObservable.notifyObservers(t),e},r.prototype.loadSceneAsync=function(t,e){var n=this,o=this._extensionsLoadSceneAsync(t,e);if(o)return o;var s=new Array;if(this.logOpen("".concat(t," ").concat(e.name||"")),e.nodes)for(var u=0,_=e.nodes;u<_.length;u++){var g=_[u],O=a.Get("".concat(t,"/nodes/").concat(g),this._gltf.nodes,g);s.push(this.loadNodeAsync("/nodes/".concat(O.index),O,function(x){x.parent=n._rootBabylonMesh}))}for(var y=0,E=this._postSceneLoadActions;y<E.length;y++){var P=E[y];P()}return s.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(s).then(function(){})},r.prototype._forEachPrimitive=function(t,e){if(t._primitiveBabylonMeshes)for(var n=0,o=t._primitiveBabylonMeshes;n<o.length;n++){var s=o[n];e(s)}},r.prototype._getGeometries=function(){var t=[],e=this._gltf.nodes;if(e)for(var n=0,o=e;n<o.length;n++){var s=o[n];this._forEachPrimitive(s,function(u){var _=u.geometry;_&&t.indexOf(_)===-1&&t.push(_)})}return t},r.prototype._getMeshes=function(){var t=[];this._rootBabylonMesh instanceof c.AbstractMesh&&t.push(this._rootBabylonMesh);var e=this._gltf.nodes;if(e)for(var n=0,o=e;n<o.length;n++){var s=o[n];this._forEachPrimitive(s,function(u){t.push(u)})}return t},r.prototype._getTransformNodes=function(){var t=[],e=this._gltf.nodes;if(e)for(var n=0,o=e;n<o.length;n++){var s=o[n];s._babylonTransformNode&&s._babylonTransformNode.getClassName()==="TransformNode"&&t.push(s._babylonTransformNode),s._babylonTransformNodeForSkin&&t.push(s._babylonTransformNodeForSkin)}return t},r.prototype._getSkeletons=function(){var t=[],e=this._gltf.skins;if(e)for(var n=0,o=e;n<o.length;n++){var s=o[n];s._data&&t.push(s._data.babylonSkeleton)}return t},r.prototype._getAnimationGroups=function(){var t=[],e=this._gltf.animations;if(e)for(var n=0,o=e;n<o.length;n++){var s=o[n];s._babylonAnimationGroup&&t.push(s._babylonAnimationGroup)}return t},r.prototype._startAnimations=function(){switch(this._parent.animationStartMode){case m.GLTFLoaderAnimationStartMode.NONE:break;case m.GLTFLoaderAnimationStartMode.FIRST:{var t=this._getAnimationGroups();t.length!==0&&t[0].start(!0);break}case m.GLTFLoaderAnimationStartMode.ALL:{for(var t=this._getAnimationGroups(),e=0,n=t;e<n.length;e++){var o=n[e];o.start(!0)}break}default:{c.Logger.Error("Invalid animation start mode (".concat(this._parent.animationStartMode,")"));return}}},r.prototype.loadNodeAsync=function(t,e,n){var o=this;n===void 0&&(n=function(){});var s=this._extensionsLoadNodeAsync(t,e,n);if(s)return s;if(e._babylonTransformNode)throw new Error("".concat(t,": Invalid recursive node hierarchy"));var u=new Array;this.logOpen("".concat(t," ").concat(e.name||""));var _=function(x){if(r.AddPointerMetadata(x,t),r._LoadTransform(e,x),e.camera!=null){var B=a.Get("".concat(t,"/camera"),o._gltf.cameras,e.camera);u.push(o.loadCameraAsync("/cameras/".concat(B.index),B,function(Y){Y.parent=x}))}if(e.children)for(var K=0,I=e.children;K<I.length;K++){var S=I[K],H=a.Get("".concat(t,"/children/").concat(S),o._gltf.nodes,S);u.push(o.loadNodeAsync("/nodes/".concat(H.index),H,function(Y){Y.parent=x}))}n(x)},g=e.mesh!=null,O=this._parent.loadSkins&&e.skin!=null;if(!g||O){var y=e.name||"node".concat(e.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;var E=new c.TransformNode(y,this._babylonScene);E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e.mesh==null?e._babylonTransformNode=E:e._babylonTransformNodeForSkin=E,_(E)}if(g)if(O){var P=a.Get("".concat(t,"/mesh"),this._gltf.meshes,e.mesh);u.push(this._loadMeshAsync("/meshes/".concat(P.index),e,P,function(x){var B=e._babylonTransformNodeForSkin;x.metadata=(0,c.deepMerge)(B.metadata,x.metadata||{});var K=a.Get("".concat(t,"/skin"),o._gltf.skins,e.skin);u.push(o._loadSkinAsync("/skins/".concat(K.index),e,K,function(I){o._forEachPrimitive(e,function(S){S.skeleton=I}),o._postSceneLoadActions.push(function(){if(K.skeleton!=null){var S=a.Get("/skins/".concat(K.index,"/skeleton"),o._gltf.nodes,K.skeleton).parent;e.index===S.index?x.parent=B.parent:x.parent=S._babylonTransformNode}else x.parent=o._rootBabylonMesh;o._parent.onSkinLoadedObservable.notifyObservers({node:B,skinnedNode:x})})}))}))}else{var P=a.Get("".concat(t,"/mesh"),this._gltf.meshes,e.mesh);u.push(this._loadMeshAsync("/meshes/".concat(P.index),e,P,_))}return this.logClose(),Promise.all(u).then(function(){return o._forEachPrimitive(e,function(x){x.geometry&&x.geometry.useBoundingInfoFromGeometry?x._updateBoundingInfo():x.refreshBoundingInfo(!0,!0)}),e._babylonTransformNode})},r.prototype._loadMeshAsync=function(t,e,n,o){var s=n.primitives;if(!s||!s.length)throw new Error("".concat(t,": Primitives are missing"));s[0].index==null&&a.Assign(s);var u=new Array;this.logOpen("".concat(t," ").concat(n.name||""));var _=e.name||"node".concat(e.index);if(s.length===1){var g=n.primitives[0];u.push(this._loadMeshPrimitiveAsync("".concat(t,"/primitives/").concat(g.index),_,e,n,g,function(E){e._babylonTransformNode=E,e._primitiveBabylonMeshes=[E]}))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,e._babylonTransformNode=new c.TransformNode(_,this._babylonScene),e._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e._primitiveBabylonMeshes=[];for(var O=0,y=s;O<y.length;O++){var g=y[O];u.push(this._loadMeshPrimitiveAsync("".concat(t,"/primitives/").concat(g.index),"".concat(_,"_primitive").concat(g.index),e,n,g,function(P){P.parent=e._babylonTransformNode,e._primitiveBabylonMeshes.push(P)}))}}return o(e._babylonTransformNode),this.logClose(),Promise.all(u).then(function(){return e._babylonTransformNode})},r.prototype._loadMeshPrimitiveAsync=function(t,e,n,o,s,u){var _=this,g=this._extensionsLoadMeshPrimitiveAsync(t,e,n,o,s,u);if(g)return g;this.logOpen("".concat(t));var O=this._disableInstancedMesh===0&&this._parent.createInstances&&n.skin==null&&!o.primitives[0].targets,y,E;if(O&&s._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,y=s._instanceData.babylonSourceMesh.createInstance(e),y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E=s._instanceData.promise;else{var P=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;var x=new c.Mesh(e,this._babylonScene);x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x.sideOrientation=this._babylonScene.useRightHandedSystem?c.Material.CounterClockWiseSideOrientation:c.Material.ClockWiseSideOrientation,this._createMorphTargets(t,n,o,s,x),P.push(this._loadVertexDataAsync(t,s,x).then(function(S){return _._loadMorphTargetsAsync(t,s,x,S).then(function(){_._disposed||(_._babylonScene._blockEntityCollection=!!_._assetContainer,S.applyToMesh(x),S._parentContainer=_._assetContainer,_._babylonScene._blockEntityCollection=!1)})}));var B=r._GetDrawMode(t,s.mode);if(s.material==null){var K=this._defaultBabylonMaterialData[B];K||(K=this._createDefaultMaterial("__GLTFLoader._default",B),this._parent.onMaterialLoadedObservable.notifyObservers(K),this._defaultBabylonMaterialData[B]=K),x.material=K}else if(!this.parent.skipMaterials){var I=a.Get("".concat(t,"/material"),this._gltf.materials,s.material);P.push(this._loadMaterialAsync("/materials/".concat(I.index),I,x,B,function(S){x.material=S}))}E=Promise.all(P),O&&(s._instanceData={babylonSourceMesh:x,promise:E}),y=x}return r.AddPointerMetadata(y,t),this._parent.onMeshLoadedObservable.notifyObservers(y),u(y),this.logClose(),E.then(function(){return y})},r.prototype._loadVertexDataAsync=function(t,e,n){var o=this,s=this._extensionsLoadVertexDataAsync(t,e,n);if(s)return s;var u=e.attributes;if(!u)throw new Error("".concat(t,": Attributes are missing"));var _=new Array,g=new c.Geometry(n.name,this._babylonScene);if(e.indices==null)n.isUnIndexed=!0;else{var O=a.Get("".concat(t,"/indices"),this._gltf.accessors,e.indices);_.push(this._loadIndicesAccessorAsync("/accessors/".concat(O.index),O).then(function(E){g.setIndices(E)}))}var y=function(E,P,x){if(u[E]!=null){n._delayInfo=n._delayInfo||[],n._delayInfo.indexOf(P)===-1&&n._delayInfo.push(P);var B=a.Get("".concat(t,"/attributes/").concat(E),o._gltf.accessors,u[E]);_.push(o._loadVertexAccessorAsync("/accessors/".concat(B.index),B,P).then(function(K){if(K.getKind()===c.VertexBuffer.PositionKind&&!o.parent.alwaysComputeBoundingBox&&!n.skeleton){var I=i(B);I&&(g._boundingInfo=I,g.useBoundingInfoFromGeometry=!0)}g.setVerticesBuffer(K,B.count)})),P==c.VertexBuffer.MatricesIndicesExtraKind&&(n.numBoneInfluencers=8),x&&x(B)}};return y("POSITION",c.VertexBuffer.PositionKind),y("NORMAL",c.VertexBuffer.NormalKind),y("TANGENT",c.VertexBuffer.TangentKind),y("TEXCOORD_0",c.VertexBuffer.UVKind),y("TEXCOORD_1",c.VertexBuffer.UV2Kind),y("TEXCOORD_2",c.VertexBuffer.UV3Kind),y("TEXCOORD_3",c.VertexBuffer.UV4Kind),y("TEXCOORD_4",c.VertexBuffer.UV5Kind),y("TEXCOORD_5",c.VertexBuffer.UV6Kind),y("JOINTS_0",c.VertexBuffer.MatricesIndicesKind),y("WEIGHTS_0",c.VertexBuffer.MatricesWeightsKind),y("JOINTS_1",c.VertexBuffer.MatricesIndicesExtraKind),y("WEIGHTS_1",c.VertexBuffer.MatricesWeightsExtraKind),y("COLOR_0",c.VertexBuffer.ColorKind,function(E){E.type==="VEC4"&&(n.hasVertexAlpha=!0)}),Promise.all(_).then(function(){return g})},r.prototype._createMorphTargets=function(t,e,n,o,s){if(!(!o.targets||!this._parent.loadMorphTargets)){if(e._numMorphTargets==null)e._numMorphTargets=o.targets.length;else if(o.targets.length!==e._numMorphTargets)throw new Error("".concat(t,": Primitives do not have the same number of targets"));var u=n.extras?n.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,s.morphTargetManager=new c.MorphTargetManager(this._babylonScene),s.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,s.morphTargetManager.areUpdatesFrozen=!0;for(var _=0;_<o.targets.length;_++){var g=e.weights?e.weights[_]:n.weights?n.weights[_]:0,O=u?u[_]:"morphTarget".concat(_);s.morphTargetManager.addTarget(new c.MorphTarget(O,g,s.getScene()))}}},r.prototype._loadMorphTargetsAsync=function(t,e,n,o){if(!e.targets||!this._parent.loadMorphTargets)return Promise.resolve();for(var s=new Array,u=n.morphTargetManager,_=0;_<u.numTargets;_++){var g=u.getTarget(_);s.push(this._loadMorphTargetVertexDataAsync("".concat(t,"/targets/").concat(_),o,e.targets[_],g))}return Promise.all(s).then(function(){u.areUpdatesFrozen=!1})},r.prototype._loadMorphTargetVertexDataAsync=function(t,e,n,o){var s=this,u=new Array,_=function(g,O,y){if(n[g]!=null){var E=e.getVertexBuffer(O);if(E){var P=a.Get("".concat(t,"/").concat(g),s._gltf.accessors,n[g]);u.push(s._loadFloatAccessorAsync("/accessors/".concat(P.index),P).then(function(x){y(E,x)}))}}};return _("POSITION",c.VertexBuffer.PositionKind,function(g,O){var y=new Float32Array(O.length);g.forEach(O.length,function(E,P){y[P]=O[P]+E}),o.setPositions(y)}),_("NORMAL",c.VertexBuffer.NormalKind,function(g,O){var y=new Float32Array(O.length);g.forEach(y.length,function(E,P){y[P]=O[P]+E}),o.setNormals(y)}),_("TANGENT",c.VertexBuffer.TangentKind,function(g,O){var y=new Float32Array(O.length/3*4),E=0;g.forEach(O.length/3*4,function(P,x){(x+1)%4!==0&&(y[E]=O[E]+P,E++)}),o.setTangents(y)}),_("TEXCOORD_0",c.VertexBuffer.UVKind,function(g,O){var y=new Float32Array(O.length);g.forEach(O.length,function(E,P){y[P]=O[P]+E}),o.setUVs(y)}),_("TEXCOORD_1",c.VertexBuffer.UV2Kind,function(g,O){var y=new Float32Array(O.length);g.forEach(O.length,function(E,P){y[P]=O[P]+E}),o.setUV2s(y)}),Promise.all(u).then(function(){})},r._LoadTransform=function(t,e){if(t.skin==null){var n=c.Vector3.Zero(),o=c.Quaternion.Identity(),s=c.Vector3.One();if(t.matrix){var u=c.Matrix.FromArray(t.matrix);u.decompose(s,o,n)}else t.translation&&(n=c.Vector3.FromArray(t.translation)),t.rotation&&(o=c.Quaternion.FromArray(t.rotation)),t.scale&&(s=c.Vector3.FromArray(t.scale));e.position=n,e.rotationQuaternion=o,e.scaling=s}},r.prototype._loadSkinAsync=function(t,e,n,o){var s=this;if(!this._parent.loadSkins)return Promise.resolve();var u=this._extensionsLoadSkinAsync(t,e,n);if(u)return u;if(n._data)return o(n._data.babylonSkeleton),n._data.promise;var _="skeleton".concat(n.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;var g=new c.Skeleton(n.name||_,_,this._babylonScene);g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(t,n,g);var O=this._loadSkinInverseBindMatricesDataAsync(t,n).then(function(y){s._updateBoneMatrices(g,y)});return n._data={babylonSkeleton:g,promise:O},o(g),O},r.prototype._loadBones=function(t,e,n){if(e.skeleton==null||this._parent.alwaysComputeSkeletonRootNode){var o=this._findSkeletonRootNode("".concat(t,"/joints"),e.joints);if(o)if(e.skeleton===void 0)e.skeleton=o.index;else{var s=function(P,x){for(;x.parent;x=x.parent)if(x.parent===P)return!0;return!1},u=a.Get("".concat(t,"/skeleton"),this._gltf.nodes,e.skeleton);u!==o&&!s(u,o)&&(c.Logger.Warn("".concat(t,"/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root")),e.skeleton=o.index)}else c.Logger.Warn("".concat(t,": Failed to find common root"))}for(var _={},g=0,O=e.joints;g<O.length;g++){var y=O[g],E=a.Get("".concat(t,"/joints/").concat(y),this._gltf.nodes,y);this._loadBone(E,e,n,_)}},r.prototype._findSkeletonRootNode=function(t,e){if(e.length===0)return null;for(var n={},o=0,s=e;o<s.length;o++){for(var u=s[o],_=[],g=a.Get("".concat(t,"/").concat(u),this._gltf.nodes,u);g.index!==-1;)_.unshift(g),g=g.parent;n[u]=_}for(var O=null,y=0;;++y){var _=n[e[0]];if(y>=_.length)return O;for(var g=_[y],E=1;E<e.length;++E)if(_=n[e[E]],y>=_.length||g!==_[y])return O;O=g}},r.prototype._loadBone=function(t,e,n,o){t._isJoint=!0;var s=o[t.index];if(s)return s;var u=null;t.index!==e.skeleton&&(t.parent&&t.parent.index!==-1?u=this._loadBone(t.parent,e,n,o):e.skeleton!==void 0&&c.Logger.Warn("/skins/".concat(e.index,"/skeleton: Skeleton node is not a common root")));var _=e.joints.indexOf(t.index);return s=new c.Bone(t.name||"joint".concat(t.index),n,u,this._getNodeMatrix(t),null,null,_),o[t.index]=s,this._postSceneLoadActions.push(function(){s.linkTransformNode(t._babylonTransformNode)}),s},r.prototype._loadSkinInverseBindMatricesDataAsync=function(t,e){if(e.inverseBindMatrices==null)return Promise.resolve(null);var n=a.Get("".concat(t,"/inverseBindMatrices"),this._gltf.accessors,e.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/".concat(n.index),n)},r.prototype._updateBoneMatrices=function(t,e){for(var n=0,o=t.bones;n<o.length;n++){var s=o[n],u=c.Matrix.Identity(),_=s._index;e&&_!==-1&&(c.Matrix.FromArrayToRef(e,_*16,u),u.invertToRef(u));var g=s.getParent();g&&u.multiplyToRef(g.getAbsoluteInverseBindMatrix(),u),s.updateMatrix(u,!1,!1),s._updateAbsoluteBindMatrices(void 0,!1)}},r.prototype._getNodeMatrix=function(t){return t.matrix?c.Matrix.FromArray(t.matrix):c.Matrix.Compose(t.scale?c.Vector3.FromArray(t.scale):c.Vector3.One(),t.rotation?c.Quaternion.FromArray(t.rotation):c.Quaternion.Identity(),t.translation?c.Vector3.FromArray(t.translation):c.Vector3.Zero())},r.prototype.loadCameraAsync=function(t,e,n){n===void 0&&(n=function(){});var o=this._extensionsLoadCameraAsync(t,e,n);if(o)return o;var s=new Array;this.logOpen("".concat(t," ").concat(e.name||"")),this._babylonScene._blockEntityCollection=!!this._assetContainer;var u=new c.FreeCamera(e.name||"camera".concat(e.index),c.Vector3.Zero(),this._babylonScene,!1);switch(u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u.ignoreParentScaling=!0,e._babylonCamera=u,u.rotation.set(0,Math.PI,0),e.type){case"perspective":{var _=e.perspective;if(!_)throw new Error("".concat(t,": Camera perspective properties are missing"));u.fov=_.yfov,u.minZ=_.znear,u.maxZ=_.zfar||0;break}case"orthographic":{if(!e.orthographic)throw new Error("".concat(t,": Camera orthographic properties are missing"));u.mode=c.Camera.ORTHOGRAPHIC_CAMERA,u.orthoLeft=-e.orthographic.xmag,u.orthoRight=e.orthographic.xmag,u.orthoBottom=-e.orthographic.ymag,u.orthoTop=e.orthographic.ymag,u.minZ=e.orthographic.znear,u.maxZ=e.orthographic.zfar;break}default:throw new Error("".concat(t,": Invalid camera type (").concat(e.type,")"))}return r.AddPointerMetadata(u,t),this._parent.onCameraLoadedObservable.notifyObservers(u),n(u),this.logClose(),Promise.all(s).then(function(){return u})},r.prototype._loadAnimationsAsync=function(){var t=this._gltf.animations;if(!t)return Promise.resolve();for(var e=new Array,n=0;n<t.length;n++){var o=t[n];e.push(this.loadAnimationAsync("/animations/".concat(o.index),o).then(function(s){s.targetedAnimations.length===0&&s.dispose()}))}return Promise.all(e).then(function(){})},r.prototype.loadAnimationAsync=function(t,e){var n=this,o=this._extensionsLoadAnimationAsync(t,e);return o||Promise.resolve().then(d.t.bind(d,"babylonjs/Misc/tools",23)).then(function(s){var u=s.AnimationGroup;n._babylonScene._blockEntityCollection=!!n._assetContainer;var _=new u(e.name||"animation".concat(e.index),n._babylonScene);_._parentContainer=n._assetContainer,n._babylonScene._blockEntityCollection=!1,e._babylonAnimationGroup=_;var g=new Array;a.Assign(e.channels),a.Assign(e.samplers);for(var O=0,y=e.channels;O<y.length;O++){var E=y[O];g.push(n._loadAnimationChannelAsync("".concat(t,"/channels/").concat(E.index),t,e,E,function(P,x){P.animations=P.animations||[],P.animations.push(x),_.addTargetedAnimation(x,P)}))}return Promise.all(g).then(function(){return _.normalize(0),_})})},r.prototype._loadAnimationChannelAsync=function(t,e,n,o,s){var u=this._extensionsLoadAnimationChannelAsync(t,e,n,o,s);if(u)return u;if(o.target.node==null)return Promise.resolve();var _=a.Get("".concat(t,"/target/node"),this._gltf.nodes,o.target.node),g=o.target.path,O=g==="weights";if(O&&!_._numMorphTargets||!O&&!_._babylonTransformNode||!this._parent.loadNodeAnimations&&!O&&!_._isJoint)return Promise.resolve();var y;switch(g){case"translation":{y=p.nodeAnimationData.translation;break}case"rotation":{y=p.nodeAnimationData.rotation;break}case"scale":{y=p.nodeAnimationData.scale;break}case"weights":{y=p.nodeAnimationData.weights;break}default:throw new Error("".concat(t,"/target/path: Invalid value (").concat(o.target.path,")"))}var E={object:_,info:y};return this._loadAnimationChannelFromTargetInfoAsync(t,e,n,o,E,s)},r.prototype._loadAnimationChannelFromTargetInfoAsync=function(t,e,n,o,s,u){var _=this.parent.targetFps,g=1/_,O=a.Get("".concat(t,"/sampler"),n.samplers,o.sampler);return this._loadAnimationSamplerAsync("".concat(e,"/samplers/").concat(o.sampler),O).then(function(y){for(var E=0,P=s.object,x=s.info,B=0,K=x;B<K.length;B++){var I=K[B],S=I.getStride(P),H=y.input,Y=y.output,re=new Array(H.length),Q=0;switch(y.interpolation){case"STEP":{for(var $=0;$<H.length;$++){var oe=I.getValue(P,Y,Q,1);Q+=S,re[$]={frame:H[$]*_,value:oe,interpolation:1}}break}case"CUBICSPLINE":{for(var $=0;$<H.length;$++){var J=I.getValue(P,Y,Q,g);Q+=S;var oe=I.getValue(P,Y,Q,1);Q+=S;var ne=I.getValue(P,Y,Q,g);Q+=S,re[$]={frame:H[$]*_,inTangent:J,value:oe,outTangent:ne}}break}case"LINEAR":{for(var $=0;$<H.length;$++){var oe=I.getValue(P,Y,Q,1);Q+=S,re[$]={frame:H[$]*_,value:oe}}break}}if(Q>0){var te="".concat(n.name||"animation".concat(n.index),"_channel").concat(o.index,"_").concat(E);I.buildAnimations(P,te,_,re,function(q,Z){++E,u(q,Z)})}}})},r.prototype._loadAnimationSamplerAsync=function(t,e){if(e._data)return e._data;var n=e.interpolation||"LINEAR";switch(n){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error("".concat(t,"/interpolation: Invalid value (").concat(e.interpolation,")"))}var o=a.Get("".concat(t,"/input"),this._gltf.accessors,e.input),s=a.Get("".concat(t,"/output"),this._gltf.accessors,e.output);return e._data=Promise.all([this._loadFloatAccessorAsync("/accessors/".concat(o.index),o),this._loadFloatAccessorAsync("/accessors/".concat(s.index),s)]).then(function(u){var _=u[0],g=u[1];return{input:_,interpolation:n,output:g}}),e._data},r.prototype.loadBufferAsync=function(t,e,n,o){var s=this._extensionsLoadBufferAsync(t,e,n,o);if(s)return s;if(!e._data)if(e.uri)e._data=this.loadUriAsync("".concat(t,"/uri"),e,e.uri);else{if(!this._bin)throw new Error("".concat(t,": Uri is missing or the binary glTF is missing its binary chunk"));e._data=this._bin.readAsync(0,e.byteLength)}return e._data.then(function(u){try{return new Uint8Array(u.buffer,u.byteOffset+n,o)}catch(_){throw new Error("".concat(t,": ").concat(_.message))}})},r.prototype.loadBufferViewAsync=function(t,e){var n=this._extensionsLoadBufferViewAsync(t,e);if(n)return n;if(e._data)return e._data;var o=a.Get("".concat(t,"/buffer"),this._gltf.buffers,e.buffer);return e._data=this.loadBufferAsync("/buffers/".concat(o.index),o,e.byteOffset||0,e.byteLength),e._data},r.prototype._loadAccessorAsync=function(t,e,n){var o=this;if(e._data)return e._data;var s=r._GetNumComponents(t,e.type),u=s*c.VertexBuffer.GetTypeByteLength(e.componentType),_=s*e.count;if(e.bufferView==null)e._data=Promise.resolve(new n(_));else{var g=a.Get("".concat(t,"/bufferView"),this._gltf.bufferViews,e.bufferView);e._data=this.loadBufferViewAsync("/bufferViews/".concat(g.index),g).then(function(y){if(e.componentType===5126&&!e.normalized&&(!g.byteStride||g.byteStride===u))return r._GetTypedArray(t,e.componentType,y,e.byteOffset,_);var E=new n(_);return c.VertexBuffer.ForEach(y,e.byteOffset||0,g.byteStride||u,s,e.componentType,E.length,e.normalized||!1,function(P,x){E[x]=P}),E})}if(e.sparse){var O=e.sparse;e._data=e._data.then(function(y){var E=y,P=a.Get("".concat(t,"/sparse/indices/bufferView"),o._gltf.bufferViews,O.indices.bufferView),x=a.Get("".concat(t,"/sparse/values/bufferView"),o._gltf.bufferViews,O.values.bufferView);return Promise.all([o.loadBufferViewAsync("/bufferViews/".concat(P.index),P),o.loadBufferViewAsync("/bufferViews/".concat(x.index),x)]).then(function(B){var K=B[0],I=B[1],S=r._GetTypedArray("".concat(t,"/sparse/indices"),O.indices.componentType,K,O.indices.byteOffset,O.count),H=s*O.count,Y;if(e.componentType===5126&&!e.normalized)Y=r._GetTypedArray("".concat(t,"/sparse/values"),e.componentType,I,O.values.byteOffset,H);else{var re=r._GetTypedArray("".concat(t,"/sparse/values"),e.componentType,I,O.values.byteOffset,H);Y=new n(H),c.VertexBuffer.ForEach(re,0,u,s,e.componentType,Y.length,e.normalized||!1,function(ne,te){Y[te]=ne})}for(var Q=0,$=0;$<S.length;$++)for(var oe=S[$]*s,J=0;J<s;J++)E[oe++]=Y[Q++];return E})})}return e._data},r.prototype._loadFloatAccessorAsync=function(t,e){return this._loadAccessorAsync(t,e,Float32Array)},r.prototype._loadIndicesAccessorAsync=function(t,e){if(e.type!=="SCALAR")throw new Error("".concat(t,"/type: Invalid value ").concat(e.type));if(e.componentType!==5121&&e.componentType!==5123&&e.componentType!==5125)throw new Error("".concat(t,"/componentType: Invalid value ").concat(e.componentType));if(e._data)return e._data;if(e.sparse){var n=r._GetTypedArrayConstructor("".concat(t,"/componentType"),e.componentType);e._data=this._loadAccessorAsync(t,e,n)}else{var o=a.Get("".concat(t,"/bufferView"),this._gltf.bufferViews,e.bufferView);e._data=this.loadBufferViewAsync("/bufferViews/".concat(o.index),o).then(function(s){return r._GetTypedArray(t,e.componentType,s,e.byteOffset,e.count)})}return e._data},r.prototype._loadVertexBufferViewAsync=function(t){if(t._babylonBuffer)return t._babylonBuffer;var e=this._babylonScene.getEngine();return t._babylonBuffer=this.loadBufferViewAsync("/bufferViews/".concat(t.index),t).then(function(n){return new c.Buffer(e,n,!1)}),t._babylonBuffer},r.prototype._loadVertexAccessorAsync=function(t,e,n){var o;if(!((o=e._babylonVertexBuffer)===null||o===void 0)&&o[n])return e._babylonVertexBuffer[n];e._babylonVertexBuffer||(e._babylonVertexBuffer={});var s=this._babylonScene.getEngine();if(e.sparse||e.bufferView==null)e._babylonVertexBuffer[n]=this._loadFloatAccessorAsync(t,e).then(function(_){return new c.VertexBuffer(s,_,n,!1)});else{var u=a.Get("".concat(t,"/bufferView"),this._gltf.bufferViews,e.bufferView);e._babylonVertexBuffer[n]=this._loadVertexBufferViewAsync(u).then(function(_){var g=r._GetNumComponents(t,e.type);return new c.VertexBuffer(s,_,n,!1,void 0,u.byteStride,void 0,e.byteOffset,g,e.componentType,e.normalized,!0,void 0,!0)})}return e._babylonVertexBuffer[n]},r.prototype._loadMaterialMetallicRoughnessPropertiesAsync=function(t,e,n){if(!(n instanceof c.PBRMaterial))throw new Error("".concat(t,": Material type not supported"));var o=new Array;return e&&(e.baseColorFactor?(n.albedoColor=c.Color3.FromArray(e.baseColorFactor),n.alpha=e.baseColorFactor[3]):n.albedoColor=c.Color3.White(),n.metallic=e.metallicFactor==null?1:e.metallicFactor,n.roughness=e.roughnessFactor==null?1:e.roughnessFactor,e.baseColorTexture&&o.push(this.loadTextureInfoAsync("".concat(t,"/baseColorTexture"),e.baseColorTexture,function(s){s.name="".concat(n.name," (Base Color)"),n.albedoTexture=s})),e.metallicRoughnessTexture&&(e.metallicRoughnessTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync("".concat(t,"/metallicRoughnessTexture"),e.metallicRoughnessTexture,function(s){s.name="".concat(n.name," (Metallic Roughness)"),n.metallicTexture=s})),n.useMetallnessFromMetallicTextureBlue=!0,n.useRoughnessFromMetallicTextureGreen=!0,n.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(o).then(function(){})},r.prototype._loadMaterialAsync=function(t,e,n,o,s){s===void 0&&(s=function(){});var u=this._extensionsLoadMaterialAsync(t,e,n,o,s);if(u)return u;e._data=e._data||{};var _=e._data[o];if(!_){this.logOpen("".concat(t," ").concat(e.name||""));var g=this.createMaterial(t,e,o);_={babylonMaterial:g,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(t,e,g)},e._data[o]=_,r.AddPointerMetadata(g,t),this._parent.onMaterialLoadedObservable.notifyObservers(g),this.logClose()}return n&&(_.babylonMeshes.push(n),n.onDisposeObservable.addOnce(function(){var O=_.babylonMeshes.indexOf(n);O!==-1&&_.babylonMeshes.splice(O,1)})),s(_.babylonMaterial),_.promise.then(function(){return _.babylonMaterial})},r.prototype._createDefaultMaterial=function(t,e){this._babylonScene._blockEntityCollection=!!this._assetContainer;var n=new c.PBRMaterial(t,this._babylonScene);return n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n.fillMode=e,n.enableSpecularAntiAliasing=!0,n.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,n.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,n.transparencyMode=c.PBRMaterial.PBRMATERIAL_OPAQUE,n.metallic=1,n.roughness=1,n},r.prototype.createMaterial=function(t,e,n){var o=this._extensionsCreateMaterial(t,e,n);if(o)return o;var s=e.name||"material".concat(e.index),u=this._createDefaultMaterial(s,n);return u},r.prototype.loadMaterialPropertiesAsync=function(t,e,n){var o=this._extensionsLoadMaterialPropertiesAsync(t,e,n);if(o)return o;var s=new Array;return s.push(this.loadMaterialBasePropertiesAsync(t,e,n)),e.pbrMetallicRoughness&&s.push(this._loadMaterialMetallicRoughnessPropertiesAsync("".concat(t,"/pbrMetallicRoughness"),e.pbrMetallicRoughness,n)),this.loadMaterialAlphaProperties(t,e,n),Promise.all(s).then(function(){})},r.prototype.loadMaterialBasePropertiesAsync=function(t,e,n){if(!(n instanceof c.PBRMaterial))throw new Error("".concat(t,": Material type not supported"));var o=new Array;return n.emissiveColor=e.emissiveFactor?c.Color3.FromArray(e.emissiveFactor):new c.Color3(0,0,0),e.doubleSided&&(n.backFaceCulling=!1,n.twoSidedLighting=!0),e.normalTexture&&(e.normalTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync("".concat(t,"/normalTexture"),e.normalTexture,function(s){s.name="".concat(n.name," (Normal)"),n.bumpTexture=s})),n.invertNormalMapX=!this._babylonScene.useRightHandedSystem,n.invertNormalMapY=this._babylonScene.useRightHandedSystem,e.normalTexture.scale!=null&&n.bumpTexture&&(n.bumpTexture.level=e.normalTexture.scale),n.forceIrradianceInFragment=!0),e.occlusionTexture&&(e.occlusionTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync("".concat(t,"/occlusionTexture"),e.occlusionTexture,function(s){s.name="".concat(n.name," (Occlusion)"),n.ambientTexture=s})),n.useAmbientInGrayScale=!0,e.occlusionTexture.strength!=null&&(n.ambientTextureStrength=e.occlusionTexture.strength)),e.emissiveTexture&&o.push(this.loadTextureInfoAsync("".concat(t,"/emissiveTexture"),e.emissiveTexture,function(s){s.name="".concat(n.name," (Emissive)"),n.emissiveTexture=s})),Promise.all(o).then(function(){})},r.prototype.loadMaterialAlphaProperties=function(t,e,n){if(!(n instanceof c.PBRMaterial))throw new Error("".concat(t,": Material type not supported"));var o=e.alphaMode||"OPAQUE";switch(o){case"OPAQUE":{n.transparencyMode=c.PBRMaterial.PBRMATERIAL_OPAQUE,n.alpha=1;break}case"MASK":{n.transparencyMode=c.PBRMaterial.PBRMATERIAL_ALPHATEST,n.alphaCutOff=e.alphaCutoff==null?.5:e.alphaCutoff,n.albedoTexture&&(n.albedoTexture.hasAlpha=!0);break}case"BLEND":{n.transparencyMode=c.PBRMaterial.PBRMATERIAL_ALPHABLEND,n.albedoTexture&&(n.albedoTexture.hasAlpha=!0,n.useAlphaFromAlbedoTexture=!0);break}default:throw new Error("".concat(t,"/alphaMode: Invalid value (").concat(e.alphaMode,")"))}},r.prototype.loadTextureInfoAsync=function(t,e,n){var o=this;n===void 0&&(n=function(){});var s=this._extensionsLoadTextureInfoAsync(t,e,n);if(s)return s;if(this.logOpen("".concat(t)),e.texCoord>=6)throw new Error("".concat(t,"/texCoord: Invalid value (").concat(e.texCoord,")"));var u=a.Get("".concat(t,"/index"),this._gltf.textures,e.index);u._textureInfo=e;var _=this._loadTextureAsync("/textures/".concat(e.index),u,function(g){g.coordinatesIndex=e.texCoord||0,r.AddPointerMetadata(g,t),o._parent.onTextureLoadedObservable.notifyObservers(g),n(g)});return this.logClose(),_},r.prototype._loadTextureAsync=function(t,e,n){n===void 0&&(n=function(){});var o=this._extensionsLoadTextureAsync(t,e,n);if(o)return o;this.logOpen("".concat(t," ").concat(e.name||""));var s=e.sampler==null?r.DefaultSampler:a.Get("".concat(t,"/sampler"),this._gltf.samplers,e.sampler),u=a.Get("".concat(t,"/source"),this._gltf.images,e.source),_=this._createTextureAsync(t,s,u,n,void 0,!e._textureInfo.nonColorData);return this.logClose(),_},r.prototype._createTextureAsync=function(t,e,n,o,s,u){var _=this;o===void 0&&(o=function(){});var g=this._loadSampler("/samplers/".concat(e.index),e),O=new Array,y=new c.Deferred;this._babylonScene._blockEntityCollection=!!this._assetContainer;var E={noMipmap:g.noMipMaps,invertY:!1,samplingMode:g.samplingMode,onLoad:function(){_._disposed||y.resolve()},onError:function(x,B){_._disposed||y.reject(new Error("".concat(t,": ").concat(B&&B.message?B.message:x||"Failed to load texture")))},mimeType:n.mimeType,loaderOptions:s,useSRGBBuffer:!!u&&this._parent.useSRGBBuffers},P=new c.Texture(null,this._babylonScene,E);return P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O.push(y.promise),O.push(this.loadImageAsync("/images/".concat(n.index),n).then(function(x){var B=n.uri||"".concat(_._fileName,"#image").concat(n.index),K="data:".concat(_._uniqueRootUrl).concat(B);P.updateURL(K,x);var I=P.getInternalTexture();I&&(I.label=n.name)})),P.wrapU=g.wrapU,P.wrapV=g.wrapV,o(P),this._parent.useGltfTextureNames&&(P.name=n.name||n.uri||"image".concat(n.index)),Promise.all(O).then(function(){return P})},r.prototype._loadSampler=function(t,e){return e._data||(e._data={noMipMaps:e.minFilter===9728||e.minFilter===9729,samplingMode:r._GetTextureSamplingMode(t,e),wrapU:r._GetTextureWrapMode("".concat(t,"/wrapS"),e.wrapS),wrapV:r._GetTextureWrapMode("".concat(t,"/wrapT"),e.wrapT)}),e._data},r.prototype.loadImageAsync=function(t,e){if(!e._data){if(this.logOpen("".concat(t," ").concat(e.name||"")),e.uri)e._data=this.loadUriAsync("".concat(t,"/uri"),e,e.uri);else{var n=a.Get("".concat(t,"/bufferView"),this._gltf.bufferViews,e.bufferView);e._data=this.loadBufferViewAsync("/bufferViews/".concat(n.index),n)}this.logClose()}return e._data},r.prototype.loadUriAsync=function(t,e,n){var o=this,s=this._extensionsLoadUriAsync(t,e,n);if(s)return s;if(!r._ValidateUri(n))throw new Error("".concat(t,": '").concat(n,"' is invalid"));if((0,c.IsBase64DataUrl)(n)){var u=new Uint8Array((0,c.DecodeBase64UrlToBinary)(n));return this.log("".concat(t,": Decoded ").concat(n.substring(0,64),"... (").concat(u.length," bytes)")),Promise.resolve(u)}return this.log("".concat(t,": Loading ").concat(n)),this._parent.preprocessUrlAsync(this._rootUrl+n).then(function(_){return new Promise(function(g,O){o._parent._loadFile(o._babylonScene,_,function(y){o._disposed||(o.log("".concat(t,": Loaded ").concat(n," (").concat(y.byteLength," bytes)")),g(new Uint8Array(y)))},!0,function(y){O(new c.LoadFileError("".concat(t,": Failed to load '").concat(n,"'").concat(y?": "+y.status+" "+y.statusText:""),y))})})})},r.AddPointerMetadata=function(t,e){t.metadata=t.metadata||{};var n=t._internalMetadata=t._internalMetadata||{},o=n.gltf=n.gltf||{},s=o.pointers=o.pointers||[];s.push(e)},r._GetTextureWrapMode=function(t,e){switch(e=e??10497,e){case 33071:return c.Texture.CLAMP_ADDRESSMODE;case 33648:return c.Texture.MIRROR_ADDRESSMODE;case 10497:return c.Texture.WRAP_ADDRESSMODE;default:return c.Logger.Warn("".concat(t,": Invalid value (").concat(e,")")),c.Texture.WRAP_ADDRESSMODE}},r._GetTextureSamplingMode=function(t,e){var n=e.magFilter==null?9729:e.magFilter,o=e.minFilter==null?9987:e.minFilter;if(n===9729)switch(o){case 9728:return c.Texture.LINEAR_NEAREST;case 9729:return c.Texture.LINEAR_LINEAR;case 9984:return c.Texture.LINEAR_NEAREST_MIPNEAREST;case 9985:return c.Texture.LINEAR_LINEAR_MIPNEAREST;case 9986:return c.Texture.LINEAR_NEAREST_MIPLINEAR;case 9987:return c.Texture.LINEAR_LINEAR_MIPLINEAR;default:return c.Logger.Warn("".concat(t,"/minFilter: Invalid value (").concat(o,")")),c.Texture.LINEAR_LINEAR_MIPLINEAR}else switch(n!==9728&&c.Logger.Warn("".concat(t,"/magFilter: Invalid value (").concat(n,")")),o){case 9728:return c.Texture.NEAREST_NEAREST;case 9729:return c.Texture.NEAREST_LINEAR;case 9984:return c.Texture.NEAREST_NEAREST_MIPNEAREST;case 9985:return c.Texture.NEAREST_LINEAR_MIPNEAREST;case 9986:return c.Texture.NEAREST_NEAREST_MIPLINEAR;case 9987:return c.Texture.NEAREST_LINEAR_MIPLINEAR;default:return c.Logger.Warn("".concat(t,"/minFilter: Invalid value (").concat(o,")")),c.Texture.NEAREST_NEAREST_MIPNEAREST}},r._GetTypedArrayConstructor=function(t,e){switch(e){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error("".concat(t,": Invalid component type ").concat(e))}},r._GetTypedArray=function(t,e,n,o,s){var u=n.buffer;o=n.byteOffset+(o||0);var _=r._GetTypedArrayConstructor("".concat(t,"/componentType"),e),g=c.VertexBuffer.GetTypeByteLength(e);return o%g!==0?(c.Logger.Warn("".concat(t,": Copying buffer as byte offset (").concat(o,") is not a multiple of component type byte length (").concat(g,")")),new _(u.slice(o,o+s*g),0)):new _(u,o,s)},r._GetNumComponents=function(t,e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":return 4;case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error("".concat(t,": Invalid type (").concat(e,")"))},r._ValidateUri=function(t){return c.Tools.IsBase64(t)||t.indexOf("..")===-1},r._GetDrawMode=function(t,e){switch(e==null&&(e=4),e){case 0:return c.Material.PointListDrawMode;case 1:return c.Material.LineListDrawMode;case 2:return c.Material.LineLoopDrawMode;case 3:return c.Material.LineStripDrawMode;case 4:return c.Material.TriangleFillMode;case 5:return c.Material.TriangleStripDrawMode;case 6:return c.Material.TriangleFanDrawMode}throw new Error("".concat(t,": Invalid mesh primitive mode (").concat(e,")"))},r.prototype._compileMaterialsAsync=function(){var t=this;this._parent._startPerformanceCounter("Compile materials");var e=new Array;if(this._gltf.materials)for(var n=0,o=this._gltf.materials;n<o.length;n++){var s=o[n];if(s._data)for(var u in s._data)for(var _=s._data[u],g=0,O=_.babylonMeshes;g<O.length;g++){var y=O[g];y.computeWorldMatrix(!0);var E=_.babylonMaterial;e.push(E.forceCompilationAsync(y)),e.push(E.forceCompilationAsync(y,{useInstances:!0})),this._parent.useClipPlane&&(e.push(E.forceCompilationAsync(y,{clipPlane:!0})),e.push(E.forceCompilationAsync(y,{clipPlane:!0,useInstances:!0})))}}return Promise.all(e).then(function(){t._parent._endPerformanceCounter("Compile materials")})},r.prototype._compileShadowGeneratorsAsync=function(){var t=this;this._parent._startPerformanceCounter("Compile shadow generators");for(var e=new Array,n=this._babylonScene.lights,o=0,s=n;o<s.length;o++){var u=s[o],_=u.getShadowGenerator();_&&e.push(_.forceCompilationAsync())}return Promise.all(e).then(function(){t._parent._endPerformanceCounter("Compile shadow generators")})},r.prototype._forEachExtensions=function(t){for(var e=0,n=this._extensions;e<n.length;e++){var o=n[e];o.enabled&&t(o)}},r.prototype._applyExtensions=function(t,e,n){for(var o=0,s=this._extensions;o<s.length;o++){var u=s[o];if(u.enabled){var _="".concat(u.name,".").concat(e),g=t;g._activeLoaderExtensionFunctions=g._activeLoaderExtensionFunctions||{};var O=g._activeLoaderExtensionFunctions;if(!O[_]){O[_]=!0;try{var y=n(u);if(y)return y}finally{delete O[_]}}}}return null},r.prototype._extensionsOnLoading=function(){this._forEachExtensions(function(t){return t.onLoading&&t.onLoading()})},r.prototype._extensionsOnReady=function(){this._forEachExtensions(function(t){return t.onReady&&t.onReady()})},r.prototype._extensionsLoadSceneAsync=function(t,e){return this._applyExtensions(e,"loadScene",function(n){return n.loadSceneAsync&&n.loadSceneAsync(t,e)})},r.prototype._extensionsLoadNodeAsync=function(t,e,n){return this._applyExtensions(e,"loadNode",function(o){return o.loadNodeAsync&&o.loadNodeAsync(t,e,n)})},r.prototype._extensionsLoadCameraAsync=function(t,e,n){return this._applyExtensions(e,"loadCamera",function(o){return o.loadCameraAsync&&o.loadCameraAsync(t,e,n)})},r.prototype._extensionsLoadVertexDataAsync=function(t,e,n){return this._applyExtensions(e,"loadVertexData",function(o){return o._loadVertexDataAsync&&o._loadVertexDataAsync(t,e,n)})},r.prototype._extensionsLoadMeshPrimitiveAsync=function(t,e,n,o,s,u){return this._applyExtensions(s,"loadMeshPrimitive",function(_){return _._loadMeshPrimitiveAsync&&_._loadMeshPrimitiveAsync(t,e,n,o,s,u)})},r.prototype._extensionsLoadMaterialAsync=function(t,e,n,o,s){return this._applyExtensions(e,"loadMaterial",function(u){return u._loadMaterialAsync&&u._loadMaterialAsync(t,e,n,o,s)})},r.prototype._extensionsCreateMaterial=function(t,e,n){return this._applyExtensions(e,"createMaterial",function(o){return o.createMaterial&&o.createMaterial(t,e,n)})},r.prototype._extensionsLoadMaterialPropertiesAsync=function(t,e,n){return this._applyExtensions(e,"loadMaterialProperties",function(o){return o.loadMaterialPropertiesAsync&&o.loadMaterialPropertiesAsync(t,e,n)})},r.prototype._extensionsLoadTextureInfoAsync=function(t,e,n){return this._applyExtensions(e,"loadTextureInfo",function(o){return o.loadTextureInfoAsync&&o.loadTextureInfoAsync(t,e,n)})},r.prototype._extensionsLoadTextureAsync=function(t,e,n){return this._applyExtensions(e,"loadTexture",function(o){return o._loadTextureAsync&&o._loadTextureAsync(t,e,n)})},r.prototype._extensionsLoadAnimationAsync=function(t,e){return this._applyExtensions(e,"loadAnimation",function(n){return n.loadAnimationAsync&&n.loadAnimationAsync(t,e)})},r.prototype._extensionsLoadAnimationChannelAsync=function(t,e,n,o,s){return this._applyExtensions(n,"loadAnimationChannel",function(u){return u._loadAnimationChannelAsync&&u._loadAnimationChannelAsync(t,e,n,o,s)})},r.prototype._extensionsLoadSkinAsync=function(t,e,n){return this._applyExtensions(n,"loadSkin",function(o){return o._loadSkinAsync&&o._loadSkinAsync(t,e,n)})},r.prototype._extensionsLoadUriAsync=function(t,e,n){return this._applyExtensions(e,"loadUri",function(o){return o._loadUriAsync&&o._loadUriAsync(t,e,n)})},r.prototype._extensionsLoadBufferViewAsync=function(t,e){return this._applyExtensions(e,"loadBufferView",function(n){return n.loadBufferViewAsync&&n.loadBufferViewAsync(t,e)})},r.prototype._extensionsLoadBufferAsync=function(t,e,n,o){return this._applyExtensions(e,"loadBuffer",function(s){return s.loadBufferAsync&&s.loadBufferAsync(t,e,n,o)})},r.LoadExtensionAsync=function(t,e,n,o){if(!e.extensions)return null;var s=e.extensions,u=s[n];return u?o("".concat(t,"/extensions/").concat(n),u):null},r.LoadExtraAsync=function(t,e,n,o){if(!e.extras)return null;var s=e.extras,u=s[n];return u?o("".concat(t,"/extras/").concat(n),u):null},r.prototype.isExtensionUsed=function(t){return!!this._gltf.extensionsUsed&&this._gltf.extensionsUsed.indexOf(t)!==-1},r.prototype.logOpen=function(t){this._parent._logOpen(t)},r.prototype.logClose=function(){this._parent._logClose()},r.prototype.log=function(t){this._parent._log(t)},r.prototype.startPerformanceCounter=function(t){this._parent._startPerformanceCounter(t)},r.prototype.endPerformanceCounter=function(t){this._parent._endPerformanceCounter(t)},r.DefaultSampler={index:-1},r}();m.GLTFFileLoader._CreateGLTF2Loader=function(r){return new l(r)}},"../../../dev/loaders/src/glTF/2.0/glTFLoaderAnimation.ts":(w,M,d)=>{d.r(M),d.d(M,{AnimationPropertyInfo:()=>a,TransformNodeAnimationPropertyInfo:()=>i,WeightAnimationPropertyInfo:()=>l,getQuaternion:()=>p,getVector3:()=>m,getWeights:()=>T,nodeAnimationData:()=>r});var f=d("../../../../node_modules/tslib/tslib.es6.mjs"),c=d("babylonjs/Misc/tools");function m(t,e,n,o){return c.Vector3.FromArray(e,n).scaleInPlace(o)}function p(t,e,n,o){return c.Quaternion.FromArray(e,n).scaleInPlace(o)}function T(t,e,n,o){for(var s=new Array(t._numMorphTargets),u=0;u<s.length;u++)s[u]=e[n++]*o;return s}var a=function(){function t(e,n,o,s){this.type=e,this.name=n,this.getValue=o,this.getStride=s}return t.prototype._buildAnimation=function(e,n,o){var s=new c.Animation(e,this.name,n,this.type);return s.setKeys(o),s},t}(),i=function(t){(0,f.__extends)(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.buildAnimations=function(n,o,s,u,_){_(n._babylonTransformNode,this._buildAnimation(o,s,u))},e}(a),l=function(t){(0,f.__extends)(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.buildAnimations=function(n,o,s,u,_){if(n._numMorphTargets)for(var g=function(E){var P=new c.Animation("".concat(o,"_").concat(E),O.name,s,O.type);if(P.setKeys(u.map(function(H){return{frame:H.frame,inTangent:H.inTangent?H.inTangent[E]:void 0,value:H.value[E],outTangent:H.outTangent?H.outTangent[E]:void 0,interpolation:H.interpolation}})),n._primitiveBabylonMeshes)for(var x=0,B=n._primitiveBabylonMeshes;x<B.length;x++){var K=B[x];if(K.morphTargetManager){var I=K.morphTargetManager.getTarget(E),S=P.clone();I.animations.push(S),_(I,S)}}},O=this,y=0;y<n._numMorphTargets;y++)g(y)},e}(a),r={translation:[new i(c.Animation.ANIMATIONTYPE_VECTOR3,"position",m,function(){return 3})],rotation:[new i(c.Animation.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",p,function(){return 4})],scale:[new i(c.Animation.ANIMATIONTYPE_VECTOR3,"scaling",m,function(){return 3})],weights:[new l(c.Animation.ANIMATIONTYPE_FLOAT,"influence",T,function(t){return t._numMorphTargets})]}},"../../../dev/loaders/src/glTF/2.0/glTFLoaderExtension.ts":(w,M,d)=>{d.r(M)},"../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts":(w,M,d)=>{d.r(M),d.d(M,{registerGLTFExtension:()=>p,registeredGLTFExtensions:()=>m,unregisterGLTFExtension:()=>T});var f=d("babylonjs/Misc/tools"),c=new Map,m=c;function p(a,i,l){T(a)&&f.Logger.Warn("Extension with the name '".concat(a,"' already exists")),c.set(a,{isGLTFExtension:i,factory:l})}function T(a){return c.delete(a)}},"../../../dev/loaders/src/glTF/2.0/glTFLoaderInterfaces.ts":(w,M,d)=>{d.r(M)},"../../../dev/loaders/src/glTF/2.0/index.ts":(w,M,d)=>{d.r(M),d.d(M,{ArrayItem:()=>f.ArrayItem,EXT_lights_ies:()=>m.EXT_lights_ies,EXT_lights_image_based:()=>m.EXT_lights_image_based,EXT_mesh_gpu_instancing:()=>m.EXT_mesh_gpu_instancing,EXT_meshopt_compression:()=>m.EXT_meshopt_compression,EXT_texture_avif:()=>m.EXT_texture_avif,EXT_texture_webp:()=>m.EXT_texture_webp,ExtrasAsMetadata:()=>m.ExtrasAsMetadata,GLTFFileLoader:()=>f.GLTFFileLoader,GLTFLoader:()=>f.GLTFLoader,KHR_animation_pointer:()=>m.KHR_animation_pointer,KHR_draco_mesh_compression:()=>m.KHR_draco_mesh_compression,KHR_interactivity:()=>m.KHR_interactivity,KHR_lights:()=>m.KHR_lights,KHR_materials_anisotropy:()=>m.KHR_materials_anisotropy,KHR_materials_clearcoat:()=>m.KHR_materials_clearcoat,KHR_materials_diffuse_transmission:()=>m.KHR_materials_diffuse_transmission,KHR_materials_dispersion:()=>m.KHR_materials_dispersion,KHR_materials_emissive_strength:()=>m.KHR_materials_emissive_strength,KHR_materials_ior:()=>m.KHR_materials_ior,KHR_materials_iridescence:()=>m.KHR_materials_iridescence,KHR_materials_pbrSpecularGlossiness:()=>m.KHR_materials_pbrSpecularGlossiness,KHR_materials_sheen:()=>m.KHR_materials_sheen,KHR_materials_specular:()=>m.KHR_materials_specular,KHR_materials_transmission:()=>m.KHR_materials_transmission,KHR_materials_unlit:()=>m.KHR_materials_unlit,KHR_materials_variants:()=>m.KHR_materials_variants,KHR_materials_volume:()=>m.KHR_materials_volume,KHR_mesh_quantization:()=>m.KHR_mesh_quantization,KHR_node_visibility:()=>m.KHR_node_visibility,KHR_texture_basisu:()=>m.KHR_texture_basisu,KHR_texture_transform:()=>m.KHR_texture_transform,KHR_xmp_json_ld:()=>m.KHR_xmp_json_ld,LoadBoundingInfoFromPositionAccessor:()=>f.LoadBoundingInfoFromPositionAccessor,MSFT_audio_emitter:()=>m.MSFT_audio_emitter,MSFT_lod:()=>m.MSFT_lod,MSFT_minecraftMesh:()=>m.MSFT_minecraftMesh,MSFT_sRGBFactors:()=>m.MSFT_sRGBFactors,registerGLTFExtension:()=>c.registerGLTFExtension,registeredGLTFExtensions:()=>c.registeredGLTFExtensions,unregisterGLTFExtension:()=>c.unregisterGLTFExtension});var f=d("../../../dev/loaders/src/glTF/2.0/glTFLoader.ts");d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtension.ts");var c=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderExtensionRegistry.ts");d("../../../dev/loaders/src/glTF/2.0/glTFLoaderInterfaces.ts");var m=d("../../../dev/loaders/src/glTF/2.0/Extensions/index.ts")},"../../../dev/loaders/src/glTF/glTFFileLoader.metadata.ts":(w,M,d)=>{d.r(M),d.d(M,{GLTFFileLoaderMetadata:()=>c,GLTFMagicBase64Encoded:()=>f});var f="Z2xURg",c={name:"gltf",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:function(m){return m.indexOf("asset")!==-1&&m.indexOf("version")!==-1||m.startsWith("data:base64,"+f)||m.startsWith("data:;base64,"+f)||m.startsWith("data:application/octet-stream;base64,"+f)||m.startsWith("data:model/gltf-binary;base64,"+f)}}},"../../../dev/loaders/src/glTF/glTFFileLoader.ts":(w,M,d)=>{d.r(M),d.d(M,{GLTFFileLoader:()=>e,GLTFLoaderAnimationStartMode:()=>l,GLTFLoaderCoordinateSystemMode:()=>i,GLTFLoaderState:()=>r});var f=d("../../../../node_modules/tslib/tslib.es6.mjs"),c=d("babylonjs/Misc/tools"),m=d("../../../dev/loaders/src/glTF/glTFValidation.ts"),p=d("../../../dev/loaders/src/glTF/glTFFileLoader.metadata.ts");function T(n,o,s){try{return Promise.resolve(new Uint8Array(n,o,s))}catch(u){return Promise.reject(u)}}function a(n,o,s){try{if(o<0||o>=n.byteLength)throw new RangeError("Offset is out of range.");if(o+s>n.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(n.buffer,n.byteOffset+o,s))}catch(u){return Promise.reject(u)}}var i;(function(n){n[n.AUTO=0]="AUTO",n[n.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"})(i||(i={}));var l;(function(n){n[n.NONE=0]="NONE",n[n.FIRST=1]="FIRST",n[n.ALL=2]="ALL"})(l||(l={}));var r;(function(n){n[n.LOADING=0]="LOADING",n[n.READY=1]="READY",n[n.COMPLETE=2]="COMPLETE"})(r||(r={}));var t=function(){function n(){this.coordinateSystemMode=i.AUTO,this.animationStartMode=l.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=function(o){return Promise.resolve(o)},this.extensionOptions={}}return n.prototype.copyFrom=function(o){var s,u,_,g,O,y,E,P,x,B,K,I,S,H,Y,re,Q,$,oe,J,ne;o&&(this.onParsed=o.onParsed,this.coordinateSystemMode=(s=o.coordinateSystemMode)!==null&&s!==void 0?s:this.coordinateSystemMode,this.animationStartMode=(u=o.animationStartMode)!==null&&u!==void 0?u:this.animationStartMode,this.loadNodeAnimations=(_=o.loadNodeAnimations)!==null&&_!==void 0?_:this.loadNodeAnimations,this.loadSkins=(g=o.loadSkins)!==null&&g!==void 0?g:this.loadSkins,this.loadMorphTargets=(O=o.loadMorphTargets)!==null&&O!==void 0?O:this.loadMorphTargets,this.compileMaterials=(y=o.compileMaterials)!==null&&y!==void 0?y:this.compileMaterials,this.useClipPlane=(E=o.useClipPlane)!==null&&E!==void 0?E:this.useClipPlane,this.compileShadowGenerators=(P=o.compileShadowGenerators)!==null&&P!==void 0?P:this.compileShadowGenerators,this.transparencyAsCoverage=(x=o.transparencyAsCoverage)!==null&&x!==void 0?x:this.transparencyAsCoverage,this.useRangeRequests=(B=o.useRangeRequests)!==null&&B!==void 0?B:this.useRangeRequests,this.createInstances=(K=o.createInstances)!==null&&K!==void 0?K:this.createInstances,this.alwaysComputeBoundingBox=(I=o.alwaysComputeBoundingBox)!==null&&I!==void 0?I:this.alwaysComputeBoundingBox,this.loadAllMaterials=(S=o.loadAllMaterials)!==null&&S!==void 0?S:this.loadAllMaterials,this.loadOnlyMaterials=(H=o.loadOnlyMaterials)!==null&&H!==void 0?H:this.loadOnlyMaterials,this.skipMaterials=(Y=o.skipMaterials)!==null&&Y!==void 0?Y:this.skipMaterials,this.useSRGBBuffers=(re=o.useSRGBBuffers)!==null&&re!==void 0?re:this.useSRGBBuffers,this.targetFps=(Q=o.targetFps)!==null&&Q!==void 0?Q:this.targetFps,this.alwaysComputeSkeletonRootNode=($=o.alwaysComputeSkeletonRootNode)!==null&&$!==void 0?$:this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=(oe=o.useGltfTextureNames)!==null&&oe!==void 0?oe:this.useGltfTextureNames,this.preprocessUrlAsync=(J=o.preprocessUrlAsync)!==null&&J!==void 0?J:this.preprocessUrlAsync,this.customRootNode=o.customRootNode,this.onMeshLoaded=o.onMeshLoaded,this.onSkinLoaded=o.onSkinLoaded,this.onTextureLoaded=o.onTextureLoaded,this.onMaterialLoaded=o.onMaterialLoaded,this.onCameraLoaded=o.onCameraLoaded,this.extensionOptions=(ne=o.extensionOptions)!==null&&ne!==void 0?ne:this.extensionOptions)},n}(),e=function(n){(0,f.__extends)(o,n);function o(s){var u=n.call(this)||this;return u.onParsedObservable=new c.Observable,u.onMeshLoadedObservable=new c.Observable,u.onSkinLoadedObservable=new c.Observable,u.onTextureLoadedObservable=new c.Observable,u.onMaterialLoadedObservable=new c.Observable,u.onCameraLoadedObservable=new c.Observable,u.onCompleteObservable=new c.Observable,u.onErrorObservable=new c.Observable,u.onDisposeObservable=new c.Observable,u.onExtensionLoadedObservable=new c.Observable,u.validate=!1,u.onValidatedObservable=new c.Observable,u._loader=null,u._state=null,u._requests=new Array,u.name=p.GLTFFileLoaderMetadata.name,u.extensions=p.GLTFFileLoaderMetadata.extensions,u.onLoaderStateChangedObservable=new c.Observable,u._logIndentLevel=0,u._loggingEnabled=!1,u._log=u._logDisabled,u._capturePerformanceCounters=!1,u._startPerformanceCounter=u._startPerformanceCounterDisabled,u._endPerformanceCounter=u._endPerformanceCounterDisabled,u.copyFrom(s),u}return Object.defineProperty(o.prototype,"onParsed",{set:function(s){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),s&&(this._onParsedObserver=this.onParsedObservable.add(s))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onMeshLoaded",{set:function(s){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),s&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(s))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onSkinLoaded",{set:function(s){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),s&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add(function(u){return s(u.node,u.skinnedNode)}))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onTextureLoaded",{set:function(s){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),s&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(s))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onMaterialLoaded",{set:function(s){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),s&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(s))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onCameraLoaded",{set:function(s){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),s&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(s))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onComplete",{set:function(s){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(s)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onError",{set:function(s){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(s)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onDispose",{set:function(s){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(s)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onExtensionLoaded",{set:function(s){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(s)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"loggingEnabled",{get:function(){return this._loggingEnabled},set:function(s){this._loggingEnabled!==s&&(this._loggingEnabled=s,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"capturePerformanceCounters",{get:function(){return this._capturePerformanceCounters},set:function(s){this._capturePerformanceCounters!==s&&(this._capturePerformanceCounters=s,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onValidated",{set:function(s){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(s)},enumerable:!1,configurable:!0}),o.prototype.dispose=function(){this._loader&&(this._loader.dispose(),this._loader=null);for(var s=0,u=this._requests;s<u.length;s++){var _=u[s];_.abort()}this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=function(g){return Promise.resolve(g)},this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()},o.prototype.loadFile=function(s,u,_,g,O,y,E,P){var x=this;if(ArrayBuffer.isView(u))return this._loadBinary(s,u,_,g,E,P),null;this._progressCallback=O;var B=u.name||c.Tools.GetFilename(u);if(y){if(this.useRangeRequests){this.validate&&c.Logger.Warn("glTF validation is not supported when range requests are enabled");var K={abort:function(){},onCompleteObservable:new c.Observable},I={readAsync:function(S,H){return new Promise(function(Y,re){x._loadFile(s,u,function(Q){Y(new Uint8Array(Q))},!0,function(Q){re(Q)},function(Q){Q.setRequestHeader("Range","bytes=".concat(S,"-").concat(S+H-1))})})},byteLength:0};return this._unpackBinaryAsync(new c.DataReader(I)).then(function(S){K.onCompleteObservable.notifyObservers(K),g(S)},E?function(S){return E(void 0,S)}:void 0),K}return this._loadFile(s,u,function(S){x._validate(s,new Uint8Array(S,0,S.byteLength),_,B),x._unpackBinaryAsync(new c.DataReader({readAsync:function(H,Y){return T(S,H,Y)},byteLength:S.byteLength})).then(function(H){g(H)},E?function(H){return E(void 0,H)}:void 0)},!0,E)}else return this._loadFile(s,u,function(S){try{x._validate(s,S,_,B),g({json:x._parseJson(S)})}catch{E&&E()}},!1,E)},o.prototype._loadBinary=function(s,u,_,g,O,y){this._validate(s,new Uint8Array(u.buffer,u.byteOffset,u.byteLength),_,y),this._unpackBinaryAsync(new c.DataReader({readAsync:function(E,P){return a(u,E,P)},byteLength:u.byteLength})).then(function(E){g(E)},O?function(E){return O(void 0,E)}:void 0)},o.prototype.importMeshAsync=function(s,u,_,g,O,y){var E=this;return Promise.resolve().then(function(){return E.onParsedObservable.notifyObservers(_),E.onParsedObservable.clear(),E._log("Loading ".concat(y||"")),E._loader=E._getLoader(_),E._loader.importMeshAsync(s,u,null,_,g,O,y)})},o.prototype.loadAsync=function(s,u,_,g,O){var y=this;return Promise.resolve().then(function(){return y.onParsedObservable.notifyObservers(u),y.onParsedObservable.clear(),y._log("Loading ".concat(O||"")),y._loader=y._getLoader(u),y._loader.loadAsync(s,u,_,g,O)})},o.prototype.loadAssetContainerAsync=function(s,u,_,g,O){var y=this;return Promise.resolve().then(function(){y.onParsedObservable.notifyObservers(u),y.onParsedObservable.clear(),y._log("Loading ".concat(O||"")),y._loader=y._getLoader(u);var E=new c.AssetContainer(s),P=[];y.onMaterialLoadedObservable.add(function(I){P.push(I)});var x=[];y.onTextureLoadedObservable.add(function(I){x.push(I)});var B=[];y.onCameraLoadedObservable.add(function(I){B.push(I)});var K=[];return y.onMeshLoadedObservable.add(function(I){I.morphTargetManager&&K.push(I.morphTargetManager)}),y._loader.importMeshAsync(null,s,E,u,_,g,O).then(function(I){return Array.prototype.push.apply(E.geometries,I.geometries),Array.prototype.push.apply(E.meshes,I.meshes),Array.prototype.push.apply(E.particleSystems,I.particleSystems),Array.prototype.push.apply(E.skeletons,I.skeletons),Array.prototype.push.apply(E.animationGroups,I.animationGroups),Array.prototype.push.apply(E.materials,P),Array.prototype.push.apply(E.textures,x),Array.prototype.push.apply(E.lights,I.lights),Array.prototype.push.apply(E.transformNodes,I.transformNodes),Array.prototype.push.apply(E.cameras,B),Array.prototype.push.apply(E.morphTargetManagers,K),E})})},o.prototype.canDirectLoad=function(s){return p.GLTFFileLoaderMetadata.canDirectLoad(s)},o.prototype.directLoad=function(s,u){if(u.startsWith("base64,"+p.GLTFMagicBase64Encoded)||u.startsWith(";base64,"+p.GLTFMagicBase64Encoded)||u.startsWith("application/octet-stream;base64,"+p.GLTFMagicBase64Encoded)||u.startsWith("model/gltf-binary;base64,"+p.GLTFMagicBase64Encoded)){var _=(0,c.DecodeBase64UrlToBinary)(u);return this._validate(s,new Uint8Array(_,0,_.byteLength)),this._unpackBinaryAsync(new c.DataReader({readAsync:function(g,O){return T(_,g,O)},byteLength:_.byteLength}))}return this._validate(s,u),Promise.resolve({json:this._parseJson(u)})},o.prototype.createPlugin=function(s){return new o(s[p.GLTFFileLoaderMetadata.name])},Object.defineProperty(o.prototype,"loaderState",{get:function(){return this._state},enumerable:!1,configurable:!0}),o.prototype.whenCompleteAsync=function(){var s=this;return new Promise(function(u,_){s.onCompleteObservable.addOnce(function(){u()}),s.onErrorObservable.addOnce(function(g){_(g)})})},o.prototype._setState=function(s){this._state!==s&&(this._state=s,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(r[this._state]))},o.prototype._loadFile=function(s,u,_,g,O,y){var E=this,P=s._loadFile(u,_,function(x){E._onProgress(x,P)},!0,g,O,y);return P.onCompleteObservable.add(function(){P._lengthComputable=!0,P._total=P._loaded}),this._requests.push(P),P},o.prototype._onProgress=function(s,u){if(this._progressCallback){u._lengthComputable=s.lengthComputable,u._loaded=s.loaded,u._total=s.total;for(var _=!0,g=0,O=0,y=0,E=this._requests;y<E.length;y++){var P=E[y];if(P._lengthComputable===void 0||P._loaded===void 0||P._total===void 0)return;_=_&&P._lengthComputable,g+=P._loaded,O+=P._total}this._progressCallback({lengthComputable:_,loaded:g,total:_?O:0})}},o.prototype._validate=function(s,u,_,g){var O=this;_===void 0&&(_=""),g===void 0&&(g=""),this.validate&&(this._startPerformanceCounter("Validate JSON"),m.GLTFValidation.ValidateAsync(u,_,g,function(y){return O.preprocessUrlAsync(_+y).then(function(E){return s._loadFileAsync(E,void 0,!0,!0).then(function(P){return new Uint8Array(P,0,P.byteLength)})})}).then(function(y){O._endPerformanceCounter("Validate JSON"),O.onValidatedObservable.notifyObservers(y),O.onValidatedObservable.clear()},function(y){O._endPerformanceCounter("Validate JSON"),c.Tools.Warn("Failed to validate: ".concat(y.message)),O.onValidatedObservable.clear()}))},o.prototype._getLoader=function(s){var u=s.json.asset||{};this._log("Asset version: ".concat(u.version)),u.minVersion&&this._log("Asset minimum version: ".concat(u.minVersion)),u.generator&&this._log("Asset generator: ".concat(u.generator));var _=o._parseVersion(u.version);if(!_)throw new Error("Invalid version: "+u.version);if(u.minVersion!==void 0){var g=o._parseVersion(u.minVersion);if(!g)throw new Error("Invalid minimum version: "+u.minVersion);if(o._compareVersion(g,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+u.minVersion)}var O={1:o._CreateGLTF1Loader,2:o._CreateGLTF2Loader},y=O[_.major];if(!y)throw new Error("Unsupported version: "+u.version);return y(this)},o.prototype._parseJson=function(s){this._startPerformanceCounter("Parse JSON"),this._log("JSON length: ".concat(s.length));var u=JSON.parse(s);return this._endPerformanceCounter("Parse JSON"),u},o.prototype._unpackBinaryAsync=function(s){var u=this;return this._startPerformanceCounter("Unpack Binary"),s.loadAsync(20).then(function(){var _={Magic:1179937895},g=s.readUint32();if(g!==_.Magic)throw new c.RuntimeError("Unexpected magic: "+g,c.ErrorCodes.GLTFLoaderUnexpectedMagicError);var O=s.readUint32();u.loggingEnabled&&u._log("Binary version: ".concat(O));var y=s.readUint32();!u.useRangeRequests&&y!==s.buffer.byteLength&&c.Logger.Warn("Length in header does not match actual data length: ".concat(y," != ").concat(s.buffer.byteLength));var E;switch(O){case 1:{E=u._unpackBinaryV1Async(s,y);break}case 2:{E=u._unpackBinaryV2Async(s,y);break}default:throw new Error("Unsupported version: "+O)}return u._endPerformanceCounter("Unpack Binary"),E})},o.prototype._unpackBinaryV1Async=function(s,u){var _={JSON:0},g=s.readUint32(),O=s.readUint32();if(O!==_.JSON)throw new Error("Unexpected content format: ".concat(O));var y=u-s.byteOffset,E={json:this._parseJson(s.readString(g)),bin:null};if(y!==0){var P=s.byteOffset;E.bin={readAsync:function(x,B){return s.buffer.readAsync(P+x,B)},byteLength:y}}return Promise.resolve(E)},o.prototype._unpackBinaryV2Async=function(s,u){var _=this,g={JSON:1313821514,BIN:5130562},O=s.readUint32(),y=s.readUint32();if(y!==g.JSON)throw new Error("First chunk format is not JSON");return s.byteOffset+O===u?s.loadAsync(O).then(function(){return{json:_._parseJson(s.readString(O)),bin:null}}):s.loadAsync(O+8).then(function(){var E={json:_._parseJson(s.readString(O)),bin:null},P=function(){var x=s.readUint32(),B=s.readUint32();switch(B){case g.JSON:throw new Error("Unexpected JSON chunk");case g.BIN:{var K=s.byteOffset;E.bin={readAsync:function(I,S){return s.buffer.readAsync(K+I,S)},byteLength:x},s.skipBytes(x);break}default:{s.skipBytes(x);break}}return s.byteOffset!==u?s.loadAsync(8).then(P):Promise.resolve(E)};return P()})},o._parseVersion=function(s){if(s==="1.0"||s==="1.0.1")return{major:1,minor:0};var u=(s+"").match(/^(\d+)\.(\d+)/);return u?{major:parseInt(u[1]),minor:parseInt(u[2])}:null},o._compareVersion=function(s,u){return s.major>u.major?1:s.major<u.major?-1:s.minor>u.minor?1:s.minor<u.minor?-1:0},o.prototype._logOpen=function(s){this._log(s),this._logIndentLevel++},o.prototype._logClose=function(){--this._logIndentLevel},o.prototype._logEnabled=function(s){var u=o._logSpaces.substring(0,this._logIndentLevel*2);c.Logger.Log("".concat(u).concat(s))},o.prototype._logDisabled=function(s){},o.prototype._startPerformanceCounterEnabled=function(s){c.Tools.StartPerformanceCounter(s)},o.prototype._startPerformanceCounterDisabled=function(s){},o.prototype._endPerformanceCounterEnabled=function(s){c.Tools.EndPerformanceCounter(s)},o.prototype._endPerformanceCounterDisabled=function(s){},o.IncrementalLoading=!0,o.HomogeneousCoordinates=!1,o._logSpaces="                                ",o}(t);(0,c.registerSceneLoaderPlugin)(new e)},"../../../dev/loaders/src/glTF/glTFValidation.ts":(w,M,d)=>{d.r(M),d.d(M,{GLTFValidation:()=>p});var f=d("babylonjs/Misc/tools");function c(T,a,i,l){var r={externalResourceFunction:l};return i&&(r.uri=a==="file:"?i:a+i),ArrayBuffer.isView(T)?GLTFValidator.validateBytes(T,r):GLTFValidator.validateString(T,r)}function m(){var T=[];onmessage=function(a){var i=a.data;switch(i.id){case"init":{importScripts(i.url);break}case"validate":{c(i.data,i.rootUrl,i.fileName,function(l){return new Promise(function(r,t){var e=T.length;T.push({resolve:r,reject:t}),postMessage({id:"getExternalResource",index:e,uri:l})})}).then(function(l){postMessage({id:"validate.resolve",value:l})},function(l){postMessage({id:"validate.reject",reason:l})});break}case"getExternalResource.resolve":{T[i.index].resolve(i.value);break}case"getExternalResource.reject":{T[i.index].reject(i.reason);break}}}}var p=function(){function T(){}return T.ValidateAsync=function(a,i,l,r){var t=this;return typeof Worker=="function"?new Promise(function(e,n){var o="".concat(c,"(").concat(m,")()"),s=URL.createObjectURL(new Blob([o],{type:"application/javascript"})),u=new Worker(s),_=function(y){u.removeEventListener("error",_),u.removeEventListener("message",g),n(y)},g=function(y){var E=y.data;switch(E.id){case"getExternalResource":{r(E.uri).then(function(P){u.postMessage({id:"getExternalResource.resolve",index:E.index,value:P},[P.buffer])},function(P){u.postMessage({id:"getExternalResource.reject",index:E.index,reason:P})});break}case"validate.resolve":{u.removeEventListener("error",_),u.removeEventListener("message",g),e(E.value),u.terminate();break}case"validate.reject":u.removeEventListener("error",_),u.removeEventListener("message",g),n(E.reason),u.terminate()}};if(u.addEventListener("error",_),u.addEventListener("message",g),u.postMessage({id:"init",url:f.Tools.GetBabylonScriptURL(t.Configuration.url)}),ArrayBuffer.isView(a)){var O=a.slice();u.postMessage({id:"validate",data:O,rootUrl:i,fileName:l},[O.buffer])}else u.postMessage({id:"validate",data:a,rootUrl:i,fileName:l})}):(this._LoadScriptPromise||(this._LoadScriptPromise=f.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then(function(){return c(a,i,l,r)}))},T.Configuration={url:"".concat(f.Tools._DefaultCdnUrl,"/gltf_validator.js")},T}()},"../../../dev/loaders/src/glTF/index.ts":(w,M,d)=>{d.r(M),d.d(M,{GLTF1:()=>m,GLTF2:()=>p,GLTFFileLoader:()=>f.GLTFFileLoader,GLTFLoaderAnimationStartMode:()=>f.GLTFLoaderAnimationStartMode,GLTFLoaderCoordinateSystemMode:()=>f.GLTFLoaderCoordinateSystemMode,GLTFLoaderState:()=>f.GLTFLoaderState,GLTFValidation:()=>c.GLTFValidation});var f=d("../../../dev/loaders/src/glTF/glTFFileLoader.ts"),c=d("../../../dev/loaders/src/glTF/glTFValidation.ts"),m=d("../../../dev/loaders/src/glTF/1.0/index.ts"),p=d("../../../dev/loaders/src/glTF/2.0/index.ts")},"../../../dev/loaders/src/index.ts":(w,M,d)=>{d.r(M),d.d(M,{GLTF1:()=>f.GLTF1,GLTF2:()=>f.GLTF2,GLTFFileLoader:()=>f.GLTFFileLoader,GLTFLoaderAnimationStartMode:()=>f.GLTFLoaderAnimationStartMode,GLTFLoaderCoordinateSystemMode:()=>f.GLTFLoaderCoordinateSystemMode,GLTFLoaderState:()=>f.GLTFLoaderState,GLTFValidation:()=>f.GLTFValidation,MTLFileLoader:()=>c.MTLFileLoader,OBJFileLoader:()=>c.OBJFileLoader,SPLATFileLoader:()=>p.SPLATFileLoader,STLFileLoader:()=>m.STLFileLoader,SolidParser:()=>c.SolidParser});var f=d("../../../dev/loaders/src/glTF/index.ts"),c=d("../../../dev/loaders/src/OBJ/index.ts"),m=d("../../../dev/loaders/src/STL/index.ts"),p=d("../../../dev/loaders/src/SPLAT/index.ts")},"../../../lts/loaders/src/legacy/legacy-glTF.ts":(w,M,d)=>{d.r(M),d.d(M,{GLTFFileLoader:()=>f.GLTFFileLoader,GLTFLoaderAnimationStartMode:()=>f.GLTFLoaderAnimationStartMode,GLTFLoaderCoordinateSystemMode:()=>f.GLTFLoaderCoordinateSystemMode,GLTFLoaderState:()=>f.GLTFLoaderState,GLTFValidation:()=>c.GLTFValidation});var f=d("../../../dev/loaders/src/glTF/glTFFileLoader.ts"),c=d("../../../dev/loaders/src/glTF/glTFValidation.ts"),m=typeof d.g<"u"?d.g:typeof window<"u"?window:void 0;if(typeof m<"u"){m.BABYLON=m.BABYLON||{};for(var p in f)m.BABYLON[p]=f[p];for(var p in c)m.BABYLON[p]=c[p]}},"../../../lts/loaders/src/legacy/legacy-glTF1.ts":(w,M,d)=>{d.r(M),d.d(M,{GLTF1:()=>f});var f=d("../../../dev/loaders/src/glTF/1.0/index.ts"),c=typeof d.g<"u"?d.g:typeof window<"u"?window:void 0;if(typeof c<"u"){c.BABYLON=c.BABYLON||{},c.BABYLON.GLTF1=c.BABYLON.GLTF1||{};for(var m in f)c.BABYLON.GLTF1[m]=f[m]}},"../../../lts/loaders/src/legacy/legacy-glTF2.ts":(w,M,d)=>{d.r(M),d.d(M,{GLTF2:()=>m});var f=d("../../../dev/loaders/src/glTF/2.0/Extensions/index.ts"),c=d("../../../dev/loaders/src/glTF/2.0/glTFLoaderInterfaces.ts"),m=d("../../../dev/loaders/src/glTF/2.0/index.ts"),p=typeof d.g<"u"?d.g:typeof window<"u"?window:void 0;if(typeof p<"u"){p.BABYLON=p.BABYLON||{};var T=p.BABYLON;T.GLTF2=T.GLTF2||{},T.GLTF2.Loader=T.GLTF2.Loader||{},T.GLTF2.Loader.Extensions=T.GLTF2.Loader.Extensions||{};var a=[];for(var i in f)T.GLTF2.Loader.Extensions[i]=f[i],a.push(i);for(var i in c)T.GLTF2.Loader[i]=c[i],a.push(i);for(var i in m)a.indexOf(i)>-1||(T.GLTF2[i]=m[i])}},"../../../lts/loaders/src/legacy/legacy-objFileLoader.ts":(w,M,d)=>{d.r(M),d.d(M,{MTLFileLoader:()=>f.MTLFileLoader,OBJFileLoader:()=>f.OBJFileLoader,SolidParser:()=>f.SolidParser});var f=d("../../../dev/loaders/src/OBJ/index.ts"),c=typeof d.g<"u"?d.g:typeof window<"u"?window:void 0;if(typeof c<"u")for(var m in f)c.BABYLON[m]||(c.BABYLON[m]=f[m])},"../../../lts/loaders/src/legacy/legacy-stlFileLoader.ts":(w,M,d)=>{d.r(M),d.d(M,{STLFileLoader:()=>f.STLFileLoader});var f=d("../../../dev/loaders/src/STL/index.ts"),c=typeof d.g<"u"?d.g:typeof window<"u"?window:void 0;if(typeof c<"u")for(var m in f)c.BABYLON[m]||(c.BABYLON[m]=f[m])},"../../../lts/loaders/src/legacy/legacy.ts":(w,M,d)=>{d.r(M),d.d(M,{GLTF1:()=>f.GLTF1,GLTF2:()=>f.GLTF2,GLTFFileLoader:()=>f.GLTFFileLoader,GLTFLoaderAnimationStartMode:()=>f.GLTFLoaderAnimationStartMode,GLTFLoaderCoordinateSystemMode:()=>f.GLTFLoaderCoordinateSystemMode,GLTFLoaderState:()=>f.GLTFLoaderState,GLTFValidation:()=>f.GLTFValidation,MTLFileLoader:()=>f.MTLFileLoader,OBJFileLoader:()=>f.OBJFileLoader,SPLATFileLoader:()=>f.SPLATFileLoader,STLFileLoader:()=>f.STLFileLoader,SolidParser:()=>f.SolidParser});var f=d("../../../dev/loaders/src/index.ts");d("../../../lts/loaders/src/legacy/legacy-glTF.ts"),d("../../../lts/loaders/src/legacy/legacy-glTF1.ts"),d("../../../lts/loaders/src/legacy/legacy-glTF2.ts"),d("../../../lts/loaders/src/legacy/legacy-objFileLoader.ts"),d("../../../lts/loaders/src/legacy/legacy-stlFileLoader.ts")},"babylonjs/Misc/tools":w=>{w.exports=Le},"../../../../node_modules/tslib/tslib.es6.mjs":(w,M,d)=>{d.r(M),d.d(M,{__addDisposableResource:()=>J,__assign:()=>m,__asyncDelegator:()=>B,__asyncGenerator:()=>x,__asyncValues:()=>K,__await:()=>P,__awaiter:()=>n,__classPrivateFieldGet:()=>Q,__classPrivateFieldIn:()=>oe,__classPrivateFieldSet:()=>$,__createBinding:()=>s,__decorate:()=>T,__disposeResources:()=>te,__esDecorate:()=>i,__exportStar:()=>u,__extends:()=>c,__generator:()=>o,__importDefault:()=>re,__importStar:()=>Y,__makeTemplateObject:()=>I,__metadata:()=>e,__param:()=>a,__propKey:()=>r,__read:()=>g,__rest:()=>p,__rewriteRelativeImportExtension:()=>q,__runInitializers:()=>l,__setFunctionName:()=>t,__spread:()=>O,__spreadArray:()=>E,__spreadArrays:()=>y,__values:()=>_,default:()=>Z});var f=function(C,v){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,A){h.__proto__=A}||function(h,A){for(var L in A)Object.prototype.hasOwnProperty.call(A,L)&&(h[L]=A[L])},f(C,v)};function c(C,v){if(typeof v!="function"&&v!==null)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");f(C,v);function h(){this.constructor=C}C.prototype=v===null?Object.create(v):(h.prototype=v.prototype,new h)}var m=function(){return m=Object.assign||function(v){for(var h,A=1,L=arguments.length;A<L;A++){h=arguments[A];for(var F in h)Object.prototype.hasOwnProperty.call(h,F)&&(v[F]=h[F])}return v},m.apply(this,arguments)};function p(C,v){var h={};for(var A in C)Object.prototype.hasOwnProperty.call(C,A)&&v.indexOf(A)<0&&(h[A]=C[A]);if(C!=null&&typeof Object.getOwnPropertySymbols=="function")for(var L=0,A=Object.getOwnPropertySymbols(C);L<A.length;L++)v.indexOf(A[L])<0&&Object.prototype.propertyIsEnumerable.call(C,A[L])&&(h[A[L]]=C[A[L]]);return h}function T(C,v,h,A){var L=arguments.length,F=L<3?v:A===null?A=Object.getOwnPropertyDescriptor(v,h):A,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")F=Reflect.decorate(C,v,h,A);else for(var b=C.length-1;b>=0;b--)(R=C[b])&&(F=(L<3?R(F):L>3?R(v,h,F):R(v,h))||F);return L>3&&F&&Object.defineProperty(v,h,F),F}function a(C,v){return function(h,A){v(h,A,C)}}function i(C,v,h,A,L,F){function R(ee){if(ee!==void 0&&typeof ee!="function")throw new TypeError("Function expected");return ee}for(var b=A.kind,N=b==="getter"?"get":b==="setter"?"set":"value",D=!v&&C?A.static?C:C.prototype:null,G=v||(D?Object.getOwnPropertyDescriptor(D,A.name):{}),U,z=!1,V=h.length-1;V>=0;V--){var j={};for(var W in A)j[W]=W==="access"?{}:A[W];for(var W in A.access)j.access[W]=A.access[W];j.addInitializer=function(ee){if(z)throw new TypeError("Cannot add initializers after decoration has completed");F.push(R(ee||null))};var X=(0,h[V])(b==="accessor"?{get:G.get,set:G.set}:G[N],j);if(b==="accessor"){if(X===void 0)continue;if(X===null||typeof X!="object")throw new TypeError("Object expected");(U=R(X.get))&&(G.get=U),(U=R(X.set))&&(G.set=U),(U=R(X.init))&&L.unshift(U)}else(U=R(X))&&(b==="field"?L.unshift(U):G[N]=U)}D&&Object.defineProperty(D,A.name,G),z=!0}function l(C,v,h){for(var A=arguments.length>2,L=0;L<v.length;L++)h=A?v[L].call(C,h):v[L].call(C);return A?h:void 0}function r(C){return typeof C=="symbol"?C:"".concat(C)}function t(C,v,h){return typeof v=="symbol"&&(v=v.description?"[".concat(v.description,"]"):""),Object.defineProperty(C,"name",{configurable:!0,value:h?"".concat(h," ",v):v})}function e(C,v){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(C,v)}function n(C,v,h,A){function L(F){return F instanceof h?F:new h(function(R){R(F)})}return new(h||(h=Promise))(function(F,R){function b(G){try{D(A.next(G))}catch(U){R(U)}}function N(G){try{D(A.throw(G))}catch(U){R(U)}}function D(G){G.done?F(G.value):L(G.value).then(b,N)}D((A=A.apply(C,v||[])).next())})}function o(C,v){var h={label:0,sent:function(){if(F[0]&1)throw F[1];return F[1]},trys:[],ops:[]},A,L,F,R=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return R.next=b(0),R.throw=b(1),R.return=b(2),typeof Symbol=="function"&&(R[Symbol.iterator]=function(){return this}),R;function b(D){return function(G){return N([D,G])}}function N(D){if(A)throw new TypeError("Generator is already executing.");for(;R&&(R=0,D[0]&&(h=0)),h;)try{if(A=1,L&&(F=D[0]&2?L.return:D[0]?L.throw||((F=L.return)&&F.call(L),0):L.next)&&!(F=F.call(L,D[1])).done)return F;switch(L=0,F&&(D=[D[0]&2,F.value]),D[0]){case 0:case 1:F=D;break;case 4:return h.label++,{value:D[1],done:!1};case 5:h.label++,L=D[1],D=[0];continue;case 7:D=h.ops.pop(),h.trys.pop();continue;default:if(F=h.trys,!(F=F.length>0&&F[F.length-1])&&(D[0]===6||D[0]===2)){h=0;continue}if(D[0]===3&&(!F||D[1]>F[0]&&D[1]<F[3])){h.label=D[1];break}if(D[0]===6&&h.label<F[1]){h.label=F[1],F=D;break}if(F&&h.label<F[2]){h.label=F[2],h.ops.push(D);break}F[2]&&h.ops.pop(),h.trys.pop();continue}D=v.call(C,h)}catch(G){D=[6,G],L=0}finally{A=F=0}if(D[0]&5)throw D[1];return{value:D[0]?D[1]:void 0,done:!0}}}var s=Object.create?function(C,v,h,A){A===void 0&&(A=h);var L=Object.getOwnPropertyDescriptor(v,h);(!L||("get"in L?!v.__esModule:L.writable||L.configurable))&&(L={enumerable:!0,get:function(){return v[h]}}),Object.defineProperty(C,A,L)}:function(C,v,h,A){A===void 0&&(A=h),C[A]=v[h]};function u(C,v){for(var h in C)h!=="default"&&!Object.prototype.hasOwnProperty.call(v,h)&&s(v,C,h)}function _(C){var v=typeof Symbol=="function"&&Symbol.iterator,h=v&&C[v],A=0;if(h)return h.call(C);if(C&&typeof C.length=="number")return{next:function(){return C&&A>=C.length&&(C=void 0),{value:C&&C[A++],done:!C}}};throw new TypeError(v?"Object is not iterable.":"Symbol.iterator is not defined.")}function g(C,v){var h=typeof Symbol=="function"&&C[Symbol.iterator];if(!h)return C;var A=h.call(C),L,F=[],R;try{for(;(v===void 0||v-- >0)&&!(L=A.next()).done;)F.push(L.value)}catch(b){R={error:b}}finally{try{L&&!L.done&&(h=A.return)&&h.call(A)}finally{if(R)throw R.error}}return F}function O(){for(var C=[],v=0;v<arguments.length;v++)C=C.concat(g(arguments[v]));return C}function y(){for(var C=0,v=0,h=arguments.length;v<h;v++)C+=arguments[v].length;for(var A=Array(C),L=0,v=0;v<h;v++)for(var F=arguments[v],R=0,b=F.length;R<b;R++,L++)A[L]=F[R];return A}function E(C,v,h){if(h||arguments.length===2)for(var A=0,L=v.length,F;A<L;A++)(F||!(A in v))&&(F||(F=Array.prototype.slice.call(v,0,A)),F[A]=v[A]);return C.concat(F||Array.prototype.slice.call(v))}function P(C){return this instanceof P?(this.v=C,this):new P(C)}function x(C,v,h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var A=h.apply(C,v||[]),L,F=[];return L=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),b("next"),b("throw"),b("return",R),L[Symbol.asyncIterator]=function(){return this},L;function R(V){return function(j){return Promise.resolve(j).then(V,U)}}function b(V,j){A[V]&&(L[V]=function(W){return new Promise(function(X,ee){F.push([V,W,X,ee])>1||N(V,W)})},j&&(L[V]=j(L[V])))}function N(V,j){try{D(A[V](j))}catch(W){z(F[0][3],W)}}function D(V){V.value instanceof P?Promise.resolve(V.value.v).then(G,U):z(F[0][2],V)}function G(V){N("next",V)}function U(V){N("throw",V)}function z(V,j){V(j),F.shift(),F.length&&N(F[0][0],F[0][1])}}function B(C){var v,h;return v={},A("next"),A("throw",function(L){throw L}),A("return"),v[Symbol.iterator]=function(){return this},v;function A(L,F){v[L]=C[L]?function(R){return(h=!h)?{value:P(C[L](R)),done:!1}:F?F(R):R}:F}}function K(C){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var v=C[Symbol.asyncIterator],h;return v?v.call(C):(C=typeof _=="function"?_(C):C[Symbol.iterator](),h={},A("next"),A("throw"),A("return"),h[Symbol.asyncIterator]=function(){return this},h);function A(F){h[F]=C[F]&&function(R){return new Promise(function(b,N){R=C[F](R),L(b,N,R.done,R.value)})}}function L(F,R,b,N){Promise.resolve(N).then(function(D){F({value:D,done:b})},R)}}function I(C,v){return Object.defineProperty?Object.defineProperty(C,"raw",{value:v}):C.raw=v,C}var S=Object.create?function(C,v){Object.defineProperty(C,"default",{enumerable:!0,value:v})}:function(C,v){C.default=v},H=function(C){return H=Object.getOwnPropertyNames||function(v){var h=[];for(var A in v)Object.prototype.hasOwnProperty.call(v,A)&&(h[h.length]=A);return h},H(C)};function Y(C){if(C&&C.__esModule)return C;var v={};if(C!=null)for(var h=H(C),A=0;A<h.length;A++)h[A]!=="default"&&s(v,C,h[A]);return S(v,C),v}function re(C){return C&&C.__esModule?C:{default:C}}function Q(C,v,h,A){if(h==="a"&&!A)throw new TypeError("Private accessor was defined without a getter");if(typeof v=="function"?C!==v||!A:!v.has(C))throw new TypeError("Cannot read private member from an object whose class did not declare it");return h==="m"?A:h==="a"?A.call(C):A?A.value:v.get(C)}function $(C,v,h,A,L){if(A==="m")throw new TypeError("Private method is not writable");if(A==="a"&&!L)throw new TypeError("Private accessor was defined without a setter");if(typeof v=="function"?C!==v||!L:!v.has(C))throw new TypeError("Cannot write private member to an object whose class did not declare it");return A==="a"?L.call(C,h):L?L.value=h:v.set(C,h),h}function oe(C,v){if(v===null||typeof v!="object"&&typeof v!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof C=="function"?v===C:C.has(v)}function J(C,v,h){if(v!=null){if(typeof v!="object"&&typeof v!="function")throw new TypeError("Object expected.");var A,L;if(h){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");A=v[Symbol.asyncDispose]}if(A===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");A=v[Symbol.dispose],h&&(L=A)}if(typeof A!="function")throw new TypeError("Object not disposable.");L&&(A=function(){try{L.call(this)}catch(F){return Promise.reject(F)}}),C.stack.push({value:v,dispose:A,async:h})}else h&&C.stack.push({async:!0});return v}var ne=typeof SuppressedError=="function"?SuppressedError:function(C,v,h){var A=new Error(h);return A.name="SuppressedError",A.error=C,A.suppressed=v,A};function te(C){function v(F){C.error=C.hasError?new ne(F,C.error,"An error was suppressed during disposal."):F,C.hasError=!0}var h,A=0;function L(){for(;h=C.stack.pop();)try{if(!h.async&&A===1)return A=0,C.stack.push(h),Promise.resolve().then(L);if(h.dispose){var F=h.dispose.call(h.value);if(h.async)return A|=2,Promise.resolve(F).then(L,function(R){return v(R),L()})}else A|=1}catch(R){v(R)}if(A===1)return C.hasError?Promise.reject(C.error):Promise.resolve();if(C.hasError)throw C.error}return L()}function q(C,v){return typeof C=="string"&&/^\.\.?\//.test(C)?C.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(h,A,L,F,R){return A?v?".jsx":".js":L&&(!F||!R)?h:L+F+"."+R.toLowerCase()+"js"}):C}const Z={__extends:c,__assign:m,__rest:p,__decorate:T,__param:a,__esDecorate:i,__runInitializers:l,__propKey:r,__setFunctionName:t,__metadata:e,__awaiter:n,__generator:o,__createBinding:s,__exportStar:u,__values:_,__read:g,__spread:O,__spreadArrays:y,__spreadArray:E,__await:P,__asyncGenerator:x,__asyncDelegator:B,__asyncValues:K,__makeTemplateObject:I,__importStar:Y,__importDefault:re,__classPrivateFieldGet:Q,__classPrivateFieldSet:$,__classPrivateFieldIn:oe,__addDisposableResource:J,__disposeResources:te,__rewriteRelativeImportExtension:q}}},ye={};function de(w){var M=ye[w];if(M!==void 0)return M.exports;var d=ye[w]={exports:{}};return Fe[w](d,d.exports,de),d.exports}de.n=w=>{var M=w&&w.__esModule?()=>w.default:()=>w;return de.d(M,{a:M}),M},(()=>{var w=Object.getPrototypeOf?d=>Object.getPrototypeOf(d):d=>d.__proto__,M;de.t=function(d,f){if(f&1&&(d=this(d)),f&8||typeof d=="object"&&d&&(f&4&&d.__esModule||f&16&&typeof d.then=="function"))return d;var c=Object.create(null);de.r(c);var m={};M=M||[null,w({}),w([]),w(w)];for(var p=f&2&&d;typeof p=="object"&&!~M.indexOf(p);p=w(p))Object.getOwnPropertyNames(p).forEach(T=>m[T]=()=>d[T]);return m.default=()=>d,de.d(c,m),c}})(),de.d=(w,M)=>{for(var d in M)de.o(M,d)&&!de.o(w,d)&&Object.defineProperty(w,d,{enumerable:!0,get:M[d]})},de.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),de.o=(w,M)=>Object.prototype.hasOwnProperty.call(w,M),de.r=w=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(w,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(w,"__esModule",{value:!0})};var ge={};return(()=>{/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/de.r(ge),de.d(ge,{default:()=>M,loaders:()=>w});var w=de("../../../lts/loaders/src/legacy/legacy.ts");const M=w})(),ge=ge.default,ge})())})(Re);
