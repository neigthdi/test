var Ne=(ui,xs)=>()=>(xs||ui((xs={exports:{}}).exports,xs),xs.exports);var ke=Ne((jh,de)=>{(function(ui,xs){typeof jh=="object"&&typeof de<"u"?xs(jh):typeof define=="function"&&define.amd?define(["exports"],xs):xs((ui=ui||window||global).OIMO={})})(void 0,function(ui){Number.EPSILON===void 0&&(Number.EPSILON=Math.pow(2,-52)),Math.sign===void 0&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),Function.prototype.name===void 0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),Object.assign===void 0&&(Object.assign=function(t){if(t==null)throw new TypeError("Cannot convert undefined or null to object");for(var s=Object(t),h=1;h<arguments.length;h++){var e=arguments[h];if(e!=null)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(s[a]=e[a])}return s});var xs,Ch,_s,qs,Oh="1.0.9",Ah=0,Dh=1,Eh=2,Fh=3,Bh=0,Rh=0,bs=1,vs=2,Cs=3,Rs=4,Uh=5,_h=0,qh=1,Jh=2,Wh=3,Yh=4,Hh=5,Kh=6,g={sqrt:Math.sqrt,abs:Math.abs,floor:Math.floor,cos:Math.cos,sin:Math.sin,acos:Math.acos,asin:Math.asin,atan2:Math.atan2,round:Math.round,pow:Math.pow,max:Math.max,min:Math.min,random:Math.random,degtorad:.017453292519943295,radtodeg:57.29577951308232,PI:3.141592653589793,TwoPI:6.283185307179586,PI90:1.570796326794896,PI270:4.712388980384689,INF:1/0,EPZ:1e-5,EPZ2:1e-6,lerp:function(t,s,h){return(1-h)*t+h*s},randInt:function(t,s){return t+g.floor(g.random()*(s-t+1))},rand:function(t,s){return t+g.random()*(s-t)},generateUUID:(Ch="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_s=new Array(36),qs=0,function(){for(var t=0;t<36;t++)t===8||t===13||t===18||t===23?_s[t]="-":t===14?_s[t]="4":(qs<=2&&(qs=33554432+16777216*Math.random()|0),xs=15&qs,qs>>=4,_s[t]=Ch[t===19?3&xs|8:xs]);return _s.join("")}),int:function(t){return g.floor(t)},fix:function(t,s){return t.toFixed(s||3,10)},clamp:function(t,s,h){return g.max(s,g.min(h,t))},distance:function(t,s){var h=s[0]-t[0],e=s[1]-t[1],a=s[2]-t[2];return g.sqrt(h*h+e*e+a*a)},acosClamp:function(t){return t>1?0:t<-1?g.PI:g.acos(t)},distanceVector:function(t,s){var h=t.x-s.x,e=t.y-s.y,a=t.z-s.z;return h*h+e*e+a*a},dotVectors:function(t,s){return t.x*s.x+t.y*s.y+t.z*s.z}};function Rt(t,s){console.error("[OIMO] "+t+": "+s)}function xh(t){this.parent=t,this.infos=new Float32Array(13),this.f=[0,0,0],this.times=[0,0,0,0],this.broadPhase=this.parent.broadPhaseType,this.version=Oh,this.fps=0,this.tt=0,this.broadPhaseTime=0,this.narrowPhaseTime=0,this.solvingTime=0,this.totalTime=0,this.updateTime=0,this.MaxBroadPhaseTime=0,this.MaxNarrowPhaseTime=0,this.MaxSolvingTime=0,this.MaxTotalTime=0,this.MaxUpdateTime=0}function M(t,s,h){this.x=t||0,this.y=s||0,this.z=h||0}function Ut(t,s,h,e){this.x=t||0,this.y=s||0,this.z=h||0,this.w=e!==void 0?e:1}function Bt(t,s,h,e,a,n,o,c,l){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("OIMO.Mat33: the constructor no longer reads arguments. use .set() instead.")}function Ks(t,s,h,e,a,n){this.elements=new Float32Array(6);var o=this.elements;o[0]=t||0,o[1]=h||0,o[2]=a||0,o[3]=s||0,o[4]=e||0,o[5]=n||0}Object.assign(xh.prototype,{setTime:function(t){this.times[t||0]=performance.now()},resetMax:function(){this.MaxBroadPhaseTime=0,this.MaxNarrowPhaseTime=0,this.MaxSolvingTime=0,this.MaxTotalTime=0,this.MaxUpdateTime=0},calcBroadPhase:function(){this.setTime(2),this.broadPhaseTime=this.times[2]-this.times[1]},calcNarrowPhase:function(){this.setTime(3),this.narrowPhaseTime=this.times[3]-this.times[2]},calcEnd:function(){this.setTime(2),this.solvingTime=this.times[2]-this.times[1],this.totalTime=this.times[2]-this.times[0],this.updateTime=this.totalTime-(this.broadPhaseTime+this.narrowPhaseTime+this.solvingTime),this.tt===100&&this.resetMax(),this.tt>100&&(this.broadPhaseTime>this.MaxBroadPhaseTime&&(this.MaxBroadPhaseTime=this.broadPhaseTime),this.narrowPhaseTime>this.MaxNarrowPhaseTime&&(this.MaxNarrowPhaseTime=this.narrowPhaseTime),this.solvingTime>this.MaxSolvingTime&&(this.MaxSolvingTime=this.solvingTime),this.totalTime>this.MaxTotalTime&&(this.MaxTotalTime=this.totalTime),this.updateTime>this.MaxUpdateTime&&(this.MaxUpdateTime=this.updateTime)),this.upfps(),this.tt++,this.tt>500&&(this.tt=0)},upfps:function(){this.f[1]=Date.now(),this.f[1]-1e3>this.f[0]&&(this.f[0]=this.f[1],this.fps=this.f[2],this.f[2]=0),this.f[2]++},show:function(){return["Oimo.js "+this.version+"<br>",this.broadPhase+"<br><br>","FPS: "+this.fps+" fps<br><br>","rigidbody "+this.parent.numRigidBodies+"<br>","contact &nbsp;&nbsp;"+this.parent.numContacts+"<br>","ct-point &nbsp;"+this.parent.numContactPoints+"<br>","paircheck "+this.parent.broadPhase.numPairChecks+"<br>","island &nbsp;&nbsp;&nbsp;"+this.parent.numIslands+"<br><br>","Time in milliseconds<br><br>","broadphase &nbsp;"+g.fix(this.broadPhaseTime)+" | "+g.fix(this.MaxBroadPhaseTime)+"<br>","narrowphase "+g.fix(this.narrowPhaseTime)+" | "+g.fix(this.MaxNarrowPhaseTime)+"<br>","solving &nbsp;&nbsp;&nbsp;&nbsp;"+g.fix(this.solvingTime)+" | "+g.fix(this.MaxSolvingTime)+"<br>","total &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+g.fix(this.totalTime)+" | "+g.fix(this.MaxTotalTime)+"<br>","updating &nbsp;&nbsp;&nbsp;"+g.fix(this.updateTime)+" | "+g.fix(this.MaxUpdateTime)+"<br>"].join(`
`)},toArray:function(){return this.infos[0]=this.parent.broadPhase.types,this.infos[1]=this.parent.numRigidBodies,this.infos[2]=this.parent.numContacts,this.infos[3]=this.parent.broadPhase.numPairChecks,this.infos[4]=this.parent.numContactPoints,this.infos[5]=this.parent.numIslands,this.infos[6]=this.broadPhaseTime,this.infos[7]=this.narrowPhaseTime,this.infos[8]=this.solvingTime,this.infos[9]=this.updateTime,this.infos[10]=this.totalTime,this.infos[11]=this.fps,this.infos}}),Object.assign(M.prototype,{Vec3:!0,set:function(t,s,h){return this.x=t,this.y=s,this.z=h,this},add:function(t,s){return s!==void 0?this.addVectors(t,s):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addVectors:function(t,s){return this.x=t.x+s.x,this.y=t.y+s.y,this.z=t.z+s.z,this},addEqual:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},sub:function(t,s){return s!==void 0?this.subVectors(t,s):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subVectors:function(t,s){return this.x=t.x-s.x,this.y=t.y-s.y,this.z=t.z-s.z,this},subEqual:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},scale:function(t,s){return this.x=t.x*s,this.y=t.y*s,this.z=t.z*s,this},scaleEqual:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},addScaledVector:function(t,s){return this.x+=t.x*s,this.y+=t.y*s,this.z+=t.z*s,this},subScaledVector:function(t,s){return this.x-=t.x*s,this.y-=t.y*s,this.z-=t.z*s,this},cross:function(t,s){if(s!==void 0)return this.crossVectors(t,s);var h=this.x,e=this.y,a=this.z;return this.x=e*t.z-a*t.y,this.y=a*t.x-h*t.z,this.z=h*t.y-e*t.x,this},crossVectors:function(t,s){var h=t.x,e=t.y,a=t.z,n=s.x,o=s.y,c=s.z;return this.x=e*c-a*o,this.y=a*n-h*c,this.z=h*o-e*n,this},tangent:function(t){var s=t.x,h=t.y,e=t.z;return this.x=h*s-e*e,this.y=-e*h-s*s,this.z=s*e+h*h,this},invert:function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},addition:function(){return this.x+this.y+this.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return g.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},applyMatrix3:function(t,s){var h=this.x,e=this.y,a=this.z,n=t.elements;return s?(this.x=n[0]*h+n[1]*e+n[2]*a,this.y=n[3]*h+n[4]*e+n[5]*a,this.z=n[6]*h+n[7]*e+n[8]*a):(this.x=n[0]*h+n[3]*e+n[6]*a,this.y=n[1]*h+n[4]*e+n[7]*a,this.z=n[2]*h+n[5]*e+n[8]*a),this},applyQuaternion:function(t){var s=this.x,h=this.y,e=this.z,a=t.x,n=t.y,o=t.z,c=t.w,l=c*s+n*e-o*h,m=c*h+o*s-a*e,r=c*e+a*h-n*s,x=-a*s-n*h-o*e;return this.x=l*c+x*-a+m*-o-r*-n,this.y=m*c+x*-n+r*-a-l*-o,this.z=r*c+x*-o+l*-n-m*-a,this},testZero:function(){return this.x!==0||this.y!==0||this.z!==0},testDiff:function(t){return!this.equals(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},clone:function(){return new this.constructor(this.x,this.y,this.z)},toString:function(){return"Vec3["+this.x.toFixed(4)+", "+this.y.toFixed(4)+", "+this.z.toFixed(4)+"]"},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this},divideScalar:function(t){return this.multiplyScalar(1/t)},normalize:function(){return this.divideScalar(this.length())},toArray:function(t,s){s===void 0&&(s=0),t[s]=this.x,t[s+1]=this.y,t[s+2]=this.z},fromArray:function(t,s){return s===void 0&&(s=0),this.x=t[s],this.y=t[s+1],this.z=t[s+2],this}}),Object.assign(Ut.prototype,{Quat:!0,set:function(t,s,h,e){return this.x=t,this.y=s,this.z=h,this.w=e,this},addTime:function(t,s){var h=t.x,e=t.y,a=t.z,n=this.w,o=this.x,c=this.y,l=this.z;return s*=.5,this.x+=s*(h*n+e*l-a*c),this.y+=s*(e*n+a*o-h*l),this.z+=s*(a*n+h*c-e*o),this.w+=s*(-h*o-e*c-a*l),this.normalize(),this},multiply:function(t,s){return s!==void 0?this.multiplyQuaternions(t,s):this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,s){var h=t.x,e=t.y,a=t.z,n=t.w,o=s.x,c=s.y,l=s.z,m=s.w;return this.x=h*m+n*o+e*l-a*c,this.y=e*m+n*c+a*o-h*l,this.z=a*m+n*l+h*c-e*o,this.w=n*m-h*o-e*c-a*l,this},setFromUnitVectors:function(t,s){var h=new M,e=t.dot(s)+1;return e<g.EPS2?(e=0,g.abs(t.x)>g.abs(t.z)?h.set(-t.y,t.x,0):h.set(0,-t.z,t.y)):h.crossVectors(t,s),this._x=h.x,this._y=h.y,this._z=h.z,this._w=e,this.normalize()},arc:function(t,s){var h=t.x,e=t.y,a=t.z,n=s.x,o=s.y,c=s.z,l=h*n+e*o+a*c;if(l==-1)return n=e*h-a*a,o=-a*e-h*h,c=h*a+e*e,l=1/g.sqrt(n*n+o*o+c*c),this.w=0,this.x=n*l,this.y=o*l,this.z=c*l,this;var m=e*c-a*o,r=a*n-h*c,x=h*o-e*n;return this.w=g.sqrt(.5*(1+l)),l=.5/this.w,this.x=m*l,this.y=r*l,this.z=x*l,this},normalize:function(){var t=this.length();return t===0?this.set(0,0,0,1):(t=1/t,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t),this},inverse:function(){return this.conjugate().normalize()},invert:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},length:function(){return g.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},clone:function(t){return new Ut(this.x,this.y,this.z,this.w)},testDiff:function(t){return!this.equals(t)},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},toString:function(){return"Quat["+this.x.toFixed(4)+", ("+this.y.toFixed(4)+", "+this.z.toFixed(4)+", "+this.w.toFixed(4)+")]"},setFromEuler:function(t,s,h){var e=Math.cos(.5*t),a=Math.cos(.5*s),n=Math.cos(.5*h),o=Math.sin(.5*t),c=Math.sin(.5*s),l=Math.sin(.5*h);return this.x=o*a*n+e*c*l,this.y=e*c*n-o*a*l,this.z=e*a*l+o*c*n,this.w=e*a*n-o*c*l,this},setFromAxis:function(t,s){t.normalize(),s*=.5;var h=g.sin(s);return this.x=h*t.x,this.y=h*t.y,this.z=h*t.z,this.w=g.cos(s),this},setFromMat33:function(t){var s,h=t[0]+t[4]+t[8];if(h>0)s=g.sqrt(h+1),this.w=.5/s,s=.5/s,this.x=(t[5]-t[7])*s,this.y=(t[6]-t[2])*s,this.z=(t[1]-t[3])*s;else{var e=[],a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var n=(a+1)%3,o=(a+2)%3;s=g.sqrt(t[3*a+a]-t[3*n+n]-t[3*o+o]+1),e[a]=.5*fRoot,s=.5/fRoot,this.w=(t[3*n+o]-t[3*o+n])*s,e[n]=(t[3*n+a]+t[3*a+n])*s,e[o]=(t[3*o+a]+t[3*a+o])*s,this.x=e[1],this.y=e[2],this.z=e[3]}return this},toArray:function(t,s){t[s=s||0]=this.x,t[s+1]=this.y,t[s+2]=this.z,t[s+3]=this.w},fromArray:function(t,s){return s=s||0,this.set(t[s],t[s+1],t[s+2],t[s+3]),this}}),Object.assign(Bt.prototype,{Mat33:!0,set:function(t,s,h,e,a,n,o,c,l){var m=this.elements;return m[0]=t,m[1]=s,m[2]=h,m[3]=e,m[4]=a,m[5]=n,m[6]=o,m[7]=c,m[8]=l,this},add:function(t,s){if(s!==void 0)return this.addMatrixs(t,s);var h=this.elements,e=t.elements;return h[0]+=e[0],h[1]+=e[1],h[2]+=e[2],h[3]+=e[3],h[4]+=e[4],h[5]+=e[5],h[6]+=e[6],h[7]+=e[7],h[8]+=e[8],this},addMatrixs:function(t,s){var h=this.elements,e=t.elements,a=s.elements;return h[0]=e[0]+a[0],h[1]=e[1]+a[1],h[2]=e[2]+a[2],h[3]=e[3]+a[3],h[4]=e[4]+a[4],h[5]=e[5]+a[5],h[6]=e[6]+a[6],h[7]=e[7]+a[7],h[8]=e[8]+a[8],this},addEqual:function(t){var s=this.elements,h=t.elements;return s[0]+=h[0],s[1]+=h[1],s[2]+=h[2],s[3]+=h[3],s[4]+=h[4],s[5]+=h[5],s[6]+=h[6],s[7]+=h[7],s[8]+=h[8],this},sub:function(t,s){if(s!==void 0)return this.subMatrixs(t,s);var h=this.elements,e=t.elements;return h[0]-=e[0],h[1]-=e[1],h[2]-=e[2],h[3]-=e[3],h[4]-=e[4],h[5]-=e[5],h[6]-=e[6],h[7]-=e[7],h[8]-=e[8],this},subMatrixs:function(t,s){var h=this.elements,e=t.elements,a=s.elements;return h[0]=e[0]-a[0],h[1]=e[1]-a[1],h[2]=e[2]-a[2],h[3]=e[3]-a[3],h[4]=e[4]-a[4],h[5]=e[5]-a[5],h[6]=e[6]-a[6],h[7]=e[7]-a[7],h[8]=e[8]-a[8],this},subEqual:function(t){var s=this.elements,h=t.elements;return s[0]-=h[0],s[1]-=h[1],s[2]-=h[2],s[3]-=h[3],s[4]-=h[4],s[5]-=h[5],s[6]-=h[6],s[7]-=h[7],s[8]-=h[8],this},scale:function(t,s){var h=this.elements,e=t.elements;return h[0]=e[0]*s,h[1]=e[1]*s,h[2]=e[2]*s,h[3]=e[3]*s,h[4]=e[4]*s,h[5]=e[5]*s,h[6]=e[6]*s,h[7]=e[7]*s,h[8]=e[8]*s,this},scaleEqual:function(t){var s=this.elements;return s[0]*=t,s[1]*=t,s[2]*=t,s[3]*=t,s[4]*=t,s[5]*=t,s[6]*=t,s[7]*=t,s[8]*=t,this},multiplyMatrices:function(t,s,h){h&&(s=s.clone().transpose());var e=this.elements,a=t.elements,n=s.elements,o=a[0],c=a[3],l=a[6],m=a[1],r=a[4],x=a[7],p=a[2],u=a[5],y=a[8],v=n[0],w=n[3],C=n[6],b=n[1],j=n[4],T=n[7],B=n[2],R=n[5],O=n[8];return e[0]=o*v+m*w+p*C,e[1]=o*b+m*j+p*T,e[2]=o*B+m*R+p*O,e[3]=c*v+r*w+u*C,e[4]=c*b+r*j+u*T,e[5]=c*B+r*R+u*O,e[6]=l*v+x*w+y*C,e[7]=l*b+x*j+y*T,e[8]=l*B+x*R+y*O,this},transpose:function(t){if(t!==void 0){var s=t.elements;return this.set(s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]),this}var h=this.elements,e=h[1],a=h[2],n=h[5];return h[1]=h[3],h[2]=h[6],h[3]=e,h[5]=h[7],h[6]=a,h[7]=n,this},setQuat:function(t){var s=this.elements,h=t.x,e=t.y,a=t.z,n=t.w,o=h+h,c=e+e,l=a+a,m=h*o,r=h*c,x=h*l,p=e*c,u=e*l,y=a*l,v=n*o,w=n*c,C=n*l;return s[0]=1-(p+y),s[1]=r-C,s[2]=x+w,s[3]=r+C,s[4]=1-(m+y),s[5]=u-v,s[6]=x-w,s[7]=u+v,s[8]=1-(m+p),this},invert:function(t){var s=this.elements,h=t.elements,e=h[0],a=h[3],n=h[6],o=h[1],c=h[4],l=h[7],m=h[2],r=h[5],x=h[8],p=x*c-r*l,u=-x*a+r*n,y=l*a-c*n,v=e*p+o*u+m*y;return v===0?(console.log("can't invert matrix, determinant is 0"),this.identity()):(v=1/v,s[0]=p*v,s[1]=(-x*o+m*l)*v,s[2]=(r*o-m*c)*v,s[3]=u*v,s[4]=(x*e-m*n)*v,s[5]=(-r*e+m*a)*v,s[6]=y*v,s[7]=(-l*e+o*n)*v,s[8]=(c*e-o*a)*v,this)},addOffset:function(t,s){var h=s.x,e=s.y,a=s.z,n=this.elements;n[0]+=t*(e*e+a*a),n[4]+=t*(h*h+a*a),n[8]+=t*(h*h+e*e);var o=t*h*e,c=t*e*a,l=t*a*h;return n[1]-=o,n[3]-=o,n[2]-=c,n[6]-=c,n[5]-=l,n[7]-=l,this},subOffset:function(t,s){var h=s.x,e=s.y,a=s.z,n=this.elements;n[0]-=t*(e*e+a*a),n[4]-=t*(h*h+a*a),n[8]-=t*(h*h+e*e);var o=t*h*e,c=t*e*a,l=t*a*h;return n[1]+=o,n[3]+=o,n[2]+=c,n[6]+=c,n[5]+=l,n[7]+=l,this},multiplyScalar:function(t){var s=this.elements;return s[0]*=t,s[3]*=t,s[6]*=t,s[1]*=t,s[4]*=t,s[7]*=t,s[2]*=t,s[5]*=t,s[8]*=t,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new Bt().fromArray(this.elements)},copy:function(t){for(var s=0;s<9;s++)this.elements[s]=t.elements[s];return this},determinant:function(){var t=this.elements,s=t[0],h=t[1],e=t[2],a=t[3],n=t[4],o=t[5],c=t[6],l=t[7],m=t[8];return s*n*m-s*o*l-h*a*m+h*o*c+e*a*l-e*n*c},fromArray:function(t,s){s===void 0&&(s=0);for(var h=0;h<9;h++)this.elements[h]=t[h+s];return this},toArray:function(t,s){t===void 0&&(t=[]),s===void 0&&(s=0);var h=this.elements;return t[s]=h[0],t[s+1]=h[1],t[s+2]=h[2],t[s+3]=h[3],t[s+4]=h[4],t[s+5]=h[5],t[s+6]=h[6],t[s+7]=h[7],t[s+8]=h[8],t}}),Object.assign(Ks.prototype,{AABB:!0,set:function(t,s,h,e,a,n){var o=this.elements;return o[0]=t,o[3]=s,o[1]=h,o[4]=e,o[2]=a,o[5]=n,this},intersectTest:function(t){var s=this.elements,h=t.elements;return s[0]>h[3]||s[1]>h[4]||s[2]>h[5]||s[3]<h[0]||s[4]<h[1]||s[5]<h[2]},intersectTestTwo:function(t){var s=this.elements,h=t.elements;return s[0]<h[0]||s[1]<h[1]||s[2]<h[2]||s[3]>h[3]||s[4]>h[4]||s[5]>h[5]},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(t,s){var h=s||0,e=t.elements;return this.set(e[0]-h,e[3]+h,e[1]-h,e[4]+h,e[2]-h,e[5]+h),this},fromArray:function(t){return this.elements.set(t),this},combine:function(t,s){var h=t.elements,e=s.elements,a=this.elements;return a[0]=h[0]<e[0]?h[0]:e[0],a[1]=h[1]<e[1]?h[1]:e[1],a[2]=h[2]<e[2]?h[2]:e[2],a[3]=h[3]>e[3]?h[3]:e[3],a[4]=h[4]>e[4]?h[4]:e[4],a[5]=h[5]>e[5]?h[5]:e[5],this},surfaceArea:function(){var t=this.elements,s=t[3]-t[0],h=t[4]-t[1],e=t[5]-t[2];return 2*(s*(h+e)+h*e)},intersectsWithPoint:function(t,s,h){var e=this.elements;return t>=e[0]&&t<=e[3]&&s>=e[1]&&s<=e[4]&&h>=e[2]&&h<=e[5]},setFromPoints:function(t){this.makeEmpty();for(var s=0;s<t.length;s++)this.expandByPoint(t[s])},makeEmpty:function(){this.set(-1/0,-1/0,-1/0,1/0,1/0,1/0)},expandByPoint:function(t){var s=this.elements;this.set(g.min(s[0],t.x),g.min(s[1],t.y),g.min(s[2],t.z),g.max(s[3],t.x),g.max(s[4],t.y),g.max(s[5],t.z))},expandByScalar:function(t){var s=this.elements;s[0]+=-t,s[1]+=-t,s[2]+=-t,s[3]+=t,s[4]+=t,s[5]+=t}});var xe=0;function fs(t){this.type=Rh,this.id=xe++,this.prev=null,this.next=null,this.proxy=null,this.parent=null,this.contactLink=null,this.numContacts=0,this.position=new M,this.rotation=new Bt,this.relativePosition=new M().copy(t.relativePosition),this.relativeRotation=new Bt().copy(t.relativeRotation),this.aabb=new Ks,this.density=t.density,this.friction=t.friction,this.restitution=t.restitution,this.belongsTo=t.belongsTo,this.collidesWith=t.collidesWith}function Zs(t,s,h,e){fs.call(this,t),this.type=vs,this.width=s,this.height=h,this.depth=e,this.halfWidth=.5*s,this.halfHeight=.5*h,this.halfDepth=.5*e,this.dimentions=new Float32Array(18),this.elements=new Float32Array(24)}function Xs(t,s){fs.call(this,t),this.type=bs,this.radius=s}function $s(t,s,h){fs.call(this,t),this.type=Cs,this.radius=s,this.height=h,this.halfHeight=.5*h,this.normalDirection=new M,this.halfDirection=new M}function Gs(t,s){fs.call(this,t),this.type=Rs,this.normal=new M(0,1,0)}function fh(t,s){fs.call(this,t),this.type=Uh}function Zh(){this.relativePosition=new M,this.relativeRotation=new Bt,this.friction=.2,this.restitution=.2,this.density=1,this.belongsTo=1,this.collidesWith=4294967295}function Ct(t,s){s=s||!1,this.axis=t,this.angle=0,this.lowerLimit=s?0:1,this.upperLimit=0,this.motorSpeed=0,this.maxMotorForce=0,this.frequency=0,this.dampingRatio=0}function Js(){this.parent=null,this.body1=null,this.body2=null,this.addedToIsland=!1}function Xh(t){this.prev=null,this.next=null,this.body=null,this.joint=t}function rs(t){Js.call(this),this.scale=1,this.invScale=1,this.name="",this.id=NaN,this.type=_h,this.prev=null,this.next=null,this.body1=t.body1,this.body2=t.body2,this.localAnchorPoint1=new M().copy(t.localAnchorPoint1),this.localAnchorPoint2=new M().copy(t.localAnchorPoint2),this.relativeAnchorPoint1=new M,this.relativeAnchorPoint2=new M,this.anchorPoint1=new M,this.anchorPoint2=new M,this.allowCollision=t.allowCollision,this.b1Link=new Xh(this),this.b2Link=new Xh(this)}function bh(t){this.m1=NaN,this.m2=NaN,this.ii1=null,this.ii2=null,this.dd=null,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.ax1x=NaN,this.ax1y=NaN,this.ax1z=NaN,this.ay1x=NaN,this.ay1y=NaN,this.ay1z=NaN,this.az1x=NaN,this.az1y=NaN,this.az1z=NaN,this.ax2x=NaN,this.ax2y=NaN,this.ax2z=NaN,this.ay2x=NaN,this.ay2y=NaN,this.ay2z=NaN,this.az2x=NaN,this.az2y=NaN,this.az2z=NaN,this.vel=NaN,this.velx=NaN,this.vely=NaN,this.velz=NaN,this.joint=t,this.r1=t.relativeAnchorPoint1,this.r2=t.relativeAnchorPoint2,this.p1=t.anchorPoint1,this.p2=t.anchorPoint2,this.b1=t.body1,this.b2=t.body2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.impx=0,this.impy=0,this.impz=0}function Qs(t,s,h,e){this.cfm1=NaN,this.cfm2=NaN,this.cfm3=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.ax1=NaN,this.ay1=NaN,this.az1=NaN,this.ax2=NaN,this.ay2=NaN,this.az2=NaN,this.ax3=NaN,this.ay3=NaN,this.az3=NaN,this.a1x1=NaN,this.a1y1=NaN,this.a1z1=NaN,this.a2x1=NaN,this.a2y1=NaN,this.a2z1=NaN,this.a1x2=NaN,this.a1y2=NaN,this.a1z2=NaN,this.a2x2=NaN,this.a2y2=NaN,this.a2z2=NaN,this.a1x3=NaN,this.a1y3=NaN,this.a1z3=NaN,this.a2x3=NaN,this.a2y3=NaN,this.a2z3=NaN,this.lowerLimit1=NaN,this.upperLimit1=NaN,this.limitVelocity1=NaN,this.limitState1=0,this.enableMotor1=!1,this.motorSpeed1=NaN,this.maxMotorForce1=NaN,this.maxMotorImpulse1=NaN,this.lowerLimit2=NaN,this.upperLimit2=NaN,this.limitVelocity2=NaN,this.limitState2=0,this.enableMotor2=!1,this.motorSpeed2=NaN,this.maxMotorForce2=NaN,this.maxMotorImpulse2=NaN,this.lowerLimit3=NaN,this.upperLimit3=NaN,this.limitVelocity3=NaN,this.limitState3=0,this.enableMotor3=!1,this.motorSpeed3=NaN,this.maxMotorForce3=NaN,this.maxMotorImpulse3=NaN,this.k00=NaN,this.k01=NaN,this.k02=NaN,this.k10=NaN,this.k11=NaN,this.k12=NaN,this.k20=NaN,this.k21=NaN,this.k22=NaN,this.kv00=NaN,this.kv11=NaN,this.kv22=NaN,this.dv00=NaN,this.dv11=NaN,this.dv22=NaN,this.d00=NaN,this.d01=NaN,this.d02=NaN,this.d10=NaN,this.d11=NaN,this.d12=NaN,this.d20=NaN,this.d21=NaN,this.d22=NaN,this.limitMotor1=s,this.limitMotor2=h,this.limitMotor3=e,this.b1=t.body1,this.b2=t.body2,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse1=0,this.motorImpulse1=0,this.limitImpulse2=0,this.motorImpulse2=0,this.limitImpulse3=0,this.motorImpulse3=0}function ih(t,s,h){rs.call(this,t),this.type=Wh,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize();var e=new Bt().setQuat(new Ut().setFromUnitVectors(this.localAxis1,this.localAxis2));this.localAngle1=new M().tangent(this.localAxis1).normalize(),this.localAngle2=this.localAngle1.clone().applyMatrix3(e,!0),this.ax1=new M,this.ax2=new M,this.an1=new M,this.an2=new M,this.tmp=new M,this.nor=new M,this.tan=new M,this.bin=new M,this.limitMotor=new Ct(this.nor,!1),this.limitMotor.lowerLimit=s,this.limitMotor.upperLimit=h,this.lc=new bh(this),this.r3=new Qs(this,this.limitMotor,new Ct(this.tan,!0),new Ct(this.bin,!0))}function th(t){rs.call(this,t),this.type=Jh,this.lc=new bh(this)}function $h(t,s){this.cfm=NaN,this.m1=NaN,this.m2=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.motorDenom=NaN,this.invMotorDenom=NaN,this.invDenom=NaN,this.ax=NaN,this.ay=NaN,this.az=NaN,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.t1x=NaN,this.t1y=NaN,this.t1z=NaN,this.t2x=NaN,this.t2y=NaN,this.t2z=NaN,this.l1x=NaN,this.l1y=NaN,this.l1z=NaN,this.l2x=NaN,this.l2y=NaN,this.l2z=NaN,this.a1x=NaN,this.a1y=NaN,this.a1z=NaN,this.a2x=NaN,this.a2y=NaN,this.a2z=NaN,this.lowerLimit=NaN,this.upperLimit=NaN,this.limitVelocity=NaN,this.limitState=0,this.enableMotor=!1,this.motorSpeed=NaN,this.maxMotorForce=NaN,this.maxMotorImpulse=NaN,this.limitMotor=s,this.b1=t.body1,this.b2=t.body2,this.p1=t.anchorPoint1,this.p2=t.anchorPoint2,this.r1=t.relativeAnchorPoint1,this.r2=t.relativeAnchorPoint2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse=0,this.motorImpulse=0}function sh(t,s,h){rs.call(this,t),this.type=qh,this.nor=new M,this.limitMotor=new Ct(this.nor,!0),this.limitMotor.lowerLimit=s,this.limitMotor.upperLimit=h,this.t=new $h(this,this.limitMotor)}function Gh(t,s){this.joint=t,this.targetOrientation=new Ut().invert(s),this.relativeOrientation=new Ut,this.ii1=null,this.ii2=null,this.dd=null,this.vel=new M,this.imp=new M,this.rn0=new M,this.rn1=new M,this.rn2=new M,this.b1=t.body1,this.b2=t.body2,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia}function hh(t,s,h,e){this.m1=NaN,this.m2=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.ax1=NaN,this.ay1=NaN,this.az1=NaN,this.ax2=NaN,this.ay2=NaN,this.az2=NaN,this.ax3=NaN,this.ay3=NaN,this.az3=NaN,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.t1x1=NaN,this.t1y1=NaN,this.t1z1=NaN,this.t2x1=NaN,this.t2y1=NaN,this.t2z1=NaN,this.l1x1=NaN,this.l1y1=NaN,this.l1z1=NaN,this.l2x1=NaN,this.l2y1=NaN,this.l2z1=NaN,this.a1x1=NaN,this.a1y1=NaN,this.a1z1=NaN,this.a2x1=NaN,this.a2y1=NaN,this.a2z1=NaN,this.t1x2=NaN,this.t1y2=NaN,this.t1z2=NaN,this.t2x2=NaN,this.t2y2=NaN,this.t2z2=NaN,this.l1x2=NaN,this.l1y2=NaN,this.l1z2=NaN,this.l2x2=NaN,this.l2y2=NaN,this.l2z2=NaN,this.a1x2=NaN,this.a1y2=NaN,this.a1z2=NaN,this.a2x2=NaN,this.a2y2=NaN,this.a2z2=NaN,this.t1x3=NaN,this.t1y3=NaN,this.t1z3=NaN,this.t2x3=NaN,this.t2y3=NaN,this.t2z3=NaN,this.l1x3=NaN,this.l1y3=NaN,this.l1z3=NaN,this.l2x3=NaN,this.l2y3=NaN,this.l2z3=NaN,this.a1x3=NaN,this.a1y3=NaN,this.a1z3=NaN,this.a2x3=NaN,this.a2y3=NaN,this.a2z3=NaN,this.lowerLimit1=NaN,this.upperLimit1=NaN,this.limitVelocity1=NaN,this.limitState1=0,this.enableMotor1=!1,this.motorSpeed1=NaN,this.maxMotorForce1=NaN,this.maxMotorImpulse1=NaN,this.lowerLimit2=NaN,this.upperLimit2=NaN,this.limitVelocity2=NaN,this.limitState2=0,this.enableMotor2=!1,this.motorSpeed2=NaN,this.maxMotorForce2=NaN,this.maxMotorImpulse2=NaN,this.lowerLimit3=NaN,this.upperLimit3=NaN,this.limitVelocity3=NaN,this.limitState3=0,this.enableMotor3=!1,this.motorSpeed3=NaN,this.maxMotorForce3=NaN,this.maxMotorImpulse3=NaN,this.k00=NaN,this.k01=NaN,this.k02=NaN,this.k10=NaN,this.k11=NaN,this.k12=NaN,this.k20=NaN,this.k21=NaN,this.k22=NaN,this.kv00=NaN,this.kv11=NaN,this.kv22=NaN,this.dv00=NaN,this.dv11=NaN,this.dv22=NaN,this.d00=NaN,this.d01=NaN,this.d02=NaN,this.d10=NaN,this.d11=NaN,this.d12=NaN,this.d20=NaN,this.d21=NaN,this.d22=NaN,this.limitMotor1=s,this.limitMotor2=h,this.limitMotor3=e,this.b1=t.body1,this.b2=t.body2,this.p1=t.anchorPoint1,this.p2=t.anchorPoint2,this.r1=t.relativeAnchorPoint1,this.r2=t.relativeAnchorPoint2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse1=0,this.motorImpulse1=0,this.limitImpulse2=0,this.motorImpulse2=0,this.limitImpulse3=0,this.motorImpulse3=0,this.cfm1=0,this.cfm2=0,this.cfm3=0,this.weight=-1}function eh(t,s,h){rs.call(this,t),this.type=Kh,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize(),this.ax1=new M,this.ax2=new M,this.nor=new M,this.tan=new M,this.bin=new M,this.ac=new Gh(this,new Ut().setFromUnitVectors(this.localAxis1,this.localAxis2)),this.limitMotor=new Ct(this.nor,!0),this.limitMotor.lowerLimit=s,this.limitMotor.upperLimit=h,this.t3=new hh(this,this.limitMotor,new Ct(this.tan,!0),new Ct(this.bin,!0))}function ah(t,s,h){rs.call(this,t),this.type=Hh,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize();var e=new Bt().setQuat(new Ut().setFromUnitVectors(this.localAxis1,this.localAxis2));this.localAngle1=new M().tangent(this.localAxis1).normalize(),this.localAngle2=this.localAngle1.clone().applyMatrix3(e,!0),this.ax1=new M,this.ax2=new M,this.an1=new M,this.an2=new M,this.tmp=new M,this.nor=new M,this.tan=new M,this.bin=new M,this.rotationalLimitMotor=new Ct(this.nor,!1),this.r3=new Qs(this,this.rotationalLimitMotor,new Ct(this.tan,!0),new Ct(this.bin,!0)),this.translationalLimitMotor=new Ct(this.nor,!0),this.translationalLimitMotor.lowerLimit=s,this.translationalLimitMotor.upperLimit=h,this.t3=new hh(this,this.translationalLimitMotor,new Ct(this.tan,!0),new Ct(this.bin,!0))}function nh(t){rs.call(this,t),this.type=Yh,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize(),this.localAngle1=new M,this.localAngle2=new M;var s=g.dotVectors(this.localAxis1,this.localAxis2);if(s>-1&&s<1)this.localAngle1.set(this.localAxis2.x-s*this.localAxis1.x,this.localAxis2.y-s*this.localAxis1.y,this.localAxis2.z-s*this.localAxis1.z).normalize(),this.localAngle2.set(this.localAxis1.x-s*this.localAxis2.x,this.localAxis1.y-s*this.localAxis2.y,this.localAxis1.z-s*this.localAxis2.z).normalize();else{var h=new Bt().setQuat(new Ut().setFromUnitVectors(this.localAxis1,this.localAxis2));this.localAngle1.tangent(this.localAxis1).normalize(),this.localAngle2=this.localAngle1.clone().applyMatrix3(h,!0)}this.ax1=new M,this.ax2=new M,this.an1=new M,this.an2=new M,this.tmp=new M,this.nor=new M,this.tan=new M,this.bin=new M,this.translationalLimitMotor=new Ct(this.tan,!0),this.translationalLimitMotor.frequency=8,this.translationalLimitMotor.dampingRatio=1,this.rotationalLimitMotor1=new Ct(this.tan,!1),this.rotationalLimitMotor2=new Ct(this.bin,!1),this.t3=new hh(this,new Ct(this.nor,!0),this.translationalLimitMotor,new Ct(this.bin,!0)),this.t3.weight=1,this.r3=new Qs(this,new Ct(this.nor,!0),this.rotationalLimitMotor1,this.rotationalLimitMotor2)}function Qh(){this.scale=1,this.invScale=1,this.body1=null,this.body2=null,this.localAnchorPoint1=new M,this.localAnchorPoint2=new M,this.localAxis1=new M,this.localAxis2=new M,this.allowCollision=!1}function fe(){this.mass=0,this.inertia=new Bt}function oh(t){this.prev=null,this.next=null,this.shape=null,this.body=null,this.contact=t}function rh(){this.lp1X=NaN,this.lp1Y=NaN,this.lp1Z=NaN,this.lp2X=NaN,this.lp2Y=NaN,this.lp2Z=NaN,this.impulse=NaN}function lh(){this.warmStarted=!1,this.position=new M,this.localPoint1=new M,this.localPoint2=new M,this.normal=new M,this.tangent=new M,this.binormal=new M,this.normalImpulse=0,this.tangentImpulse=0,this.binormalImpulse=0,this.normalDenominator=0,this.tangentDenominator=0,this.binormalDenominator=0,this.penetration=0}function vh(){this.body1=null,this.body2=null,this.numPoints=0,this.points=[new lh,new lh,new lh,new lh]}function mh(){this.nor=new M,this.tan=new M,this.bin=new M,this.norU1=new M,this.tanU1=new M,this.binU1=new M,this.norU2=new M,this.tanU2=new M,this.binU2=new M,this.norT1=new M,this.tanT1=new M,this.binT1=new M,this.norT2=new M,this.tanT2=new M,this.binT2=new M,this.norTU1=new M,this.tanTU1=new M,this.binTU1=new M,this.norTU2=new M,this.tanTU2=new M,this.binTU2=new M,this.norImp=0,this.tanImp=0,this.binImp=0,this.norDen=0,this.tanDen=0,this.binDen=0,this.norTar=0,this.next=null,this.last=!1}function zh(t){Js.call(this),this.manifold=t,this.restitution=NaN,this.friction=NaN,this.p1=null,this.p2=null,this.lv1=null,this.lv2=null,this.av1=null,this.av2=null,this.i1=null,this.i2=null,this.tmp=new M,this.tmpC1=new M,this.tmpC2=new M,this.tmpP1=new M,this.tmpP2=new M,this.tmplv1=new M,this.tmplv2=new M,this.tmpav1=new M,this.tmpav2=new M,this.m1=NaN,this.m2=NaN,this.num=0,this.ps=t.points,this.cs=new mh,this.cs.next=new mh,this.cs.next.next=new mh,this.cs.next.next.next=new mh}function ie(){this.shape1=null,this.shape2=null,this.body1=null,this.body2=null,this.prev=null,this.next=null,this.persisting=!1,this.sleeping=!1,this.detector=null,this.constraint=null,this.touching=!1,this.close=!1,this.dist=g.INF,this.b1Link=new oh(this),this.b2Link=new oh(this),this.s1Link=new oh(this),this.s2Link=new oh(this),this.manifold=new vh,this.buffer=[new rh,new rh,new rh,new rh],this.points=this.manifold.points,this.constraint=new zh(this.manifold)}function Ds(t,s){this.position=t||new M,this.orientation=s||new Ut,this.scale=1,this.invScale=1,this.mesh=null,this.id=NaN,this.name="",this.prev=null,this.next=null,this.type=Bh,this.massInfo=new fe,this.newPosition=new M,this.controlPos=!1,this.newOrientation=new Ut,this.newRotation=new M,this.currentRotation=new M,this.controlRot=!1,this.controlRotInTime=!1,this.quaternion=new Ut,this.pos=new M,this.linearVelocity=new M,this.angularVelocity=new M,this.parent=null,this.contactLink=null,this.numContacts=0,this.shapes=null,this.numShapes=0,this.jointLink=null,this.numJoints=0,this.sleepPosition=new M,this.sleepOrientation=new Ut,this.isStatic=!1,this.isDynamic=!1,this.isKinematic=!1,this.rotation=new Bt,this.mass=0,this.inverseMass=0,this.inverseInertia=new Bt,this.localInertia=new Bt,this.inverseLocalInertia=new Bt,this.tmpInertia=new Bt,this.addedToIsland=!1,this.allowSleep=!0,this.sleepTime=0,this.sleeping=!1}function be(t,s){this.shape1=t||null,this.shape2=s||null}function Es(){this.types=Ah,this.numPairChecks=0,this.numPairs=0,this.pairs=[]}Object.assign(fs.prototype,{Shape:!0,calculateMassInfo:function(t){Rt("Shape","Inheritance error.")},updateProxy:function(){Rt("Shape","Inheritance error.")}}),Zs.prototype=Object.assign(Object.create(fs.prototype),{constructor:Zs,calculateMassInfo:function(t){var s=this.width*this.height*this.depth*this.density;t.mass=s,t.inertia.set(s*(this.height*this.height+this.depth*this.depth)*(1/12),0,0,0,s*(this.width*this.width+this.depth*this.depth)*(1/12),0,0,0,s*(this.width*this.width+this.height*this.height)*(1/12))},updateProxy:function(){var t=this.rotation.elements,s=this.dimentions;s[0]=t[0],s[1]=t[3],s[2]=t[6],s[3]=t[1],s[4]=t[4],s[5]=t[7],s[6]=t[2],s[7]=t[5],s[8]=t[8],s[9]=t[0]*this.halfWidth,s[10]=t[3]*this.halfWidth,s[11]=t[6]*this.halfWidth,s[12]=t[1]*this.halfHeight,s[13]=t[4]*this.halfHeight,s[14]=t[7]*this.halfHeight,s[15]=t[2]*this.halfDepth,s[16]=t[5]*this.halfDepth,s[17]=t[8]*this.halfDepth;var h=s[9],e=s[10],a=s[11],n=s[12],o=s[13],c=s[14],l=s[15],m=s[16],r=s[17],x=this.position.x,p=this.position.y,u=this.position.z,y=this.elements;y[0]=x+h+n+l,y[1]=p+e+o+m,y[2]=u+a+c+r,y[3]=x+h+n-l,y[4]=p+e+o-m,y[5]=u+a+c-r,y[6]=x+h-n+l,y[7]=p+e-o+m,y[8]=u+a-c+r,y[9]=x+h-n-l,y[10]=p+e-o-m,y[11]=u+a-c-r,y[12]=x-h+n+l,y[13]=p-e+o+m,y[14]=u-a+c+r,y[15]=x-h+n-l,y[16]=p-e+o-m,y[17]=u-a+c-r,y[18]=x-h-n+l,y[19]=p-e-o+m,y[20]=u-a-c+r,y[21]=x-h-n-l,y[22]=p-e-o-m,y[23]=u-a-c-r;var v=s[9]<0?-s[9]:s[9],w=s[10]<0?-s[10]:s[10],C=s[11]<0?-s[11]:s[11];v=s[12]<0?v-s[12]:v+s[12],w=s[13]<0?w-s[13]:w+s[13],C=s[14]<0?C-s[14]:C+s[14],v=s[15]<0?v-s[15]:v+s[15],w=s[16]<0?w-s[16]:w+s[16],C=s[17]<0?C-s[17]:C+s[17];var b=.005;this.aabb.set(this.position.x-v-b,this.position.x+v+b,this.position.y-w-b,this.position.y+w+b,this.position.z-C-b,this.position.z+C+b),this.proxy!=null&&this.proxy.update()}}),Xs.prototype=Object.assign(Object.create(fs.prototype),{constructor:Xs,volume:function(){return g.PI*this.radius*1.333333},calculateMassInfo:function(t){var s=this.volume()*this.radius*this.radius*this.density;t.mass=s;var h=s*this.radius*this.radius*.4;t.inertia.set(h,0,0,0,h,0,0,0,h)},updateProxy:function(){var t=.005;this.aabb.set(this.position.x-this.radius-t,this.position.x+this.radius+t,this.position.y-this.radius-t,this.position.y+this.radius+t,this.position.z-this.radius-t,this.position.z+this.radius+t),this.proxy!=null&&this.proxy.update()}}),$s.prototype=Object.assign(Object.create(fs.prototype),{constructor:$s,calculateMassInfo:function(t){var s=this.radius*this.radius,h=g.PI*s*this.height*this.density,e=(.25*s+.0833*this.height*this.height)*h,a=.5*s;t.mass=h,t.inertia.set(e,0,0,0,a,0,0,0,e)},updateProxy:function(){var t,s,h,e,a,n,o,c,l,m,r,x=this.rotation.elements;a=x[1]*x[1],n=x[4]*x[4],o=x[7]*x[7],this.normalDirection.set(x[1],x[4],x[7]),this.halfDirection.scale(this.normalDirection,this.halfHeight),s=1-a,(t=g.sqrt(s*s+a*n+a*o))>0&&(t=this.radius/t),s*=t,h=1-n,(t=g.sqrt(n*a+h*h+n*o))>0&&(t=this.radius/t),h*=t,e=1-o,(t=g.sqrt(o*a+o*n+e*e))>0&&(t=this.radius/t),e*=t,c=this.halfDirection.x<0?-this.halfDirection.x:this.halfDirection.x,l=this.halfDirection.y<0?-this.halfDirection.y:this.halfDirection.y,m=this.halfDirection.z<0?-this.halfDirection.z:this.halfDirection.z,c=s<0?c-s:c+s,l=h<0?l-h:l+h,m=e<0?m-e:m+e,r=.005,this.aabb.set(this.position.x-c-r,this.position.x+c+r,this.position.y-l-r,this.position.y+l+r,this.position.z-m-r,this.position.z+m+r),this.proxy!=null&&this.proxy.update()}}),Gs.prototype=Object.assign(Object.create(fs.prototype),{constructor:Gs,volume:function(){return Number.MAX_VALUE},calculateMassInfo:function(t){t.mass=this.density,t.inertia.set(1,0,0,0,1,0,0,0,1)},updateProxy:function(){var t=.005,s=-g.INF,h=g.INF,e=this.normal;this.aabb.set(e.x===-1?this.position.x-t:s,e.x===1?this.position.x+t:h,e.y===-1?this.position.y-t:s,e.y===1?this.position.y+t:h,e.z===-1?this.position.z-t:s,e.z===1?this.position.z+t:h),this.proxy!=null&&this.proxy.update()}}),fh.prototype=Object.assign(Object.create(fs.prototype),{constructor:fh,volume:function(){return Number.MAX_VALUE},calculateMassInfo:function(t){t.inertia.set(0,0,0,0,0,0,0,0,0)},updateProxy:function(){this.aabb.set(this.position.x-0,this.position.x+0,this.position.y-0,this.position.y+0,this.position.z-0,this.position.z+0),this.proxy!=null&&this.proxy.update()}}),Object.assign(Ct.prototype,{LimitMotor:!0,setLimit:function(t,s){this.lowerLimit=t,this.upperLimit=s},setMotor:function(t,s){this.motorSpeed=t,this.maxMotorForce=s},setSpring:function(t,s){this.frequency=t,this.dampingRatio=s}}),Object.assign(Js.prototype,{Constraint:!0,preSolve:function(t,s){Rt("Constraint","Inheritance error.")},solve:function(){Rt("Constraint","Inheritance error.")},postSolve:function(){Rt("Constraint","Inheritance error.")}}),rs.prototype=Object.assign(Object.create(Js.prototype),{constructor:rs,setId:function(t){this.id=i},setParent:function(t){this.parent=t,this.scale=this.parent.scale,this.invScale=this.parent.invScale,this.id=this.parent.numJoints,this.name||(this.name="J"+this.id)},updateAnchorPoints:function(){this.relativeAnchorPoint1.copy(this.localAnchorPoint1).applyMatrix3(this.body1.rotation,!0),this.relativeAnchorPoint2.copy(this.localAnchorPoint2).applyMatrix3(this.body2.rotation,!0),this.anchorPoint1.add(this.relativeAnchorPoint1,this.body1.position),this.anchorPoint2.add(this.relativeAnchorPoint2,this.body2.position)},attach:function(t){this.b1Link.body=this.body2,this.b2Link.body=this.body1,t?(this.body1.jointLink.push(this.b1Link),this.body2.jointLink.push(this.b2Link)):(this.body1.jointLink!=null?(this.b1Link.next=this.body1.jointLink).prev=this.b1Link:this.b1Link.next=null,this.body1.jointLink=this.b1Link,this.body1.numJoints++,this.body2.jointLink!=null?(this.b2Link.next=this.body2.jointLink).prev=this.b2Link:this.b2Link.next=null,this.body2.jointLink=this.b2Link,this.body2.numJoints++)},detach:function(t){if(t)this.body1.jointLink.splice(this.body1.jointLink.indexOf(this.b1Link),1),this.body2.jointLink.splice(this.body2.jointLink.indexOf(this.b2Link),1);else{var s=this.b1Link.prev,h=this.b1Link.next;s!=null&&(s.next=h),h!=null&&(h.prev=s),this.body1.jointLink==this.b1Link&&(this.body1.jointLink=h),this.b1Link.prev=null,this.b1Link.next=null,this.b1Link.body=null,this.body1.numJoints--,s=this.b2Link.prev,h=this.b2Link.next,s!=null&&(s.next=h),h!=null&&(h.prev=s),this.body2.jointLink==this.b2Link&&(this.body2.jointLink=h),this.b2Link.prev=null,this.b2Link.next=null,this.b2Link.body=null,this.body2.numJoints--}this.b1Link.body=null,this.b2Link.body=null},awake:function(){this.body1.awake(),this.body2.awake()},preSolve:function(t,s){},solve:function(){},postSolve:function(){},remove:function(){this.dispose()},dispose:function(){this.parent.removeJoint(this)},getPosition:function(){return[new M().scale(this.anchorPoint1,this.scale),new M().scale(this.anchorPoint2,this.scale)]}}),Object.assign(bh.prototype,{LinearConstraint:!0,preSolve:function(t,s){this.r1x=this.r1.x,this.r1y=this.r1.y,this.r1z=this.r1.z,this.r2x=this.r2.x,this.r2y=this.r2.y,this.r2z=this.r2.z,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass,this.ii1=this.i1.clone(),this.ii2=this.i2.clone();var h=this.ii1.elements,e=this.ii2.elements;this.ax1x=this.r1z*h[1]+-this.r1y*h[2],this.ax1y=this.r1z*h[4]+-this.r1y*h[5],this.ax1z=this.r1z*h[7]+-this.r1y*h[8],this.ay1x=-this.r1z*h[0]+this.r1x*h[2],this.ay1y=-this.r1z*h[3]+this.r1x*h[5],this.ay1z=-this.r1z*h[6]+this.r1x*h[8],this.az1x=this.r1y*h[0]+-this.r1x*h[1],this.az1y=this.r1y*h[3]+-this.r1x*h[4],this.az1z=this.r1y*h[6]+-this.r1x*h[7],this.ax2x=this.r2z*e[1]+-this.r2y*e[2],this.ax2y=this.r2z*e[4]+-this.r2y*e[5],this.ax2z=this.r2z*e[7]+-this.r2y*e[8],this.ay2x=-this.r2z*e[0]+this.r2x*e[2],this.ay2y=-this.r2z*e[3]+this.r2x*e[5],this.ay2z=-this.r2z*e[6]+this.r2x*e[8],this.az2x=this.r2y*e[0]+-this.r2x*e[1],this.az2y=this.r2y*e[3]+-this.r2x*e[4],this.az2z=this.r2y*e[6]+-this.r2x*e[7];var a=this.m1+this.m2,n=new Bt().set(a,0,0,0,a,0,0,0,a).elements;n[0]+=h[4]*this.r1z*this.r1z-(h[7]+h[5])*this.r1y*this.r1z+h[8]*this.r1y*this.r1y,n[1]+=(h[6]*this.r1y+h[5]*this.r1x)*this.r1z-h[3]*this.r1z*this.r1z-h[8]*this.r1x*this.r1y,n[2]+=(h[3]*this.r1y-h[4]*this.r1x)*this.r1z-h[6]*this.r1y*this.r1y+h[7]*this.r1x*this.r1y,n[3]+=(h[2]*this.r1y+h[7]*this.r1x)*this.r1z-h[1]*this.r1z*this.r1z-h[8]*this.r1x*this.r1y,n[4]+=h[0]*this.r1z*this.r1z-(h[6]+h[2])*this.r1x*this.r1z+h[8]*this.r1x*this.r1x,n[5]+=(h[1]*this.r1x-h[0]*this.r1y)*this.r1z-h[7]*this.r1x*this.r1x+h[6]*this.r1x*this.r1y,n[6]+=(h[1]*this.r1y-h[4]*this.r1x)*this.r1z-h[2]*this.r1y*this.r1y+h[5]*this.r1x*this.r1y,n[7]+=(h[3]*this.r1x-h[0]*this.r1y)*this.r1z-h[5]*this.r1x*this.r1x+h[2]*this.r1x*this.r1y,n[8]+=h[0]*this.r1y*this.r1y-(h[3]+h[1])*this.r1x*this.r1y+h[4]*this.r1x*this.r1x,n[0]+=e[4]*this.r2z*this.r2z-(e[7]+e[5])*this.r2y*this.r2z+e[8]*this.r2y*this.r2y,n[1]+=(e[6]*this.r2y+e[5]*this.r2x)*this.r2z-e[3]*this.r2z*this.r2z-e[8]*this.r2x*this.r2y,n[2]+=(e[3]*this.r2y-e[4]*this.r2x)*this.r2z-e[6]*this.r2y*this.r2y+e[7]*this.r2x*this.r2y,n[3]+=(e[2]*this.r2y+e[7]*this.r2x)*this.r2z-e[1]*this.r2z*this.r2z-e[8]*this.r2x*this.r2y,n[4]+=e[0]*this.r2z*this.r2z-(e[6]+e[2])*this.r2x*this.r2z+e[8]*this.r2x*this.r2x,n[5]+=(e[1]*this.r2x-e[0]*this.r2y)*this.r2z-e[7]*this.r2x*this.r2x+e[6]*this.r2x*this.r2y,n[6]+=(e[1]*this.r2y-e[4]*this.r2x)*this.r2z-e[2]*this.r2y*this.r2y+e[5]*this.r2x*this.r2y,n[7]+=(e[3]*this.r2x-e[0]*this.r2y)*this.r2z-e[5]*this.r2x*this.r2x+e[2]*this.r2x*this.r2y,n[8]+=e[0]*this.r2y*this.r2y-(e[3]+e[1])*this.r2x*this.r2y+e[4]*this.r2x*this.r2x;var o=1/(n[0]*(n[4]*n[8]-n[7]*n[5])+n[3]*(n[7]*n[2]-n[1]*n[8])+n[6]*(n[1]*n[5]-n[4]*n[2]));this.dd=new Bt().set(n[4]*n[8]-n[5]*n[7],n[2]*n[7]-n[1]*n[8],n[1]*n[5]-n[2]*n[4],n[5]*n[6]-n[3]*n[8],n[0]*n[8]-n[2]*n[6],n[2]*n[3]-n[0]*n[5],n[3]*n[7]-n[4]*n[6],n[1]*n[6]-n[0]*n[7],n[0]*n[4]-n[1]*n[3]).scaleEqual(o),this.velx=this.p2.x-this.p1.x,this.vely=this.p2.y-this.p1.y,this.velz=this.p2.z-this.p1.z;var c=g.sqrt(this.velx*this.velx+this.vely*this.vely+this.velz*this.velz);c>.005?(c=(.005-c)/c*s*.05,this.velx*=c,this.vely*=c,this.velz*=c):(this.velx=0,this.vely=0,this.velz=0),this.impx*=.95,this.impy*=.95,this.impz*=.95,this.l1.x+=this.impx*this.m1,this.l1.y+=this.impy*this.m1,this.l1.z+=this.impz*this.m1,this.a1.x+=this.impx*this.ax1x+this.impy*this.ay1x+this.impz*this.az1x,this.a1.y+=this.impx*this.ax1y+this.impy*this.ay1y+this.impz*this.az1y,this.a1.z+=this.impx*this.ax1z+this.impy*this.ay1z+this.impz*this.az1z,this.l2.x-=this.impx*this.m2,this.l2.y-=this.impy*this.m2,this.l2.z-=this.impz*this.m2,this.a2.x-=this.impx*this.ax2x+this.impy*this.ay2x+this.impz*this.az2x,this.a2.y-=this.impx*this.ax2y+this.impy*this.ay2y+this.impz*this.az2y,this.a2.z-=this.impx*this.ax2z+this.impy*this.ay2z+this.impz*this.az2z},solve:function(){var t=this.dd.elements,s=this.l2.x-this.l1.x+this.a2.y*this.r2z-this.a2.z*this.r2y-this.a1.y*this.r1z+this.a1.z*this.r1y-this.velx,h=this.l2.y-this.l1.y+this.a2.z*this.r2x-this.a2.x*this.r2z-this.a1.z*this.r1x+this.a1.x*this.r1z-this.vely,e=this.l2.z-this.l1.z+this.a2.x*this.r2y-this.a2.y*this.r2x-this.a1.x*this.r1y+this.a1.y*this.r1x-this.velz,a=s*t[0]+h*t[1]+e*t[2],n=s*t[3]+h*t[4]+e*t[5],o=s*t[6]+h*t[7]+e*t[8];this.impx+=a,this.impy+=n,this.impz+=o,this.l1.x+=a*this.m1,this.l1.y+=n*this.m1,this.l1.z+=o*this.m1,this.a1.x+=a*this.ax1x+n*this.ay1x+o*this.az1x,this.a1.y+=a*this.ax1y+n*this.ay1y+o*this.az1y,this.a1.z+=a*this.ax1z+n*this.ay1z+o*this.az1z,this.l2.x-=a*this.m2,this.l2.y-=n*this.m2,this.l2.z-=o*this.m2,this.a2.x-=a*this.ax2x+n*this.ay2x+o*this.az2x,this.a2.y-=a*this.ax2y+n*this.ay2y+o*this.az2y,this.a2.z-=a*this.ax2z+n*this.ay2z+o*this.az2z}}),Object.assign(Qs.prototype,{Rotational3Constraint:!0,preSolve:function(t,s){this.ax1=this.limitMotor1.axis.x,this.ay1=this.limitMotor1.axis.y,this.az1=this.limitMotor1.axis.z,this.ax2=this.limitMotor2.axis.x,this.ay2=this.limitMotor2.axis.y,this.az2=this.limitMotor2.axis.z,this.ax3=this.limitMotor3.axis.x,this.ay3=this.limitMotor3.axis.y,this.az3=this.limitMotor3.axis.z,this.lowerLimit1=this.limitMotor1.lowerLimit,this.upperLimit1=this.limitMotor1.upperLimit,this.motorSpeed1=this.limitMotor1.motorSpeed,this.maxMotorForce1=this.limitMotor1.maxMotorForce,this.enableMotor1=this.maxMotorForce1>0,this.lowerLimit2=this.limitMotor2.lowerLimit,this.upperLimit2=this.limitMotor2.upperLimit,this.motorSpeed2=this.limitMotor2.motorSpeed,this.maxMotorForce2=this.limitMotor2.maxMotorForce,this.enableMotor2=this.maxMotorForce2>0,this.lowerLimit3=this.limitMotor3.lowerLimit,this.upperLimit3=this.limitMotor3.upperLimit,this.motorSpeed3=this.limitMotor3.motorSpeed,this.maxMotorForce3=this.limitMotor3.maxMotorForce,this.enableMotor3=this.maxMotorForce3>0;var h=this.i1.elements,e=this.i2.elements;this.i1e00=h[0],this.i1e01=h[1],this.i1e02=h[2],this.i1e10=h[3],this.i1e11=h[4],this.i1e12=h[5],this.i1e20=h[6],this.i1e21=h[7],this.i1e22=h[8],this.i2e00=e[0],this.i2e01=e[1],this.i2e02=e[2],this.i2e10=e[3],this.i2e11=e[4],this.i2e12=e[5],this.i2e20=e[6],this.i2e21=e[7],this.i2e22=e[8];var a=this.limitMotor1.frequency,n=this.limitMotor2.frequency,o=this.limitMotor3.frequency,c=a>0,l=n>0,m=o>0,r=this.lowerLimit1<=this.upperLimit1,x=this.lowerLimit2<=this.upperLimit2,p=this.lowerLimit3<=this.upperLimit3,u=this.limitMotor1.angle;r?(this.lowerLimit1==this.upperLimit1?(this.limitState1!=0&&(this.limitState1=0,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-u):u<this.lowerLimit1?(this.limitState1!=-1&&(this.limitState1=-1,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-u):u>this.upperLimit1?(this.limitState1!=1&&(this.limitState1=1,this.limitImpulse1=0),this.limitVelocity1=this.upperLimit1-u):(this.limitState1=2,this.limitImpulse1=0,this.limitVelocity1=0),c||(this.limitVelocity1>.02?this.limitVelocity1-=.02:this.limitVelocity1<-.02?this.limitVelocity1+=.02:this.limitVelocity1=0)):(this.limitState1=2,this.limitImpulse1=0);var y=this.limitMotor2.angle;x?(this.lowerLimit2==this.upperLimit2?(this.limitState2!=0&&(this.limitState2=0,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-y):y<this.lowerLimit2?(this.limitState2!=-1&&(this.limitState2=-1,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-y):y>this.upperLimit2?(this.limitState2!=1&&(this.limitState2=1,this.limitImpulse2=0),this.limitVelocity2=this.upperLimit2-y):(this.limitState2=2,this.limitImpulse2=0,this.limitVelocity2=0),l||(this.limitVelocity2>.02?this.limitVelocity2-=.02:this.limitVelocity2<-.02?this.limitVelocity2+=.02:this.limitVelocity2=0)):(this.limitState2=2,this.limitImpulse2=0);var v=this.limitMotor3.angle;if(p?(this.lowerLimit3==this.upperLimit3?(this.limitState3!=0&&(this.limitState3=0,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-v):v<this.lowerLimit3?(this.limitState3!=-1&&(this.limitState3=-1,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-v):v>this.upperLimit3?(this.limitState3!=1&&(this.limitState3=1,this.limitImpulse3=0),this.limitVelocity3=this.upperLimit3-v):(this.limitState3=2,this.limitImpulse3=0,this.limitVelocity3=0),m||(this.limitVelocity3>.02?this.limitVelocity3-=.02:this.limitVelocity3<-.02?this.limitVelocity3+=.02:this.limitVelocity3=0)):(this.limitState3=2,this.limitImpulse3=0),this.enableMotor1&&(this.limitState1!=0||c)?this.maxMotorImpulse1=this.maxMotorForce1*t:(this.motorImpulse1=0,this.maxMotorImpulse1=0),this.enableMotor2&&(this.limitState2!=0||l)?this.maxMotorImpulse2=this.maxMotorForce2*t:(this.motorImpulse2=0,this.maxMotorImpulse2=0),this.enableMotor3&&(this.limitState3!=0||m)?this.maxMotorImpulse3=this.maxMotorForce3*t:(this.motorImpulse3=0,this.maxMotorImpulse3=0),this.a1x1=this.ax1*this.i1e00+this.ay1*this.i1e01+this.az1*this.i1e02,this.a1y1=this.ax1*this.i1e10+this.ay1*this.i1e11+this.az1*this.i1e12,this.a1z1=this.ax1*this.i1e20+this.ay1*this.i1e21+this.az1*this.i1e22,this.a2x1=this.ax1*this.i2e00+this.ay1*this.i2e01+this.az1*this.i2e02,this.a2y1=this.ax1*this.i2e10+this.ay1*this.i2e11+this.az1*this.i2e12,this.a2z1=this.ax1*this.i2e20+this.ay1*this.i2e21+this.az1*this.i2e22,this.a1x2=this.ax2*this.i1e00+this.ay2*this.i1e01+this.az2*this.i1e02,this.a1y2=this.ax2*this.i1e10+this.ay2*this.i1e11+this.az2*this.i1e12,this.a1z2=this.ax2*this.i1e20+this.ay2*this.i1e21+this.az2*this.i1e22,this.a2x2=this.ax2*this.i2e00+this.ay2*this.i2e01+this.az2*this.i2e02,this.a2y2=this.ax2*this.i2e10+this.ay2*this.i2e11+this.az2*this.i2e12,this.a2z2=this.ax2*this.i2e20+this.ay2*this.i2e21+this.az2*this.i2e22,this.a1x3=this.ax3*this.i1e00+this.ay3*this.i1e01+this.az3*this.i1e02,this.a1y3=this.ax3*this.i1e10+this.ay3*this.i1e11+this.az3*this.i1e12,this.a1z3=this.ax3*this.i1e20+this.ay3*this.i1e21+this.az3*this.i1e22,this.a2x3=this.ax3*this.i2e00+this.ay3*this.i2e01+this.az3*this.i2e02,this.a2y3=this.ax3*this.i2e10+this.ay3*this.i2e11+this.az3*this.i2e12,this.a2z3=this.ax3*this.i2e20+this.ay3*this.i2e21+this.az3*this.i2e22,this.k00=this.ax1*(this.a1x1+this.a2x1)+this.ay1*(this.a1y1+this.a2y1)+this.az1*(this.a1z1+this.a2z1),this.k01=this.ax1*(this.a1x2+this.a2x2)+this.ay1*(this.a1y2+this.a2y2)+this.az1*(this.a1z2+this.a2z2),this.k02=this.ax1*(this.a1x3+this.a2x3)+this.ay1*(this.a1y3+this.a2y3)+this.az1*(this.a1z3+this.a2z3),this.k10=this.ax2*(this.a1x1+this.a2x1)+this.ay2*(this.a1y1+this.a2y1)+this.az2*(this.a1z1+this.a2z1),this.k11=this.ax2*(this.a1x2+this.a2x2)+this.ay2*(this.a1y2+this.a2y2)+this.az2*(this.a1z2+this.a2z2),this.k12=this.ax2*(this.a1x3+this.a2x3)+this.ay2*(this.a1y3+this.a2y3)+this.az2*(this.a1z3+this.a2z3),this.k20=this.ax3*(this.a1x1+this.a2x1)+this.ay3*(this.a1y1+this.a2y1)+this.az3*(this.a1z1+this.a2z1),this.k21=this.ax3*(this.a1x2+this.a2x2)+this.ay3*(this.a1y2+this.a2y2)+this.az3*(this.a1z2+this.a2z2),this.k22=this.ax3*(this.a1x3+this.a2x3)+this.ay3*(this.a1y3+this.a2y3)+this.az3*(this.a1z3+this.a2z3),this.kv00=this.k00,this.kv11=this.k11,this.kv22=this.k22,this.dv00=1/this.kv00,this.dv11=1/this.kv11,this.dv22=1/this.kv22,c&&this.limitState1!=2){var w=6.2831853*a,C=w*w*t,b=s/(C+2*this.limitMotor1.dampingRatio*w);this.cfm1=this.kv00*b,this.limitVelocity1*=C*b}else this.cfm1=0,this.limitVelocity1*=.05*s;l&&this.limitState2!=2?(b=s/((C=(w=6.2831853*n)*w*t)+2*this.limitMotor2.dampingRatio*w),this.cfm2=this.kv11*b,this.limitVelocity2*=C*b):(this.cfm2=0,this.limitVelocity2*=.05*s),m&&this.limitState3!=2?(b=s/((C=(w=6.2831853*o)*w*t)+2*this.limitMotor3.dampingRatio*w),this.cfm3=this.kv22*b,this.limitVelocity3*=C*b):(this.cfm3=0,this.limitVelocity3*=.05*s),this.k00+=this.cfm1,this.k11+=this.cfm2,this.k22+=this.cfm3;var j=1/(this.k00*(this.k11*this.k22-this.k21*this.k12)+this.k10*(this.k21*this.k02-this.k01*this.k22)+this.k20*(this.k01*this.k12-this.k11*this.k02));this.d00=(this.k11*this.k22-this.k12*this.k21)*j,this.d01=(this.k02*this.k21-this.k01*this.k22)*j,this.d02=(this.k01*this.k12-this.k02*this.k11)*j,this.d10=(this.k12*this.k20-this.k10*this.k22)*j,this.d11=(this.k00*this.k22-this.k02*this.k20)*j,this.d12=(this.k02*this.k10-this.k00*this.k12)*j,this.d20=(this.k10*this.k21-this.k11*this.k20)*j,this.d21=(this.k01*this.k20-this.k00*this.k21)*j,this.d22=(this.k00*this.k11-this.k01*this.k10)*j,this.limitImpulse1*=.95,this.motorImpulse1*=.95,this.limitImpulse2*=.95,this.motorImpulse2*=.95,this.limitImpulse3*=.95,this.motorImpulse3*=.95;var T=this.limitImpulse1+this.motorImpulse1,B=this.limitImpulse2+this.motorImpulse2,R=this.limitImpulse3+this.motorImpulse3;this.a1.x+=T*this.a1x1+B*this.a1x2+R*this.a1x3,this.a1.y+=T*this.a1y1+B*this.a1y2+R*this.a1y3,this.a1.z+=T*this.a1z1+B*this.a1z2+R*this.a1z3,this.a2.x-=T*this.a2x1+B*this.a2x2+R*this.a2x3,this.a2.y-=T*this.a2y1+B*this.a2y2+R*this.a2y3,this.a2.z-=T*this.a2z1+B*this.a2z2+R*this.a2z3},solve_:function(){var t=this.a2.x-this.a1.x,s=this.a2.y-this.a1.y,h=this.a2.z-this.a1.z;this.limitVelocity3=30;var e=t*this.ax1+s*this.ay1+h*this.az1-this.limitVelocity1,a=t*this.ax2+s*this.ay2+h*this.az2-this.limitVelocity2,n=t*this.ax3+s*this.ay3+h*this.az3-this.limitVelocity3,o=e*this.d00+a*this.d01+n*this.d02,c=e*this.d10+a*this.d11+n*this.d12,l=e*this.d20+a*this.d21+n*this.d22;this.limitImpulse1+=o,this.limitImpulse2+=c,this.limitImpulse3+=l,this.a1.x+=o*this.a1x1+c*this.a1x2+l*this.a1x3,this.a1.y+=o*this.a1y1+c*this.a1y2+l*this.a1y3,this.a1.z+=o*this.a1z1+c*this.a1z2+l*this.a1z3,this.a2.x-=o*this.a2x1+c*this.a2x2+l*this.a2x3,this.a2.y-=o*this.a2y1+c*this.a2y2+l*this.a2y3,this.a2.z-=o*this.a2z1+c*this.a2z2+l*this.a2z3},solve:function(){var t=this.a2.x-this.a1.x,s=this.a2.y-this.a1.y,h=this.a2.z-this.a1.z,e=t*this.ax1+s*this.ay1+h*this.az1,a=t*this.ax2+s*this.ay2+h*this.az2,n=t*this.ax3+s*this.ay3+h*this.az3,o=this.motorImpulse1,c=this.motorImpulse2,l=this.motorImpulse3,m=0,r=0,x=0;this.enableMotor1&&(m=(e-this.motorSpeed1)*this.dv00,this.motorImpulse1+=m,this.motorImpulse1>this.maxMotorImpulse1?this.motorImpulse1=this.maxMotorImpulse1:this.motorImpulse1<-this.maxMotorImpulse1&&(this.motorImpulse1=-this.maxMotorImpulse1),m=this.motorImpulse1-o),this.enableMotor2&&(r=(a-this.motorSpeed2)*this.dv11,this.motorImpulse2+=r,this.motorImpulse2>this.maxMotorImpulse2?this.motorImpulse2=this.maxMotorImpulse2:this.motorImpulse2<-this.maxMotorImpulse2&&(this.motorImpulse2=-this.maxMotorImpulse2),r=this.motorImpulse2-c),this.enableMotor3&&(x=(n-this.motorSpeed3)*this.dv22,this.motorImpulse3+=x,this.motorImpulse3>this.maxMotorImpulse3?this.motorImpulse3=this.maxMotorImpulse3:this.motorImpulse3<-this.maxMotorImpulse3&&(this.motorImpulse3=-this.maxMotorImpulse3),x=this.motorImpulse3-l),e+=m*this.kv00+r*this.k01+x*this.k02,a+=m*this.k10+r*this.kv11+x*this.k12,n+=m*this.k20+r*this.k21+x*this.kv22,e-=this.limitVelocity1+this.limitImpulse1*this.cfm1,a-=this.limitVelocity2+this.limitImpulse2*this.cfm2,n-=this.limitVelocity3+this.limitImpulse3*this.cfm3;var p=this.limitImpulse1,u=this.limitImpulse2,y=this.limitImpulse3,v=e*this.d00+a*this.d01+n*this.d02,w=e*this.d10+a*this.d11+n*this.d12,C=e*this.d20+a*this.d21+n*this.d22;this.limitImpulse1+=v,this.limitImpulse2+=w,this.limitImpulse3+=C;var b,j=0;switch((this.limitState1==2||this.limitImpulse1*this.limitState1<0)&&(a+=(v=-p)*this.k10,n+=v*this.k20,j|=1),(this.limitState2==2||this.limitImpulse2*this.limitState2<0)&&(e+=(w=-u)*this.k01,n+=w*this.k21,j|=2),(this.limitState3==2||this.limitImpulse3*this.limitState3<0)&&(e+=(C=-y)*this.k02,a+=C*this.k12,j|=4),j){case 1:b=1/(this.k11*this.k22-this.k12*this.k21),w=(this.k22*a+-this.k12*n)*b,C=(-this.k21*a+this.k11*n)*b;break;case 2:b=1/(this.k00*this.k22-this.k02*this.k20),v=(this.k22*e+-this.k02*n)*b,C=(-this.k20*e+this.k00*n)*b;break;case 3:C=n/this.k22;break;case 4:b=1/(this.k00*this.k11-this.k01*this.k10),v=(this.k11*e+-this.k01*a)*b,w=(-this.k10*e+this.k00*a)*b;break;case 5:w=a/this.k11;break;case 6:v=e/this.k00}this.limitImpulse1=v+p,this.limitImpulse2=w+u,this.limitImpulse3=C+y;var T=m+v,B=r+w,R=x+C;this.a1.x+=T*this.a1x1+B*this.a1x2+R*this.a1x3,this.a1.y+=T*this.a1y1+B*this.a1y2+R*this.a1y3,this.a1.z+=T*this.a1z1+B*this.a1z2+R*this.a1z3,this.a2.x-=T*this.a2x1+B*this.a2x2+R*this.a2x3,this.a2.y-=T*this.a2y1+B*this.a2y2+R*this.a2y3,this.a2.z-=T*this.a2z1+B*this.a2z2+R*this.a2z3,t=this.a2.x-this.a1.x,s=this.a2.y-this.a1.y,h=this.a2.z-this.a1.z,a=t*this.ax2+s*this.ay2+h*this.az2}}),ih.prototype=Object.assign(Object.create(rs.prototype),{constructor:ih,preSolve:function(t,s){this.updateAnchorPoints(),this.ax1.copy(this.localAxis1).applyMatrix3(this.body1.rotation,!0),this.ax2.copy(this.localAxis2).applyMatrix3(this.body2.rotation,!0),this.an1.copy(this.localAngle1).applyMatrix3(this.body1.rotation,!0),this.an2.copy(this.localAngle2).applyMatrix3(this.body2.rotation,!0),this.nor.set(this.ax1.x*this.body2.inverseMass+this.ax2.x*this.body1.inverseMass,this.ax1.y*this.body2.inverseMass+this.ax2.y*this.body1.inverseMass,this.ax1.z*this.body2.inverseMass+this.ax2.z*this.body1.inverseMass).normalize(),this.tan.tangent(this.nor).normalize(),this.bin.crossVectors(this.nor,this.tan);var h=g.acosClamp(g.dotVectors(this.an1,this.an2));this.tmp.crossVectors(this.an1,this.an2),g.dotVectors(this.nor,this.tmp)<0?this.limitMotor.angle=-h:this.limitMotor.angle=h,this.tmp.crossVectors(this.ax1,this.ax2),this.r3.limitMotor2.angle=g.dotVectors(this.tan,this.tmp),this.r3.limitMotor3.angle=g.dotVectors(this.bin,this.tmp),this.r3.preSolve(t,s),this.lc.preSolve(t,s)},solve:function(){this.r3.solve(),this.lc.solve()},postSolve:function(){}}),th.prototype=Object.assign(Object.create(rs.prototype),{constructor:th,preSolve:function(t,s){this.updateAnchorPoints(),this.lc.preSolve(t,s)},solve:function(){this.lc.solve()},postSolve:function(){}}),Object.assign($h.prototype,{TranslationalConstraint:!0,preSolve:function(t,s){this.ax=this.limitMotor.axis.x,this.ay=this.limitMotor.axis.y,this.az=this.limitMotor.axis.z,this.lowerLimit=this.limitMotor.lowerLimit,this.upperLimit=this.limitMotor.upperLimit,this.motorSpeed=this.limitMotor.motorSpeed,this.maxMotorForce=this.limitMotor.maxMotorForce,this.enableMotor=this.maxMotorForce>0,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass;var h=this.i1.elements,e=this.i2.elements;this.i1e00=h[0],this.i1e01=h[1],this.i1e02=h[2],this.i1e10=h[3],this.i1e11=h[4],this.i1e12=h[5],this.i1e20=h[6],this.i1e21=h[7],this.i1e22=h[8],this.i2e00=e[0],this.i2e01=e[1],this.i2e02=e[2],this.i2e10=e[3],this.i2e11=e[4],this.i2e12=e[5],this.i2e20=e[6],this.i2e21=e[7],this.i2e22=e[8];var a=this.p2.x-this.p1.x,n=this.p2.y-this.p1.y,o=this.p2.z-this.p1.z,c=a*this.ax+n*this.ay+o*this.az,l=this.limitMotor.frequency,m=l>0;(m&&c>20||c<-20)&&(m=!1),this.lowerLimit<=this.upperLimit?(this.lowerLimit==this.upperLimit?(this.limitState!=0&&(this.limitState=0,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-c,m||(c=this.lowerLimit)):c<this.lowerLimit?(this.limitState!=-1&&(this.limitState=-1,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-c,m||(c=this.lowerLimit)):c>this.upperLimit?(this.limitState!=1&&(this.limitState=1,this.limitImpulse=0),this.limitVelocity=this.upperLimit-c,m||(c=this.upperLimit)):(this.limitState=2,this.limitImpulse=0,this.limitVelocity=0),m||(this.limitVelocity>.005?this.limitVelocity-=.005:this.limitVelocity<-.005?this.limitVelocity+=.005:this.limitVelocity=0)):(this.limitState=2,this.limitImpulse=0),this.enableMotor&&(this.limitState!=0||m)?this.maxMotorImpulse=this.maxMotorForce*t:(this.motorImpulse=0,this.maxMotorImpulse=0);var r=c*this.ax,x=c*this.ay,p=c*this.az,u=this.m1/(this.m1+this.m2),y=1-u;if(this.r1x=this.r1.x+r*u,this.r1y=this.r1.y+x*u,this.r1z=this.r1.z+p*u,this.r2x=this.r2.x-r*y,this.r2y=this.r2.y-x*y,this.r2z=this.r2.z-p*y,this.t1x=this.r1y*this.az-this.r1z*this.ay,this.t1y=this.r1z*this.ax-this.r1x*this.az,this.t1z=this.r1x*this.ay-this.r1y*this.ax,this.t2x=this.r2y*this.az-this.r2z*this.ay,this.t2y=this.r2z*this.ax-this.r2x*this.az,this.t2z=this.r2x*this.ay-this.r2y*this.ax,this.l1x=this.ax*this.m1,this.l1y=this.ay*this.m1,this.l1z=this.az*this.m1,this.l2x=this.ax*this.m2,this.l2y=this.ay*this.m2,this.l2z=this.az*this.m2,this.a1x=this.t1x*this.i1e00+this.t1y*this.i1e01+this.t1z*this.i1e02,this.a1y=this.t1x*this.i1e10+this.t1y*this.i1e11+this.t1z*this.i1e12,this.a1z=this.t1x*this.i1e20+this.t1y*this.i1e21+this.t1z*this.i1e22,this.a2x=this.t2x*this.i2e00+this.t2y*this.i2e01+this.t2z*this.i2e02,this.a2y=this.t2x*this.i2e10+this.t2y*this.i2e11+this.t2z*this.i2e12,this.a2z=this.t2x*this.i2e20+this.t2y*this.i2e21+this.t2z*this.i2e22,this.motorDenom=this.m1+this.m2+this.ax*(this.a1y*this.r1z-this.a1z*this.r1y+this.a2y*this.r2z-this.a2z*this.r2y)+this.ay*(this.a1z*this.r1x-this.a1x*this.r1z+this.a2z*this.r2x-this.a2x*this.r2z)+this.az*(this.a1x*this.r1y-this.a1y*this.r1x+this.a2x*this.r2y-this.a2y*this.r2x),this.invMotorDenom=1/this.motorDenom,m&&this.limitState!=2){var v=6.2831853*l,w=v*v*t,C=s/(w+2*this.limitMotor.dampingRatio*v);this.cfm=this.motorDenom*C,this.limitVelocity*=w*C}else this.cfm=0,this.limitVelocity*=.05*s;this.invDenom=1/(this.motorDenom+this.cfm);var b=this.limitImpulse+this.motorImpulse;this.l1.x+=b*this.l1x,this.l1.y+=b*this.l1y,this.l1.z+=b*this.l1z,this.a1.x+=b*this.a1x,this.a1.y+=b*this.a1y,this.a1.z+=b*this.a1z,this.l2.x-=b*this.l2x,this.l2.y-=b*this.l2y,this.l2.z-=b*this.l2z,this.a2.x-=b*this.a2x,this.a2.y-=b*this.a2y,this.a2.z-=b*this.a2z},solve:function(){var t,s,h=this.ax*(this.l2.x-this.l1.x)+this.ay*(this.l2.y-this.l1.y)+this.az*(this.l2.z-this.l1.z)+this.t2x*this.a2.x-this.t1x*this.a1.x+this.t2y*this.a2.y-this.t1y*this.a1.y+this.t2z*this.a2.z-this.t1z*this.a1.z;if(this.enableMotor){t=(h-this.motorSpeed)*this.invMotorDenom;var e=this.motorImpulse;this.motorImpulse+=t,this.motorImpulse>this.maxMotorImpulse?this.motorImpulse=this.maxMotorImpulse:this.motorImpulse<-this.maxMotorImpulse&&(this.motorImpulse=-this.maxMotorImpulse),h-=(t=this.motorImpulse-e)*this.motorDenom}else t=0;if(this.limitState!=2){s=(h-this.limitVelocity-this.limitImpulse*this.cfm)*this.invDenom;var a=this.limitImpulse;this.limitImpulse+=s,this.limitImpulse*this.limitState<0&&(this.limitImpulse=0),s=this.limitImpulse-a}else s=0;var n=s+t;this.l1.x+=n*this.l1x,this.l1.y+=n*this.l1y,this.l1.z+=n*this.l1z,this.a1.x+=n*this.a1x,this.a1.y+=n*this.a1y,this.a1.z+=n*this.a1z,this.l2.x-=n*this.l2x,this.l2.y-=n*this.l2y,this.l2.z-=n*this.l2z,this.a2.x-=n*this.a2x,this.a2.y-=n*this.a2y,this.a2.z-=n*this.a2z}}),sh.prototype=Object.assign(Object.create(rs.prototype),{constructor:sh,preSolve:function(t,s){this.updateAnchorPoints(),this.nor.sub(this.anchorPoint2,this.anchorPoint1).normalize(),this.t.preSolve(t,s)},solve:function(){this.t.solve()},postSolve:function(){}}),Object.assign(Gh.prototype,{AngularConstraint:!0,preSolve:function(t,s){var h,e,a;this.ii1=this.i1.clone(),this.ii2=this.i2.clone(),h=1/((a=new Bt().add(this.ii1,this.ii2).elements)[0]*(a[4]*a[8]-a[7]*a[5])+a[3]*(a[7]*a[2]-a[1]*a[8])+a[6]*(a[1]*a[5]-a[4]*a[2])),this.dd=new Bt().set(a[4]*a[8]-a[5]*a[7],a[2]*a[7]-a[1]*a[8],a[1]*a[5]-a[2]*a[4],a[5]*a[6]-a[3]*a[8],a[0]*a[8]-a[2]*a[6],a[2]*a[3]-a[0]*a[5],a[3]*a[7]-a[4]*a[6],a[1]*a[6]-a[0]*a[7],a[0]*a[4]-a[1]*a[3]).multiplyScalar(h),this.relativeOrientation.invert(this.b1.orientation).multiply(this.targetOrientation).multiply(this.b2.orientation),h=2*this.relativeOrientation.w,this.vel.copy(this.relativeOrientation).multiplyScalar(h),(e=this.vel.length())>.02?(e=(.02-e)/e*s*.05,this.vel.multiplyScalar(e)):this.vel.set(0,0,0),this.rn1.copy(this.imp).applyMatrix3(this.ii1,!0),this.rn2.copy(this.imp).applyMatrix3(this.ii2,!0),this.a1.add(this.rn1),this.a2.sub(this.rn2)},solve:function(){var t=this.a2.clone().sub(this.a1).sub(this.vel);this.rn0.copy(t).applyMatrix3(this.dd,!0),this.rn1.copy(this.rn0).applyMatrix3(this.ii1,!0),this.rn2.copy(this.rn0).applyMatrix3(this.ii2,!0),this.imp.add(this.rn0),this.a1.add(this.rn1),this.a2.sub(this.rn2)}}),Object.assign(hh.prototype,{Translational3Constraint:!0,preSolve:function(t,s){this.ax1=this.limitMotor1.axis.x,this.ay1=this.limitMotor1.axis.y,this.az1=this.limitMotor1.axis.z,this.ax2=this.limitMotor2.axis.x,this.ay2=this.limitMotor2.axis.y,this.az2=this.limitMotor2.axis.z,this.ax3=this.limitMotor3.axis.x,this.ay3=this.limitMotor3.axis.y,this.az3=this.limitMotor3.axis.z,this.lowerLimit1=this.limitMotor1.lowerLimit,this.upperLimit1=this.limitMotor1.upperLimit,this.motorSpeed1=this.limitMotor1.motorSpeed,this.maxMotorForce1=this.limitMotor1.maxMotorForce,this.enableMotor1=this.maxMotorForce1>0,this.lowerLimit2=this.limitMotor2.lowerLimit,this.upperLimit2=this.limitMotor2.upperLimit,this.motorSpeed2=this.limitMotor2.motorSpeed,this.maxMotorForce2=this.limitMotor2.maxMotorForce,this.enableMotor2=this.maxMotorForce2>0,this.lowerLimit3=this.limitMotor3.lowerLimit,this.upperLimit3=this.limitMotor3.upperLimit,this.motorSpeed3=this.limitMotor3.motorSpeed,this.maxMotorForce3=this.limitMotor3.maxMotorForce,this.enableMotor3=this.maxMotorForce3>0,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass;var h=this.i1.elements,e=this.i2.elements;this.i1e00=h[0],this.i1e01=h[1],this.i1e02=h[2],this.i1e10=h[3],this.i1e11=h[4],this.i1e12=h[5],this.i1e20=h[6],this.i1e21=h[7],this.i1e22=h[8],this.i2e00=e[0],this.i2e01=e[1],this.i2e02=e[2],this.i2e10=e[3],this.i2e11=e[4],this.i2e12=e[5],this.i2e20=e[6],this.i2e21=e[7],this.i2e22=e[8];var a=this.p2.x-this.p1.x,n=this.p2.y-this.p1.y,o=this.p2.z-this.p1.z,c=a*this.ax1+n*this.ay1+o*this.az1,l=a*this.ax2+n*this.ay2+o*this.az2,m=a*this.ax3+n*this.ay3+o*this.az3,r=this.limitMotor1.frequency,x=this.limitMotor2.frequency,p=this.limitMotor3.frequency,u=r>0,y=x>0,v=p>0,w=this.lowerLimit1<=this.upperLimit1,C=this.lowerLimit2<=this.upperLimit2,b=this.lowerLimit3<=this.upperLimit3;(u&&c>20||c<-20)&&(u=!1),(y&&l>20||l<-20)&&(y=!1),(v&&m>20||m<-20)&&(v=!1),w?(this.lowerLimit1==this.upperLimit1?(this.limitState1!=0&&(this.limitState1=0,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-c,u||(c=this.lowerLimit1)):c<this.lowerLimit1?(this.limitState1!=-1&&(this.limitState1=-1,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-c,u||(c=this.lowerLimit1)):c>this.upperLimit1?(this.limitState1!=1&&(this.limitState1=1,this.limitImpulse1=0),this.limitVelocity1=this.upperLimit1-c,u||(c=this.upperLimit1)):(this.limitState1=2,this.limitImpulse1=0,this.limitVelocity1=0),u||(this.limitVelocity1>.005?this.limitVelocity1-=.005:this.limitVelocity1<-.005?this.limitVelocity1+=.005:this.limitVelocity1=0)):(this.limitState1=2,this.limitImpulse1=0),C?(this.lowerLimit2==this.upperLimit2?(this.limitState2!=0&&(this.limitState2=0,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-l,y||(l=this.lowerLimit2)):l<this.lowerLimit2?(this.limitState2!=-1&&(this.limitState2=-1,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-l,y||(l=this.lowerLimit2)):l>this.upperLimit2?(this.limitState2!=1&&(this.limitState2=1,this.limitImpulse2=0),this.limitVelocity2=this.upperLimit2-l,y||(l=this.upperLimit2)):(this.limitState2=2,this.limitImpulse2=0,this.limitVelocity2=0),y||(this.limitVelocity2>.005?this.limitVelocity2-=.005:this.limitVelocity2<-.005?this.limitVelocity2+=.005:this.limitVelocity2=0)):(this.limitState2=2,this.limitImpulse2=0),b?(this.lowerLimit3==this.upperLimit3?(this.limitState3!=0&&(this.limitState3=0,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-m,v||(m=this.lowerLimit3)):m<this.lowerLimit3?(this.limitState3!=-1&&(this.limitState3=-1,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-m,v||(m=this.lowerLimit3)):m>this.upperLimit3?(this.limitState3!=1&&(this.limitState3=1,this.limitImpulse3=0),this.limitVelocity3=this.upperLimit3-m,v||(m=this.upperLimit3)):(this.limitState3=2,this.limitImpulse3=0,this.limitVelocity3=0),v||(this.limitVelocity3>.005?this.limitVelocity3-=.005:this.limitVelocity3<-.005?this.limitVelocity3+=.005:this.limitVelocity3=0)):(this.limitState3=2,this.limitImpulse3=0),this.enableMotor1&&(this.limitState1!=0||u)?this.maxMotorImpulse1=this.maxMotorForce1*t:(this.motorImpulse1=0,this.maxMotorImpulse1=0),this.enableMotor2&&(this.limitState2!=0||y)?this.maxMotorImpulse2=this.maxMotorForce2*t:(this.motorImpulse2=0,this.maxMotorImpulse2=0),this.enableMotor3&&(this.limitState3!=0||v)?this.maxMotorImpulse3=this.maxMotorForce3*t:(this.motorImpulse3=0,this.maxMotorImpulse3=0);var j=c*this.ax1+l*this.ax2+m*this.ax2,T=c*this.ay1+l*this.ay2+m*this.ay2,B=c*this.az1+l*this.az2+m*this.az2,R=this.m2/(this.m1+this.m2);this.weight>=0&&(R=this.weight);var O=1-R;this.r1x=this.r1.x+j*R,this.r1y=this.r1.y+T*R,this.r1z=this.r1.z+B*R,this.r2x=this.r2.x-j*O,this.r2y=this.r2.y-T*O,this.r2z=this.r2.z-B*O,this.t1x1=this.r1y*this.az1-this.r1z*this.ay1,this.t1y1=this.r1z*this.ax1-this.r1x*this.az1,this.t1z1=this.r1x*this.ay1-this.r1y*this.ax1,this.t2x1=this.r2y*this.az1-this.r2z*this.ay1,this.t2y1=this.r2z*this.ax1-this.r2x*this.az1,this.t2z1=this.r2x*this.ay1-this.r2y*this.ax1,this.l1x1=this.ax1*this.m1,this.l1y1=this.ay1*this.m1,this.l1z1=this.az1*this.m1,this.l2x1=this.ax1*this.m2,this.l2y1=this.ay1*this.m2,this.l2z1=this.az1*this.m2,this.a1x1=this.t1x1*this.i1e00+this.t1y1*this.i1e01+this.t1z1*this.i1e02,this.a1y1=this.t1x1*this.i1e10+this.t1y1*this.i1e11+this.t1z1*this.i1e12,this.a1z1=this.t1x1*this.i1e20+this.t1y1*this.i1e21+this.t1z1*this.i1e22,this.a2x1=this.t2x1*this.i2e00+this.t2y1*this.i2e01+this.t2z1*this.i2e02,this.a2y1=this.t2x1*this.i2e10+this.t2y1*this.i2e11+this.t2z1*this.i2e12,this.a2z1=this.t2x1*this.i2e20+this.t2y1*this.i2e21+this.t2z1*this.i2e22,this.t1x2=this.r1y*this.az2-this.r1z*this.ay2,this.t1y2=this.r1z*this.ax2-this.r1x*this.az2,this.t1z2=this.r1x*this.ay2-this.r1y*this.ax2,this.t2x2=this.r2y*this.az2-this.r2z*this.ay2,this.t2y2=this.r2z*this.ax2-this.r2x*this.az2,this.t2z2=this.r2x*this.ay2-this.r2y*this.ax2,this.l1x2=this.ax2*this.m1,this.l1y2=this.ay2*this.m1,this.l1z2=this.az2*this.m1,this.l2x2=this.ax2*this.m2,this.l2y2=this.ay2*this.m2,this.l2z2=this.az2*this.m2,this.a1x2=this.t1x2*this.i1e00+this.t1y2*this.i1e01+this.t1z2*this.i1e02,this.a1y2=this.t1x2*this.i1e10+this.t1y2*this.i1e11+this.t1z2*this.i1e12,this.a1z2=this.t1x2*this.i1e20+this.t1y2*this.i1e21+this.t1z2*this.i1e22,this.a2x2=this.t2x2*this.i2e00+this.t2y2*this.i2e01+this.t2z2*this.i2e02,this.a2y2=this.t2x2*this.i2e10+this.t2y2*this.i2e11+this.t2z2*this.i2e12,this.a2z2=this.t2x2*this.i2e20+this.t2y2*this.i2e21+this.t2z2*this.i2e22,this.t1x3=this.r1y*this.az3-this.r1z*this.ay3,this.t1y3=this.r1z*this.ax3-this.r1x*this.az3,this.t1z3=this.r1x*this.ay3-this.r1y*this.ax3,this.t2x3=this.r2y*this.az3-this.r2z*this.ay3,this.t2y3=this.r2z*this.ax3-this.r2x*this.az3,this.t2z3=this.r2x*this.ay3-this.r2y*this.ax3,this.l1x3=this.ax3*this.m1,this.l1y3=this.ay3*this.m1,this.l1z3=this.az3*this.m1,this.l2x3=this.ax3*this.m2,this.l2y3=this.ay3*this.m2,this.l2z3=this.az3*this.m2,this.a1x3=this.t1x3*this.i1e00+this.t1y3*this.i1e01+this.t1z3*this.i1e02,this.a1y3=this.t1x3*this.i1e10+this.t1y3*this.i1e11+this.t1z3*this.i1e12,this.a1z3=this.t1x3*this.i1e20+this.t1y3*this.i1e21+this.t1z3*this.i1e22,this.a2x3=this.t2x3*this.i2e00+this.t2y3*this.i2e01+this.t2z3*this.i2e02,this.a2y3=this.t2x3*this.i2e10+this.t2y3*this.i2e11+this.t2z3*this.i2e12,this.a2z3=this.t2x3*this.i2e20+this.t2y3*this.i2e21+this.t2z3*this.i2e22;var G=this.m1+this.m2;if(this.k00=(this.ax1*this.ax1+this.ay1*this.ay1+this.az1*this.az1)*G,this.k01=(this.ax1*this.ax2+this.ay1*this.ay2+this.az1*this.az2)*G,this.k02=(this.ax1*this.ax3+this.ay1*this.ay3+this.az1*this.az3)*G,this.k10=(this.ax2*this.ax1+this.ay2*this.ay1+this.az2*this.az1)*G,this.k11=(this.ax2*this.ax2+this.ay2*this.ay2+this.az2*this.az2)*G,this.k12=(this.ax2*this.ax3+this.ay2*this.ay3+this.az2*this.az3)*G,this.k20=(this.ax3*this.ax1+this.ay3*this.ay1+this.az3*this.az1)*G,this.k21=(this.ax3*this.ax2+this.ay3*this.ay2+this.az3*this.az2)*G,this.k22=(this.ax3*this.ax3+this.ay3*this.ay3+this.az3*this.az3)*G,this.k00+=this.t1x1*this.a1x1+this.t1y1*this.a1y1+this.t1z1*this.a1z1,this.k01+=this.t1x1*this.a1x2+this.t1y1*this.a1y2+this.t1z1*this.a1z2,this.k02+=this.t1x1*this.a1x3+this.t1y1*this.a1y3+this.t1z1*this.a1z3,this.k10+=this.t1x2*this.a1x1+this.t1y2*this.a1y1+this.t1z2*this.a1z1,this.k11+=this.t1x2*this.a1x2+this.t1y2*this.a1y2+this.t1z2*this.a1z2,this.k12+=this.t1x2*this.a1x3+this.t1y2*this.a1y3+this.t1z2*this.a1z3,this.k20+=this.t1x3*this.a1x1+this.t1y3*this.a1y1+this.t1z3*this.a1z1,this.k21+=this.t1x3*this.a1x2+this.t1y3*this.a1y2+this.t1z3*this.a1z2,this.k22+=this.t1x3*this.a1x3+this.t1y3*this.a1y3+this.t1z3*this.a1z3,this.k00+=this.t2x1*this.a2x1+this.t2y1*this.a2y1+this.t2z1*this.a2z1,this.k01+=this.t2x1*this.a2x2+this.t2y1*this.a2y2+this.t2z1*this.a2z2,this.k02+=this.t2x1*this.a2x3+this.t2y1*this.a2y3+this.t2z1*this.a2z3,this.k10+=this.t2x2*this.a2x1+this.t2y2*this.a2y1+this.t2z2*this.a2z1,this.k11+=this.t2x2*this.a2x2+this.t2y2*this.a2y2+this.t2z2*this.a2z2,this.k12+=this.t2x2*this.a2x3+this.t2y2*this.a2y3+this.t2z2*this.a2z3,this.k20+=this.t2x3*this.a2x1+this.t2y3*this.a2y1+this.t2z3*this.a2z1,this.k21+=this.t2x3*this.a2x2+this.t2y3*this.a2y2+this.t2z3*this.a2z2,this.k22+=this.t2x3*this.a2x3+this.t2y3*this.a2y3+this.t2z3*this.a2z3,this.kv00=this.k00,this.kv11=this.k11,this.kv22=this.k22,this.dv00=1/this.kv00,this.dv11=1/this.kv11,this.dv22=1/this.kv22,u&&this.limitState1!=2){var V=6.2831853*r,D=V*V*t,U=s/(D+2*this.limitMotor1.dampingRatio*V);this.cfm1=this.kv00*U,this.limitVelocity1*=D*U}else this.cfm1=0,this.limitVelocity1*=.05*s;y&&this.limitState2!=2?(U=s/((D=(V=6.2831853*x)*V*t)+2*this.limitMotor2.dampingRatio*V),this.cfm2=this.kv11*U,this.limitVelocity2*=D*U):(this.cfm2=0,this.limitVelocity2*=.05*s),v&&this.limitState3!=2?(U=s/((D=(V=6.2831853*p)*V*t)+2*this.limitMotor3.dampingRatio*V),this.cfm3=this.kv22*U,this.limitVelocity3*=D*U):(this.cfm3=0,this.limitVelocity3*=.05*s),this.k00+=this.cfm1,this.k11+=this.cfm2,this.k22+=this.cfm3;var P=1/(this.k00*(this.k11*this.k22-this.k21*this.k12)+this.k10*(this.k21*this.k02-this.k01*this.k22)+this.k20*(this.k01*this.k12-this.k11*this.k02));this.d00=(this.k11*this.k22-this.k12*this.k21)*P,this.d01=(this.k02*this.k21-this.k01*this.k22)*P,this.d02=(this.k01*this.k12-this.k02*this.k11)*P,this.d10=(this.k12*this.k20-this.k10*this.k22)*P,this.d11=(this.k00*this.k22-this.k02*this.k20)*P,this.d12=(this.k02*this.k10-this.k00*this.k12)*P,this.d20=(this.k10*this.k21-this.k11*this.k20)*P,this.d21=(this.k01*this.k20-this.k00*this.k21)*P,this.d22=(this.k00*this.k11-this.k01*this.k10)*P;var E=this.limitImpulse1+this.motorImpulse1,_=this.limitImpulse2+this.motorImpulse2,li=this.limitImpulse3+this.motorImpulse3;this.l1.x+=E*this.l1x1+_*this.l1x2+li*this.l1x3,this.l1.y+=E*this.l1y1+_*this.l1y2+li*this.l1y3,this.l1.z+=E*this.l1z1+_*this.l1z2+li*this.l1z3,this.a1.x+=E*this.a1x1+_*this.a1x2+li*this.a1x3,this.a1.y+=E*this.a1y1+_*this.a1y2+li*this.a1y3,this.a1.z+=E*this.a1z1+_*this.a1z2+li*this.a1z3,this.l2.x-=E*this.l2x1+_*this.l2x2+li*this.l2x3,this.l2.y-=E*this.l2y1+_*this.l2y2+li*this.l2y3,this.l2.z-=E*this.l2z1+_*this.l2z2+li*this.l2z3,this.a2.x-=E*this.a2x1+_*this.a2x2+li*this.a2x3,this.a2.y-=E*this.a2y1+_*this.a2y2+li*this.a2y3,this.a2.z-=E*this.a2z1+_*this.a2z2+li*this.a2z3},solve:function(){var t=this.l2.x-this.l1.x+this.a2.y*this.r2z-this.a2.z*this.r2y-this.a1.y*this.r1z+this.a1.z*this.r1y,s=this.l2.y-this.l1.y+this.a2.z*this.r2x-this.a2.x*this.r2z-this.a1.z*this.r1x+this.a1.x*this.r1z,h=this.l2.z-this.l1.z+this.a2.x*this.r2y-this.a2.y*this.r2x-this.a1.x*this.r1y+this.a1.y*this.r1x,e=t*this.ax1+s*this.ay1+h*this.az1,a=t*this.ax2+s*this.ay2+h*this.az2,n=t*this.ax3+s*this.ay3+h*this.az3,o=this.motorImpulse1,c=this.motorImpulse2,l=this.motorImpulse3,m=0,r=0,x=0;this.enableMotor1&&(m=(e-this.motorSpeed1)*this.dv00,this.motorImpulse1+=m,this.motorImpulse1>this.maxMotorImpulse1?this.motorImpulse1=this.maxMotorImpulse1:this.motorImpulse1<-this.maxMotorImpulse1&&(this.motorImpulse1=-this.maxMotorImpulse1),m=this.motorImpulse1-o),this.enableMotor2&&(r=(a-this.motorSpeed2)*this.dv11,this.motorImpulse2+=r,this.motorImpulse2>this.maxMotorImpulse2?this.motorImpulse2=this.maxMotorImpulse2:this.motorImpulse2<-this.maxMotorImpulse2&&(this.motorImpulse2=-this.maxMotorImpulse2),r=this.motorImpulse2-c),this.enableMotor3&&(x=(n-this.motorSpeed3)*this.dv22,this.motorImpulse3+=x,this.motorImpulse3>this.maxMotorImpulse3?this.motorImpulse3=this.maxMotorImpulse3:this.motorImpulse3<-this.maxMotorImpulse3&&(this.motorImpulse3=-this.maxMotorImpulse3),x=this.motorImpulse3-l),e+=m*this.kv00+r*this.k01+x*this.k02,a+=m*this.k10+r*this.kv11+x*this.k12,n+=m*this.k20+r*this.k21+x*this.kv22,e-=this.limitVelocity1+this.limitImpulse1*this.cfm1,a-=this.limitVelocity2+this.limitImpulse2*this.cfm2,n-=this.limitVelocity3+this.limitImpulse3*this.cfm3;var p=this.limitImpulse1,u=this.limitImpulse2,y=this.limitImpulse3,v=e*this.d00+a*this.d01+n*this.d02,w=e*this.d10+a*this.d11+n*this.d12,C=e*this.d20+a*this.d21+n*this.d22;this.limitImpulse1+=v,this.limitImpulse2+=w,this.limitImpulse3+=C;var b,j=0;switch((this.limitState1==2||this.limitImpulse1*this.limitState1<0)&&(a+=(v=-p)*this.k10,n+=v*this.k20,j|=1),(this.limitState2==2||this.limitImpulse2*this.limitState2<0)&&(e+=(w=-u)*this.k01,n+=w*this.k21,j|=2),(this.limitState3==2||this.limitImpulse3*this.limitState3<0)&&(e+=(C=-y)*this.k02,a+=C*this.k12,j|=4),j){case 1:b=1/(this.k11*this.k22-this.k12*this.k21),w=(this.k22*a+-this.k12*n)*b,C=(-this.k21*a+this.k11*n)*b;break;case 2:b=1/(this.k00*this.k22-this.k02*this.k20),v=(this.k22*e+-this.k02*n)*b,C=(-this.k20*e+this.k00*n)*b;break;case 3:C=n/this.k22;break;case 4:b=1/(this.k00*this.k11-this.k01*this.k10),v=(this.k11*e+-this.k01*a)*b,w=(-this.k10*e+this.k00*a)*b;break;case 5:w=a/this.k11;break;case 6:v=e/this.k00}this.limitImpulse1=p+v,this.limitImpulse2=u+w,this.limitImpulse3=y+C;var T=m+v,B=r+w,R=x+C;this.l1.x+=T*this.l1x1+B*this.l1x2+R*this.l1x3,this.l1.y+=T*this.l1y1+B*this.l1y2+R*this.l1y3,this.l1.z+=T*this.l1z1+B*this.l1z2+R*this.l1z3,this.a1.x+=T*this.a1x1+B*this.a1x2+R*this.a1x3,this.a1.y+=T*this.a1y1+B*this.a1y2+R*this.a1y3,this.a1.z+=T*this.a1z1+B*this.a1z2+R*this.a1z3,this.l2.x-=T*this.l2x1+B*this.l2x2+R*this.l2x3,this.l2.y-=T*this.l2y1+B*this.l2y2+R*this.l2y3,this.l2.z-=T*this.l2z1+B*this.l2z2+R*this.l2z3,this.a2.x-=T*this.a2x1+B*this.a2x2+R*this.a2x3,this.a2.y-=T*this.a2y1+B*this.a2y2+R*this.a2y3,this.a2.z-=T*this.a2z1+B*this.a2z2+R*this.a2z3}}),eh.prototype=Object.assign(Object.create(rs.prototype),{constructor:eh,preSolve:function(t,s){this.updateAnchorPoints(),this.ax1.copy(this.localAxis1).applyMatrix3(this.body1.rotation,!0),this.ax2.copy(this.localAxis2).applyMatrix3(this.body2.rotation,!0),this.nor.set(this.ax1.x*this.body2.inverseMass+this.ax2.x*this.body1.inverseMass,this.ax1.y*this.body2.inverseMass+this.ax2.y*this.body1.inverseMass,this.ax1.z*this.body2.inverseMass+this.ax2.z*this.body1.inverseMass).normalize(),this.tan.tangent(this.nor).normalize(),this.bin.crossVectors(this.nor,this.tan),this.ac.preSolve(t,s),this.t3.preSolve(t,s)},solve:function(){this.ac.solve(),this.t3.solve()},postSolve:function(){}}),ah.prototype=Object.assign(Object.create(rs.prototype),{constructor:ah,preSolve:function(t,s){this.updateAnchorPoints(),this.ax1.copy(this.localAxis1).applyMatrix3(this.body1.rotation,!0),this.an1.copy(this.localAngle1).applyMatrix3(this.body1.rotation,!0),this.ax2.copy(this.localAxis2).applyMatrix3(this.body2.rotation,!0),this.an2.copy(this.localAngle2).applyMatrix3(this.body2.rotation,!0),this.nor.set(this.ax1.x*this.body2.inverseMass+this.ax2.x*this.body1.inverseMass,this.ax1.y*this.body2.inverseMass+this.ax2.y*this.body1.inverseMass,this.ax1.z*this.body2.inverseMass+this.ax2.z*this.body1.inverseMass).normalize(),this.tan.tangent(this.nor).normalize(),this.bin.crossVectors(this.nor,this.tan),this.tmp.crossVectors(this.an1,this.an2);var h=g.acosClamp(g.dotVectors(this.an1,this.an2));g.dotVectors(this.nor,this.tmp)<0?this.rotationalLimitMotor.angle=-h:this.rotationalLimitMotor.angle=h,this.tmp.crossVectors(this.ax1,this.ax2),this.r3.limitMotor2.angle=g.dotVectors(this.tan,this.tmp),this.r3.limitMotor3.angle=g.dotVectors(this.bin,this.tmp),this.r3.preSolve(t,s),this.t3.preSolve(t,s)},solve:function(){this.r3.solve(),this.t3.solve()},postSolve:function(){}}),nh.prototype=Object.assign(Object.create(rs.prototype),{constructor:nh,preSolve:function(t,s){this.updateAnchorPoints(),this.ax1.copy(this.localAxis1).applyMatrix3(this.body1.rotation,!0),this.an1.copy(this.localAngle1).applyMatrix3(this.body1.rotation,!0),this.ax2.copy(this.localAxis2).applyMatrix3(this.body2.rotation,!0),this.an2.copy(this.localAngle2).applyMatrix3(this.body2.rotation,!0),this.r3.limitMotor1.angle=g.dotVectors(this.ax1,this.ax2);var h=g.dotVectors(this.an1,this.ax2);g.dotVectors(this.ax1,this.tmp.crossVectors(this.an1,this.ax2))<0?this.rotationalLimitMotor1.angle=-h:this.rotationalLimitMotor1.angle=h,h=g.dotVectors(this.an2,this.ax1),g.dotVectors(this.ax2,this.tmp.crossVectors(this.an2,this.ax1))<0?this.rotationalLimitMotor2.angle=-h:this.rotationalLimitMotor2.angle=h,this.nor.crossVectors(this.ax1,this.ax2).normalize(),this.tan.crossVectors(this.nor,this.ax2).normalize(),this.bin.crossVectors(this.nor,this.ax1).normalize(),this.r3.preSolve(t,s),this.t3.preSolve(t,s)},solve:function(){this.r3.solve(),this.t3.solve()},postSolve:function(){}}),vh.prototype={constructor:vh,reset:function(t,s){this.body1=t.parent,this.body2=s.parent,this.numPoints=0},addPointVec:function(t,s,h,e){var a=this.points[this.numPoints++];a.position.copy(t),a.localPoint1.sub(t,this.body1.position).applyMatrix3(this.body1.rotation),a.localPoint2.sub(t,this.body2.position).applyMatrix3(this.body2.rotation),a.normal.copy(s),e&&a.normal.negate(),a.normalImpulse=0,a.penetration=h,a.warmStarted=!1},addPoint:function(t,s,h,e,a,n,o,c){var l=this.points[this.numPoints++];l.position.set(t,s,h),l.localPoint1.sub(l.position,this.body1.position).applyMatrix3(this.body1.rotation),l.localPoint2.sub(l.position,this.body2.position).applyMatrix3(this.body2.rotation),l.normalImpulse=0,l.normal.set(e,a,n),c&&l.normal.negate(),l.penetration=o,l.warmStarted=!1}},zh.prototype=Object.assign(Object.create(Js.prototype),{constructor:zh,attach:function(){this.p1=this.body1.position,this.p2=this.body2.position,this.lv1=this.body1.linearVelocity,this.av1=this.body1.angularVelocity,this.lv2=this.body2.linearVelocity,this.av2=this.body2.angularVelocity,this.i1=this.body1.inverseInertia,this.i2=this.body2.inverseInertia},detach:function(){this.p1=null,this.p2=null,this.lv1=null,this.lv2=null,this.av1=null,this.av2=null,this.i1=null,this.i2=null},preSolve:function(t,s){this.m1=this.body1.inverseMass,this.m2=this.body2.inverseMass;var h=this.m1+this.m2;this.num=this.manifold.numPoints;for(var e,a,n,o,c,l,m,r=this.cs,x=0;x<this.num;x++)e=this.ps[x],this.tmpP1.sub(e.position,this.p1),this.tmpP2.sub(e.position,this.p2),this.tmpC1.crossVectors(this.av1,this.tmpP1),this.tmpC2.crossVectors(this.av2,this.tmpP2),r.norImp=e.normalImpulse,r.tanImp=e.tangentImpulse,r.binImp=e.binormalImpulse,r.nor.copy(e.normal),this.tmp.set(this.lv2.x+this.tmpC2.x-(this.lv1.x+this.tmpC1.x),this.lv2.y+this.tmpC2.y-(this.lv1.y+this.tmpC1.y),this.lv2.z+this.tmpC2.z-(this.lv1.z+this.tmpC1.z)),a=g.dotVectors(r.nor,this.tmp),r.tan.set(this.tmp.x-a*r.nor.x,this.tmp.y-a*r.nor.y,this.tmp.z-a*r.nor.z),g.dotVectors(r.tan,r.tan)<=.04&&r.tan.tangent(r.nor),r.tan.normalize(),r.bin.crossVectors(r.nor,r.tan),r.norU1.scale(r.nor,this.m1),r.norU2.scale(r.nor,this.m2),r.tanU1.scale(r.tan,this.m1),r.tanU2.scale(r.tan,this.m2),r.binU1.scale(r.bin,this.m1),r.binU2.scale(r.bin,this.m2),r.norT1.crossVectors(this.tmpP1,r.nor),r.tanT1.crossVectors(this.tmpP1,r.tan),r.binT1.crossVectors(this.tmpP1,r.bin),r.norT2.crossVectors(this.tmpP2,r.nor),r.tanT2.crossVectors(this.tmpP2,r.tan),r.binT2.crossVectors(this.tmpP2,r.bin),l=this.i1,m=this.i2,r.norTU1.copy(r.norT1).applyMatrix3(l,!0),r.tanTU1.copy(r.tanT1).applyMatrix3(l,!0),r.binTU1.copy(r.binT1).applyMatrix3(l,!0),r.norTU2.copy(r.norT2).applyMatrix3(m,!0),r.tanTU2.copy(r.tanT2).applyMatrix3(m,!0),r.binTU2.copy(r.binT2).applyMatrix3(m,!0),this.tmpC1.crossVectors(r.norTU1,this.tmpP1),this.tmpC2.crossVectors(r.norTU2,this.tmpP2),this.tmp.add(this.tmpC1,this.tmpC2),r.norDen=1/(h+g.dotVectors(r.nor,this.tmp)),this.tmpC1.crossVectors(r.tanTU1,this.tmpP1),this.tmpC2.crossVectors(r.tanTU2,this.tmpP2),this.tmp.add(this.tmpC1,this.tmpC2),r.tanDen=1/(h+g.dotVectors(r.tan,this.tmp)),this.tmpC1.crossVectors(r.binTU1,this.tmpP1),this.tmpC2.crossVectors(r.binTU2,this.tmpP2),this.tmp.add(this.tmpC1,this.tmpC2),r.binDen=1/(h+g.dotVectors(r.bin,this.tmp)),e.warmStarted?(n=e.normalImpulse,this.lv1.addScaledVector(r.norU1,n),this.av1.addScaledVector(r.norTU1,n),this.lv2.subScaledVector(r.norU2,n),this.av2.subScaledVector(r.norTU2,n),r.norImp=n,r.tanImp=0,r.binImp=0,a=0):(r.norImp=0,r.tanImp=0,r.binImp=0),a>-1&&(a=0),(o=this.restitution*-a)<(c=-(e.penetration+.005)*s*.05)&&(o=c),r.norTar=o,r.last=x==this.num-1,r=r.next},solve:function(){var t,s,h,e,a,n,o,c,l;this.tmplv1.copy(this.lv1),this.tmplv2.copy(this.lv2),this.tmpav1.copy(this.av1),this.tmpav2.copy(this.av2);for(var m=this.cs;a=m.norImp,n=m.tanImp,o=m.binImp,c=-a*this.friction,this.tmp.sub(this.tmplv2,this.tmplv1),t=n,h=o,(l=(n+=s=(g.dotVectors(this.tmp,m.tan)+g.dotVectors(this.tmpav2,m.tanT2)-g.dotVectors(this.tmpav1,m.tanT1))*m.tanDen)*n+(o+=e=(g.dotVectors(this.tmp,m.bin)+g.dotVectors(this.tmpav2,m.binT2)-g.dotVectors(this.tmpav1,m.binT1))*m.binDen)*o)>c*c&&(n*=l=c/g.sqrt(l),o*=l),s=n-t,e=o-h,this.tmp.set(m.tanU1.x*s+m.binU1.x*e,m.tanU1.y*s+m.binU1.y*e,m.tanU1.z*s+m.binU1.z*e),this.tmplv1.addEqual(this.tmp),this.tmp.set(m.tanTU1.x*s+m.binTU1.x*e,m.tanTU1.y*s+m.binTU1.y*e,m.tanTU1.z*s+m.binTU1.z*e),this.tmpav1.addEqual(this.tmp),this.tmp.set(m.tanU2.x*s+m.binU2.x*e,m.tanU2.y*s+m.binU2.y*e,m.tanU2.z*s+m.binU2.z*e),this.tmplv2.subEqual(this.tmp),this.tmp.set(m.tanTU2.x*s+m.binTU2.x*e,m.tanTU2.y*s+m.binTU2.y*e,m.tanTU2.z*s+m.binTU2.z*e),this.tmpav2.subEqual(this.tmp),this.tmp.sub(this.tmplv2,this.tmplv1),t=a,(a+=s=(g.dotVectors(this.tmp,m.nor)+g.dotVectors(this.tmpav2,m.norT2)-g.dotVectors(this.tmpav1,m.norT1)-m.norTar)*m.norDen)>0&&(a=0),s=a-t,this.tmplv1.addScaledVector(m.norU1,s),this.tmpav1.addScaledVector(m.norTU1,s),this.tmplv2.subScaledVector(m.norU2,s),this.tmpav2.subScaledVector(m.norTU2,s),m.norImp=a,m.tanImp=n,m.binImp=o,!m.last;)m=m.next;this.lv1.copy(this.tmplv1),this.lv2.copy(this.tmplv2),this.av1.copy(this.tmpav1),this.av2.copy(this.tmpav2)},postSolve:function(){for(var t,s=this.cs,h=this.num;h--;)(t=this.ps[h]).normal.copy(s.nor),t.tangent.copy(s.tan),t.binormal.copy(s.bin),t.normalImpulse=s.norImp,t.tangentImpulse=s.tanImp,t.binormalImpulse=s.binImp,t.normalDenominator=s.norDen,t.tangentDenominator=s.tanDen,t.binormalDenominator=s.binDen,s=s.next}}),Object.assign(ie.prototype,{Contact:!0,mixRestitution:function(t,s){return g.sqrt(t*s)},mixFriction:function(t,s){return g.sqrt(t*s)},updateManifold:function(){this.constraint.restitution=this.mixRestitution(this.shape1.restitution,this.shape2.restitution),this.constraint.friction=this.mixFriction(this.shape1.friction,this.shape2.friction);for(var t=this.manifold.numPoints,s=t;s--;){var h=this.buffer[s],e=this.points[s];h.lp1X=e.localPoint1.x,h.lp1Y=e.localPoint1.y,h.lp1Z=e.localPoint1.z,h.lp2X=e.localPoint2.x,h.lp2Y=e.localPoint2.y,h.lp2Z=e.localPoint2.z,h.impulse=e.normalImpulse}this.manifold.numPoints=0,this.detector.detectCollision(this.shape1,this.shape2,this.manifold);var a=this.manifold.numPoints;if(a==0)return this.touching=!1,this.close=!1,void(this.dist=g.INF);for((this.touching||this.dist<.001)&&(this.close=!0),this.touching=!0,s=a;s--;){for(var n=(e=this.points[s]).localPoint1.x,o=e.localPoint1.y,c=e.localPoint1.z,l=e.localPoint2.x,m=e.localPoint2.y,r=e.localPoint2.z,x=-1,p=4e-4,u=t;u--;){var y=(h=this.buffer[u]).lp1X-n,v=h.lp1Y-o,w=h.lp1Z-c,C=y*y+v*v+w*w,b=(y=h.lp2X-l)*y+(v=h.lp2Y-m)*v+(w=h.lp2Z-r)*w;C<b?C<p&&(p=C,x=u):b<p&&(p=b,x=u),p<this.dist&&(this.dist=p)}if(x!=-1){var j=this.buffer[x];this.buffer[x]=this.buffer[--t],this.buffer[t]=j,e.normalImpulse=j.impulse,e.warmStarted=!0}else e.normalImpulse=0,e.warmStarted=!1}},attach:function(t,s){this.shape1=t,this.shape2=s,this.body1=t.parent,this.body2=s.parent,this.manifold.body1=this.body1,this.manifold.body2=this.body2,this.constraint.body1=this.body1,this.constraint.body2=this.body2,this.constraint.attach(),this.s1Link.shape=s,this.s1Link.body=this.body2,this.s2Link.shape=t,this.s2Link.body=this.body1,t.contactLink!=null?(this.s1Link.next=t.contactLink).prev=this.s1Link:this.s1Link.next=null,t.contactLink=this.s1Link,t.numContacts++,s.contactLink!=null?(this.s2Link.next=s.contactLink).prev=this.s2Link:this.s2Link.next=null,s.contactLink=this.s2Link,s.numContacts++,this.b1Link.shape=s,this.b1Link.body=this.body2,this.b2Link.shape=t,this.b2Link.body=this.body1,this.body1.contactLink!=null?(this.b1Link.next=this.body1.contactLink).prev=this.b1Link:this.b1Link.next=null,this.body1.contactLink=this.b1Link,this.body1.numContacts++,this.body2.contactLink!=null?(this.b2Link.next=this.body2.contactLink).prev=this.b2Link:this.b2Link.next=null,this.body2.contactLink=this.b2Link,this.body2.numContacts++,this.prev=null,this.next=null,this.persisting=!0,this.sleeping=this.body1.sleeping&&this.body2.sleeping,this.manifold.numPoints=0},detach:function(){var t=this.s1Link.prev,s=this.s1Link.next;t!==null&&(t.next=s),s!==null&&(s.prev=t),this.shape1.contactLink==this.s1Link&&(this.shape1.contactLink=s),this.s1Link.prev=null,this.s1Link.next=null,this.s1Link.shape=null,this.s1Link.body=null,this.shape1.numContacts--,t=this.s2Link.prev,s=this.s2Link.next,t!==null&&(t.next=s),s!==null&&(s.prev=t),this.shape2.contactLink==this.s2Link&&(this.shape2.contactLink=s),this.s2Link.prev=null,this.s2Link.next=null,this.s2Link.shape=null,this.s2Link.body=null,this.shape2.numContacts--,t=this.b1Link.prev,s=this.b1Link.next,t!==null&&(t.next=s),s!==null&&(s.prev=t),this.body1.contactLink==this.b1Link&&(this.body1.contactLink=s),this.b1Link.prev=null,this.b1Link.next=null,this.b1Link.shape=null,this.b1Link.body=null,this.body1.numContacts--,t=this.b2Link.prev,s=this.b2Link.next,t!==null&&(t.next=s),s!==null&&(s.prev=t),this.body2.contactLink==this.b2Link&&(this.body2.contactLink=s),this.b2Link.prev=null,this.b2Link.next=null,this.b2Link.shape=null,this.b2Link.body=null,this.body2.numContacts--,this.manifold.body1=null,this.manifold.body2=null,this.constraint.body1=null,this.constraint.body2=null,this.constraint.detach(),this.shape1=null,this.shape2=null,this.body1=null,this.body2=null}}),Object.assign(Ds.prototype,{setParent:function(t){this.parent=t,this.scale=this.parent.scale,this.invScale=this.parent.invScale,this.id=this.parent.numRigidBodies,this.name||(this.name=this.id),this.updateMesh()},addShape:function(t){t.parent&&Rt("RigidBody","It is not possible that you add a shape which already has an associated body."),this.shapes!=null&&((this.shapes.prev=t).next=this.shapes),this.shapes=t,t.parent=this,this.parent&&this.parent.addShape(t),this.numShapes++},removeShape:function(t){var s=t;if(s.parent==this){var h=s.prev,e=s.next;h!=null&&(h.next=e),e!=null&&(e.prev=h),this.shapes==s&&(this.shapes=e),s.prev=null,s.next=null,s.parent=null,this.parent&&this.parent.removeShape(s),this.numShapes--}},remove:function(){this.dispose()},dispose:function(){this.parent.removeRigidBody(this)},checkContact:function(t){this.parent.checkContact(this.name,t)},setupMass:function(t,s){var h=s===void 0||s;this.type=t||2,this.isDynamic=this.type===1,this.isStatic=this.type===2,this.mass=0,this.localInertia.set(0,0,0,0,0,0,0,0,0);for(var e=new Bt,a=new M,n=this.shapes;n!==null;n=n.next){n.calculateMassInfo(this.massInfo);var o=this.massInfo.mass;a.addScaledVector(n.relativePosition,o),this.mass+=o,this.rotateInertia(n.relativeRotation,this.massInfo.inertia,e),this.localInertia.add(e),this.localInertia.addOffset(o,n.relativePosition)}if(this.inverseMass=1/this.mass,a.scaleEqual(this.inverseMass),h){for(this.position.add(a),n=this.shapes;n!==null;n=n.next)n.relativePosition.subEqual(a);this.localInertia.subOffset(this.mass,a)}this.inverseLocalInertia.invert(this.localInertia),this.type===2&&(this.inverseMass=0,this.inverseLocalInertia.set(0,0,0,0,0,0,0,0,0)),this.syncShapes(),this.awake()},awake:function(){if(this.allowSleep&&this.sleeping){this.sleeping=!1,this.sleepTime=0;for(var t=this.contactLink;t!=null;)t.body.sleepTime=0,t.body.sleeping=!1,t=t.next;for(var s=this.jointLink;s!=null;)s.body.sleepTime=0,s.body.sleeping=!1,s=s.next;for(var h=this.shapes;h!=null;h=h.next)h.updateProxy()}},sleep:function(){if(this.allowSleep&&!this.sleeping){this.linearVelocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.sleepPosition.copy(this.position),this.sleepOrientation.copy(this.orientation),this.sleepTime=0,this.sleeping=!0;for(var t=this.shapes;t!=null;t=t.next)t.updateProxy()}},testWakeUp:function(){(this.linearVelocity.testZero()||this.angularVelocity.testZero()||this.position.testDiff(this.sleepPosition)||this.orientation.testDiff(this.sleepOrientation))&&this.awake()},isLonely:function(){return this.numJoints==0&&this.numContacts==0},updatePosition:function(t){switch(this.type){case 2:this.linearVelocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.controlPos&&(this.position.copy(this.newPosition),this.controlPos=!1),this.controlRot&&(this.orientation.copy(this.newOrientation),this.controlRot=!1);break;case 1:this.isKinematic&&(this.linearVelocity.set(0,0,0),this.angularVelocity.set(0,0,0)),this.controlPos&&(this.linearVelocity.subVectors(this.newPosition,this.position).multiplyScalar(1/t),this.controlPos=!1),this.controlRot&&(this.angularVelocity.copy(this.getAxis()),this.orientation.copy(this.newOrientation),this.controlRot=!1),this.position.addScaledVector(this.linearVelocity,t),this.orientation.addTime(this.angularVelocity,t),this.updateMesh();break;default:Rt("RigidBody","Invalid type.")}this.syncShapes(),this.updateMesh()},getAxis:function(){return new M(0,1,0).applyMatrix3(this.inverseLocalInertia,!0).normalize()},rotateInertia:function(t,s,h){this.tmpInertia.multiplyMatrices(t,s),h.multiplyMatrices(this.tmpInertia,t,!0)},syncShapes:function(){this.rotation.setQuat(this.orientation),this.rotateInertia(this.rotation,this.inverseLocalInertia,this.inverseInertia);for(var t=this.shapes;t!=null;t=t.next)t.position.copy(t.relativePosition).applyMatrix3(this.rotation,!0).add(this.position),t.rotation.multiplyMatrices(this.rotation,t.relativeRotation),t.updateProxy()},applyImpulse:function(t,s){this.linearVelocity.addScaledVector(s,this.inverseMass);var h=new M().copy(t).sub(this.position).cross(s).applyMatrix3(this.inverseInertia,!0);this.angularVelocity.add(h)},setPosition:function(t){this.newPosition.copy(t).multiplyScalar(this.invScale),this.controlPos=!0,this.isKinematic||(this.isKinematic=!0)},setQuaternion:function(t){this.newOrientation.set(t.x,t.y,t.z,t.w),this.controlRot=!0,this.isKinematic||(this.isKinematic=!0)},setRotation:function(t){this.newOrientation=new Ut().setFromEuler(t.x*g.degtorad,t.y*g.degtorad,t.z*g.degtorad),this.controlRot=!0},resetPosition:function(t,s,h){this.linearVelocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.position.set(t,s,h).multiplyScalar(this.invScale),this.awake()},resetQuaternion:function(t){this.angularVelocity.set(0,0,0),this.orientation=new Ut(t.x,t.y,t.z,t.w),this.awake()},resetRotation:function(t,s,h){this.angularVelocity.set(0,0,0),this.orientation=new Ut().setFromEuler(t*g.degtorad,s*g.degtorad,h*g.degtorad),this.awake()},getPosition:function(){return this.pos},getQuaternion:function(){return this.quaternion},connectMesh:function(t){this.mesh=t,this.updateMesh()},updateMesh:function(){this.pos.scale(this.position,this.scale),this.quaternion.copy(this.orientation),this.mesh!==null&&(this.mesh.position.copy(this.getPosition()),this.mesh.quaternion.copy(this.getQuaternion()))}}),Object.assign(Es.prototype,{BroadPhase:!0,createProxy:function(t){Rt("BroadPhase","Inheritance error.")},addProxy:function(t){Rt("BroadPhase","Inheritance error.")},removeProxy:function(t){Rt("BroadPhase","Inheritance error.")},isAvailablePair:function(t,s){var h,e=t.parent,a=s.parent;if(e==a||!e.isDynamic&&!a.isDynamic||!(t.belongsTo&s.collidesWith)||!(s.belongsTo&t.collidesWith))return!1;for(h=e.numJoints<a.numJoints?e.jointLink:a.jointLink;h!==null;){var n=h.joint;if(!n.allowCollision&&(n.body1==e&&n.body2==a||n.body1==a&&n.body2==e))return!1;h=h.next}return!0},detectPairs:function(){this.pairs=[],this.numPairs=0,this.numPairChecks=0,this.collectPairs()},collectPairs:function(){},addPair:function(t,s){var h=new be(t,s);this.pairs.push(h),this.numPairs++}});var ve=0;function Fs(t){this.shape=t,this.aabb=t.aabb}function Nh(t){Fs.call(this,t),this.id=ve++}function kh(){Es.call(this),this.types=Dh,this.proxies=[]}function Bs(){this.numElements=0,this.bufferSize=256,this.elements=[],this.elements.length=this.bufferSize,this.stack=new Float32Array(64)}function Us(t,s){this.proxy=t,this.pair=null,this.min1=null,this.max1=null,this.min2=null,this.max2=null,this.max=s,this.value=0}function wh(t,s){Fs.call(this,s),this.belongsTo=0,this.max=[],this.min=[],this.sap=t,this.min[0]=new Us(this,!1),this.max[0]=new Us(this,!0),this.min[1]=new Us(this,!1),this.max[1]=new Us(this,!0),this.min[2]=new Us(this,!1),this.max[2]=new Us(this,!0),this.max[0].pair=this.min[0],this.max[1].pair=this.min[1],this.max[2].pair=this.min[2],this.min[0].min1=this.min[1],this.min[0].max1=this.max[1],this.min[0].min2=this.min[2],this.min[0].max2=this.max[2],this.min[1].min1=this.min[0],this.min[1].max1=this.max[0],this.min[1].min2=this.min[2],this.min[1].max2=this.max[2],this.min[2].min1=this.min[0],this.min[2].max1=this.max[0],this.min[2].min2=this.min[1],this.min[2].max2=this.max[1]}function Mh(){Es.call(this),this.types=Eh,this.numElementsD=0,this.numElementsS=0,this.axesD=[new Bs,new Bs,new Bs],this.axesS=[new Bs,new Bs,new Bs],this.index1=0,this.index2=1}function te(){this.child1=null,this.child2=null,this.parent=null,this.proxy=null,this.height=0,this.aabb=new Ks}function se(){this.root=null,this.freeNodes=[],this.freeNodes.length=16384,this.numFreeNodes=0,this.aabb=new Ks}function gh(t){Fs.call(this,t),this.leaf=new te,this.leaf.proxy=this}function Ih(){Es.call(this),this.types=Fh,this.tree=new se,this.stack=[],this.leaves=[],this.numLeaves=0}function qt(){this.flip=!1}function Sh(){qt.call(this),this.clipVertices1=new Float32Array(24),this.clipVertices2=new Float32Array(24),this.used=new Float32Array(8),this.INF=1/0}function ch(t){qt.call(this),this.flip=t}function Vh(){qt.call(this)}function ph(t){qt.call(this),this.flip=t}function uh(t){qt.call(this),this.flip=t}function Lh(){qt.call(this)}function yh(t){qt.call(this),this.flip=t,this.n=new M,this.p=new M}function dh(t){qt.call(this),this.flip=t,this.n=new M,this.p=new M,this.dix=new M,this.diy=new M,this.diz=new M,this.cc=new M,this.cc2=new M}function he(t){switch(t instanceof Object||(t={}),this.scale=t.worldscale||1,this.invScale=1/this.scale,this.timeStep=t.timestep||.01666,this.timerate=1e3*this.timeStep,this.timer=null,this.preLoop=null,this.postLoop=null,this.numIterations=t.iterations||8,t.broadphase||2){case 1:this.broadPhase=new kh;break;case 2:default:this.broadPhase=new Mh;break;case 3:this.broadPhase=new Ih}this.Btypes=["None","BruteForce","Sweep & Prune","Bounding Volume Tree"],this.broadPhaseType=this.Btypes[t.broadphase||2],this.performance=null,this.isStat=t.info!==void 0&&t.info,this.isStat&&(this.performance=new xh(this)),this.enableRandomizer=t.random===void 0||t.random,this.rigidBodies=null,this.numRigidBodies=0,this.contacts=null,this.unusedContacts=null,this.numContacts=0,this.numContactPoints=0,this.joints=null,this.numJoints=0,this.numIslands=0,this.gravity=new M(0,-9.8,0),t.gravity!==void 0&&this.gravity.fromArray(t.gravity),this.detectors=[],this.detectors.length=5;for(var s=5;s--;)this.detectors[s]=[],this.detectors[s].length=5;this.detectors[bs][bs]=new Lh,this.detectors[bs][vs]=new ph(!1),this.detectors[vs][bs]=new ph(!0),this.detectors[vs][vs]=new Sh,this.detectors[Cs][Cs]=new Vh,this.detectors[Cs][vs]=new ch(!0),this.detectors[vs][Cs]=new ch(!1),this.detectors[Cs][bs]=new uh(!0),this.detectors[bs][Cs]=new uh(!1),this.detectors[Rs][bs]=new yh(!0),this.detectors[bs][Rs]=new yh(!1),this.detectors[Rs][vs]=new dh(!0),this.detectors[vs][Rs]=new dh(!1),this.randX=65535,this.randA=98765,this.randB=123456789,this.islandRigidBodies=[],this.islandStack=[],this.islandConstraints=[]}Object.assign(Fs.prototype,{Proxy:!0,update:function(){Rt("Proxy","Inheritance error.")}}),Nh.prototype=Object.assign(Object.create(Fs.prototype),{constructor:Nh,update:function(){}}),kh.prototype=Object.assign(Object.create(Es.prototype),{constructor:kh,createProxy:function(t){return new Nh(t)},addProxy:function(t){this.proxies.push(t)},removeProxy:function(t){var s=this.proxies.indexOf(t);s>-1&&this.proxies.splice(s,1)},collectPairs:function(){var t,s,h,e=0,a=this.proxies,n=a.length;for(this.numPairChecks=n*(n-1)>>1;e<n;)for(s=a[e++],t=e+1;t<n;)h=a[t++],!s.aabb.intersectTest(h.aabb)&&this.isAvailablePair(s.shape,h.shape)&&this.addPair(s.shape,h.shape)}}),Object.assign(Bs.prototype,{SAPAxis:!0,addElements:function(t,s){if(this.numElements+2>=this.bufferSize){this.bufferSize*=2;for(var h=[],e=this.numElements;e--;)h[e]=this.elements[e]}this.elements[this.numElements++]=t,this.elements[this.numElements++]=s},removeElements:function(t,s){for(var h=-1,e=-1,a=0,n=this.numElements;a<n;a++){var o=this.elements[a];if(o==t||o==s){if(h!=-1){e=a;break}h=a}}for(a=h+1,n=e;a<n;a++)this.elements[a-1]=this.elements[a];for(a=e+1,n=this.numElements;a<n;a++)this.elements[a-2]=this.elements[a];this.elements[--this.numElements]=null,this.elements[--this.numElements]=null},sort:function(){for(var t=0,s=1;this.numElements>>s;)s++;s=s*this.numElements>>2,t=0;for(var h=!1,e=this.elements,a=1,n=this.numElements;a<n;a++){var o=e[a],c=o.value,l=e[a-1];if(l.value>c){var m=a;do{if(e[m]=l,--m==0)break;l=e[m-1]}while(l.value>c);if(e[m]=o,(t+=a-m)>s){h=!0;break}}}if(h){t=2;var r=this.stack;for(r[0]=0,r[1]=this.numElements-1;t>0;){var x=r[--t],p=r[--t],u=x-p;if(u>16){var y=p+g.floor(.5*u);for(o=e[y],e[y]=e[x],e[x]=o,c=o.value,a=p-1,m=x;;){var v,w;do v=e[++a];while(v.value<c);do w=e[--m];while(c<w.value&&m!=p);if(a>=m)break;e[a]=w,e[m]=v}e[x]=e[a],e[a]=o,a-p>x-a?(r[t++]=p,r[t++]=a-1,r[t++]=a+1,r[t++]=x):(r[t++]=a+1,r[t++]=x,r[t++]=p,r[t++]=a-1)}else for(a=p+1;a<=x;a++)if(c=(o=e[a]).value,(l=e[a-1]).value>c){m=a;do{if(e[m]=l,--m==0)break;l=e[m-1]}while(l.value>c);e[m]=o}}}},calculateTestCount:function(){for(var t=1,s=0,h=1,e=this.numElements;h<e;h++)this.elements[h].max?t--:(s+=t,t++);return s}}),wh.prototype=Object.assign(Object.create(Fs.prototype),{constructor:wh,isDynamic:function(){var t=this.shape.parent;return t.isDynamic&&!t.sleeping},update:function(){var t=this.aabb.elements;this.min[0].value=t[0],this.min[1].value=t[1],this.min[2].value=t[2],this.max[0].value=t[3],this.max[1].value=t[4],this.max[2].value=t[5],(this.belongsTo==1&&!this.isDynamic()||this.belongsTo==2&&this.isDynamic())&&(this.sap.removeProxy(this),this.sap.addProxy(this))}}),Mh.prototype=Object.assign(Object.create(Es.prototype),{constructor:Mh,createProxy:function(t){return new wh(this,t)},addProxy:function(t){var s=t;s.isDynamic()?(this.axesD[0].addElements(s.min[0],s.max[0]),this.axesD[1].addElements(s.min[1],s.max[1]),this.axesD[2].addElements(s.min[2],s.max[2]),s.belongsTo=1,this.numElementsD+=2):(this.axesS[0].addElements(s.min[0],s.max[0]),this.axesS[1].addElements(s.min[1],s.max[1]),this.axesS[2].addElements(s.min[2],s.max[2]),s.belongsTo=2,this.numElementsS+=2)},removeProxy:function(t){var s=t;if(s.belongsTo!=0){switch(s.belongsTo){case 1:this.axesD[0].removeElements(s.min[0],s.max[0]),this.axesD[1].removeElements(s.min[1],s.max[1]),this.axesD[2].removeElements(s.min[2],s.max[2]),this.numElementsD-=2;break;case 2:this.axesS[0].removeElements(s.min[0],s.max[0]),this.axesS[1].removeElements(s.min[1],s.max[1]),this.axesS[2].removeElements(s.min[2],s.max[2]),this.numElementsS-=2}s.belongsTo=0}},collectPairs:function(){if(this.numElementsD!=0){var t,s,h,e,a=this.axesD[this.index1],n=this.axesD[this.index2];a.sort(),n.sort(),a.calculateTestCount()<=n.calculateTestCount()?((n=this.axesS[this.index1]).sort(),t=a.elements,s=n.elements):((a=this.axesS[this.index2]).sort(),t=n.elements,s=a.elements,this.index1^=this.index2,this.index2^=this.index1,this.index1^=this.index2);for(var o=0,c=0;o<this.numElementsD;){var l,m;if(c==this.numElementsS)l=t[o],m=!0,o++;else{var r=t[o],x=s[c];r.value<x.value?(l=r,m=!0,o++):(l=x,m=!1,c++)}if(l.max){var p=l.pair;if(m){if(p==h){h=h.pair;continue}l=h}else{if(p==e){e=e.pair;continue}l=e}for(;l;){if((b=l.pair)==p){l.pair=b.pair;break}l=b}}else{for(var u=l.proxy.shape,y=l.min1.value,v=l.max1.value,w=l.min2.value,C=l.max2.value,b=h;b!=null;b=b.pair){var j=b.proxy.shape;this.numPairChecks++,y>b.max1.value||v<b.min1.value||w>b.max2.value||C<b.min2.value||!this.isAvailablePair(u,j)||this.addPair(u,j)}if(m){for(b=e;b!=null;b=b.pair)j=b.proxy.shape,this.numPairChecks++,y>b.max1.value||v<b.min1.value||w>b.max2.value||C<b.min2.value||!this.isAvailablePair(u,j)||this.addPair(u,j);l.pair=h,h=l}else l.pair=e,e=l}}this.index2=3^(this.index1|this.index2)}}}),Object.assign(se.prototype,{DBVT:!0,moveLeaf:function(t){this.deleteLeaf(t),this.insertLeaf(t)},insertLeaf:function(t){if(this.root!=null){for(var s,h,e=t.aabb,a=this.root;a.proxy==null;){var n=a.child1,o=a.child2,c=a.aabb,l=n.aabb,m=o.aabb;s=c.surfaceArea(),this.aabb.combine(e,c);var r=2*(h=this.aabb.surfaceArea()),x=2*(h-s),p=x;this.aabb.combine(e,l),n.proxy!=null?p+=this.aabb.surfaceArea():p+=this.aabb.surfaceArea()-l.surfaceArea();var u=x;if(this.aabb.combine(e,m),o.proxy!=null?u+=this.aabb.surfaceArea():u+=this.aabb.surfaceArea()-m.surfaceArea(),p<u){if(r<p)break;a=n}else{if(r<u)break;a=o}}var y,v=a.parent;(y=this.numFreeNodes>0?this.freeNodes[--this.numFreeNodes]:new te).parent=v,y.child1=t,y.child2=a,y.aabb.combine(t.aabb,a.aabb),y.height=a.height+1,a.parent=y,t.parent=y,a==this.root?this.root=y:v.child1==a?v.child1=y:v.child2=y;do y=this.balance(y),this.fix(y),y=y.parent;while(y!=null)}else this.root=t},getBalance:function(t){return t.proxy!=null?0:t.child1.height-t.child2.height},deleteLeaf:function(t){if(t!=this.root){var s,h=t.parent;if(s=h.child1==t?h.child2:h.child1,h==this.root)return this.root=s,void(s.parent=null);var e=h.parent;s.parent=e,e.child1==h?e.child1=s:e.child2=s,this.numFreeNodes<16384&&(this.freeNodes[this.numFreeNodes++]=h);do e=this.balance(e),this.fix(e),e=e.parent;while(e!=null)}else this.root=null},balance:function(t){var s=t.height;if(s<2)return t;var h,e=t.parent,a=t.child1,n=t.child2,o=a.height,c=n.height,l=o-c;if(l>1){var m=a.child1,r=a.child2,x=m.height,p=r.height;return x>p?(a.child2=t,t.parent=a,t.child1=r,r.parent=t,t.aabb.combine(r.aabb,n.aabb),h=p-c,t.height=p-(h&h>>31)+1,a.aabb.combine(m.aabb,t.aabb),h=x-s,a.height=x-(h&h>>31)+1):(a.child1=t,t.parent=a,t.child1=m,m.parent=t,t.aabb.combine(m.aabb,n.aabb),h=x-c,t.height=x-(h&h>>31)+1,a.aabb.combine(t.aabb,r.aabb),h=s-p,a.height=s-(h&h>>31)+1),e!=null?e.child1==t?e.child1=a:e.child2=a:this.root=a,a.parent=e,a}if(l<-1){var u=n.child1,y=n.child2,v=u.height,w=y.height;return v>w?(n.child2=t,t.parent=n,t.child2=y,y.parent=t,t.aabb.combine(a.aabb,y.aabb),h=o-w,t.height=o-(h&h>>31)+1,n.aabb.combine(u.aabb,t.aabb),h=v-s,n.height=v-(h&h>>31)+1):(n.child1=t,t.parent=n,t.child2=u,u.parent=t,t.aabb.combine(a.aabb,u.aabb),h=o-v,t.height=o-(h&h>>31)+1,n.aabb.combine(t.aabb,y.aabb),h=s-w,n.height=s-(h&h>>31)+1),e!=null?e.child1==t?e.child1=n:e.child2=n:this.root=n,n.parent=e,n}return t},fix:function(t){var s=t.child1,h=t.child2;t.aabb.combine(s.aabb,h.aabb),t.height=s.height<h.height?h.height+1:s.height+1}}),gh.prototype=Object.assign(Object.create(Fs.prototype),{constructor:gh,update:function(){}}),Ih.prototype=Object.assign(Object.create(Es.prototype),{constructor:Ih,createProxy:function(t){return new gh(t)},addProxy:function(t){this.tree.insertLeaf(t.leaf),this.leaves.push(t.leaf),this.numLeaves++},removeProxy:function(t){this.tree.deleteLeaf(t.leaf);var s=this.leaves.indexOf(t.leaf);s>-1&&(this.leaves.splice(s,1),this.numLeaves--)},collectPairs:function(){if(!(this.numLeaves<2))for(var t,s=this.numLeaves;s--;)(t=this.leaves[s]).proxy.aabb.intersectTestTwo(t.aabb)&&(t.aabb.copy(t.proxy.aabb,.1),this.tree.deleteLeaf(t),this.tree.insertLeaf(t),this.collide(t,this.tree.root))},collide:function(t,s){var h,e,a,n,o,c,l=2;for(this.stack[0]=t,this.stack[1]=s;l>0;)if(a=this.stack[--l],n=this.stack[--l],o=a.proxy!=null,c=n.proxy!=null,this.numPairChecks++,o&&c){if((h=a.proxy.shape)==(e=n.proxy.shape)||h.aabb.intersectTest(e.aabb)||!this.isAvailablePair(h,e))continue;this.addPair(h,e)}else{if(a.aabb.intersectTest(n.aabb))continue;c||!o&&a.aabb.surfaceArea()>n.aabb.surfaceArea()?(this.stack[l++]=a.child1,this.stack[l++]=n,this.stack[l++]=a.child2,this.stack[l++]=n):(this.stack[l++]=a,this.stack[l++]=n.child1,this.stack[l++]=a,this.stack[l++]=n.child2)}}}),Object.assign(qt.prototype,{CollisionDetector:!0,detectCollision:function(t,s,h){Rt("CollisionDetector","Inheritance error.")}}),Sh.prototype=Object.assign(Object.create(qt.prototype),{constructor:Sh,detectCollision:function(t,s,h){var e,a;t.id<s.id?(e=t,a=s):(e=s,a=t);var n,o,c,l,m,r,x,p,u,y,v,w,C,b,j,T,B,R,O,G,V,D,U,P,E,_,li,Ki,Zi,Ri,N,zi,f,d,A,z=e.elements,k=a.elements,ci=e.dimentions,pi=a.dimentions,Z=e.position,X=a.position,S=Z.x,q=Z.y,Q=Z.z,Ot=X.x,Xi=X.y,lt=X.z,Ui=Ot-S,_i=Xi-q,ei=lt-Q,K=e.halfWidth,L=e.halfHeight,F=e.halfDepth,ii=a.halfWidth,Hi=a.halfHeight,wi=a.halfDepth,mi=ci[0],xi=ci[1],fi=ci[2],Y=ci[3],J=ci[4],W=ci[5],Mi=ci[6],bi=ci[7],vi=ci[8],Oi=ci[9],Ti=ci[10],yi=ci[11],ai=ci[12],di=ci[13],it=ci[14],gi=ci[15],hi=ci[16],ti=ci[17],$=pi[0],si=pi[1],Ni=pi[2],ki=pi[3],Si=pi[4],Fi=pi[5],qi=pi[6],Ji=pi[7],Wi=pi[8],zs=pi[9],ut=pi[10],kt=pi[11],wt=pi[12],Ii=pi[13],At=pi[14],Dt=pi[15],Et=pi[16],Ci=pi[17],Li=xi*Ni-fi*si,tt=fi*$-mi*Ni,Pi=mi*si-xi*$,St=xi*Fi-fi*Si,Vt=fi*ki-mi*Fi,Lt=mi*Si-xi*ki,Pt=xi*Wi-fi*Ji,Tt=fi*qi-mi*Wi,jt=mi*Ji-xi*qi,at=J*Ni-W*si,nt=W*$-Y*Ni,yt=Y*si-J*$,Jt=J*Fi-W*Si,Wt=W*ki-Y*Fi,Yt=Y*Si-J*ki,Ht=J*Wi-W*Ji,Kt=W*qi-Y*Wi,Zt=Y*Ji-J*qi,Xt=bi*Ni-vi*si,$t=vi*$-Mi*Ni,Gt=Mi*si-bi*$,Qt=bi*Fi-vi*Si,is=vi*ki-Mi*Fi,ts=Mi*Si-bi*ki,H=bi*Wi-vi*Ji,Os=vi*qi-Mi*Wi,As=Mi*Ji-bi*qi,ee=!1,ae=!1,ne=!1,oe=!1,re=!1,le=!1,me=!1,ce=!1,pe=!1;if((n=(N=mi*Ui+xi*_i+fi*ei)>0)||(N=-N),(f=mi*$+xi*si+fi*Ni)<0&&(f=-f),(d=mi*ki+xi*Si+fi*Fi)<0&&(d=-d),(A=mi*qi+xi*Ji+fi*Wi)<0&&(A=-A),!((T=N-(zi=K)-(f*ii+d*Hi+A*wi))>0||((o=(N=Y*Ui+J*_i+W*ei)>0)||(N=-N),(f=Y*$+J*si+W*Ni)<0&&(f=-f),(d=Y*ki+J*Si+W*Fi)<0&&(d=-d),(A=Y*qi+J*Ji+W*Wi)<0&&(A=-A),(B=N-(zi=L)-(f*ii+d*Hi+A*wi))>0||((c=(N=Mi*Ui+bi*_i+vi*ei)>0)||(N=-N),(f=Mi*$+bi*si+vi*Ni)<0&&(f=-f),(d=Mi*ki+bi*Si+vi*Fi)<0&&(d=-d),(A=Mi*qi+bi*Ji+vi*Wi)<0&&(A=-A),(R=N-(zi=F)-(f*ii+d*Hi+A*wi))>0||((l=(N=$*Ui+si*_i+Ni*ei)>0)||(N=-N),(f=$*mi+si*xi+Ni*fi)<0&&(f=-f),(d=$*Y+si*J+Ni*W)<0&&(d=-d),(A=$*Mi+si*bi+Ni*vi)<0&&(A=-A),(O=1*(N-(zi=f*K+d*L+A*F)-ii))>0||((m=(N=ki*Ui+Si*_i+Fi*ei)>0)||(N=-N),(f=ki*mi+Si*xi+Fi*fi)<0&&(f=-f),(d=ki*Y+Si*J+Fi*W)<0&&(d=-d),(A=ki*Mi+Si*bi+Fi*vi)<0&&(A=-A),(G=1*(N-(zi=f*K+d*L+A*F)-Hi))>0||((r=(N=qi*Ui+Ji*_i+Wi*ei)>0)||(N=-N),(f=qi*mi+Ji*xi+Wi*fi)<0&&(f=-f),(d=qi*Y+Ji*J+Wi*W)<0&&(d=-d),(A=qi*Mi+Ji*bi+Wi*vi)<0&&(A=-A),(V=1*(N-(zi=f*K+d*L+A*F)-wi))>0))))))){if((N=Li*Li+tt*tt+Pi*Pi)>1e-5){if((x=(N=(Li*=N=1/g.sqrt(N))*Ui+(tt*=N)*_i+(Pi*=N)*ei)>0)||(N=-N),(f=Li*Y+tt*J+Pi*W)<0&&(f=-f),(d=Li*Mi+tt*bi+Pi*vi)<0&&(d=-d),zi=f*L+d*F,(f=Li*ki+tt*Si+Pi*Fi)<0&&(f=-f),(d=Li*qi+tt*Ji+Pi*Wi)<0&&(d=-d),(D=N-zi-(f*Hi+d*wi))>0)return}else x=!1,D=0,ee=!0;if((N=St*St+Vt*Vt+Lt*Lt)>1e-5){if((p=(N=(St*=N=1/g.sqrt(N))*Ui+(Vt*=N)*_i+(Lt*=N)*ei)>0)||(N=-N),(f=St*Y+Vt*J+Lt*W)<0&&(f=-f),(d=St*Mi+Vt*bi+Lt*vi)<0&&(d=-d),zi=f*L+d*F,(f=St*$+Vt*si+Lt*Ni)<0&&(f=-f),(d=St*qi+Vt*Ji+Lt*Wi)<0&&(d=-d),(U=N-zi-(f*ii+d*wi))>0)return}else p=!1,U=0,ae=!0;if((N=Pt*Pt+Tt*Tt+jt*jt)>1e-5){if((u=(N=(Pt*=N=1/g.sqrt(N))*Ui+(Tt*=N)*_i+(jt*=N)*ei)>0)||(N=-N),(f=Pt*Y+Tt*J+jt*W)<0&&(f=-f),(d=Pt*Mi+Tt*bi+jt*vi)<0&&(d=-d),zi=f*L+d*F,(f=Pt*$+Tt*si+jt*Ni)<0&&(f=-f),(d=Pt*ki+Tt*Si+jt*Fi)<0&&(d=-d),(P=N-zi-(f*ii+d*Hi))>0)return}else u=!1,P=0,ne=!0;if((N=at*at+nt*nt+yt*yt)>1e-5){if((y=(N=(at*=N=1/g.sqrt(N))*Ui+(nt*=N)*_i+(yt*=N)*ei)>0)||(N=-N),(f=at*mi+nt*xi+yt*fi)<0&&(f=-f),(d=at*Mi+nt*bi+yt*vi)<0&&(d=-d),zi=f*K+d*F,(f=at*ki+nt*Si+yt*Fi)<0&&(f=-f),(d=at*qi+nt*Ji+yt*Wi)<0&&(d=-d),(E=N-zi-(f*Hi+d*wi))>0)return}else y=!1,E=0,oe=!0;if((N=Jt*Jt+Wt*Wt+Yt*Yt)>1e-5){if((v=(N=(Jt*=N=1/g.sqrt(N))*Ui+(Wt*=N)*_i+(Yt*=N)*ei)>0)||(N=-N),(f=Jt*mi+Wt*xi+Yt*fi)<0&&(f=-f),(d=Jt*Mi+Wt*bi+Yt*vi)<0&&(d=-d),zi=f*K+d*F,(f=Jt*$+Wt*si+Yt*Ni)<0&&(f=-f),(d=Jt*qi+Wt*Ji+Yt*Wi)<0&&(d=-d),(_=N-zi-(f*ii+d*wi))>0)return}else v=!1,_=0,re=!0;if((N=Ht*Ht+Kt*Kt+Zt*Zt)>1e-5){if((w=(N=(Ht*=N=1/g.sqrt(N))*Ui+(Kt*=N)*_i+(Zt*=N)*ei)>0)||(N=-N),(f=Ht*mi+Kt*xi+Zt*fi)<0&&(f=-f),(d=Ht*Mi+Kt*bi+Zt*vi)<0&&(d=-d),zi=f*K+d*F,(f=Ht*$+Kt*si+Zt*Ni)<0&&(f=-f),(d=Ht*ki+Kt*Si+Zt*Fi)<0&&(d=-d),(li=N-zi-(f*ii+d*Hi))>0)return}else w=!1,li=0,le=!0;if((N=Xt*Xt+$t*$t+Gt*Gt)>1e-5){if((C=(N=(Xt*=N=1/g.sqrt(N))*Ui+($t*=N)*_i+(Gt*=N)*ei)>0)||(N=-N),(f=Xt*mi+$t*xi+Gt*fi)<0&&(f=-f),(d=Xt*Y+$t*J+Gt*W)<0&&(d=-d),zi=f*K+d*L,(f=Xt*ki+$t*Si+Gt*Fi)<0&&(f=-f),(d=Xt*qi+$t*Ji+Gt*Wi)<0&&(d=-d),(Ki=N-zi-(f*Hi+d*wi))>0)return}else C=!1,Ki=0,me=!0;if((N=Qt*Qt+is*is+ts*ts)>1e-5){if((b=(N=(Qt*=N=1/g.sqrt(N))*Ui+(is*=N)*_i+(ts*=N)*ei)>0)||(N=-N),(f=Qt*mi+is*xi+ts*fi)<0&&(f=-f),(d=Qt*Y+is*J+ts*W)<0&&(d=-d),zi=f*K+d*L,(f=Qt*$+is*si+ts*Ni)<0&&(f=-f),(d=Qt*qi+is*Ji+ts*Wi)<0&&(d=-d),(Zi=N-zi-(f*ii+d*wi))>0)return}else b=!1,Zi=0,ce=!0;if((N=H*H+Os*Os+As*As)>1e-5){if((j=(N=(H*=N=1/g.sqrt(N))*Ui+(Os*=N)*_i+(As*=N)*ei)>0)||(N=-N),(f=H*mi+Os*xi+As*fi)<0&&(f=-f),(d=H*Y+Os*J+As*W)<0&&(d=-d),zi=f*K+d*L,(f=H*$+Os*si+As*Ni)<0&&(f=-f),(d=H*ki+Os*Si+As*Fi)<0&&(d=-d),(Ri=N-zi-(f*ii+d*Hi))>0)return}else j=!1,Ri=0,pe=!0;var _t=T,rt=T,$i=0,Ft=n;B>rt&&(_t=B,rt=B,$i=1,Ft=o),R>rt&&(_t=R,rt=R,$i=2,Ft=c),O>rt&&(_t=O,rt=O,$i=3,Ft=l),G>rt&&(_t=G,rt=G,$i=4,Ft=m),V>rt&&(_t=V,rt=V,$i=5,Ft=r),D-.01>rt&&!ee&&(_t=D,rt=D-.01,$i=6,Ft=x),U-.01>rt&&!ae&&(_t=U,rt=U-.01,$i=7,Ft=p),P-.01>rt&&!ne&&(_t=P,rt=P-.01,$i=8,Ft=u),E-.01>rt&&!oe&&(_t=E,rt=E-.01,$i=9,Ft=y),_-.01>rt&&!re&&(_t=_,rt=_-.01,$i=10,Ft=v),li-.01>rt&&!le&&(_t=li,rt=li-.01,$i=11,Ft=w),Ki-.01>rt&&!me&&(_t=Ki,rt=Ki-.01,$i=12,Ft=C),Zi-.01>rt&&!ce&&(_t=Zi,rt=Zi-.01,$i=13,Ft=b),Ri-.01>rt&&!pe&&(_t=Ri,$i=14,Ft=j);var ni=0,oi=0,ri=0,dt=0,xt=0,ft=0,Mt=0,gt=0,It=0,mt=0,ct=0,pt=0,Ns=0,ks=0,ws=0,Ms=0,gs=0,Is=0,Ws=!1;if($i==0?(Ft?(mt=S+Oi,ct=q+Ti,pt=Q+yi,ni=mi,oi=xi,ri=fi):(mt=S-Oi,ct=q-Ti,pt=Q-yi,ni=-mi,oi=-xi,ri=-fi),Ns=ai,ks=di,ws=it,dt=-Y,xt=-J,ft=-W,Ms=gi,gs=hi,Is=ti,Mt=-Mi,gt=-bi,It=-vi):$i==1?(Ft?(mt=S+ai,ct=q+di,pt=Q+it,ni=Y,oi=J,ri=W):(mt=S-ai,ct=q-di,pt=Q-it,ni=-Y,oi=-J,ri=-W),Ns=Oi,ks=Ti,ws=yi,dt=-mi,xt=-xi,ft=-fi,Ms=gi,gs=hi,Is=ti,Mt=-Mi,gt=-bi,It=-vi):$i==2?(Ft?(mt=S+gi,ct=q+hi,pt=Q+ti,ni=Mi,oi=bi,ri=vi):(mt=S-gi,ct=q-hi,pt=Q-ti,ni=-Mi,oi=-bi,ri=-vi),Ns=Oi,ks=Ti,ws=yi,dt=-mi,xt=-xi,ft=-fi,Ms=ai,gs=di,Is=it,Mt=-Y,gt=-J,It=-W):$i==3?(Ws=!0,Ft?(mt=Ot-zs,ct=Xi-ut,pt=lt-kt,ni=-$,oi=-si,ri=-Ni):(mt=Ot+zs,ct=Xi+ut,pt=lt+kt,ni=$,oi=si,ri=Ni),Ns=wt,ks=Ii,ws=At,dt=-ki,xt=-Si,ft=-Fi,Ms=Dt,gs=Et,Is=Ci,Mt=-qi,gt=-Ji,It=-Wi):$i==4?(Ws=!0,Ft?(mt=Ot-wt,ct=Xi-Ii,pt=lt-At,ni=-ki,oi=-Si,ri=-Fi):(mt=Ot+wt,ct=Xi+Ii,pt=lt+At,ni=ki,oi=Si,ri=Fi),Ns=zs,ks=ut,ws=kt,dt=-$,xt=-si,ft=-Ni,Ms=Dt,gs=Et,Is=Ci,Mt=-qi,gt=-Ji,It=-Wi):$i==5?(Ws=!0,Ft?(mt=Ot-Dt,ct=Xi-Et,pt=lt-Ci,ni=-qi,oi=-Ji,ri=-Wi):(mt=Ot+Dt,ct=Xi+Et,pt=lt+Ci,ni=qi,oi=Ji,ri=Wi),Ns=zs,ks=ut,ws=kt,dt=-$,xt=-si,ft=-Ni,Ms=wt,gs=Ii,Is=At,Mt=-ki,gt=-Si,It=-Fi):$i==6?(ni=Li,oi=tt,ri=Pi,dt=mi,xt=xi,ft=fi,Mt=$,gt=si,It=Ni):$i==7?(ni=St,oi=Vt,ri=Lt,dt=mi,xt=xi,ft=fi,Mt=ki,gt=Si,It=Fi):$i==8?(ni=Pt,oi=Tt,ri=jt,dt=mi,xt=xi,ft=fi,Mt=qi,gt=Ji,It=Wi):$i==9?(ni=at,oi=nt,ri=yt,dt=Y,xt=J,ft=W,Mt=$,gt=si,It=Ni):$i==10?(ni=Jt,oi=Wt,ri=Yt,dt=Y,xt=J,ft=W,Mt=ki,gt=Si,It=Fi):$i==11?(ni=Ht,oi=Kt,ri=Zt,dt=Y,xt=J,ft=W,Mt=qi,gt=Ji,It=Wi):$i==12?(ni=Xt,oi=$t,ri=Gt,dt=Mi,xt=bi,ft=vi,Mt=$,gt=si,It=Ni):$i==13?(ni=Qt,oi=is,ri=ts,dt=Mi,xt=bi,ft=vi,Mt=ki,gt=Si,It=Fi):$i==14&&(ni=H,oi=Os,ri=As,dt=Mi,xt=bi,ft=vi,Mt=qi,gt=Ji,It=Wi),$i>5){var ot,Gi,st,ht,et,Ss,Vs,Ls,Ps,Ts,js;Ft||(ni=-ni,oi=-oi,ri=-ri),Gi=ni*(Ss=z[0])+oi*(Vs=z[1])+ri*(Ls=z[2]),(ot=ni*(st=z[3])+oi*(ht=z[4])+ri*(et=z[5]))>Gi&&(Gi=ot,Ss=st,Vs=ht,Ls=et),(ot=ni*(st=z[6])+oi*(ht=z[7])+ri*(et=z[8]))>Gi&&(Gi=ot,Ss=st,Vs=ht,Ls=et),(ot=ni*(st=z[9])+oi*(ht=z[10])+ri*(et=z[11]))>Gi&&(Gi=ot,Ss=st,Vs=ht,Ls=et),(ot=ni*(st=z[12])+oi*(ht=z[13])+ri*(et=z[14]))>Gi&&(Gi=ot,Ss=st,Vs=ht,Ls=et),(ot=ni*(st=z[15])+oi*(ht=z[16])+ri*(et=z[17]))>Gi&&(Gi=ot,Ss=st,Vs=ht,Ls=et),(ot=ni*(st=z[18])+oi*(ht=z[19])+ri*(et=z[20]))>Gi&&(Gi=ot,Ss=st,Vs=ht,Ls=et),(ot=ni*(st=z[21])+oi*(ht=z[22])+ri*(et=z[23]))>Gi&&(Gi=ot,Ss=st,Vs=ht,Ls=et),Gi=ni*(Ps=k[0])+oi*(Ts=k[1])+ri*(js=k[2]),(ot=ni*(st=k[3])+oi*(ht=k[4])+ri*(et=k[5]))<Gi&&(Gi=ot,Ps=st,Ts=ht,js=et),(ot=ni*(st=k[6])+oi*(ht=k[7])+ri*(et=k[8]))<Gi&&(Gi=ot,Ps=st,Ts=ht,js=et),(ot=ni*(st=k[9])+oi*(ht=k[10])+ri*(et=k[11]))<Gi&&(Gi=ot,Ps=st,Ts=ht,js=et),(ot=ni*(st=k[12])+oi*(ht=k[13])+ri*(et=k[14]))<Gi&&(Gi=ot,Ps=st,Ts=ht,js=et),(ot=ni*(st=k[15])+oi*(ht=k[16])+ri*(et=k[17]))<Gi&&(Gi=ot,Ps=st,Ts=ht,js=et),(ot=ni*(st=k[18])+oi*(ht=k[19])+ri*(et=k[20]))<Gi&&(Gi=ot,Ps=st,Ts=ht,js=et),(ot=ni*(st=k[21])+oi*(ht=k[22])+ri*(et=k[23]))<Gi&&(Gi=ot,Ps=st,Ts=ht,js=et);var Bi=((st=Ps-Ss)*(dt-Mt*(f=dt*Mt+xt*gt+ft*It))+(ht=Ts-Vs)*(xt-gt*f)+(et=js-Ls)*(ft-It*f))/(1-f*f);h.addPoint(Ss+dt*Bi+ni*_t*.5,Vs+xt*Bi+oi*_t*.5,Ls+ft*Bi+ri*_t*.5,ni,oi,ri,_t,!1)}else{var ss,hs,es,as,ns,os,ls,ms,cs,ps,us,ys,ds,ji,I,Ai,Di,Ei,bt,vt,zt,Qi=1,Vi=0,Nt=0;Ws?((Vi=mi*ni+xi*oi+fi*ri)<Qi&&(Qi=Vi,Nt=0),-Vi<Qi&&(Qi=-Vi,Nt=1),(Vi=Y*ni+J*oi+W*ri)<Qi&&(Qi=Vi,Nt=2),-Vi<Qi&&(Qi=-Vi,Nt=3),(Vi=Mi*ni+bi*oi+vi*ri)<Qi&&(Qi=Vi,Nt=4),-Vi<Qi&&(Qi=-Vi,Nt=5),Nt==0?(ss=z[0],hs=z[1],es=z[2],as=z[6],ns=z[7],os=z[8],ls=z[9],ms=z[10],cs=z[11],ps=z[3],us=z[4],ys=z[5]):Nt==1?(ss=z[15],hs=z[16],es=z[17],as=z[21],ns=z[22],os=z[23],ls=z[18],ms=z[19],cs=z[20],ps=z[12],us=z[13],ys=z[14]):Nt==2?(ss=z[12],hs=z[13],es=z[14],as=z[0],ns=z[1],os=z[2],ls=z[3],ms=z[4],cs=z[5],ps=z[15],us=z[16],ys=z[17]):Nt==3?(ss=z[21],hs=z[22],es=z[23],as=z[9],ns=z[10],os=z[11],ls=z[6],ms=z[7],cs=z[8],ps=z[18],us=z[19],ys=z[20]):Nt==4?(ss=z[12],hs=z[13],es=z[14],as=z[18],ns=z[19],os=z[20],ls=z[6],ms=z[7],cs=z[8],ps=z[0],us=z[1],ys=z[2]):Nt==5&&(ss=z[3],hs=z[4],es=z[5],as=k[9],ns=k[10],os=k[11],ls=z[21],ms=z[22],cs=z[23],ps=z[15],us=z[16],ys=z[17])):((Vi=$*ni+si*oi+Ni*ri)<Qi&&(Qi=Vi,Nt=0),-Vi<Qi&&(Qi=-Vi,Nt=1),(Vi=ki*ni+Si*oi+Fi*ri)<Qi&&(Qi=Vi,Nt=2),-Vi<Qi&&(Qi=-Vi,Nt=3),(Vi=qi*ni+Ji*oi+Wi*ri)<Qi&&(Qi=Vi,Nt=4),-Vi<Qi&&(Qi=-Vi,Nt=5),Nt==0?(ss=k[0],hs=k[1],es=k[2],as=k[6],ns=k[7],os=k[8],ls=k[9],ms=k[10],cs=k[11],ps=k[3],us=k[4],ys=k[5]):Nt==1?(ss=k[15],hs=k[16],es=k[17],as=k[21],ns=k[22],os=k[23],ls=k[18],ms=k[19],cs=k[20],ps=k[12],us=k[13],ys=k[14]):Nt==2?(ss=k[12],hs=k[13],es=k[14],as=k[0],ns=k[1],os=k[2],ls=k[3],ms=k[4],cs=k[5],ps=k[15],us=k[16],ys=k[17]):Nt==3?(ss=k[21],hs=k[22],es=k[23],as=k[9],ns=k[10],os=k[11],ls=k[6],ms=k[7],cs=k[8],ps=k[18],us=k[19],ys=k[20]):Nt==4?(ss=k[12],hs=k[13],es=k[14],as=k[18],ns=k[19],os=k[20],ls=k[6],ms=k[7],cs=k[8],ps=k[0],us=k[1],ys=k[2]):Nt==5&&(ss=k[3],hs=k[4],es=k[5],as=k[9],ns=k[10],os=k[11],ls=k[21],ms=k[22],cs=k[23],ps=k[15],us=k[16],ys=k[17])),this.clipVertices1[0]=ss,this.clipVertices1[1]=hs,this.clipVertices1[2]=es,this.clipVertices1[3]=as,this.clipVertices1[4]=ns,this.clipVertices1[5]=os,this.clipVertices1[6]=ls,this.clipVertices1[7]=ms,this.clipVertices1[8]=cs,this.clipVertices1[9]=ps,this.clipVertices1[10]=us,this.clipVertices1[11]=ys,ji=0,f=((Ai=this.clipVertices1[9])-mt-Ns)*dt+((Di=this.clipVertices1[10])-ct-ks)*xt+((Ei=this.clipVertices1[11])-pt-ws)*ft;for(var Yi=0;Yi<4;Yi++)I=3*Yi,d=((bt=this.clipVertices1[I])-mt-Ns)*dt+((vt=this.clipVertices1[I+1])-ct-ks)*xt+((zt=this.clipVertices1[I+2])-pt-ws)*ft,f>0?d>0?(I=3*ji,ji++,this.clipVertices2[I]=bt,this.clipVertices2[I+1]=vt,this.clipVertices2[I+2]=zt):(I=3*ji,ji++,Bi=f/(f-d),this.clipVertices2[I]=Ai+(bt-Ai)*Bi,this.clipVertices2[I+1]=Di+(vt-Di)*Bi,this.clipVertices2[I+2]=Ei+(zt-Ei)*Bi):d>0&&(I=3*ji,ji++,Bi=f/(f-d),this.clipVertices2[I]=Ai+(bt-Ai)*Bi,this.clipVertices2[I+1]=Di+(vt-Di)*Bi,this.clipVertices2[I+2]=Ei+(zt-Ei)*Bi,I=3*ji,ji++,this.clipVertices2[I]=bt,this.clipVertices2[I+1]=vt,this.clipVertices2[I+2]=zt),Ai=bt,Di=vt,Ei=zt,f=d;if((ds=ji)!=0){for(ji=0,I=3*(ds-1),f=((Ai=this.clipVertices2[I])-mt-Ms)*Mt+((Di=this.clipVertices2[I+1])-ct-gs)*gt+((Ei=this.clipVertices2[I+2])-pt-Is)*It,Yi=0;Yi<ds;Yi++)I=3*Yi,d=((bt=this.clipVertices2[I])-mt-Ms)*Mt+((vt=this.clipVertices2[I+1])-ct-gs)*gt+((zt=this.clipVertices2[I+2])-pt-Is)*It,f>0?d>0?(I=3*ji,ji++,this.clipVertices1[I]=bt,this.clipVertices1[I+1]=vt,this.clipVertices1[I+2]=zt):(I=3*ji,ji++,Bi=f/(f-d),this.clipVertices1[I]=Ai+(bt-Ai)*Bi,this.clipVertices1[I+1]=Di+(vt-Di)*Bi,this.clipVertices1[I+2]=Ei+(zt-Ei)*Bi):d>0&&(I=3*ji,ji++,Bi=f/(f-d),this.clipVertices1[I]=Ai+(bt-Ai)*Bi,this.clipVertices1[I+1]=Di+(vt-Di)*Bi,this.clipVertices1[I+2]=Ei+(zt-Ei)*Bi,I=3*ji,ji++,this.clipVertices1[I]=bt,this.clipVertices1[I+1]=vt,this.clipVertices1[I+2]=zt),Ai=bt,Di=vt,Ei=zt,f=d;if((ds=ji)!=0){for(ji=0,I=3*(ds-1),f=((Ai=this.clipVertices1[I])-mt+Ns)*-dt+((Di=this.clipVertices1[I+1])-ct+ks)*-xt+((Ei=this.clipVertices1[I+2])-pt+ws)*-ft,Yi=0;Yi<ds;Yi++)I=3*Yi,d=((bt=this.clipVertices1[I])-mt+Ns)*-dt+((vt=this.clipVertices1[I+1])-ct+ks)*-xt+((zt=this.clipVertices1[I+2])-pt+ws)*-ft,f>0?d>0?(I=3*ji,ji++,this.clipVertices2[I]=bt,this.clipVertices2[I+1]=vt,this.clipVertices2[I+2]=zt):(I=3*ji,ji++,Bi=f/(f-d),this.clipVertices2[I]=Ai+(bt-Ai)*Bi,this.clipVertices2[I+1]=Di+(vt-Di)*Bi,this.clipVertices2[I+2]=Ei+(zt-Ei)*Bi):d>0&&(I=3*ji,ji++,Bi=f/(f-d),this.clipVertices2[I]=Ai+(bt-Ai)*Bi,this.clipVertices2[I+1]=Di+(vt-Di)*Bi,this.clipVertices2[I+2]=Ei+(zt-Ei)*Bi,I=3*ji,ji++,this.clipVertices2[I]=bt,this.clipVertices2[I+1]=vt,this.clipVertices2[I+2]=zt),Ai=bt,Di=vt,Ei=zt,f=d;if((ds=ji)!=0){for(ji=0,I=3*(ds-1),f=((Ai=this.clipVertices2[I])-mt+Ms)*-Mt+((Di=this.clipVertices2[I+1])-ct+gs)*-gt+((Ei=this.clipVertices2[I+2])-pt+Is)*-It,Yi=0;Yi<ds;Yi++)I=3*Yi,d=((bt=this.clipVertices2[I])-mt+Ms)*-Mt+((vt=this.clipVertices2[I+1])-ct+gs)*-gt+((zt=this.clipVertices2[I+2])-pt+Is)*-It,f>0?d>0?(I=3*ji,ji++,this.clipVertices1[I]=bt,this.clipVertices1[I+1]=vt,this.clipVertices1[I+2]=zt):(I=3*ji,ji++,Bi=f/(f-d),this.clipVertices1[I]=Ai+(bt-Ai)*Bi,this.clipVertices1[I+1]=Di+(vt-Di)*Bi,this.clipVertices1[I+2]=Ei+(zt-Ei)*Bi):d>0&&(I=3*ji,ji++,Bi=f/(f-d),this.clipVertices1[I]=Ai+(bt-Ai)*Bi,this.clipVertices1[I+1]=Di+(vt-Di)*Bi,this.clipVertices1[I+2]=Ei+(zt-Ei)*Bi,I=3*ji,ji++,this.clipVertices1[I]=bt,this.clipVertices1[I+1]=vt,this.clipVertices1[I+2]=zt),Ai=bt,Di=vt,Ei=zt,f=d;if(Ws){var ze=e;e=a,a=ze}if((ds=ji)!=0){var Ys=e!=t;if(ds>4){dt=ss-(Ai=.25*(ss+as+ls+ps)),xt=hs-(Di=.25*(hs+ns+ms+us)),ft=es-(Ei=.25*(es+os+cs+ys)),Mt=as-Ai,gt=ns-Di,It=os-Ei;var Ph=0,ue=0,Th=0,ye=0,Hs=-this.INF;for(Qi=this.INF,Yi=0;Yi<ds;Yi++)this.used[Yi]=!1,I=3*Yi,(Vi=(Ai=this.clipVertices1[I])*dt+(Di=this.clipVertices1[I+1])*xt+(Ei=this.clipVertices1[I+2])*ft)<Qi&&(Qi=Vi,Ph=Yi),Vi>Hs&&(Hs=Vi,Th=Yi);for(this.used[Ph]=!0,this.used[Th]=!0,Hs=-this.INF,Qi=this.INF,Yi=0;Yi<ds;Yi++)this.used[Yi]||(I=3*Yi,(Vi=(Ai=this.clipVertices1[I])*Mt+(Di=this.clipVertices1[I+1])*gt+(Ei=this.clipVertices1[I+2])*It)<Qi&&(Qi=Vi,ue=Yi),Vi>Hs&&(Hs=Vi,ye=Yi));I=3*Ph,(Vi=((Ai=this.clipVertices1[I])-mt)*ni+((Di=this.clipVertices1[I+1])-ct)*oi+((Ei=this.clipVertices1[I+2])-pt)*ri)<0&&h.addPoint(Ai,Di,Ei,ni,oi,ri,Vi,Ys),I=3*ue,(Vi=((Ai=this.clipVertices1[I])-mt)*ni+((Di=this.clipVertices1[I+1])-ct)*oi+((Ei=this.clipVertices1[I+2])-pt)*ri)<0&&h.addPoint(Ai,Di,Ei,ni,oi,ri,Vi,Ys),I=3*Th,(Vi=((Ai=this.clipVertices1[I])-mt)*ni+((Di=this.clipVertices1[I+1])-ct)*oi+((Ei=this.clipVertices1[I+2])-pt)*ri)<0&&h.addPoint(Ai,Di,Ei,ni,oi,ri,Vi,Ys),I=3*ye,(Vi=((Ai=this.clipVertices1[I])-mt)*ni+((Di=this.clipVertices1[I+1])-ct)*oi+((Ei=this.clipVertices1[I+2])-pt)*ri)<0&&h.addPoint(Ai,Di,Ei,ni,oi,ri,Vi,Ys)}else for(Yi=0;Yi<ds;Yi++)I=3*Yi,(Vi=((Ai=this.clipVertices1[I])-mt)*ni+((Di=this.clipVertices1[I+1])-ct)*oi+((Ei=this.clipVertices1[I+2])-pt)*ri)<0&&h.addPoint(Ai,Di,Ei,ni,oi,ri,Vi,Ys)}}}}}}}}),ch.prototype=Object.assign(Object.create(qt.prototype),{constructor:ch,getSep:function(t,s,h,e,a){var n,o,c,l,m,r,x,p,u,y,v,w,C,b=new M,j=t.position.x,T=t.position.y,B=t.position.z,R=s.position.x,O=s.position.y,G=s.position.z,V=R-j,D=O-T,U=G-B;V*V+D*D+U*U==0&&(D=.001);var P=-V,E=-D,_=-U;this.supportPointB(t,-P,-E,-_,b);var li=b.x,Ki=b.y,Zi=b.z;this.supportPointC(s,P,E,_,b);var Ri=b.x,N=b.y,zi=b.z,f=Ri-li,d=N-Ki,A=zi-Zi;if(f*P+d*E+A*_<=0)return!1;if((P=d*U-A*D)*P+(E=A*V-f*U)*E+(_=f*D-d*V)*_==0)return h.set(f-V,d-D,A-U).normalize(),e.set(.5*(li+Ri),.5*(Ki+N),.5*(Zi+zi)),!0;this.supportPointB(t,-P,-E,-_,b);var z=b.x,k=b.y,ci=b.z;this.supportPointC(s,P,E,_,b);var pi=b.x,Z=b.y,X=b.z,S=pi-z,q=Z-k,Q=X-ci;if(S*P+q*E+Q*_<=0)return!1;(P=(o=d-D)*(r=Q-U)-(c=A-U)*(m=q-D))*V+(E=c*(l=S-V)-(n=f-V)*r)*D+(_=n*m-o*l)*U>0&&(n=f,o=d,c=A,f=S,d=q,A=Q,S=n,q=o,Q=c,n=li,o=Ki,c=Zi,li=z,Ki=k,Zi=ci,z=n,k=o,ci=c,n=Ri,o=N,c=zi,Ri=pi,N=Z,zi=X,pi=n,Z=o,X=c,P=-P,E=-E,_=-_);for(var Ot=0;;){if(++Ot>100)return!1;this.supportPointB(t,-P,-E,-_,b);var Xi=b.x,lt=b.y,Ui=b.z;this.supportPointC(s,P,E,_,b);var _i=b.x,ei=b.y,K=b.z,L=_i-Xi,F=ei-lt,ii=K-Ui;if(L*P+F*E+ii*_<=0)return!1;if((d*ii-A*F)*V+(A*L-f*ii)*D+(f*F-d*L)*U<0)S=L,q=F,Q=ii,z=Xi,k=lt,ci=Ui,pi=_i,Z=ei,X=K,P=(o=d-D)*(r=ii-U)-(c=A-U)*(m=F-D),E=c*(l=L-V)-(n=f-V)*r,_=n*m-o*l;else if((F*Q-ii*q)*V+(ii*S-L*Q)*D+(L*q-F*S)*U<0)f=L,d=F,A=ii,li=Xi,Ki=lt,Zi=Ui,Ri=_i,N=ei,zi=K,P=(o=F-D)*(r=Q-U)-(c=ii-U)*(m=q-D),E=c*(l=S-V)-(n=L-V)*r,_=n*m-o*l;else for(var Hi=!1;;){if(P=(o=q-d)*(r=ii-A)-(c=Q-A)*(m=F-d),E=c*(l=L-f)-(n=S-f)*r,_=n*m-o*l,(P*=x=1/g.sqrt(P*P+E*E+_*_))*f+(E*=x)*d+(_*=x)*A>=0&&!Hi){var wi=(d*Q-A*q)*L+(A*S-f*Q)*F+(f*q-d*S)*ii,mi=(F*Q-ii*q)*V+(ii*S-L*Q)*D+(L*q-F*S)*U,xi=(D*A-U*d)*L+(U*f-V*A)*F+(V*d-D*f)*ii,fi=(q*A-Q*d)*V+(Q*f-S*A)*D+(S*d-q*f)*U,Y=wi+mi+xi+fi;Y<=0&&(wi=0,Y=(mi=(q*ii-Q*F)*P+(Q*L-S*ii)*E+(S*F-q*L)*_)+(xi=(F*Q-ii*q)*P+(ii*S-L*Q)*E+(L*q-F*S)*_)+(fi=(d*Q-A*q)*P+(A*S-f*Q)*E+(f*q-d*S)*_));var J=1/Y;p=(j*wi+li*mi+z*xi+Xi*fi)*J,u=(T*wi+Ki*mi+k*xi+lt*fi)*J,y=(B*wi+Zi*mi+ci*xi+Ui*fi)*J,v=(R*wi+Ri*mi+pi*xi+_i*fi)*J,w=(O*wi+N*mi+Z*xi+ei*fi)*J,C=(G*wi+zi*mi+X*xi+K*fi)*J,Hi=!0}this.supportPointB(t,-P,-E,-_,b);var W=b.x,Mi=b.y,bi=b.z;this.supportPointC(s,P,E,_,b);var vi=b.x,Oi=b.y,Ti=b.z,yi=vi-W,ai=Oi-Mi,di=Ti-bi,it=-(yi*P+ai*E+di*_);if((yi-L)*P+(ai-F)*E+(di-ii)*_<=.01||it>=0)return!!Hi&&(h.set(-P,-E,-_),e.set(.5*(p+v),.5*(u+w),.5*(y+C)),a.x=it,!0);(ai*A-di*d)*V+(di*f-yi*A)*D+(yi*d-ai*f)*U<0?(ai*Q-di*q)*V+(di*S-yi*Q)*D+(yi*q-ai*S)*U<0?(f=yi,d=ai,A=di,li=W,Ki=Mi,Zi=bi,Ri=vi,N=Oi,zi=Ti):(L=yi,F=ai,ii=di,Xi=W,lt=Mi,Ui=bi,_i=vi,ei=Oi,K=Ti):(ai*ii-di*F)*V+(di*L-yi*ii)*D+(yi*F-ai*L)*U<0?(S=yi,q=ai,Q=di,z=W,k=Mi,ci=bi,pi=vi,Z=Oi,X=Ti):(f=yi,d=ai,A=di,li=W,Ki=Mi,Zi=bi,Ri=vi,N=Oi,zi=Ti)}}},supportPointB:function(t,s,h,e,a){var n,o,c,l=t.rotation.elements,m=l[0]*s+l[3]*h+l[6]*e,r=l[1]*s+l[4]*h+l[7]*e,x=l[2]*s+l[5]*h+l[8]*e,p=t.halfWidth,u=t.halfHeight,y=t.halfDepth;n=m<0?-p:p,o=r<0?-u:u,c=x<0?-y:y,m=l[0]*n+l[1]*o+l[2]*c+t.position.x,r=l[3]*n+l[4]*o+l[5]*c+t.position.y,x=l[6]*n+l[7]*o+l[8]*c+t.position.z,a.set(m,r,x)},supportPointC:function(t,s,h,e,a){var n,o,c,l=t.rotation.elements,m=l[0]*s+l[3]*h+l[6]*e,r=l[1]*s+l[4]*h+l[7]*e,x=l[2]*s+l[5]*h+l[8]*e,p=m,u=x,y=p*p+u*u,v=t.radius,w=t.halfHeight;y==0?r<0?(n=v,o=-w,c=0):(n=v,o=w,c=0):(y=t.radius/g.sqrt(y),r<0?(n=p*y,o=-w,c=u*y):(n=p*y,o=w,c=u*y)),m=l[0]*n+l[1]*o+l[2]*c+t.position.x,r=l[3]*n+l[4]*o+l[5]*c+t.position.y,x=l[6]*n+l[7]*o+l[8]*c+t.position.z,a.set(m,r,x)},detectCollision:function(t,s,h){var e,a;this.flip?(e=s,a=t):(e=t,a=s);var n=new M,o=new M,c=new M;if(this.getSep(e,a,n,o,c)){var l=e.position.x,m=e.position.y,r=e.position.z,x=a.position.x,p=a.position.y,u=a.position.z,y=e.halfWidth,v=e.halfHeight,w=e.halfDepth,C=a.halfHeight,b=a.radius,j=e.dimentions,T=j[0],B=j[1],R=j[2],O=j[3],G=j[4],V=j[5],D=j[6],U=j[7],P=j[8],E=j[9],_=j[10],li=j[11],Ki=j[12],Zi=j[13],Ri=j[14],N=j[15],zi=j[16],f=j[17],d=a.normalDirection.x,A=a.normalDirection.y,z=a.normalDirection.z,k=a.halfDirection.x,ci=a.halfDirection.y,pi=a.halfDirection.z,Z=n.x,X=n.y,S=n.z,q=Z*T+X*B+S*R,Q=Z*O+X*G+S*V,Ot=Z*D+X*U+S*P,Xi=Z*d+X*A+S*z,lt=q>0,Ui=Q>0,_i=Ot>0,ei=Xi>0;lt||(q=-q),Ui||(Q=-Q),_i||(Ot=-Ot),ei||(Xi=-Xi);var K,L,F,ii,Hi,wi,mi,xi,fi,Y,J,W,Mi,bi,vi,Oi,Ti,yi,ai,di,it,gi,hi,ti,$,si,Ni,ki,Si,Fi,qi,Ji,Wi,zs,ut,kt,wt,Ii,At,Dt,Et,Ci,Li,tt,Pi,St,Vt,Lt,Pt,Tt,jt,at,nt,yt=0;if(Xi>.999?yt=q>.999?q>Xi?1:4:Q>.999?Q>Xi?2:4:Ot>.999&&Ot>Xi?3:4:q>.999?yt=1:Q>.999?yt=2:Ot>.999&&(yt=3),yt==0)h.addPoint(o.x,o.y,o.z,Z,X,S,c.x,this.flip);else if(yt==4){var Jt,Wt,Yt,Ht,Kt,Zt,Xt,$t,Gt,Qt,is,ts;ei?(ii=x-k,Hi=p-ci,wi=u-pi,Z=-d,X=-A,S=-z):(ii=x+k,Hi=p+ci,wi=u+pi,Z=d,X=A,S=z),yt=0,(Li=T*Z+B*X+R*S)<(di=1)&&(di=Li,yt=0),-Li<di&&(di=-Li,yt=1),(Li=O*Z+G*X+V*S)<di&&(di=Li,yt=2),-Li<di&&(di=-Li,yt=3),(Li=D*Z+U*X+P*S)<di&&(di=Li,yt=4),-Li<di&&(di=-Li,yt=5);var H=e.elements;switch(yt){case 0:Jt=H[0],Wt=H[1],Yt=H[2],Ht=H[6],Kt=H[7],Zt=H[8],Xt=H[9],$t=H[10],Gt=H[11],Qt=H[3],is=H[4],ts=H[5];break;case 1:Jt=H[15],Wt=H[16],Yt=H[17],Ht=H[21],Kt=H[22],Zt=H[23],Xt=H[18],$t=H[19],Gt=H[20],Qt=H[12],is=H[13],ts=H[14];break;case 2:Jt=H[12],Wt=H[13],Yt=H[14],Ht=H[0],Kt=H[1],Zt=H[2],Xt=H[3],$t=H[4],Gt=H[5],Qt=H[15],is=H[16],ts=H[17];break;case 3:Jt=H[21],Wt=H[22],Yt=H[23],Ht=H[9],Kt=H[10],Zt=H[11],Xt=H[6],$t=H[7],Gt=H[8],Qt=H[18],is=H[19],ts=H[20];break;case 4:Jt=H[12],Wt=H[13],Yt=H[14],Ht=H[18],Kt=H[19],Zt=H[20],Xt=H[6],$t=H[7],Gt=H[8],Qt=H[0],is=H[1],ts=H[2];break;case 5:Jt=H[3],Wt=H[4],Yt=H[5],Ht=H[9],Kt=H[10],Zt=H[11],Xt=H[21],$t=H[22],Gt=H[23],Qt=H[15],is=H[16],ts=H[17]}(ai=Z*(Jt-ii)+X*(Wt-Hi)+S*(Yt-wi))<=0&&h.addPoint(Jt,Wt,Yt,-Z,-X,-S,ai,this.flip),(ai=Z*(Ht-ii)+X*(Kt-Hi)+S*(Zt-wi))<=0&&h.addPoint(Ht,Kt,Zt,-Z,-X,-S,ai,this.flip),(ai=Z*(Xt-ii)+X*($t-Hi)+S*(Gt-wi))<=0&&h.addPoint(Xt,$t,Gt,-Z,-X,-S,ai,this.flip),(ai=Z*(Qt-ii)+X*(is-Hi)+S*(ts-wi))<=0&&h.addPoint(Qt,is,ts,-Z,-X,-S,ai,this.flip)}else{switch(yt){case 1:lt?(K=l+E,L=m+_,F=r+li,Z=T,X=B,S=R):(K=l-E,L=m-_,F=r-li,Z=-T,X=-B,S=-R),St=O,Vt=G,Lt=V,at=v,Pt=D,Tt=U,jt=P,nt=w;break;case 2:Ui?(K=l+Ki,L=m+Zi,F=r+Ri,Z=O,X=G,S=V):(K=l-Ki,L=m-Zi,F=r-Ri,Z=-O,X=-G,S=-V),St=T,Vt=B,Lt=R,at=y,Pt=D,Tt=U,jt=P,nt=w;break;case 3:_i?(K=l+N,L=m+zi,F=r+f,Z=D,X=U,S=P):(K=l-N,L=m-zi,F=r-f,Z=-D,X=-U,S=-P),St=T,Vt=B,Lt=R,at=y,Pt=O,Tt=G,jt=V,nt=v}if(ii=x+(it=(di=Z*d+X*A+S*z)<0?C:-C)*d,Hi=p+it*A,wi=u+it*z,Xi>=.999999?(gi=-X,hi=S,ti=Z):(gi=Z,hi=X,ti=S),si=(it=gi*d+hi*A+ti*z)*d-gi,Ni=it*A-hi,ki=it*z-ti,(it=g.sqrt(si*si+Ni*Ni+ki*ki))==0)return;if(gi=ii+(si*=it=b/it),hi=Hi+(Ni*=it),ti=wi+(ki*=it),di<-.96||di>.96)mi=d*d*1.5-.5,xi=d*A*1.5-.866025403*z,fi=d*z*1.5+.866025403*A,Y=A*d*1.5+.866025403*z,J=A*A*1.5-.5,W=A*z*1.5-.866025403*d,Mi=z*d*1.5-.866025403*A,bi=z*A*1.5+.866025403*d,vi=z*z*1.5-.5,(Ii=St*(gi=(Oi=gi)-(ai=Z*(Oi-K)+X*((Ti=hi)-L)+S*((yi=ti)-F))*Z-K)+Vt*(hi=Ti-ai*X-L)+Lt*(ti=yi-ai*S-F))<-at?Ii=-at:Ii>at&&(Ii=at),(Ci=Pt*gi+Tt*hi+jt*ti)<-nt?Ci=-nt:Ci>nt&&(Ci=nt),Oi=K+(gi=Ii*St+Ci*Pt),Ti=L+(hi=Ii*Vt+Ci*Tt),yi=F+(ti=Ii*Lt+Ci*jt),h.addPoint(Oi,Ti,yi,Z,X,S,ai,this.flip),Ti=si*Y+Ni*J+ki*W,yi=si*Mi+Ni*bi+ki*vi,(ai=Z*((Oi=(si=Oi=si*mi+Ni*xi+ki*fi)+ii)-K)+X*((Ti=(Ni=Ti)+Hi)-L)+S*((yi=(ki=yi)+wi)-F))<=0&&((Ii=St*(gi=Oi-ai*Z-K)+Vt*(hi=Ti-ai*X-L)+Lt*(ti=yi-ai*S-F))<-at?Ii=-at:Ii>at&&(Ii=at),(Ci=Pt*gi+Tt*hi+jt*ti)<-nt?Ci=-nt:Ci>nt&&(Ci=nt),Oi=K+(gi=Ii*St+Ci*Pt),Ti=L+(hi=Ii*Vt+Ci*Tt),yi=F+(ti=Ii*Lt+Ci*jt),h.addPoint(Oi,Ti,yi,Z,X,S,ai,this.flip)),Ti=si*Y+Ni*J+ki*W,yi=si*Mi+Ni*bi+ki*vi,(ai=Z*((Oi=(si=Oi=si*mi+Ni*xi+ki*fi)+ii)-K)+X*((Ti=(Ni=Ti)+Hi)-L)+S*((yi=(ki=yi)+wi)-F))<=0&&((Ii=St*(gi=Oi-ai*Z-K)+Vt*(hi=Ti-ai*X-L)+Lt*(ti=yi-ai*S-F))<-at?Ii=-at:Ii>at&&(Ii=at),(Ci=Pt*gi+Tt*hi+jt*ti)<-nt?Ci=-nt:Ci>nt&&(Ci=nt),Oi=K+(gi=Ii*St+Ci*Pt),Ti=L+(hi=Ii*Vt+Ci*Tt),yi=F+(ti=Ii*Lt+Ci*jt),h.addPoint(Oi,Ti,yi,Z,X,S,ai,this.flip));else{if(ut=gi,di>0?(At=gi+2*k,Dt=hi+2*ci,Et=ti+2*pi):(At=gi-2*k,Dt=hi-2*ci,Et=ti-2*pi),gi=(At-=(Ci=Z*(At-K)+X*(Dt-L)+S*(Et-F))*Z)-(ut-=(Ii=Z*(ut-K)+X*((kt=hi)-L)+S*((wt=ti)-F))*Z),hi=(Dt-=Ci*X)-(kt-=Ii*X),ti=(Et-=Ci*S)-(wt-=Ii*S),$=Ci-Ii,tt=(Q=(Ji=At-K)*St+(Wi=Dt-L)*Vt+(zs=Et-F)*Lt)-at,(Li=(q=(Si=ut-K)*St+(Fi=kt-L)*Vt+(qi=wt-F)*Lt)-at)>0){if(tt>0)return;q=(Si=(ut+=gi*(Pi=Li/(Li-tt)))-K)*St+(Fi=(kt+=hi*Pi)-L)*Vt+(qi=(wt+=ti*Pi)-F)*Lt,gi=At-ut,hi=Dt-kt,ti=Et-wt,$=Ci-(Ii+=$*Pi)}else tt>0&&(Q=(Ji=(At=ut+gi*(Pi=Li/(Li-tt)))-K)*St+(Wi=(Dt=kt+hi*Pi)-L)*Vt+(zs=(Et=wt+ti*Pi)-F)*Lt,gi=At-ut,hi=Dt-kt,ti=Et-wt,$=(Ci=Ii+$*Pi)-Ii);if(tt=Q+at,(Li=q+at)<0){if(tt<0)return;Si=(ut+=gi*(Pi=Li/(Li-tt)))-K,Fi=(kt+=hi*Pi)-L,qi=(wt+=ti*Pi)-F,gi=At-ut,hi=Dt-kt,ti=Et-wt,$=Ci-(Ii+=$*Pi)}else tt<0&&(Ji=(At=ut+gi*(Pi=Li/(Li-tt)))-K,Wi=(Dt=kt+hi*Pi)-L,zs=(Et=wt+ti*Pi)-F,gi=At-ut,hi=Dt-kt,ti=Et-wt,$=(Ci=Ii+$*Pi)-Ii);if(tt=(Q=Ji*Pt+Wi*Tt+zs*jt)-nt,(Li=(q=Si*Pt+Fi*Tt+qi*jt)-nt)>0){if(tt>0)return;q=(Si=(ut+=gi*(Pi=Li/(Li-tt)))-K)*Pt+(Fi=(kt+=hi*Pi)-L)*Tt+(qi=(wt+=ti*Pi)-F)*jt,gi=At-ut,hi=Dt-kt,ti=Et-wt,$=Ci-(Ii+=$*Pi)}else tt>0&&(Q=(Ji=(At=ut+gi*(Pi=Li/(Li-tt)))-K)*Pt+(Wi=(Dt=kt+hi*Pi)-L)*Tt+(zs=(Et=wt+ti*Pi)-F)*jt,gi=At-ut,hi=Dt-kt,ti=Et-wt,$=(Ci=Ii+$*Pi)-Ii);if(tt=Q+nt,(Li=q+nt)<0){if(tt<0)return;ut+=gi*(Pi=Li/(Li-tt)),kt+=hi*Pi,wt+=ti*Pi,Ii+=$*Pi}else tt<0&&(At=ut+gi*(Pi=Li/(Li-tt)),Dt=kt+hi*Pi,Et=wt+ti*Pi,Ci=Ii+$*Pi);Ii<0&&h.addPoint(ut,kt,wt,Z,X,S,Ii,this.flip),Ci<0&&h.addPoint(At,Dt,Et,Z,X,S,Ci,this.flip)}}}}}),Vh.prototype=Object.assign(Object.create(qt.prototype),{constructor:Vh,getSep:function(t,s,h,e,a){var n,o,c,l,m,r,x,p,u,y,v,w,C,b=new M,j=t.position.x,T=t.position.y,B=t.position.z,R=s.position.x,O=s.position.y,G=s.position.z,V=R-j,D=O-T,U=G-B;V*V+D*D+U*U==0&&(D=.001);var P=-V,E=-D,_=-U;this.supportPoint(t,-P,-E,-_,b);var li=b.x,Ki=b.y,Zi=b.z;this.supportPoint(s,P,E,_,b);var Ri=b.x,N=b.y,zi=b.z,f=Ri-li,d=N-Ki,A=zi-Zi;if(f*P+d*E+A*_<=0)return!1;if((P=d*U-A*D)*P+(E=A*V-f*U)*E+(_=f*D-d*V)*_==0)return h.set(f-V,d-D,A-U).normalize(),e.set(.5*(li+Ri),.5*(Ki+N),.5*(Zi+zi)),!0;this.supportPoint(t,-P,-E,-_,b);var z=b.x,k=b.y,ci=b.z;this.supportPoint(s,P,E,_,b);var pi=b.x,Z=b.y,X=b.z,S=pi-z,q=Z-k,Q=X-ci;if(S*P+q*E+Q*_<=0)return!1;(P=(o=d-D)*(r=Q-U)-(c=A-U)*(m=q-D))*V+(E=c*(l=S-V)-(n=f-V)*r)*D+(_=n*m-o*l)*U>0&&(n=f,o=d,c=A,f=S,d=q,A=Q,S=n,q=o,Q=c,n=li,o=Ki,c=Zi,li=z,Ki=k,Zi=ci,z=n,k=o,ci=c,n=Ri,o=N,c=zi,Ri=pi,N=Z,zi=X,pi=n,Z=o,X=c,P=-P,E=-E,_=-_);for(var Ot=0;;){if(++Ot>100)return!1;this.supportPoint(t,-P,-E,-_,b);var Xi=b.x,lt=b.y,Ui=b.z;this.supportPoint(s,P,E,_,b);var _i=b.x,ei=b.y,K=b.z,L=_i-Xi,F=ei-lt,ii=K-Ui;if(L*P+F*E+ii*_<=0)return!1;if((d*ii-A*F)*V+(A*L-f*ii)*D+(f*F-d*L)*U<0)S=L,q=F,Q=ii,z=Xi,k=lt,ci=Ui,pi=_i,Z=ei,X=K,P=(o=d-D)*(r=ii-U)-(c=A-U)*(m=F-D),E=c*(l=L-V)-(n=f-V)*r,_=n*m-o*l;else if((F*Q-ii*q)*V+(ii*S-L*Q)*D+(L*q-F*S)*U<0)f=L,d=F,A=ii,li=Xi,Ki=lt,Zi=Ui,Ri=_i,N=ei,zi=K,P=(o=F-D)*(r=Q-U)-(c=ii-U)*(m=q-D),E=c*(l=S-V)-(n=L-V)*r,_=n*m-o*l;else for(var Hi=!1;;){if(P=(o=q-d)*(r=ii-A)-(c=Q-A)*(m=F-d),E=c*(l=L-f)-(n=S-f)*r,_=n*m-o*l,(P*=x=1/g.sqrt(P*P+E*E+_*_))*f+(E*=x)*d+(_*=x)*A>=0&&!Hi){var wi=(d*Q-A*q)*L+(A*S-f*Q)*F+(f*q-d*S)*ii,mi=(F*Q-ii*q)*V+(ii*S-L*Q)*D+(L*q-F*S)*U,xi=(D*A-U*d)*L+(U*f-V*A)*F+(V*d-D*f)*ii,fi=(q*A-Q*d)*V+(Q*f-S*A)*D+(S*d-q*f)*U,Y=wi+mi+xi+fi;Y<=0&&(wi=0,Y=(mi=(q*ii-Q*F)*P+(Q*L-S*ii)*E+(S*F-q*L)*_)+(xi=(F*Q-ii*q)*P+(ii*S-L*Q)*E+(L*q-F*S)*_)+(fi=(d*Q-A*q)*P+(A*S-f*Q)*E+(f*q-d*S)*_));var J=1/Y;p=(j*wi+li*mi+z*xi+Xi*fi)*J,u=(T*wi+Ki*mi+k*xi+lt*fi)*J,y=(B*wi+Zi*mi+ci*xi+Ui*fi)*J,v=(R*wi+Ri*mi+pi*xi+_i*fi)*J,w=(O*wi+N*mi+Z*xi+ei*fi)*J,C=(G*wi+zi*mi+X*xi+K*fi)*J,Hi=!0}this.supportPoint(t,-P,-E,-_,b);var W=b.x,Mi=b.y,bi=b.z;this.supportPoint(s,P,E,_,b);var vi=b.x,Oi=b.y,Ti=b.z,yi=vi-W,ai=Oi-Mi,di=Ti-bi,it=-(yi*P+ai*E+di*_);if((yi-L)*P+(ai-F)*E+(di-ii)*_<=.01||it>=0)return!!Hi&&(h.set(-P,-E,-_),e.set(.5*(p+v),.5*(u+w),.5*(y+C)),a.x=it,!0);(ai*A-di*d)*V+(di*f-yi*A)*D+(yi*d-ai*f)*U<0?(ai*Q-di*q)*V+(di*S-yi*Q)*D+(yi*q-ai*S)*U<0?(f=yi,d=ai,A=di,li=W,Ki=Mi,Zi=bi,Ri=vi,N=Oi,zi=Ti):(L=yi,F=ai,ii=di,Xi=W,lt=Mi,Ui=bi,_i=vi,ei=Oi,K=Ti):(ai*ii-di*F)*V+(di*L-yi*ii)*D+(yi*F-ai*L)*U<0?(S=yi,q=ai,Q=di,z=W,k=Mi,ci=bi,pi=vi,Z=Oi,X=Ti):(f=yi,d=ai,A=di,li=W,Ki=Mi,Zi=bi,Ri=vi,N=Oi,zi=Ti)}}},supportPoint:function(t,s,h,e,a){var n,o,c,l=t.rotation.elements,m=l[0]*s+l[3]*h+l[6]*e,r=l[1]*s+l[4]*h+l[7]*e,x=l[2]*s+l[5]*h+l[8]*e,p=m,u=x,y=p*p+u*u,v=t.radius,w=t.halfHeight;y==0?r<0?(n=v,o=-w,c=0):(n=v,o=w,c=0):(y=t.radius/g.sqrt(y),r<0?(n=p*y,o=-w,c=u*y):(n=p*y,o=w,c=u*y)),m=l[0]*n+l[1]*o+l[2]*c+t.position.x,r=l[3]*n+l[4]*o+l[5]*c+t.position.y,x=l[6]*n+l[7]*o+l[8]*c+t.position.z,a.set(m,r,x)},detectCollision:function(t,s,h){var e,a;t.id<s.id?(e=t,a=s):(e=s,a=t);var n,o,c,l,m,r,x,p,u,y,v,w,C,b,j,T,B,R,O,G,V,D=e.position,U=a.position,P=D.x,E=D.y,_=D.z,li=U.x,Ki=U.y,Zi=U.z,Ri=e.halfHeight,N=a.halfHeight,zi=e.normalDirection,f=a.normalDirection,d=e.halfDirection,A=a.halfDirection,z=e.radius,k=a.radius,ci=zi.x,pi=zi.y,Z=zi.z,X=f.x,S=f.y,q=f.z,Q=d.x,Ot=d.y,Xi=d.z,lt=A.x,Ui=A.y,_i=A.z,ei=P-li,K=E-Ki,L=_-Zi,F=new M,ii=new M,Hi=new M;if(this.getSep(e,a,F,ii,Hi)){var wi=F.x*ci+F.y*pi+F.z*Z,mi=F.x*X+F.y*S+F.z*q,xi=wi>0,fi=mi>0;xi||(wi=-wi),fi||(mi=-mi);var Y,J,W,Mi=0;(wi>.999||mi>.999)&&(Mi=wi>mi?1:2);var bi,vi,Oi,Ti,yi,ai,di,it,gi,hi,ti,$,si,Ni,ki,Si,Fi=Hi.x;switch(Y=F.x,J=F.y,W=F.z,Mi){case 0:h.addPoint(ii.x,ii.y,ii.z,Y,J,W,Fi,!1);break;case 1:if(xi?(o=P+Q,c=E+Ot,l=_+Xi,Y=ci,J=pi,W=Z):(o=P-Q,c=E-Ot,l=_-Xi,Y=-ci,J=-pi,W=-Z),m=li+(n=(O=Y*X+J*S+W*q)<0?N:-N)*X,r=Ki+n*S,x=Zi+n*q,mi>=.999999?(p=-J,u=W,y=Y):(p=Y,u=J,y=W),ei=(n=p*X+u*S+y*q)*X-p,K=n*S-u,L=n*q-y,(n=g.sqrt(ei*ei+K*K+L*L))==0)break;if(p=m+(ei*=n=k/n),u=r+(K*=n),y=x+(L*=n),O<-.96||O>.96)bi=X*X*1.5-.5,vi=X*S*1.5-.866025403*q,Oi=X*q*1.5+.866025403*S,Ti=S*X*1.5+.866025403*q,yi=S*S*1.5-.5,ai=S*q*1.5-.866025403*X,di=q*X*1.5-.866025403*S,it=q*S*1.5+.866025403*X,gi=q*q*1.5-.5,(n=(p=(hi=p)-(si=Y*(hi-o)+J*((ti=u)-c)+W*(($=y)-l))*Y-o)*p+(u=ti-si*J-c)*u+(y=$-si*W-l)*y)>z*z&&(p*=n=z/g.sqrt(n),u*=n,y*=n),hi=o+p,ti=c+u,$=l+y,h.addPoint(hi,ti,$,Y,J,W,si,!1),ti=ei*Ti+K*yi+L*ai,$=ei*di+K*it+L*gi,(si=Y*((hi=(ei=hi=ei*bi+K*vi+L*Oi)+m)-o)+J*((ti=(K=ti)+r)-c)+W*(($=(L=$)+x)-l))<=0&&((n=(p=hi-si*Y-o)*p+(u=ti-si*J-c)*u+(y=$-si*W-l)*y)>z*z&&(p*=n=z/g.sqrt(n),u*=n,y*=n),hi=o+p,ti=c+u,$=l+y,h.addPoint(hi,ti,$,Y,J,W,si,!1)),ti=ei*Ti+K*yi+L*ai,$=ei*di+K*it+L*gi,(si=Y*((hi=(ei=hi=ei*bi+K*vi+L*Oi)+m)-o)+J*((ti=(K=ti)+r)-c)+W*(($=(L=$)+x)-l))<=0&&((n=(p=hi-si*Y-o)*p+(u=ti-si*J-c)*u+(y=$-si*W-l)*y)>z*z&&(p*=n=z/g.sqrt(n),u*=n,y*=n),hi=o+p,ti=c+u,$=l+y,h.addPoint(hi,ti,$,Y,J,W,si,!1));else{if(v=p,O>0?(b=p+X*N*2,j=u+S*N*2,T=y+q*N*2):(b=p-X*N*2,j=u-S*N*2,T=y-q*N*2),(Si=(Ni=(ei=o-(v-=(B=Y*(v-o)+J*((w=u)-c)+W*((C=y)-l))*Y))*(p=(b-=(R=Y*(b-o)+J*(j-c)+W*(T-l))*Y)-v)+(K=c-(w-=B*J))*(u=(j-=R*J)-w)+(L=l-(C-=B*W))*(y=(T-=R*W)-C))*Ni-(ki=p*p+u*u+y*y)*(ei*ei+K*K+L*L-z*z))<0)break;(V=(Ni-(Si=g.sqrt(Si)))/ki)<(G=(Ni+Si)/ki)&&(n=G,G=V,V=n),V>1&&(V=1),G<0&&(G=0),p=v+(b-v)*G,u=w+(j-w)*G,y=C+(T-C)*G,b=v+(b-v)*V,j=w+(j-w)*V,T=C+(T-C)*V,v=p,w=u,C=y,n=B+(R-B)*G,R=B+(R-B)*V,(B=n)<0&&h.addPoint(v,w,C,Y,J,W,si,!1),R<0&&h.addPoint(b,j,T,Y,J,W,si,!1)}break;case 2:if(fi?(m=li-lt,r=Ki-Ui,x=Zi-_i,Y=-X,J=-S,W=-q):(m=li+lt,r=Ki+Ui,x=Zi+_i,Y=X,J=S,W=q),o=P+(n=(O=Y*ci+J*pi+W*Z)<0?Ri:-Ri)*ci,c=E+n*pi,l=_+n*Z,wi>=.999999?(p=-J,u=W,y=Y):(p=Y,u=J,y=W),ei=(n=p*ci+u*pi+y*Z)*ci-p,K=n*pi-u,L=n*Z-y,(n=g.sqrt(ei*ei+K*K+L*L))==0)break;if(p=o+(ei*=n=z/n),u=c+(K*=n),y=l+(L*=n),O<-.96||O>.96)bi=ci*ci*1.5-.5,vi=ci*pi*1.5-.866025403*Z,Oi=ci*Z*1.5+.866025403*pi,Ti=pi*ci*1.5+.866025403*Z,yi=pi*pi*1.5-.5,ai=pi*Z*1.5-.866025403*ci,di=Z*ci*1.5-.866025403*pi,it=Z*pi*1.5+.866025403*ci,gi=Z*Z*1.5-.5,(n=(p=(hi=p)-(si=Y*(hi-m)+J*((ti=u)-r)+W*(($=y)-x))*Y-m)*p+(u=ti-si*J-r)*u+(y=$-si*W-x)*y)>k*k&&(p*=n=k/g.sqrt(n),u*=n,y*=n),hi=m+p,ti=r+u,$=x+y,h.addPoint(hi,ti,$,-Y,-J,-W,si,!1),ti=ei*Ti+K*yi+L*ai,$=ei*di+K*it+L*gi,(si=Y*((hi=(ei=hi=ei*bi+K*vi+L*Oi)+o)-m)+J*((ti=(K=ti)+c)-r)+W*(($=(L=$)+l)-x))<=0&&((n=(p=hi-si*Y-m)*p+(u=ti-si*J-r)*u+(y=$-si*W-x)*y)>k*k&&(p*=n=k/g.sqrt(n),u*=n,y*=n),hi=m+p,ti=r+u,$=x+y,h.addPoint(hi,ti,$,-Y,-J,-W,si,!1)),ti=ei*Ti+K*yi+L*ai,$=ei*di+K*it+L*gi,(si=Y*((hi=(ei=hi=ei*bi+K*vi+L*Oi)+o)-m)+J*((ti=(K=ti)+c)-r)+W*(($=(L=$)+l)-x))<=0&&((n=(p=hi-si*Y-m)*p+(u=ti-si*J-r)*u+(y=$-si*W-x)*y)>k*k&&(p*=n=k/g.sqrt(n),u*=n,y*=n),hi=m+p,ti=r+u,$=x+y,h.addPoint(hi,ti,$,-Y,-J,-W,si,!1));else{if(v=p,O>0?(b=p+ci*Ri*2,j=u+pi*Ri*2,T=y+Z*Ri*2):(b=p-ci*Ri*2,j=u-pi*Ri*2,T=y-Z*Ri*2),(Si=(Ni=(ei=m-(v-=(B=Y*(v-m)+J*((w=u)-r)+W*((C=y)-x))*Y))*(p=(b-=(R=Y*(b-m)+J*(j-r)+W*(T-x))*Y)-v)+(K=r-(w-=B*J))*(u=(j-=R*J)-w)+(L=x-(C-=B*W))*(y=(T-=R*W)-C))*Ni-(ki=p*p+u*u+y*y)*(ei*ei+K*K+L*L-k*k))<0)break;(V=(Ni-(Si=g.sqrt(Si)))/ki)<(G=(Ni+Si)/ki)&&(n=G,G=V,V=n),V>1&&(V=1),G<0&&(G=0),p=v+(b-v)*G,u=w+(j-w)*G,y=C+(T-C)*G,b=v+(b-v)*V,j=w+(j-w)*V,T=C+(T-C)*V,v=p,w=u,C=y,n=B+(R-B)*G,R=B+(R-B)*V,(B=n)<0&&h.addPoint(v,w,C,-Y,-J,-W,B,!1),R<0&&h.addPoint(b,j,T,-Y,-J,-W,R,!1)}}}}}),ph.prototype=Object.assign(Object.create(qt.prototype),{constructor:ph,detectCollision:function(t,s,h){var e,a;this.flip?(e=s,a=t):(e=t,a=s);var n,o,c,l,m,r=a.dimentions,x=e.position,p=x.x,u=x.y,y=x.z,v=a.position,w=v.x,C=v.y,b=v.z,j=e.radius,T=a.halfWidth,B=a.halfHeight,R=a.halfDepth,O=p-w,G=u-C,V=y-b,D=r[0]*O+r[1]*G+r[2]*V,U=r[3]*O+r[4]*G+r[5]*V,P=r[6]*O+r[7]*G+r[8]*V,E=0;D>T?D=T:D<-T?D=-T:E=1,U>B?U=B:U<-B?U=-B:E|=2,P>R?P=R:P<-R?P=-R:E|=4,E==7?(V=P<0?R+P:R-P,(O=D<0?T+D:T-D)<(G=U<0?B+U:B-U)?O<V?(l=O-T,D<0?(D=-T,O=r[0],G=r[1],V=r[2]):(D=T,O=-r[0],G=-r[1],V=-r[2])):(l=V-R,P<0?(P=-R,O=r[6],G=r[7],V=r[8]):(P=R,O=-r[6],G=-r[7],V=-r[8])):G<V?(l=G-B,U<0?(U=-B,O=r[3],G=r[4],V=r[5]):(U=B,O=-r[3],G=-r[4],V=-r[5])):(l=V-R,P<0?(P=-R,O=r[6],G=r[7],V=r[8]):(P=R,O=-r[6],G=-r[7],V=-r[8])),n=w+D*r[0]+U*r[3]+P*r[6],o=C+D*r[1]+U*r[4]+P*r[7],c=b+D*r[2]+U*r[5]+P*r[8],h.addPoint(p+j*O,u+j*G,y+j*V,O,G,V,l-j,this.flip)):(n=w+D*r[0]+U*r[3]+P*r[6],o=C+D*r[1]+U*r[4]+P*r[7],c=b+D*r[2]+U*r[5]+P*r[8],(l=(O=n-x.x)*O+(G=o-x.y)*G+(V=c-x.z)*V)>0&&l<j*j&&(O*=m=1/(l=g.sqrt(l)),G*=m,V*=m,h.addPoint(p+j*O,u+j*G,y+j*V,O,G,V,l-j,this.flip)))}}),uh.prototype=Object.assign(Object.create(qt.prototype),{constructor:uh,detectCollision:function(t,s,h){var e,a;this.flip?(e=s,a=t):(e=t,a=s);var n=e.position,o=n.x,c=n.y,l=n.z,m=a.position,r=m.x,x=m.y,p=m.z,u=a.normalDirection.x,y=a.normalDirection.y,v=a.normalDirection.z,w=e.radius,C=a.radius,b=w+C,j=a.halfHeight,T=o-r,B=c-x,R=l-p,O=T*u+B*y+R*v;if(!(O<-j-w||O>j+w)){var G,V=r+O*u,D=x+O*y,U=p+O*v,P=o-V,E=c-D,_=l-U,li=P*P+E*E+_*_;li>b*b||(li>C*C&&(P*=li=C/g.sqrt(li),E*=li,_*=li),O<-j?O=-j:O>j&&(O=j),(li=(T=(V=r+O*u+P)-o)*T+(B=(D=x+O*y+E)-c)*B+(R=(U=p+O*v+_)-l)*R)>0&&li<w*w&&(T*=G=1/(li=g.sqrt(li)),B*=G,R*=G,h.addPoint(o+T*w,c+B*w,l+R*w,T,B,R,li-w,this.flip)))}}}),Lh.prototype=Object.assign(Object.create(qt.prototype),{constructor:Lh,detectCollision:function(t,s,h){var e=t,a=s,n=e.position,o=a.position,c=o.x-n.x,l=o.y-n.y,m=o.z-n.z,r=c*c+l*l+m*m,x=e.radius,p=x+a.radius;if(r>0&&r<p*p){var u=1/(r=g.sqrt(r));c*=u,l*=u,m*=u,h.addPoint(n.x+c*x,n.y+l*x,n.z+m*x,c,l,m,r-p,!1)}}}),yh.prototype=Object.assign(Object.create(qt.prototype),{constructor:yh,detectCollision:function(t,s,h){var e,a=this.n,n=this.p,o=this.flip?s:t,c=this.flip?t:s,l=o.radius;a.sub(o.position,c.position),a.x*=c.normal.x,a.y*=c.normal.y,a.z*=c.normal.z,(e=a.lengthSq())>0&&e<l*l&&(e=g.sqrt(e),a.copy(c.normal).negate(),n.copy(o.position).addScaledVector(a,l),h.addPointVec(n,a,e-l,this.flip))}}),dh.prototype=Object.assign(Object.create(qt.prototype),{constructor:dh,detectCollision:function(t,s,h){var e,a=this.n,n=this.p,o=this.cc,c=this.flip?s:t,l=this.flip?t:s,m=c.dimentions,r=c.halfWidth,x=c.halfHeight,p=c.halfDepth,u=0;this.dix.set(m[0],m[1],m[2]),this.diy.set(m[3],m[4],m[5]),this.diz.set(m[6],m[7],m[8]),a.sub(c.position,l.position),a.x*=l.normal.x,a.y*=l.normal.y,a.z*=l.normal.z,o.set(g.dotVectors(this.dix,a),g.dotVectors(this.diy,a),g.dotVectors(this.diz,a)),o.x>r?o.x=r:o.x<-r?o.x=-r:u=1,o.y>x?o.y=x:o.y<-x?o.y=-x:u|=2,o.z>p?o.z=p:o.z<-p?o.z=-p:u|=4,u===7&&(a.set(o.x<0?r+o.x:r-o.x,o.y<0?x+o.y:x-o.y,o.z<0?p+o.z:p-o.z),a.x<a.y?a.x<a.z?(e=a.x-r,o.x<0?(o.x=-r,a.copy(this.dix)):(o.x=r,a.subEqual(this.dix))):(e=a.z-p,o.z<0?(o.z=-p,a.copy(this.diz)):(o.z=p,a.subEqual(this.diz))):a.y<a.z?(e=a.y-x,o.y<0?(o.y=-x,a.copy(this.diy)):(o.y=x,a.subEqual(this.diy))):(e=a.z-p,o.z<0?(o.z=-p,a.copy(this.diz)):(o.z=p,a.subEqual(this.diz))),n.copy(l.position).addScaledVector(a,1),h.addPointVec(n,a,e,this.flip))}}),Object.assign(he.prototype,{World:!0,play:function(){if(this.timer===null){var t=this;this.timer=setInterval(function(){t.step()},this.timerate)}},stop:function(){this.timer!==null&&(clearInterval(this.timer),this.timer=null)},setGravity:function(t){this.gravity.fromArray(t)},getInfo:function(){return this.isStat?this.performance.show():""},clear:function(){for(this.stop(),this.preLoop=null,this.postLoop=null,this.randX=65535;this.joints!==null;)this.removeJoint(this.joints);for(;this.contacts!==null;)this.removeContact(this.contacts);for(;this.rigidBodies!==null;)this.removeRigidBody(this.rigidBodies)},addRigidBody:function(t){t.parent&&Rt("World","It is not possible to be added to more than one world one of the rigid body"),t.setParent(this);for(var s=t.shapes;s!==null;s=s.next)this.addShape(s);this.rigidBodies!==null&&((this.rigidBodies.prev=t).next=this.rigidBodies),this.rigidBodies=t,this.numRigidBodies++},removeRigidBody:function(t){var s=t;if(s.parent===this){s.awake();for(var h=s.jointLink;h!=null;){var e=h.joint;h=h.next,this.removeJoint(e)}for(var a=t.shapes;a!==null;a=a.next)this.removeShape(a);var n=s.prev,o=s.next;n!==null&&(n.next=o),o!==null&&(o.prev=n),this.rigidBodies==s&&(this.rigidBodies=o),s.prev=null,s.next=null,s.parent=null,this.numRigidBodies--}},getByName:function(t){for(var s=this.rigidBodies;s!==null;){if(s.name===t)return s;s=s.next}for(var h=this.joints;h!==null;){if(h.name===t)return h;h=h.next}return null},addShape:function(t){t.parent&&t.parent.parent||Rt("World","It is not possible to be added alone to shape world"),t.proxy=this.broadPhase.createProxy(t),t.updateProxy(),this.broadPhase.addProxy(t.proxy)},removeShape:function(t){this.broadPhase.removeProxy(t.proxy),t.proxy=null},addJoint:function(t){t.parent&&Rt("World","It is not possible to be added to more than one world one of the joint"),this.joints!=null&&((this.joints.prev=t).next=this.joints),this.joints=t,t.setParent(this),this.numJoints++,t.awake(),t.attach()},removeJoint:function(t){var s=t,h=s.prev,e=s.next;h!==null&&(h.next=e),e!==null&&(e.prev=h),this.joints==s&&(this.joints=e),s.prev=null,s.next=null,this.numJoints--,s.awake(),s.detach(),s.parent=null},addContact:function(t,s){var h;this.unusedContacts!==null?(h=this.unusedContacts,this.unusedContacts=this.unusedContacts.next):h=new ie,h.attach(t,s),h.detector=this.detectors[t.type][s.type],this.contacts&&((this.contacts.prev=h).next=this.contacts),this.contacts=h,this.numContacts++},removeContact:function(t){var s=t.prev,h=t.next;h&&(h.prev=s),s&&(s.next=h),this.contacts==t&&(this.contacts=h),t.prev=null,t.next=null,t.detach(),t.next=this.unusedContacts,this.unusedContacts=t,this.numContacts--},getContact:function(t,s){var h,e;t=t.constructor===Ds?t.name:t,s=s.constructor===Ds?s.name:s;for(var a=this.contacts;a!==null;){if(h=a.body1.name,e=a.body2.name,h===t&&e===s||e===t&&h===s)return a.touching?a:null;a=a.next}return null},checkContact:function(t,s){for(var h,e,a=this.contacts;a!==null;){if(h=a.body1.name||" ",e=a.body2.name||" ",h==t&&e==s||e==t&&h==s)return!!a.touching;a=a.next}},callSleep:function(t){return!!t.allowSleep&&!(t.linearVelocity.lengthSq()>.04)&&!(t.angularVelocity.lengthSq()>.25)},step:function(){var t=this.isStat;t&&this.performance.setTime(0);for(var s=this.rigidBodies;s!==null;)s.addedToIsland=!1,s.sleeping&&s.testWakeUp(),s=s.next;t&&this.performance.setTime(1),this.broadPhase.detectPairs();for(var h=this.broadPhase.pairs,e=this.broadPhase.numPairs;e--;){var a,n,o,c=h[e];c.shape1.id<c.shape2.id?(a=c.shape1,n=c.shape2):(a=c.shape2,n=c.shape1),o=a.numContacts<n.numContacts?a.contactLink:n.contactLink;for(var l=!1;o;){if((T=o.contact).shape1==a&&T.shape2==n){T.persisting=!0,l=!0;break}o=o.next}l||this.addContact(a,n)}for(t&&this.performance.calcBroadPhase(),this.numContactPoints=0,T=this.contacts;T!==null;)if(T.persisting||!T.shape1.aabb.intersectTest(T.shape2.aabb)){var m=T.body1,r=T.body2;(m.isDynamic&&!m.sleeping||r.isDynamic&&!r.sleeping)&&T.updateManifold(),this.numContactPoints+=T.manifold.numPoints,T.persisting=!1,T.constraint.addedToIsland=!1,T=T.next}else{var x=T.next;this.removeContact(T),T=x}t&&this.performance.calcNarrowPhase();var p,u,y=1/this.timeStep;for(p=this.joints;p!==null;p=p.next)p.addedToIsland=!1;this.islandRigidBodies=[],this.islandConstraints=[],this.islandStack=[],t&&this.performance.setTime(1),this.numIslands=0;for(var v=this.rigidBodies;v!==null;v=v.next)if(!(v.addedToIsland||v.isStatic||v.sleeping))if(v.isLonely())v.isDynamic&&v.linearVelocity.addScaledVector(this.gravity,this.timeStep),this.callSleep(v)?(v.sleepTime+=this.timeStep,v.sleepTime>.5?v.sleep():v.updatePosition(this.timeStep)):(v.sleepTime=0,v.updatePosition(this.timeStep)),this.numIslands++;else{var w=0,C=0,b=1;this.islandStack[0]=v,v.addedToIsland=!0;do if(s=this.islandStack[--b],this.islandStack[b]=null,s.sleeping=!1,this.islandRigidBodies[w++]=s,!s.isStatic){for(var j=s.contactLink;j!==null;j=j.next){var T;!(u=(T=j.contact).constraint).addedToIsland&&T.touching&&(this.islandConstraints[C++]=u,u.addedToIsland=!0,(x=j.body).addedToIsland||(this.islandStack[b++]=x,x.addedToIsland=!0))}for(var B=s.jointLink;B!==null;B=B.next)(u=B.joint).addedToIsland||(this.islandConstraints[C++]=u,u.addedToIsland=!0,!(x=B.body).addedToIsland&&x.isDynamic&&(this.islandStack[b++]=x,x.addedToIsland=!0))}while(b!=0);for(var R=new M().addScaledVector(this.gravity,this.timeStep),O=w;O--;)(s=this.islandRigidBodies[O]).isDynamic&&s.linearVelocity.addEqual(R);if(this.enableRandomizer){for(O=C;O--;)if(O!==0){var G=(this.randX=this.randX*this.randA+this.randB&2147483647)/2147483648*O|0;u=this.islandConstraints[O],this.islandConstraints[O]=this.islandConstraints[G],this.islandConstraints[G]=u}}for(O=C;O--;)this.islandConstraints[O].preSolve(this.timeStep,y);for(var V=this.numIterations;V--;)for(O=C;O--;)this.islandConstraints[O].solve();for(O=C;O--;)this.islandConstraints[O].postSolve(),this.islandConstraints[O]=null;var D=10;for(O=w;O--;)s=this.islandRigidBodies[O],this.callSleep(s)?(s.sleepTime+=this.timeStep,s.sleepTime<D&&(D=s.sleepTime)):(s.sleepTime=0,D=0);if(D>.5)for(O=w;O--;)this.islandRigidBodies[O].sleep(),this.islandRigidBodies[O]=null;else for(O=w;O--;)this.islandRigidBodies[O].updatePosition(this.timeStep),this.islandRigidBodies[O]=null;this.numIslands++}t&&this.performance.calcEnd(),this.postLoop!==null&&this.postLoop()},remove:function(t){},add:function(t){var s=(t=t||{}).type||"box";return s.constructor===String&&(s=[s]),s[0].substring(0,5)==="joint"?this.initJoint(s[0],t):this.initBody(s,t)},initBody:function(t,s){var h=this.invScale,e=s.move||!1,a=s.kinematic||!1,n=s.pos||[0,0,0];n=n.map(function(v){return v*h});var o=s.posShape||[0,0,0];o=o.map(function(v){return v*h});var c=s.rot||[0,0,0];c=c.map(function(v){return v*g.degtorad});var l=s.rotShape;l=c.map(function(v){return v*g.degtorad});var m=s.size===void 0?[1,1,1]:s.size;m.length===1&&(m[1]=m[0]),m.length===2&&(m[2]=m[0]),m=m.map(function(v){return v*h});var r=new Zh;s.density!==void 0&&(r.density=s.density),s.friction!==void 0&&(r.friction=s.friction),s.restitution!==void 0&&(r.restitution=s.restitution),s.belongsTo!==void 0&&(r.belongsTo=s.belongsTo),s.collidesWith!==void 0&&(r.collidesWith=s.collidesWith),s.config!==void 0&&(s.config[0]!==void 0&&(r.density=s.config[0]),s.config[1]!==void 0&&(r.friction=s.config[1]),s.config[2]!==void 0&&(r.restitution=s.config[2]),s.config[3]!==void 0&&(r.belongsTo=s.config[3]),s.config[4]!==void 0&&(r.collidesWith=s.config[4]));for(var x,p,u=new Ds(new M(n[0],n[1],n[2]),new Ut().setFromEuler(c[0],c[1],c[2])),y=0;y<t.length;y++){switch(o[p=3*y]!==void 0&&r.relativePosition.set(o[p],o[p+1],o[p+2]),l[p]!==void 0&&r.relativeRotation.setQuat(new Ut().setFromEuler(l[p],l[p+1],l[p+2])),t[y]){case"sphere":x=new Xs(r,m[p]);break;case"cylinder":x=new $s(r,m[p],m[p+1]);break;case"box":x=new Zs(r,m[p],m[p+1],m[p+2]);break;case"plane":x=new Gs(r)}u.addShape(x)}return s.neverSleep||a?u.allowSleep=!1:u.allowSleep=!0,u.isKinematic=a,e?s.massPos||s.massRot?u.setupMass(1,!1):u.setupMass(1,!0):u.setupMass(2),s.name!==void 0&&(u.name=s.name),this.addRigidBody(u),e&&(s.sleep?u.sleep():u.awake()),u},initJoint:function(t,s){var h,e,a=this.invScale,n=s.axe1||[1,0,0],o=s.axe2||[1,0,0],c=s.pos1||[0,0,0],l=s.pos2||[0,0,0];c=c.map(function(w){return w*a}),l=l.map(function(w){return w*a}),t==="jointDistance"?(h=s.min||0,e=s.max||10,h*=a,e*=a):(h=s.min||57.29578,e=s.max||0,h*=g.degtorad,e*=g.degtorad);var m=s.limit||null,r=s.spring||null,x=s.motor||null,p=new Qh;p.scale=this.scale,p.invScale=this.invScale,p.allowCollision=s.collision||!1,p.localAxis1.set(n[0],n[1],n[2]),p.localAxis2.set(o[0],o[1],o[2]),p.localAnchorPoint1.set(c[0],c[1],c[2]),p.localAnchorPoint2.set(l[0],l[1],l[2]);var u,y=null,v=null;if(s.body1===void 0||s.body2===void 0)return Rt("World","Can't add joint if attach rigidbodys not define !");if(s.body1.constructor===String?y=this.getByName(s.body1):s.body1.constructor===Number?y=this.getByName(s.body1):s.body1.constructor===Ds&&(y=s.body1),s.body2.constructor===String?v=this.getByName(s.body2):s.body2.constructor===Number?v=this.getByName(s.body2):s.body2.constructor===Ds&&(v=s.body2),y===null||v===null)return Rt("World","Can't add joint attach rigidbodys not find !");switch(p.body1=y,p.body2=v,t){case"jointDistance":u=new sh(p,h,e),r!==null&&u.limitMotor.setSpring(r[0],r[1]),x!==null&&u.limitMotor.setMotor(x[0],x[1]);break;case"jointHinge":case"joint":u=new ih(p,h,e),r!==null&&u.limitMotor.setSpring(r[0],r[1]),x!==null&&u.limitMotor.setMotor(x[0],x[1]);break;case"jointPrisme":u=new eh(p,h,e);break;case"jointSlide":u=new ah(p,h,e);break;case"jointBall":u=new th(p);break;case"jointWheel":u=new nh(p),m!==null&&u.rotationalLimitMotor1.setLimit(m[0],m[1]),r!==null&&u.rotationalLimitMotor1.setSpring(r[0],r[1]),x!==null&&u.rotationalLimitMotor1.setMotor(x[0],x[1])}return u.name=s.name||"",this.addJoint(u),u}}),ui.Math=g,ui.Vec3=M,ui.Quat=Ut,ui.Mat33=Bt,ui.Shape=fs,ui.Box=Zs,ui.Sphere=Xs,ui.Cylinder=$s,ui.Plane=Gs,ui.Particle=fh,ui.ShapeConfig=Zh,ui.LimitMotor=Ct,ui.HingeJoint=ih,ui.BallAndSocketJoint=th,ui.DistanceJoint=sh,ui.PrismaticJoint=eh,ui.SliderJoint=ah,ui.WheelJoint=nh,ui.JointConfig=Qh,ui.RigidBody=Ds,ui.World=he,ui.REVISION=Oh,ui.BR_NULL=Ah,ui.BR_BRUTE_FORCE=Dh,ui.BR_SWEEP_AND_PRUNE=Eh,ui.BR_BOUNDING_VOLUME_TREE=Fh,ui.BODY_NULL=Bh,ui.BODY_DYNAMIC=1,ui.BODY_STATIC=2,ui.BODY_KINEMATIC=3,ui.BODY_GHOST=4,ui.SHAPE_NULL=Rh,ui.SHAPE_SPHERE=bs,ui.SHAPE_BOX=vs,ui.SHAPE_CYLINDER=Cs,ui.SHAPE_PLANE=Rs,ui.SHAPE_PARTICLE=Uh,ui.SHAPE_TETRA=6,ui.JOINT_NULL=_h,ui.JOINT_DISTANCE=qh,ui.JOINT_BALL_AND_SOCKET=Jh,ui.JOINT_HINGE=Wh,ui.JOINT_WHEEL=Yh,ui.JOINT_SLIDER=Hh,ui.JOINT_PRISMATIC=Kh,ui.AABB_PROX=.005,ui.printError=Rt,ui.InfoDisplay=xh,Object.defineProperty(ui,"__esModule",{value:!0})})});export default ke();
