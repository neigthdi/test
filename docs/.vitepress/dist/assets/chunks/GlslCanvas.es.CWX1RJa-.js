import{c as F,g as k}from"./commonjsHelpers.Cpj98o6Y.js";var P={exports:{}},x;typeof window<"u"?x=window:typeof F<"u"?x=F:typeof self<"u"?x=self:x={};var W=x,j=V,q=Object.prototype.toString;function V(n){if(!n)return!1;var s=q.call(n);return s==="[object Function]"||typeof n=="function"&&s!=="[object RegExp]"||typeof window<"u"&&(n===window.setTimeout||n===window.alert||n===window.confirm||n===window.prompt)}var w=function(n){return n.replace(/^\s+|\s+$/g,"")},z=function(n){return Object.prototype.toString.call(n)==="[object Array]"},Y=function(n){if(!n)return{};for(var s={},t=w(n).split(`
`),e=0;e<t.length;e++){var i=t[e],r=i.indexOf(":"),u=w(i.slice(0,r)).toLowerCase(),a=w(i.slice(r+1));typeof s[u]>"u"?s[u]=a:z(s[u])?s[u].push(a):s[u]=[s[u],a]}return s},Q=J,$=Object.prototype.hasOwnProperty;function J(){for(var n={},s=0;s<arguments.length;s++){var t=arguments[s];for(var e in t)$.call(t,e)&&(n[e]=t[e])}return n}var C=W,K=j,Z=Y,ee=Q;P.exports=R;P.exports.default=R;R.XMLHttpRequest=C.XMLHttpRequest||se;R.XDomainRequest="withCredentials"in new R.XMLHttpRequest?R.XMLHttpRequest:C.XDomainRequest;te(["get","put","post","patch","head","delete"],function(n){R[n==="delete"?"del":n]=function(s,t,e){return t=I(s,t,e),t.method=n.toUpperCase(),B(t)}});function te(n,s){for(var t=0;t<n.length;t++)s(n[t])}function re(n){for(var s in n)if(n.hasOwnProperty(s))return!1;return!0}function I(n,s,t){var e=n;return K(s)?(t=s,typeof n=="string"&&(e={uri:n})):e=ee(s,{uri:n}),e.callback=t,e}function R(n,s,t){return s=I(n,s,t),B(s)}function B(n){if(typeof n.callback>"u")throw new Error("callback argument missing");var s=!1,t=function(m,y,O){s||(s=!0,n.callback(m,y,O))};function e(){a.readyState===4&&setTimeout(u,0)}function i(){var c=void 0;if(a.response?c=a.response:c=a.responseText||ie(a),v)try{c=JSON.parse(c)}catch{}return c}function r(c){return clearTimeout(T),c instanceof Error||(c=new Error(""+(c||"Unknown XMLHttpRequest Error"))),c.statusCode=0,t(c,p)}function u(){if(!o){var c;clearTimeout(T),n.useXDR&&a.status===void 0?c=200:c=a.status===1223?204:a.status;var m=p,y=null;return c!==0?(m={body:i(),statusCode:c,method:f,headers:{},url:h,rawRequest:a},a.getAllResponseHeaders&&(m.headers=Z(a.getAllResponseHeaders()))):y=new Error("Internal XMLHttpRequest Error"),t(y,m,m.body)}}var a=n.xhr||null;a||(n.cors||n.useXDR?a=new R.XDomainRequest:a=new R.XMLHttpRequest);var l,o,h=a.url=n.uri||n.url,f=a.method=n.method||"GET",g=n.body||n.data,d=a.headers=n.headers||{},E=!!n.sync,v=!1,T,p={body:void 0,headers:{},statusCode:0,method:f,url:h,rawRequest:a};if("json"in n&&n.json!==!1&&(v=!0,d.accept||d.Accept||(d.Accept="application/json"),f!=="GET"&&f!=="HEAD"&&(d["content-type"]||d["Content-Type"]||(d["Content-Type"]="application/json"),g=JSON.stringify(n.json===!0?g:n.json))),a.onreadystatechange=e,a.onload=u,a.onerror=r,a.onprogress=function(){},a.onabort=function(){o=!0},a.ontimeout=r,a.open(f,h,!E,n.username,n.password),E||(a.withCredentials=!!n.withCredentials),!E&&n.timeout>0&&(T=setTimeout(function(){if(!o){o=!0,a.abort("timeout");var c=new Error("XMLHttpRequest timeout");c.code="ETIMEDOUT",r(c)}},n.timeout)),a.setRequestHeader)for(l in d)d.hasOwnProperty(l)&&a.setRequestHeader(l,d[l]);else if(n.headers&&!re(n.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in n&&(a.responseType=n.responseType),"beforeSend"in n&&typeof n.beforeSend=="function"&&n.beforeSend(a),a.send(g||null),a}function ie(n){try{if(n.responseType==="document")return n.responseXML;var s=n.responseXML&&n.responseXML.documentElement.nodeName==="parsererror";if(n.responseType===""&&!s)return n.responseXML}catch{}return null}function se(){}var ne=P.exports;const X=k(ne);var A=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},G=function(n,s){if(!(n instanceof s))throw new TypeError("Cannot call a class as a function")},H=function(){function n(s,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(s,i.key,i)}}return function(s,t,e){return t&&n(s.prototype,t),e&&n(s,e),s}}(),U=function(n){if(Array.isArray(n)){for(var s=0,t=Array(n.length);s<n.length;s++)t[s]=n[s];return t}else return Array.from(n)},_="";function ae(n){return`
<table style="background-color: #8CE; width: 100%; height: 100%;"><tr>
<td align="center">
<div style="display: table-cell; vertical-align: middle;">
<div style="">`+n+`</div>
</div>
</td></tr></table>
`}var ue=`
	This page requires a browser that supports WebGL.<br/>
	<a href="http://get.webgl.org">Click here to upgrade your browser.</a>
`,oe=`
	It does not appear your computer can support WebGL.<br/>
	<a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>
`,le=1,he=2;function fe(n,s,t){function e(u){var a=n.parentNode;a&&(a.innerHTML=ae(u))}function i(u,a){typeof t=="function"?t(u):e(a)}if(!window.WebGLRenderingContext)return i(le,ue),null;var r=de(n,s);return r?r.getExtension("OES_standard_derivatives"):i(he,oe),r}function de(n,s){for(var t=["webgl","experimental-webgl"],e=null,i=0;i<t.length;++i)try{e=n.getContext(t[i],s)}catch{if(e)break}return e}function b(n,s,t,e){var i=n.gl,r=i.createShader(t);i.shaderSource(r,s),i.compileShader(r);var u=i.getShaderParameter(r,i.COMPILE_STATUS);return u?r:(_=i.getShaderInfoLog(r),console.error("*** Error compiling shader "+r+":"+_),n.trigger("error",{shader:r,source:s,type:t,error:_,offset:e||0}),i.deleteShader(r),null)}function D(n,s,t,e){for(var i=n.gl,r=i.createProgram(),u=0;u<s.length;++u)i.attachShader(r,s[u]);i.linkProgram(r);var a=i.getProgramParameter(r,i.LINK_STATUS);return a?r:(_=i.getProgramInfoLog(r),console.log("Error in program linking:"+_),i.deleteProgram(r),null)}function S(n){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=[];for(var e in n){var i=n[e],r=void 0;if(s&&(e=s+"."+e),typeof i=="number")t.push({type:"float",method:"1f",name:e,value:i});else if(Array.isArray(i)){if(typeof i[0]=="number")i.length===1?t.push({type:"float",method:"1f",name:e,value:i}):i.length>=2&&i.length<=4?t.push({type:"vec"+i.length,method:i.length+"fv",name:e,value:i}):i.length>4&&t.push({type:"float[]",method:"1fv",name:e+"[0]",value:i});else if(typeof i[0]=="string")t.push({type:"sampler2D",method:"1i",name:e,value:i});else if(Array.isArray(i[0])&&typeof i[0][0]=="number"){if(i[0].length>=2&&i[0].length<=4)for(r=0;r<i.length;r++)t.push({type:"vec"+i[0].length,method:i[r].length+"fv",name:e+"["+r+"]",value:i[r]})}else if(A(i[0])==="object")for(r=0;r<i.length;r++)t.push.apply(t,U(S(i[r],e+"["+r+"]")))}else typeof i=="boolean"?t.push({type:"bool",method:"1i",name:e,value:i}):typeof i=="string"?t.push({type:"sampler2D",method:"1i",name:e,value:i}):(typeof i>"u"?"undefined":A(i))==="object"&&t.push.apply(t,U(S(i,e)))}return t}function ge(n){var s=n.getBoundingClientRect();return s.top+s.height>0&&s.top<(window.innerHeight||document.documentElement.clientHeight)}function M(n){return(n&n-1)===0}function ce(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function ve(n,s){return n&&s?n.toString()!==s.toString():!1}function Ee(n){var s=new XMLHttpRequest;return s.open("GET",n,!1),s.send(),s.status==200?s.responseText:""}function N(n){var s=new Set;return Object.assign(n,{on:function(e,i){var r={};r[e]=i,s.add(r)},off:function(e,i){if(i){var r={};r[e]=i,s.delete(r)}else{var u=!0,a=!1,l=void 0;try{for(var o=s[Symbol.iterator](),h;!(u=(h=o.next()).done);u=!0){var f=h.value,g=!0,d=!1,E=void 0;try{for(var v=Object.keys(f)[Symbol.iterator](),T;!(g=(T=v.next()).done);g=!0){var p=T.value;if(p===e){s.delete(f);return}}}catch(c){d=!0,E=c}finally{try{!g&&v.return&&v.return()}finally{if(d)throw E}}}}catch(c){a=!0,l=c}finally{try{!u&&o.return&&o.return()}finally{if(a)throw l}}}},listSubscriptions:function(){var e=!0,i=!1,r=void 0;try{for(var u=s[Symbol.iterator](),a;!(e=(a=u.next()).done);e=!0){var l=a.value;console.log(l)}}catch(o){i=!0,r=o}finally{try{!e&&u.return&&u.return()}finally{if(i)throw r}}},subscribe:function(e){s.add(e)},unsubscribe:function(e){s.delete(e)},unsubscribeAll:function(){s.clear()},trigger:function(e){for(var i=arguments.length,r=Array(i>1?i-1:0),u=1;u<i;u++)r[u-1]=arguments[u];var a=!0,l=!1,o=void 0;try{for(var h=s[Symbol.iterator](),f;!(a=(f=h.next()).done);a=!0){var g=f.value;typeof g[e]=="function"&&g[e].apply(g,U(r))}}catch(d){l=!0,o=d}finally{try{!a&&h.return&&h.return()}finally{if(l)throw o}}}})}var L=function(){function n(s,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};G(this,n),N(this),this.gl=s,this.texture=s.createTexture(),this.texture&&(this.valid=!0),this.bind(),this.name=t,this.source=null,this.sourceType=null,this.loading=null,this.setData(1,1,new Uint8Array([0,0,0,255]),{filtering:"linear"}),this.setFiltering(e.filtering),this.load(e)}return H(n,[{key:"destroy",value:function(){this.valid&&(this.gl.deleteTexture(this.texture),this.texture=null,delete this.data,this.data=null,this.valid=!1)}},{key:"bind",value:function(t){this.valid&&(typeof t=="number"&&n.activeUnit!==t&&(this.gl.activeTexture(this.gl.TEXTURE0+t),n.activeUnit=t),n.activeTexture!==this.texture&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),n.activeTexture=this.texture))}},{key:"load",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.loading=null,typeof t.url=="string"?(this.url===void 0||t.url!==this.url)&&this.setUrl(t.url,t):t.element?this.setElement(t.element,t):t.data&&t.width&&t.height&&this.setData(t.width,t.height,t.data,t)}},{key:"setUrl",value:function(t){var e=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.valid)return this.url=t,this.source=this.url,this.sourceType="url",this.loading=new Promise(function(r,u){var a=t.split(".").pop().toLowerCase(),l=a==="ogv"||a==="webm"||a==="mp4",o=void 0;l?(o=document.createElement("video"),o.autoplay=!0,o.muted=!0,setTimeout(function(){o.play()},1),i.filtering="nearest"):o=new Image,o.onload=function(){try{e.setElement(o,i)}catch(h){console.log("Texture '"+e.name+"': failed to load url: '"+e.source+"'",h,i)}r(e)},o.onerror=function(h){console.log("Texture '"+e.name+"': failed to load url: '"+e.source+"'",h,i),r(e)},ce()&&e.source.slice(0,5)==="data:"||(o.crossOrigin="anonymous"),o.src=e.source,l&&e.setElement(o,i)}),this.loading}},{key:"setData",value:function(t,e,i){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.width=t,this.height=e,this.source=i,this.sourceType="data",this.update(r),this.setFiltering(r),this.loading=Promise.resolve(this),this.loading}},{key:"setElement",value:function(t,e){var i=this,r=t;if(typeof t=="string"&&(t=document.querySelector(t)),t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof HTMLVideoElement)this.source=t,this.sourceType="element",t instanceof HTMLVideoElement?(this.width=this.source.videoWidth,this.height=this.source.videoHeight,t.addEventListener("canplaythrough",function(){i.intervalID=setInterval(function(){i.update(e)},15)},!0),t.addEventListener("ended",function(){t.currentTime=0,t.play()},!0)):this.update(e),this.setFiltering(e);else{var u="the 'element' parameter (`element: "+JSON.stringify(r)+"`) must be a CSS ";u+="selector string, or a <canvas>, <image> or <video> object",console.log("Texture '"+this.name+"': "+u,e)}return this.loading=Promise.resolve(this),this.loading}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.valid&&(this.bind(),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,t.UNPACK_FLIP_Y_WEBGL!==!1),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.UNPACK_PREMULTIPLY_ALPHA_WEBGL||!1),this.sourceType==="element"&&(this.source instanceof HTMLCanvasElement||this.source instanceof HTMLVideoElement||this.source instanceof HTMLImageElement&&this.source.complete)?(this.source instanceof HTMLVideoElement?(this.width=this.source.videoWidth,this.height=this.source.videoHeight):(this.width=this.source.width,this.height=this.source.height),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.source)):this.sourceType==="data"&&this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.width,this.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.source),this.trigger("loaded",this))}},{key:"setFiltering",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.valid){this.powerOf2=M(this.width)&&M(this.height),this.filtering=t.filtering||"linear";var e=this.gl;this.bind(),this.powerOf2?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.TEXTURE_WRAP_S||e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.TEXTURE_WRAP_T||e.REPEAT),this.filtering==="mipmap"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.generateMipmap(e.TEXTURE_2D)):this.filtering==="linear"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)):this.filtering==="nearest"&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST))):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.filtering==="mipmap"&&(this.filtering="linear"),this.filtering==="nearest"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)))}}}]),n}();L.getMaxTextureSize=function(n){return n.getParameter(n.MAX_TEXTURE_SIZE)};L.activeUnit=-1;var Te=function(){function n(s,t,e){var i=this;G(this,n),N(this),t=t||{},e=e||{},s.hasAttribute("data-fullscreen")&&(s.getAttribute("data-fullscreen")=="1"||s.getAttribute("data-fullscreen")=="true")?(this.width=window.innerWidth,this.height=window.innerHeight,s.width=window.innerWidth,s.height=window.innerHeight):(this.width=s.clientWidth,this.height=s.clientHeight),this.canvas=s,this.gl=void 0,this.deps={},this.program=void 0,this.textures={},this.buffers={},this.uniforms={},this.vbo={},this.isValid=!1,this.animationFrameRequest=void 0,this.BUFFER_COUNT=0,this.vertexString=t.vertexString||`
#ifdef GL_ES
precision mediump float;
#endif

attribute vec2 a_position;
attribute vec2 a_texcoord;

varying vec2 v_texcoord;

void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);
    v_texcoord = a_texcoord;
}
`,this.fragmentString=t.fragmentString||`
#ifdef GL_ES
precision mediump float;
#endif

varying vec2 v_texcoord;

void main(){
    gl_FragColor = vec4(0.0);
}
`;var r=fe(s,t,e.onError);if(!r)return;if(this.gl=r,this.timeLoad=this.timePrev=performance.now(),this.timeDelta=0,this.forceRender=!0,this.paused=!1,this.realToCSSPixels=window.devicePixelRatio||1,s.style.backgroundColor=t.backgroundColor||"rgba(1,1,1,0)",s.hasAttribute("data-fragment"))this.fragmentString=s.getAttribute("data-fragment");else if(s.hasAttribute("data-fragment-url")){var u=s.getAttribute("data-fragment-url");X.get(u,function(v,T,p){i.load(p,i.vertexString)})}if(s.hasAttribute("data-vertex"))this.vertexString=s.getAttribute("data-vertex");else if(s.hasAttribute("data-vertex-url")){var a=s.getAttribute("data-vertex-url");X.get(a,function(v,T,p){i.load(i.fragmentString,p)})}if(this.load(),!this.program)return;var l=r.getAttribLocation(this.program,"a_texcoord");this.vbo.texCoords=r.createBuffer(),this.gl.bindBuffer(r.ARRAY_BUFFER,this.vbo.texCoords),this.gl.bufferData(r.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),r.STATIC_DRAW),this.gl.enableVertexAttribArray(l),this.gl.vertexAttribPointer(l,2,r.FLOAT,!1,0,0);var o=r.getAttribLocation(this.program,"a_position");if(this.vbo.vertices=r.createBuffer(),this.gl.bindBuffer(r.ARRAY_BUFFER,this.vbo.vertices),this.gl.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),r.STATIC_DRAW),this.gl.enableVertexAttribArray(o),this.gl.vertexAttribPointer(o,2,r.FLOAT,!1,0,0),s.hasAttribute("data-textures")){var h=s.getAttribute("data-textures").split(",");for(var f in h)this.setUniform("u_tex"+f,h[f])}var g={x:0,y:0};document.addEventListener("mousemove",function(v){g.x=v.clientX||v.pageX,g.y=v.clientY||v.pageY},!1);var d=this;function E(){d.nMouse>1&&d.setMouse(g),d.resize()&&(d.forceRender=!0),d.render(),d.animationFrameRequest=window.requestAnimationFrame(E)}return this.setMouse({x:0,y:0}),E(),this}return H(n,[{key:"destroy",value:function(){cancelAnimationFrame(this.animationFrameRequest),this.animated=!1,this.isValid=!1;for(var t in this.textures)t.destroy&&t.destroy();this.textures={};for(var e in this.attribs)this.gl.deleteBuffer(this.attribs[e]);this.gl.useProgram(null),this.gl.deleteProgram(this.program);for(var i in this.buffers){var r=this.buffers[i];this.gl.deleteProgram(r.program)}this.program=null,this.gl=null}},{key:"load",value:function(t,e){var i=this;e&&(this.vertexString=e),t&&(this.fragmentString=t);var r=this.fragmentString.split(/\r?\n/);this.fragmentString=`#define PLATFORM_WEBGL
#line 0
`,r.forEach(function(T,p){var c=T.trim();if(c.startsWith('#include "lygia')){var m=c.substring(15).replace(/\'|\"|\;|\s/g,"");if(m.endsWith("glsl")){if(i.deps[m]===void 0){var y="https://lygia.xyz"+m;i.deps[m]=Ee(y)}i.fragmentString+=i.deps[m]+`
#line `+(p+1)+`
`}}else i.fragmentString+=T+`
`}),this.animated=!1,this.nDelta=(this.fragmentString.match(/u_delta/g)||[]).length,this.nTime=(this.fragmentString.match(/u_time/g)||[]).length,this.nDate=(this.fragmentString.match(/u_date/g)||[]).length,this.nMouse=(this.fragmentString.match(/u_mouse/g)||[]).length,this.animated=this.nDate>1||this.nTime>1||this.nMouse>1;var u=this.fragmentString.search(/sampler2D/g);if(u)for(var a=this.fragmentString.split(`
`),l=0;l<a.length;l++){var o=a[l].match(/uniform\s*sampler2D\s*([\w]*);\s*\/\/\s*([\w|\:\/\/|\.|\-|\_]*)/i);if(o){var h=o[2].split(".").pop().toLowerCase();o[1]&&o[2]&&(h==="jpg"||h==="jpeg"||h==="png"||h==="ogv"||h==="webm"||h==="mp4")&&this.setUniform(o[1],o[2])}var f=a[l].match(/\s*void\s*main\s*/g);if(f)break}var g=b(this,this.vertexString,this.gl.VERTEX_SHADER),d=b(this,this.fragmentString,this.gl.FRAGMENT_SHADER);d?this.isValid=!0:(d=b(this,`void main(){
	gl_FragColor = vec4(1.0);
}`,this.gl.FRAGMENT_SHADER),this.isValid=!1);var E=D(this,[g,d]);this.gl.useProgram(E),this.gl.deleteShader(g),this.gl.deleteShader(d),this.program=E,this.change=!0,this.BUFFER_COUNT=0;var v=this.getBuffers(this.fragmentString);Object.keys(v).length&&this.loadPrograms(v),this.buffers=v,this.texureIndex=this.BUFFER_COUNT,this.trigger("load",{}),this.forceRender=!0,this.render()}},{key:"test",value:function(t,e,i){var r=this.vertexString,u=this.fragmentString,a=this.paused,l=this.gl.getExtension("EXT_disjoint_timer_query"),o=l.createQueryEXT(),h=this.isValid;(e||i)&&(this.load(e,i),h=this.isValid,this.forceRender=!0,this.render()),this.paused=!0,l.beginQueryEXT(l.TIME_ELAPSED_EXT,o),this.forceRender=!0,this.render(),l.endQueryEXT(l.TIME_ELAPSED_EXT);var f=this;function g(){f.paused=a,(e||i)&&f.load(u,r)}function d(){f.forceRender=!0,f.render();var E=l.getQueryObjectEXT(o,l.QUERY_RESULT_AVAILABLE_EXT),v=f.gl.getParameter(l.GPU_DISJOINT_EXT);if(E&&!v){var T={wasValid:h,frag:e||f.fragmentString,vert:i||f.vertexString,timeElapsedMs:l.getQueryObjectEXT(o,l.QUERY_RESULT_EXT)/1e6};g(),t(T)}else window.requestAnimationFrame(d)}d()}},{key:"loadTexture",value:function(t,e,i){var r=this;i||(i={}),typeof e=="string"?i.url=e:(typeof e>"u"?"undefined":A(e))==="object"&&e.data&&e.width&&e.height?(i.data=e.data,i.width=e.width,i.height=e.height):(typeof e>"u"?"undefined":A(e))==="object"&&(i.element=e),this.textures[t]?this.textures[t]&&(this.textures[t].load(i),this.textures[t].on("loaded",function(u){r.forceRender=!0})):(this.textures[t]=new L(this.gl,t,i),this.textures[t].on("loaded",function(u){r.forceRender=!0}))}},{key:"refreshUniforms",value:function(){this.uniforms={}}},{key:"setUniform",value:function(t){for(var e={},i=arguments.length,r=Array(i>1?i-1:0),u=1;u<i;u++)r[u-1]=arguments[u];e[t]=r,this.setUniforms(e)}},{key:"setUniforms",value:function(t){var e=S(t);for(var i in e)e[i].type==="sampler2D"?this.loadTexture(e[i].name,e[i].value[0]):this.uniform(e[i].method,e[i].type,e[i].name,e[i].value);this.forceRender=!0}},{key:"setMouse",value:function(t){var e=this.canvas.getBoundingClientRect();if(t&&t.x&&t.x>=e.left&&t.x<=e.right&&t.y&&t.y>=e.top&&t.y<=e.bottom){var i=(t.x-e.left)*this.realToCSSPixels,r=this.canvas.height-(t.y-e.top)*this.realToCSSPixels;this.uniform("2f","vec2","u_mouse",i,r)}}},{key:"uniform",value:function(t,e,i){this.uniforms[i]=this.uniforms[i]||{};for(var r=this.uniforms[i],u=arguments.length,a=Array(u>3?u-3:0),l=3;l<u;l++)a[l-3]=arguments[l];var o=ve(r.value,a);if(o||this.change||!r.location||!r.value){r.name=i,r.type=e,r.value=a,r.method="uniform"+t,this.gl.useProgram(this.program),r.location=this.gl.getUniformLocation(this.program,i),this.gl[r.method].apply(this.gl,[r.location].concat(r.value));for(var h in this.buffers){var f=this.buffers[h];this.gl.useProgram(f.program);var g=this.gl.getUniformLocation(f.program,i);this.gl[r.method].apply(this.gl,[g].concat(r.value))}}}},{key:"uniformTexture",value:function(t,e,i){if(this.textures[t]===void 0)this.loadTexture(t,e,i);else{this.uniform("1i","sampler2D",t,this.texureIndex);for(var r in this.buffers){var u=this.buffers[r];this.gl.useProgram(u.program),this.gl.activeTexture(this.gl.TEXTURE0+this.texureIndex),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[t].texture)}this.gl.useProgram(this.program),this.gl.activeTexture(this.gl.TEXTURE0+this.texureIndex),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[t].texture),this.uniform("2f","vec2",t+"Resolution",this.textures[t].width,this.textures[t].height)}}},{key:"resize",value:function(){if(this.width!==this.canvas.clientWidth||this.height!==this.canvas.clientHeight){this.realToCSSPixels=window.devicePixelRatio||1;var t=Math.floor(this.gl.canvas.clientWidth*this.realToCSSPixels),e=Math.floor(this.gl.canvas.clientHeight*this.realToCSSPixels);return(this.gl.canvas.width!==t||this.gl.canvas.height!==e)&&(this.gl.canvas.width=t,this.gl.canvas.height=e,this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height)),this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,this.resizeSwappableBuffers(),!0}else return!1}},{key:"render",value:function(){if(this.visible=ge(this.canvas),this.forceRender||this.change||this.animated&&this.visible&&!this.paused){var t=new Date,e=performance.now();this.timeDelta=(e-this.timePrev)/1e3,this.timePrev=e,this.nDelta>1&&this.uniform("1f","float","u_delta",this.timeDelta),this.nTime>1&&this.uniform("1f","float","u_time",(e-this.timeLoad)/1e3),this.nDate&&this.uniform("4f","float","u_date",t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()*3600+t.getMinutes()*60+t.getSeconds()+t.getMilliseconds()*.001),this.uniform("2f","vec2","u_resolution",this.canvas.width,this.canvas.height);for(var i in this.buffers){var r=this.buffers[i];this.uniform("1i","sampler2D",r.name,r.bundle.input.index)}this.texureIndex=this.BUFFER_COUNT;for(var u in this.textures)this.uniformTexture(u),this.texureIndex++;this.renderPrograms(),this.trigger("render",{}),this.change=!1,this.forceRender=!1}}},{key:"pause",value:function(){this.paused=!0}},{key:"play",value:function(){this.paused=!1}},{key:"renderPrograms",value:function(){var t=this.gl,e=t.canvas.width,i=t.canvas.height;t.viewport(0,0,e,i);for(var r in this.buffers){var u=this.buffers[r];u.bundle.render(e,i,u.program,u.name),t.bindFramebuffer(t.FRAMEBUFFER,null)}t.useProgram(this.program),t.drawArrays(t.TRIANGLES,0,6)}},{key:"getBuffers",value:function(t){var e={};return t&&t.replace(/(?:^\s*)((?:#if|#elif)(?:\s*)(defined\s*\(\s*BUFFER_)(\d+)(?:\s*\))|(?:#ifdef)(?:\s*BUFFER_)(\d+)(?:\s*))/gm,function(){var i=arguments[3]||arguments[4];e["u_buffer"+i]={fragment:"#define BUFFER_"+i+`
`+t}}),e}},{key:"loadPrograms",value:function(t){var e=this,i=this.gl,r=b(e,e.vertexString,i.VERTEX_SHADER);for(var u in t){var a=t[u],l=b(e,a.fragment,i.FRAGMENT_SHADER,1);l?e.isValid=!0:(l=b(e,`void main(){
	gl_FragColor = vec4(1.0);
}`,i.FRAGMENT_SHADER),e.isValid=!1);var o=D(e,[r,l]);a.name=u,a.program=o,a.bundle=e.createSwappableBuffer(e.canvas.width,e.canvas.height,o),i.deleteShader(l)}i.deleteShader(r)}},{key:"createSwappableBuffer",value:function(t,e,i){var r=this.createBuffer(t,e,i),u=this.createBuffer(t,e,i),a=this.gl;return{input:r,output:u,swap:function(){var o=r;r=u,u=o,this.input=r,this.output=u},render:function(o,h,f,g){a.useProgram(f),a.viewport(0,0,o,h),a.bindFramebuffer(a.FRAMEBUFFER,this.input.buffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.output.texture,0),a.drawArrays(a.TRIANGLES,0,6),this.swap()},resize:function(o,h,f,g){a.useProgram(f),a.viewport(0,0,o,h),this.input.resize(o,h),this.output.resize(o,h)}}}},{key:"createBuffer",value:function(t,e,i){var r=this.gl,u=this.BUFFER_COUNT;this.BUFFER_COUNT+=2,r.getExtension("OES_texture_float");var a=r.createTexture();r.activeTexture(r.TEXTURE0+u),r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,e,0,r.RGBA,r.FLOAT,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);var l=r.createFramebuffer();return{index:u,texture:a,buffer:l,W:t,H:e,resize:function(h,f){r.bindFramebuffer(r.FRAMEBUFFER,l);var g=Math.min(h,this.W),d=Math.min(f,this.H),E=new Float32Array(g*d*4);r.readPixels(0,0,g,d,r.RGBA,r.FLOAT,E),r.bindFramebuffer(r.FRAMEBUFFER,null);var v=u+1,T=r.createTexture();r.activeTexture(r.TEXTURE0+v),r.bindTexture(r.TEXTURE_2D,T),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,h,f,0,r.RGBA,r.FLOAT,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,g,d,r.RGBA,r.FLOAT,E);var p=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(a),r.activeTexture(r.TEXTURE0+u),r.bindTexture(r.TEXTURE_2D,T),u=this.index=u,a=this.texture=T,l=this.buffer=p,this.W=h,this.H=f}}}},{key:"resizeSwappableBuffers",value:function(){var t=this.gl,e=t.canvas.width,i=t.canvas.height;t.viewport(0,0,e,i);for(var r in this.buffers){var u=this.buffers[r];u.bundle.resize(e,i,u.program,u.name)}t.useProgram(this.program)}},{key:"version",value:function(){return"0.1.7"}}]),n}();function me(){var n=document.getElementsByClassName("glslCanvas");if(n.length>0){window.glslCanvases=[];for(var s=0;s<n.length;s++){var t=new Te(n[s]);t.isValid&&window.glslCanvases.push(t)}}}window.addEventListener("load",function(){me()});export{Te as default};
